import{r as S,j as a}from"./ui-DwAOVm1p.js";import{i as f,X as ee,u as ae,D as se,a as te,b as ne,c as re,z as ce,L as A,A as le,B as D,I as k,M as me}from"./app-BlWi7cIv.js";import{T as oe}from"./textarea-DmNeUOf1.js";import{S as ie,a as ue,b as xe,c as pe,d as H}from"./select-DV03FLtq.js";import{R as he,a as de}from"./radio-group-DtFQEo9I.js";import{C as ye}from"./checkbox-BjeNQnk5.js";import{S as je}from"./switch-DGQ2xpqa.js";import{S as ge}from"./scroll-area-BnUlm4mg.js";function be({options:u,selected:p,onChange:N,placeholder:m="Select options",className:i}){const[C,l]=S.useState(!1),[$,d]=S.useState(""),t=S.useRef(null);S.useEffect(()=>{function o(y){t.current&&!t.current.contains(y.target)&&l(!1)}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]);const q=o=>{p.includes(o)||N([...p,o]),d(""),setTimeout(()=>{var b;const y=(b=t.current)==null?void 0:b.querySelector("input");y&&y.focus()},10)},x=o=>{N(p.filter(y=>y!==o))},F=u.filter(o=>($||!p.includes(o.value))&&o.label.toLowerCase().includes($.toLowerCase()));return a.jsxs("div",{ref:t,className:`relative ${i}`,children:[a.jsxs("div",{className:"flex flex-wrap gap-1 p-2 border rounded-md min-h-[38px] cursor-text",onClick:()=>l(!0),children:[p.map(o=>{const y=u.find(b=>b.value===o);return a.jsxs(f,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[(y==null?void 0:y.label)||o,a.jsx("button",{type:"button",className:"ml-1 rounded-sm",onClick:b=>{b.stopPropagation(),x(o)},children:a.jsx(ee,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},o)}),a.jsx("input",{type:"text",value:$,onChange:o=>d(o.target.value),onFocus:()=>l(!0),placeholder:p.length===0?m:"",className:"flex-1 outline-none bg-transparent min-w-[50px]"})]}),C&&F.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-[200px] overflow-y-auto",children:F.map(o=>a.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{q(o.value),l(!0)},children:o.label},o.value))})]})}function ve({field:u,formData:p,handleChange:N}){const m=Array.isArray(p[u.name])?p[u.name]:p[u.name]?[p[u.name].toString()]:[];return a.jsx(be,{options:u.options||[],selected:m,onChange:i=>N(u.name,i),placeholder:u.placeholder||`Select ${u.label}`})}function Ae({isOpen:u,onClose:p,onSubmit:N,formConfig:m,initialData:i={},title:C,mode:l,description:$}){var M,O,P,U;const{t:d}=ae(),[t,q]=S.useState({}),[x,F]=S.useState({}),[o,y]=S.useState({}),b=()=>{if(!m.priceSummary)return 0;const e=t[m.priceSummary.quantityFieldName||"quantity"]||m.priceSummary.quantity||1;return m.priceSummary.unitPrice*e};S.useEffect(()=>{if(u){const e={...i};m.fields.forEach(c=>{c.type==="multi-select"&&e[c.name]&&!Array.isArray(e[c.name])&&(e[c.name]=Array.isArray(e[c.name])?e[c.name]:e[c.name]?[e[c.name].toString()]:[]),l==="create"&&(e[c.name]===void 0||e[c.name]===null)&&c.defaultValue!==void 0&&(e[c.name]=c.defaultValue)}),q(e||{}),F({}),m.fields.forEach(c=>{c.relation&&c.relation.endpoint&&fetch(c.relation.endpoint).then(r=>r.json()).then(r=>{y(h=>({...h,[c.name]:Array.isArray(r)?r:r.data||[]}))}).catch(r=>{})})}},[u,i,m.fields,l]);const j=(e,c)=>{q(r=>({...r,[e]:c})),x[e]&&F(r=>{const h={...r};return delete h[e],h})},R=e=>{e.preventDefault();const c={...t};m.fields.forEach(n=>{n.type==="multi-select"&&c[n.name]&&(Array.isArray(c[n.name])||(c[n.name]=[c[n.name].toString()]))}),q(c);const r={};if(m.fields.forEach(n=>{if(n.type==="file"&&l==="edit")return;const E=n.conditional?n.conditional(l,t):!0;if(n.required&&E&&!t[n.name]&&(r[n.name]=`${n.label} is required`),n.type==="file"&&t[n.name]&&n.fileValidation){const v=t[n.name];if(n.fileValidation.maxSize&&v.size>n.fileValidation.maxSize){const g=n.fileValidation.maxSize/1048576;r[n.name]=`File size must be less than ${g}MB`}if(n.fileValidation.mimeTypes&&n.fileValidation.mimeTypes.length>0&&(n.fileValidation.mimeTypes.includes(v.type)||(r[n.name]=`File type must be one of: ${n.fileValidation.mimeTypes.join(", ")}`)),n.fileValidation.extensions&&n.fileValidation.extensions.length>0){const g=v.name,w=g.substring(g.lastIndexOf(".")).toLowerCase();n.fileValidation.extensions.includes(w)||(r[n.name]=`File extension must be one of: ${n.fileValidation.extensions.join(", ")}`)}}}),Object.keys(r).length>0){F(r);return}const h={...t};m.fields.forEach(n=>{n.type==="multi-select"&&h[n.name]&&(Array.isArray(h[n.name])||(h[n.name]=[h[n.name].toString()]))}),N(h)},I=e=>{var c,r,h,n,E;if(e.conditional&&!e.conditional(l,t))return null;if(e.render)return e.render(e,t,j);if(l==="view"){if(e.type==="multi-select"){const g=(Array.isArray(t[e.name])?t[e.name]:[]).map(w=>{var z;const V=(z=e.options)==null?void 0:z.find(T=>T.value===w);return V?V.label:w}).join(", ");return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:g||"-"})}return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:e.type==="select"&&e.options?((c=e.options.find(v=>v.value===String(t[e.name])))==null?void 0:c.label)||t[e.name]||"-":t[e.name]||"-"})}switch(e.type){case"text":case"email":case"password":case"time":return a.jsx(k,{id:e.name,name:e.name,type:e.type,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"date":const v=t[e.name]?t[e.name]instanceof Date?t[e.name].toISOString().split("T")[0]:typeof t[e.name]=="string"&&t[e.name].includes("T")?t[e.name].split("T")[0]:t[e.name]:"";return a.jsx(k,{id:e.name,name:e.name,type:"date",placeholder:e.placeholder,value:v,onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"number":return a.jsx(k,{id:e.name,name:e.name,type:"number",placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value?parseFloat(s.target.value):""),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"textarea":return a.jsx(oe,{id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"select":const g=e.relation?o[e.name]||[]:e.options||[],w=String(t[e.name]||""),V=e.relation?g.find(s=>String(s[e.relation.valueField])===w):g.find(s=>String(s.value)===w),z=V?e.relation?V[e.relation.labelField]:V.label:"";return a.jsxs(ie,{value:w,onValueChange:s=>j(e.name,s),disabled:l==="view",children:[a.jsx(ue,{className:x[e.name]?"border-red-500":"",children:a.jsx(xe,{placeholder:e.placeholder||`Select ${e.label}`,children:z||e.placeholder||`Select ${e.label}`})}),a.jsx(pe,{className:"z-[60000]",children:e.relation?g.map(s=>a.jsx(H,{value:String(s[e.relation.valueField]),children:s[e.relation.labelField]},s[e.relation.valueField])):g.map(s=>a.jsx(H,{value:String(s.value),children:s.label},s.value))})]});case"radio":return a.jsx(he,{value:t[e.name]||"",onValueChange:s=>j(e.name,s),disabled:l==="view",className:"flex gap-4",children:(r=e.options)==null?void 0:r.map(s=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(de,{value:s.value,id:`${e.name}-${s.value}`}),a.jsx(A,{htmlFor:`${e.name}-${s.value}`,children:s.label})]},s.value))});case"checkbox":return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ye,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:l==="view"}),a.jsx(A,{htmlFor:e.name,children:e.placeholder||e.label})]});case"switch":return a.jsx(je,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:l==="view"});case"multi-select":return a.jsx(ve,{field:e,formData:t,handleChange:j});case"media-picker":let T=t[e.name]||"";!T&&l==="edit"&&i[e.name]&&(T=i[e.name]);const Y=s=>{var W,G,_;return!s||s.startsWith("http")?s:s.startsWith("/storage/")?`${((W=window.appSettings)==null?void 0:W.baseUrl)||""}${s}`:s.startsWith("/")?`${((G=window.appSettings)==null?void 0:G.baseUrl)||""}${s}`:s.startsWith("/")?`${((_=window.appSettings)==null?void 0:_.baseUrl)||""}${s}`:s};return a.jsx(me,{value:Y(T),onChange:s=>j(e.name,s),placeholder:e.placeholder||`Select ${e.label}`,showPreview:!0});case"file":const B=((h=e.fileValidation)==null?void 0:h.accept)||"",Z=B.includes("image")||(((E=(n=e.fileValidation)==null?void 0:n.mimeTypes)==null?void 0:E.some(s=>s.startsWith("image/")))??!1);return a.jsxs(a.Fragment,{children:[a.jsx(k,{id:e.name,name:e.name,type:"file",accept:B,onChange:s=>{s.target.files&&s.target.files[0]&&j(e.name,s.target.files[0])},className:x[e.name]?"border-red-500":"",disabled:l==="view"}),l==="edit"&&i[e.name]&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current file: ",i.featured_image_original_name||i[e.name]]}),e.fileValidation&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.fileValidation.extensions&&a.jsxs("span",{children:[d("Allowed extensions"),": ",e.fileValidation.extensions.join(", ")," "]}),e.fileValidation.maxSize&&a.jsxs("span",{children:[d("Max size"),": ",(e.fileValidation.maxSize/(1024*1024)).toFixed(1),"MB"]})]}),Z&&a.jsx("div",{className:"mt-2",children:t[e.name]&&t[e.name]instanceof File?a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Preview"),":"]}),a.jsx("img",{src:URL.createObjectURL(t[e.name]),alt:"Preview",className:"h-24 w-auto rounded-md object-cover shadow-sm"})]}):l==="edit"&&i[e.name]&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Current image"),":"]}),a.jsx("img",{src:typeof i[e.name]=="string"&&i[e.name].startsWith&&i[e.name].startsWith("http")?i[e.name]:`/storage/${i[e.name]}`,alt:"Current",className:"h-24 w-auto rounded-md object-cover shadow-sm",onError:s=>{s.currentTarget.src="https://placehold.co/200x150?text=Image+Not+Found"}})]})})]});default:return null}},Q=()=>{const e={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl","3xl":"sm:max-w-3xl","4xl":"sm:max-w-4xl","5xl":"sm:max-w-5xl",full:"sm:max-w-full"};return m.modalSize?e[m.modalSize]:"sm:max-w-md"},X=()=>{const e={};return m.fields.forEach(c=>{const r=c.row||0;e[r]||(e[r]=[]),e[r].push(c)}),Object.entries(e).sort(([c],[r])=>parseInt(c)-parseInt(r))},L=m.layout||"default",J=m.columns||1,K=`crud-modal-${l}-${C.replace(/\s+/g,"-").toLowerCase()}-${Date.now()}`;return a.jsx(se,{open:u,onOpenChange:p,children:a.jsxs(te,{className:`${Q()} max-h-[90vh]`,modalId:K,children:[a.jsxs(ne,{children:[a.jsx(re,{children:C}),a.jsx(ce,{children:$||" "})]}),a.jsx(ge,{className:"max-h-[70vh] pr-4",children:a.jsxs("form",{onSubmit:R,className:"space-y-4",children:[m.priceSummary&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Unit Price"),":"]}),a.jsxs("span",{className:"font-medium",children:[((O=(M=window==null?void 0:window.appSettings)==null?void 0:M.currencySettings)==null?void 0:O.currencySymbol)||"$",m.priceSummary.unitPrice.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Quantity"),":"]}),a.jsx("span",{className:"font-medium",children:t[m.priceSummary.quantityFieldName||"quantity"]||m.priceSummary.quantity||1})]}),a.jsx("div",{className:"border-t pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold",children:[d("Total Price"),":"]}),a.jsxs("span",{className:"font-bold text-lg text-primary",children:[((U=(P=window==null?void 0:window.appSettings)==null?void 0:P.currencySettings)==null?void 0:U.currencySymbol)||"$",b().toFixed(2)]})]})})]}),L==="grid"?a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${J}, 1fr)`,gap:"1rem"},children:m.fields.map(e=>e.conditional&&!e.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{gridColumn:e.colSpan?`span ${e.colSpan}`:"span 1",width:"100%"},children:[a.jsxs(A,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):L==="flex"?a.jsx("div",{className:"flex flex-wrap gap-4",children:m.fields.map(e=>e.conditional&&!e.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:e.width||"100%",flexGrow:e.width?0:1},children:[a.jsxs(A,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):X().map(([e,c])=>a.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:c.map(r=>r.conditional&&!r.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:r.width||"100%"},children:[a.jsxs(A,{htmlFor:r.name,className:"text-sm font-medium",children:[r.label," ",r.required&&!(r.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),I(r),x[r.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[r.name]})]},r.name))},e))]})}),a.jsxs(le,{className:"sm:justify-end",children:[a.jsx(D,{type:"button",variant:"outline",onClick:p,children:d("Cancel")}),l!=="view"&&a.jsx(D,{type:"button",onClick:R,children:d("Save")})]})]})})}export{Ae as C};
