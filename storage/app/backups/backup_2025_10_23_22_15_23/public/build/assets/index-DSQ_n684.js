import{r as c,j as e}from"./ui-DwAOVm1p.js";import{P as Je}from"./page-template-8tWNB1WX.js";import{u as Y,L as S,I as $,B as D,t as l,S as B,C as me,g as ue,m as We,D as Ee,a as Ae,b as Oe,c as Me,i as Xe,K as Ye,w as te,x as ae,y as re,z as Ge,P as Ke}from"./app-BlWi7cIv.js";import{P as Qe}from"./pagination-DWltl4Dr.js";import{S as es}from"./search-and-filter-bar-CqATafAe.js";import{S as xe,a as fe,b as je,c as ge,d as X}from"./select-DV03FLtq.js";import{S as ss}from"./switch-DGQ2xpqa.js";import{T as ts}from"./textarea-DmNeUOf1.js";import{C as as}from"./CrudFormModal-CeTBceJ8.js";import{C as rs}from"./CrudDeleteModal-D-6F4-pE.js";import{l as ns,E as is,u as ls,a as ds,C as ke}from"./react-stripe.esm-RpGt8_k_.js";import{L as ye}from"./loader-circle-DUfirWOF.js";import{C as cs}from"./copy-Btm1-TBN.js";import{C as os}from"./circle-check-big-CMY9b2ai.js";import{C as ms}from"./calendar-Jlwl64Lp.js";import{T as us}from"./tag-uteW8j4-.js";import{E as ps}from"./eye-BE9GWtQY.js";import{C as hs}from"./chart-column-CrjmBQBc.js";import{S as xs}from"./square-pen-WpJU-exV.js";import{T as Fe}from"./trash-2-BFqA1Oig.js";import{C as De}from"./credit-card-CWCbalqR.js";import{B as Te}from"./banknote-CYzFy0mg.js";import"./vendor-CxtKjBZA.js";import"./react-country-flag.esm-U4UQv2PH.js";import"./language-DYlIyiUn.js";import"./sparkles-tvpsAjMk.js";import"./chevron-up-DMuWaAmJ.js";import"./chevron-right-CTYpggVz.js";import"./cookie-consent-BF1mYY4f.js";import"./globe-kYq37WGi.js";import"./briefcase-AuRykhaE.js";import"./dollar-sign-B5K61QeY.js";import"./mail-B928cX0J.js";import"./settings-CXB8R1cS.js";import"./users-WU9ta9Er.js";import"./message-square-BEKBBgPS.js";import"./wallet-z8Vgl1na.js";import"./user-D7_XmPgu.js";import"./use-favicon-BHKlxAc6.js";import"./utils-DBYZG17H.js";import"./date-picker-DFYTG7KS.js";import"./filter-CDRTUPM0.js";import"./list-FKUY8uRs.js";import"./index-upgrZYbo.js";import"./radio-group-DtFQEo9I.js";import"./circle-BwHibmlx.js";import"./checkbox-BjeNQnk5.js";import"./scroll-area-BnUlm4mg.js";const fs=({campaignData:t,onSuccess:_,onCancel:m})=>{const{t:i}=Y(),r=ls(),p=ds(),[f,w]=c.useState(!1),[n,u]=c.useState(""),x=async j=>{if(j.preventDefault(),!r||!p)return;w(!0);const C=p.getElement(ke);if(!C){w(!1);return}const{error:v,paymentMethod:z}=await r.createPaymentMethod({type:"card",card:C,billing_details:{name:n}});if(v){l.error(v.message||i("Payment failed")),w(!1);return}B.post(route("campaigns.stripe.payment"),{payment_method_id:z.id,campaign_data:t,coupon_code:t.coupon_code||"",cardholder_name:n},{onSuccess:()=>{l.success(i("Campaign created and payment processed successfully")),_()},onError:g=>{const V=(g==null?void 0:g.message)||(g==null?void 0:g.error)||i("Payment failed");l.error(V)},onFinish:()=>{w(!1)}})},P={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}};return e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"cardholder-name",children:i("Name on card")}),e.jsx($,{id:"cardholder-name",type:"text",value:n,onChange:j=>u(j.target.value),placeholder:i("Enter cardholder name"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:i("Card details")}),e.jsx("div",{className:"p-3 border rounded-md",children:e.jsx(ke,{options:P})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:m,disabled:f,className:"flex-1",children:i("Cancel")}),e.jsx(D,{type:"submit",disabled:!r||f,className:"flex-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2 animate-spin"}),i("Processing...")]}):i("Pay ${amount}",{amount:(Number(t.final_amount)||0).toFixed(2)})})]})]})};function js({campaignData:t,stripeKey:_,onSuccess:m,onCancel:i}){const{t:r}=Y(),[p,f]=c.useState(null);return c.useEffect(()=>{_&&_.startsWith("pk_")&&f(ns(_))},[_]),p?e.jsx(is,{stripe:p,children:e.jsx(fs,{campaignData:t,onSuccess:m,onCancel:i})}):e.jsx("div",{className:"p-4 text-center text-red-500",children:r("Stripe not configured properly")})}function gs({campaignData:t,paypalClientId:_,currency:m,onSuccess:i,onCancel:r}){const{t:p}=Y(),f=c.useRef(null);return c.useEffect(()=>{if(!_||!f.current)return;const w=document.createElement("script");return w.src=`https://www.paypal.com/sdk/js?client-id=${_}&currency=${m.toUpperCase()}&disable-funding=credit,card`,w.async=!0,w.onload=()=>{window.paypal&&f.current&&window.paypal.Buttons({createOrder:(n,u)=>{var x,P;return u.order.create({purchase_units:[{amount:{value:((x=t.final_amount)==null?void 0:x.toString())||((P=t.total_amount)==null?void 0:P.toString())||"0",currency_code:m.toUpperCase()},description:`Campaign: ${t.name}`}]})},onApprove:(n,u)=>u.order.capture().then(x=>{B.post(route("campaigns.paypal.payment"),{order_id:n.orderID,payment_id:x.id,campaign_data:t,coupon_code:t.coupon_code||""},{onSuccess:()=>{l.success(p("Campaign created and payment processed successfully")),i()},onError:()=>{l.error(p("Payment failed"))}})}),onError:n=>{console.error("PayPal error:",n),n.message&&n.message.includes("declined")?l.error(p("Card was declined. Please try a different payment method.")):l.error(p("Payment failed. Please try again."))},onCancel:()=>{r()}}).render(f.current)},document.head.appendChild(w),()=>{document.head.contains(w)&&document.head.removeChild(w)}},[_,t,m]),_?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{ref:f})}):e.jsx("div",{className:"p-4 text-center text-red-500",children:p("PayPal not configured")})}function ys({campaignData:t,bankDetails:_,onSuccess:m,onCancel:i}){const{t:r}=Y(),[p,f]=c.useState(!1),w=x=>{(j=>{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(j);{const C=document.createElement("textarea");return C.value=j,C.style.position="fixed",C.style.left="-999999px",C.style.top="-999999px",document.body.appendChild(C),C.focus(),C.select(),new Promise((v,z)=>{document.execCommand("copy")?(C.remove(),v()):(C.remove(),z(new Error("Copy failed")))})}})(x).then(()=>{l.success(r("Amount copied to clipboard"))}).catch(()=>{l.error(r("Failed to copy amount"))})},n=()=>{f(!0),B.post(route("campaigns.bank.payment"),{campaign_data:t,coupon_code:t.coupon_code||"",amount:t.final_amount||t.total_amount},{onSuccess:()=>{l.success(r("Campaign created. Payment verification pending.")),m()},onError:()=>{l.error(r("Failed to submit payment request"))},onFinish:()=>{f(!1)}})},u=t.final_amount||t.total_amount||0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{children:e.jsxs(ue,{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:r("Bank Transfer Details")}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("div",{className:"whitespace-pre-line",children:_}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:e.jsxs("span",{className:"font-medium",children:[r("Campaign"),": ",t.name]})}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"font-medium",children:[r("Amount"),": ",window.appSettings.formatCurrency(u)]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>w(window.appSettings.formatCurrency(u)),children:[e.jsx(cs,{className:"h-3 w-3 mr-1"}),r("Copy")]})]})]})]})]})}),e.jsx(me,{className:"border-orange-200 bg-orange-50",children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-orange-800",children:[e.jsx("p",{className:"font-medium mb-1",children:r("Important Instructions")}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsxs("li",{children:["• ",r("Transfer the exact amount shown above")]}),e.jsxs("li",{children:["• ",r("Include the campaign name in the transfer description")]}),e.jsxs("li",{children:["• ",r("Your campaign will be activated after payment verification")]}),e.jsxs("li",{children:["• ",r("Verification may take 1-3 business days")]})]})]})]})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:i,className:"flex-1",children:r("Cancel")}),e.jsx(D,{onClick:n,disabled:p,className:"flex-1",children:r(p?"Processing...":"I have made the payment")})]})]})}function _s({isOpen:t,onClose:_,campaignData:m,paymentMethods:i,paymentSettings:r={},campaignSettings:p=null,categories:f=[],businesses:w=[]}){var I,he;const{t:n}=Y(),[u,x]=c.useState(""),[P,j]=c.useState(""),[C,v]=c.useState(!1),[z,g]=c.useState(!1),[V,T]=c.useState(!1),[R,k]=c.useState(0),[G,ne]=c.useState(0),[q,K]=c.useState(0),[O,ie]=c.useState(0),[h,H]=c.useState(null),[Q,pe]=c.useState(!1),{data:F,setData:y,post:le,processing:U}=We({name:"",description:"",business_id:"",start_date:"",end_date:"",payment_method:"",coupon_code:""}),de=o=>{if(!(p!=null&&p.pricing_tiers)||p.pricing_tiers.length===0)return 10;for(const A of p.pricing_tiers)if(o>=A.min_days&&o<=A.max_days)return parseFloat(A.per_day_price);const E=p.pricing_tiers[p.pricing_tiers.length-1];return parseFloat((E==null?void 0:E.per_day_price)||10)};c.useEffect(()=>{if(F.start_date&&F.end_date){const o=new Date(F.start_date),E=new Date(F.end_date);if(E<o){ne(0),K(0),ie(0);return}const A=E.getTime()-o.getTime(),Z=Math.ceil(A/(1e3*60*60*24))+1,ce=de(Z),J=Z*ce;ne(Z),K(J),ie(Math.max(0,J-R))}},[F.start_date,F.end_date,R,p]);const _e=async()=>{var o;if(!P.trim()){l.error(n("Please enter a coupon code"));return}pe(!0);try{const E=await fetch(route("coupons.validate"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({coupon_code:P,amount:q})}),A=await E.json();if(E.ok&&A.valid){const Z=A.coupon.type==="percentage"?q*A.coupon.value/100:A.coupon.value;k(Math.min(Z,q)),H(A.coupon),l.success(n("Coupon applied successfully"))}else l.error(A.message||n("Invalid coupon code")),k(0),H(null)}catch{l.error(n("Failed to validate coupon")),k(0),H(null)}finally{pe(!1)}},ve=()=>{H(null),j(""),k(0)},ee=()=>{if(!u){l.error(n("Please select a payment method"));return}if(u==="stripe"){v(!0);return}if(u==="paypal"){g(!0);return}if(u==="bank"){T(!0);return}const o={...F,payment_method:u,coupon_code:(h==null?void 0:h.code)||P,final_amount:O};le(route("campaigns.store"),o,{onSuccess:()=>{l.success(n("Campaign created successfully")),_()},onError:E=>{l.error(n("Failed to create campaign: {{error}}",{error:Object.values(E).join(", ")}))}})},L=()=>{l.success(n("Campaign created and payment processed successfully")),_()},N=i.filter(o=>o.enabled);return e.jsx(Ee,{open:t,onOpenChange:_,children:e.jsxs(Ae,{className:"max-w-lg max-h-[90vh] flex flex-col",children:[e.jsx(Oe,{className:"flex-shrink-0",children:e.jsx(Me,{children:n("Complete Campaign Payment")})}),e.jsxs("div",{className:"space-y-6 overflow-y-auto flex-1 pr-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"name",children:n("Campaign Name")}),e.jsx($,{id:"name",value:F.name,onChange:o=>y("name",o.target.value),placeholder:n("Enter campaign name"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"description",children:n("Description")}),e.jsx($,{id:"description",value:F.description,onChange:o=>y("description",o.target.value),placeholder:n("Enter description (optional)")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"business",children:n("Business")}),e.jsxs("select",{id:"business",value:F.business_id,onChange:o=>y("business_id",o.target.value),className:"w-full p-2 border rounded-md",required:!0,children:[e.jsx("option",{value:"",children:n("Select Business")}),w.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"start_date",children:n("Start Date")}),e.jsx($,{id:"start_date",type:"date",value:F.start_date,onChange:o=>y("start_date",o.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"end_date",children:n("End Date")}),e.jsx($,{id:"end_date",type:"date",value:F.end_date,onChange:o=>y("end_date",o.target.value),required:!0})]})]})]}),G>0&&e.jsx(me,{children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:n("Campaign Summary")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[G," ",n("days")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:window.appSettings.formatCurrency(q)})})]}),R>0&&e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:n("Subtotal")}),e.jsx("span",{children:window.appSettings.formatCurrency(q)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:n("Discount")}),e.jsxs("span",{children:["-",window.appSettings.formatCurrency(R)]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t pt-2",children:[e.jsx("span",{children:n("Total")}),e.jsx("span",{children:window.appSettings.formatCurrency(O)})]})]})]})})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(S,{htmlFor:"coupon",children:[n("Coupon Code")," (",n("Optional"),")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{id:"coupon",value:P,onChange:o=>j(o.target.value),placeholder:n("Enter coupon code"),className:"pr-10",disabled:!!h}),e.jsx(us,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),h?e.jsx(D,{type:"button",variant:"outline",onClick:ve,children:n("Remove")}):e.jsx(D,{type:"button",variant:"outline",onClick:_e,disabled:!P.trim()||Q,children:Q?e.jsx(ye,{className:"h-4 w-4 animate-spin"}):n("Apply")})]}),h&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-green-700 font-medium",children:[n("Coupon Applied"),": ",h.code]}),e.jsxs("span",{className:"text-green-600",children:["-",h.type==="percentage"?`${h.value}%`:`${((he=(I=window==null?void 0:window.appSettings)==null?void 0:I.currencySettings)==null?void 0:he.currencySymbol)||"$"}${h.value}`]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{children:n("Select Payment Method")}),N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:n("No payment methods available")}):e.jsx("div",{className:"space-y-2",children:N.map(o=>e.jsx(me,{className:`cursor-pointer transition-colors ${u===o.id?"border-primary bg-primary/5":"hover:border-gray-300"}`,onClick:()=>x(o.id),children:e.jsx(ue,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-primary",children:o.icon}),e.jsx("span",{className:"font-medium",children:o.name}),u===o.id&&e.jsx(Xe,{variant:"secondary",className:"ml-auto",children:n("Selected")})]})})},o.id))})]}),C&&u==="stripe"&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:n("Enter Card Details")}),e.jsx(js,{campaignData:{...F,coupon_code:(h==null?void 0:h.code)||P,final_amount:O},stripeKey:(r==null?void 0:r.stripe_key)||"",onSuccess:L,onCancel:()=>v(!1)})]}),z&&u==="paypal"&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:n("PayPal Payment")}),e.jsx(gs,{campaignData:{...F,coupon_code:(h==null?void 0:h.code)||P,final_amount:O},paypalClientId:(r==null?void 0:r.paypal_client_id)||"",currency:(r==null?void 0:r.default_currency)||"usd",onSuccess:L,onCancel:()=>g(!1)})]}),V&&u==="bank"&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"font-medium mb-4",children:n("Bank Transfer")}),e.jsx(ys,{campaignData:{...F,coupon_code:(h==null?void 0:h.code)||P,final_amount:O},bankDetails:(r==null?void 0:r.bank_details)||"",onSuccess:L,onCancel:()=>T(!1)})]}),!C&&!z&&!V&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:_,className:"flex-1",children:n("Cancel")}),e.jsx(D,{onClick:ee,disabled:U||N.length===0,className:"flex-1",children:U?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2 animate-spin"}),n("Processing...")]}):`${n("Pay")} ${window.appSettings.formatCurrency(O)}`})]})]})]})})}function xt(){var Ne,be,Ce,Se,we,Pe;const{t}=Y(),{auth:_,campaigns:m,filters:i={},isAdmin:r=!1,users:p=[],businesses:f=[],paymentMethods:w=[],paymentSettings:n={},campaignSettings:u=null}=Ye().props,[x,P]=c.useState(i.search||""),[j,C]=c.useState(i.user_id||"all"),[v,z]=c.useState(i.business_id||"all"),[g,V]=c.useState(i.status||"all"),[T,R]=c.useState(i.start_date?new Date(i.start_date):void 0),[k,G]=c.useState(i.end_date?new Date(i.end_date):void 0),[ne,q]=c.useState(!1),[K,O]=c.useState(!1),[ie,h]=c.useState(!1),[H,Q]=c.useState(!1),[pe,F]=c.useState(!1),[y,le]=c.useState(null),[U,de]=c.useState("create"),[_e,ve]=c.useState(null),[ee,L]=c.useState(""),[N,I]=c.useState({name:"",description:"",business_id:"",start_date:"",end_date:"",total_days:0,total_cost:0,coupon_code:"",payment_method:"credit_card"}),[he,o]=c.useState({}),E=c.useMemo(()=>!r||!ee?f:f.filter(a=>{var d;return((d=a.created_by)==null?void 0:d.toString())===ee.toString()}),[f,ee,r]),A=s=>{if(!(u!=null&&u.pricing_tiers)||u.pricing_tiers.length===0)return 10;for(const d of u.pricing_tiers)if(s>=d.min_days&&s<=d.max_days)return parseFloat(d.per_day_price);const a=u.pricing_tiers[u.pricing_tiers.length-1];return parseFloat((a==null?void 0:a.per_day_price)||10)};c.useEffect(()=>{if(N.start_date&&N.end_date){const s=new Date(N.start_date),a=new Date(N.end_date),d=Math.abs(a.getTime()-s.getTime()),b=Math.ceil(d/(1e3*60*60*24))+1,M=A(b),oe=b*M;I(He=>({...He,total_days:b,total_cost:oe}))}},[N.start_date,N.end_date,u]);const Z=s=>{s.preventDefault(),ce()},ce=()=>{const s={page:1};x&&(s.search=x),j!=="all"&&(s.user_id=j),v!=="all"&&(s.business_id=v),g!=="all"&&(s.status=g),T&&(s.start_date=T.toISOString().split("T")[0]),k&&(s.end_date=k.toISOString().split("T")[0]),i.per_page&&(s.per_page=i.per_page),B.get(route("campaigns.index"),s,{preserveState:!0,preserveScroll:!0})},J=(s,a)=>{const d={page:1};switch(x&&(d.search=x),s){case"user_id":C(a),a!=="all"&&(d.user_id=a);break;case"business_id":z(a),a!=="all"&&(d.business_id=a);break;case"status":V(a),a!=="all"&&(d.status=a);break}j!=="all"&&s!=="user_id"&&(d.user_id=j),v!=="all"&&s!=="business_id"&&(d.business_id=v),g!=="all"&&s!=="status"&&(d.status=g),T&&(d.start_date=T.toISOString().split("T")[0]),k&&(d.end_date=k.toISOString().split("T")[0]),i.per_page&&(d.per_page=i.per_page),B.get(route("campaigns.index"),d,{preserveState:!0,preserveScroll:!0})},se=s=>{const a=i.sort_field===s&&i.sort_direction==="asc"?"desc":"asc",d={sort_field:s,sort_direction:a,page:1};x&&(d.search=x),j!=="all"&&(d.user_id=j),v!=="all"&&(d.business_id=v),g!=="all"&&(d.status=g),T&&(d.start_date=T.toISOString().split("T")[0]),k&&(d.end_date=k.toISOString().split("T")[0]),i.per_page&&(d.per_page=i.per_page),B.get(route("campaigns.index"),d,{preserveState:!0,preserveScroll:!0})},W=(s,a)=>{var d;switch(le(a),s){case"edit":de("edit"),L(((d=a.user_id)==null?void 0:d.toString())||""),O(!0);break;case"delete":h(!0);break;case"toggle-status":ze(a);break;case"preview":if(a.business){const b=a.business;if(b.custom_domain&&!/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(b.custom_domain)){l.error(t("Invalid business domain"));return}const M=b.custom_domain?`https://${b.custom_domain}`:b.url_prefix&&b.url_prefix!==""?route("public.vcard.show",{prefix:b.url_prefix,slug:b.slug},!0):route("public.vcard.show.direct",b.slug,!0);window.open(M,"_blank","noopener,noreferrer")}else l.error(t("Business information not available"));break;case"analytics":window.location.href=route("campaigns.analytics",a.id);break}},Be=()=>{le(null),de("create"),L(""),O(!0)},Ie=s=>{const a={name:s.name,description:s.description,business_id:s.business_id,start_date:s.start_date,end_date:s.end_date,payment_method:s.payment_method,status:r?s.status:"pending",is_active:r&&s.is_active!==void 0?s.is_active:!0};r&&s.user_id&&(a.user_id=s.user_id),U==="create"?(l.loading(t("Creating campaign...")),B.post(route("campaigns.store"),a,{onSuccess:()=>{O(!1),l.dismiss(),l.success(t("Campaign created successfully"))},onError:d=>{l.dismiss(),l.error(`Failed to create campaign: ${Object.values(d).join(", ")}`)}})):U==="edit"&&(l.loading(t("Updating campaign...")),B.put(route("campaigns.update",y.id),a,{onSuccess:()=>{O(!1),l.dismiss(),l.success(t("Campaign updated successfully"))},onError:d=>{l.dismiss(),l.error(`Failed to update campaign: ${Object.values(d).join(", ")}`)}}))},$e=()=>{l.loading(t("Deleting campaign...")),B.delete(route("campaigns.destroy",y.id),{onSuccess:()=>{h(!1),l.dismiss(),l.success(t("Campaign deleted successfully"))},onError:s=>{l.dismiss(),l.error(`Failed to delete campaign: ${Object.values(s).join(", ")}`)}})},ze=s=>{l.loading(t("Updating status...")),B.put(route("campaigns.toggle-status",s.id),{},{onSuccess:()=>{l.dismiss(),l.success(t("Status updated successfully"))},onError:a=>{l.dismiss(),l.error(`Failed to update status: ${Object.values(a).join(", ")}`)}})},qe=()=>j!=="all"||v!=="all"||g!=="all"||x!==""||T!==void 0||k!==void 0,Ue=()=>(j!=="all"?1:0)+(v!=="all"?1:0)+(g!=="all"?1:0)+(x?1:0)+(T?1:0)+(k?1:0),Le=()=>{C("all"),z("all"),V("all"),P(""),R(void 0),G(void 0),q(!1),B.get(route("campaigns.index"),{page:1,per_page:i.per_page},{preserveState:!0,preserveScroll:!0})},Ve=[{label:"Create Campaign",icon:e.jsx(Ke,{className:"h-4 w-4 mr-2"}),variant:"default",onClick:()=>Be()}],Re=[{title:t("Dashboard"),href:route("dashboard")},{title:t("Campaigns")}],Ze=s=>{const a={pending:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a[s]||"bg-gray-100 text-gray-800"}`,children:s.charAt(0).toUpperCase()+s.slice(1)})};return e.jsxs(Je,{title:t("Campaigns Management"),url:"/campaigns",actions:Ve,breadcrumbs:Re,noPadding:!0,children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:e.jsx(es,{searchTerm:x,onSearchChange:P,onSearch:Z,filters:[...r?[{name:"user_id",label:t("User"),type:"select",value:j,onChange:s=>J("user_id",s),options:[{value:"all",label:t("All Users")},...p.map(s=>({value:s.id.toString(),label:s.name}))]}]:[],{name:"business_id",label:t("Business"),type:"select",value:v,onChange:s=>J("business_id",s),options:[{value:"all",label:t("All Businesses")},...f.map(s=>({value:s.id.toString(),label:s.name}))]},{name:"status",label:t("Status"),type:"select",value:g,onChange:s=>J("status",s),options:[{value:"all",label:t("All Status")},{value:"pending",label:t("Pending")},{value:"active",label:t("Active")},{value:"completed",label:t("Completed")},{value:"cancelled",label:t("Cancelled")}]},{name:"start_date",label:t("Start Date"),type:"date",value:T,onChange:s=>R(s)},{name:"end_date",label:t("End Date"),type:"date",value:k,onChange:s=>G(s)}],showFilters:ne,setShowFilters:q,hasActiveFilters:qe,activeFilterCount:Ue,onResetFilters:Le,onApplyFilters:ce,currentPerPage:((Ne=i.per_page)==null?void 0:Ne.toString())||"10",onPerPageChange:s=>{const a={page:1,per_page:parseInt(s)};x&&(a.search=x),j!=="all"&&(a.user_id=j),v!=="all"&&(a.business_id=v),g!=="all"&&(a.status=g),T&&(a.start_date=T.toISOString().split("T")[0]),k&&(a.end_date=k.toISOString().split("T")[0]),B.get(route("campaigns.index"),a,{preserveState:!0,preserveScroll:!0})}})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 cursor-pointer",onClick:()=>se("name"),children:e.jsxs("div",{className:"flex items-center",children:[t("Name"),i.sort_field==="name"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="asc"?"↑":"↓"})]})}),r&&e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 cursor-pointer",onClick:()=>se("user.name"),children:e.jsxs("div",{className:"flex items-center",children:[t("User Name"),i.sort_field==="user.name"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:t("Business Name")}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 cursor-pointer",onClick:()=>se("start_date"),children:e.jsxs("div",{className:"flex items-center",children:[t("Start Date"),i.sort_field==="start_date"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 cursor-pointer",onClick:()=>se("end_date"),children:e.jsxs("div",{className:"flex items-center",children:[t("End Date"),i.sort_field==="end_date"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:t("Total Days")}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 cursor-pointer",onClick:()=>se("total_amount"),children:e.jsxs("div",{className:"flex items-center",children:[t("Total Amount"),i.sort_field==="total_amount"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:t("Payment Method")}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:t("Status")}),r&&e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:t("Active")}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-500",children:t("Actions")})]})}),e.jsxs("tbody",{children:[(be=m==null?void 0:m.data)==null?void 0:be.map(s=>{var a,d,b,M,oe;return e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.description})]}),r&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"font-medium",children:(a=s.user)==null?void 0:a.name})}),e.jsx("td",{className:"px-4 py-3",children:(d=s.business)==null?void 0:d.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center",children:(b=window.appSettings)!=null&&b.formatDateTime?window.appSettings.formatDateTime(s.start_date,!1):new Date(s.start_date).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center",children:(M=window.appSettings)!=null&&M.formatDateTime?window.appSettings.formatDateTime(s.end_date,!1):new Date(s.end_date).toLocaleDateString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-medium",children:[s.total_days," days"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"font-medium",children:((oe=window.appSettings)==null?void 0:oe.formatCurrency(s.total_amount))||`$${parseFloat(s.total_amount).toFixed(2)}`})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"capitalize",children:s.payment_method==="stripe"?"Credit Card":s.payment_method==="paypal"?"PayPal":s.payment_method==="bank"?"Bank Transfer":s.payment_method.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-3",children:Ze(s.status)}),r&&e.jsx("td",{className:"px-4 py-3",children:e.jsx(ss,{checked:s.is_active,onCheckedChange:()=>W("toggle-status",s),size:"sm"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[r&&e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>W("preview",s),className:"text-blue-500 hover:text-blue-700",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsx(re,{children:t("Preview")})]}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>W("analytics",s),className:"text-green-500 hover:text-green-700",children:e.jsx(hs,{className:"h-4 w-4"})})}),e.jsx(re,{children:t("Analytics")})]}),r&&e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>W("edit",s),className:"text-amber-500 hover:text-amber-700",children:e.jsx(xs,{className:"h-4 w-4"})})}),e.jsx(re,{children:t("Edit")})]}),!r&&s.status==="pending"&&e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>W("delete",s),children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(re,{children:t("Delete")})]}),r&&e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>W("delete",s),children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(re,{children:t("Delete")})]})]})})]},s.id)}),(!(m!=null&&m.data)||m.data.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:r?12:10,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:t("No campaigns found")})})]})]})}),(m==null?void 0:m.links)&&e.jsx(Qe,{from:(m==null?void 0:m.from)||0,to:(m==null?void 0:m.to)||0,total:(m==null?void 0:m.total)||0,links:m==null?void 0:m.links,entityName:t("campaigns"),onPageChange:s=>B.get(s)})]}),r?e.jsx(as,{isOpen:K,onClose:()=>{O(!1),L("")},onSubmit:Ie,formConfig:{fields:[{name:"name",label:t("Campaign Name"),type:"text",required:!0},{name:"description",label:t("Description"),type:"textarea"},{name:"user_id",label:t("Company User"),type:"select",required:!0,options:p.map(s=>({value:s.id,label:s.name})),render:(s,a,d)=>{var b;return e.jsxs(xe,{value:((b=a[s.name])==null?void 0:b.toString())||"",onValueChange:M=>{d(s.name,M),L(M)},children:[e.jsx(fe,{children:e.jsx(je,{placeholder:t("Select User")})}),e.jsx(ge,{className:"z-[60000]",children:p.map(M=>e.jsx(X,{value:M.id.toString(),children:M.name},M.id))})]})}},{name:"business_id",label:t("Business"),type:"select",required:!0,options:E.map(s=>({value:s.id,label:s.name}))},{name:"start_date",label:t("Start Date"),type:"date",required:!0},{name:"end_date",label:t("End Date"),type:"date",required:!0},{name:"status",label:t("Status"),type:"select",required:!0,options:[{value:"pending",label:t("Pending")},{value:"active",label:t("Active")},{value:"completed",label:t("Completed")},{value:"cancelled",label:t("Cancelled")}]},{name:"is_active",label:t("Active"),type:"switch",defaultValue:!0}],modalSize:"lg",columns:2},initialData:y?{...y,business_id:(Ce=y.business_id)==null?void 0:Ce.toString(),user_id:(Se=y.user_id)==null?void 0:Se.toString(),start_date:(we=y.start_date)==null?void 0:we.split("T")[0],end_date:(Pe=y.end_date)==null?void 0:Pe.split("T")[0],is_active:!!y.is_active}:null,title:t(U==="create"?"Create Campaign":U==="edit"?"Edit Campaign":"View Campaign"),mode:U},`campaign-${(y==null?void 0:y.id)||"new"}`):e.jsx(_s,{isOpen:K,onClose:()=>O(!1),campaignData:null,paymentMethods:w.map(s=>({...s,icon:s.id==="stripe"?e.jsx(De,{className:"h-5 w-5"}):s.id==="paypal"?e.jsx(Te,{className:"h-5 w-5"}):s.id==="bank"?e.jsx(Te,{className:"h-5 w-5"}):e.jsx(De,{className:"h-5 w-5"})})),paymentSettings:n,campaignSettings:u,businesses:f}),e.jsx(rs,{isOpen:ie,onClose:()=>h(!1),onConfirm:$e,itemName:(y==null?void 0:y.name)||"",entityName:"campaign"}),e.jsx(Ee,{open:H,onOpenChange:Q,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsxs(Oe,{children:[e.jsx(Me,{children:t("Campaign Analytics")}),e.jsx(Ge,{children:t("View and analyze campaign details")})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_name",children:t("Campaign Name")}),e.jsx($,{id:"analytics_name",value:N.name,onChange:s=>I(a=>({...a,name:s.target.value})),placeholder:"Enter campaign name"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_description",children:t("Description")}),e.jsx(ts,{id:"analytics_description",value:N.description,onChange:s=>I(a=>({...a,description:s.target.value})),placeholder:"Enter campaign description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_business",children:t("Business")}),e.jsxs(xe,{value:N.business_id,onValueChange:s=>I(a=>({...a,business_id:s})),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Select business"})}),e.jsx(ge,{children:f.map(s=>e.jsx(X,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_start_date",children:t("Start Date")}),e.jsx($,{id:"analytics_start_date",type:"date",value:N.start_date,onChange:s=>I(a=>({...a,start_date:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_end_date",children:t("End Date")}),e.jsx($,{id:"analytics_end_date",type:"date",value:N.end_date,onChange:s=>I(a=>({...a,end_date:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:t("Total Days")}),e.jsx("div",{className:"p-3 bg-gray-100 rounded-md",children:e.jsxs("span",{className:"font-medium",children:[N.total_days," ",t("days")]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:t("Total Cost")}),e.jsx("div",{className:"p-3 bg-gray-100 rounded-md",children:e.jsxs("span",{className:"font-medium",children:["$",N.total_cost.toFixed(2)]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_coupon",children:t("Apply Coupon")}),e.jsx($,{id:"analytics_coupon",value:N.coupon_code,onChange:s=>I(a=>({...a,coupon_code:s.target.value})),placeholder:"Enter coupon code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"analytics_payment",children:t("Payment Method")}),e.jsxs(xe,{value:N.payment_method,onValueChange:s=>I(a=>({...a,payment_method:s})),children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Select payment method"})}),e.jsxs(ge,{children:[e.jsx(X,{value:"credit_card",children:t("Credit Card")}),e.jsx(X,{value:"paypal",children:t("PayPal")}),e.jsx(X,{value:"bank_transfer",children:t("Bank Transfer")}),e.jsx(X,{value:"stripe",children:t("Stripe")})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(D,{variant:"outline",onClick:()=>Q(!1),children:t("Close")}),e.jsx(D,{onClick:()=>{l.success(t("Analytics data logged to console"))},children:t("View Analytics")})]})]})]})})]})}export{xt as default};
