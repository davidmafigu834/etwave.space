import{j as e,r as l}from"./ui-XtzbmeJx.js";import{P as W}from"./page-template-CFccWGHX.js";import{P as X,H as $,X as Y,F as Q,r as Z,J as ee,ak as te,K as se,D as O,a as P,b as R,c as H,L as c,I as T,E as B,B as _,o as j,N as d}from"./app-BNDAg-x0.js";import{P as ae}from"./pencil-TEweTAeU.js";import{T as re}from"./trash-2-DrQu6wJh.js";import{f as A}from"./utils-CCVAIzGD.js";import{T as ie}from"./textarea-BAxIzAY1.js";import{C as ne}from"./checkbox-BS0_5fJl.js";import{R as le,a as ce}from"./radio-group-zr_nflIR.js";import{S as de}from"./switch-BcnxnoGE.js";import"./vendor-CxtKjBZA.js";import"./app-layout-CJ9aiUxz.js";import"./app-sidebar-layout-AHuSYAra.js";import"./select-CWuHpsTP.js";import"./index-C0g6bluz.js";import"./chevron-up-DUlTmMPd.js";import"./react-country-flag.esm-B3QM5-4S.js";import"./language-DYlIyiUn.js";import"./sparkles-DpD6ndVc.js";import"./loader-circle-CSHwA98f.js";import"./copy-DrIsvEfV.js";import"./chevron-right-Bd-0PcYb.js";import"./language-switcher-Sj0uA1nn.js";import"./globe-Wz67MOVh.js";import"./chart-column-c4hbpdne.js";import"./briefcase-BSRomG9M.js";import"./package-DifSoftz.js";import"./credit-card-DWMi5WDy.js";import"./dollar-sign-Cilvu6Pq.js";import"./mail-Dom0Io57.js";import"./users-dhNqMrnE.js";import"./settings-CPdYUYGM.js";import"./message-square-BWj-TB69.js";import"./calendar-Calahg4u.js";import"./wallet-BDuAFGuJ.js";import"./shopping-bag-CblcqTrH.js";import"./building-2-DMMUyCqJ.js";import"./user-D1kIaiAN.js";import"./arrow-left-oLpbgumw.js";import"./use-favicon-B5hfZCZO.js";import"./cookie-consent-B_ejjwgp.js";import"./circle-CHe9v6Fn.js";const oe=o=>{switch(o){case"warning":return e.jsx(te,{className:"w-4 h-4 text-yellow-500"});case"important":return e.jsx(ee,{className:"w-4 h-4 text-red-500"});default:return e.jsx(Z,{className:"w-4 h-4 text-blue-500"})}};function me({announcements:o=[],isLoading:C=!1,onCreate:S,onEdit:m,onDelete:g,onToggleStatus:p,onRetry:f}){return C?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Announcements"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create and manage announcements for users."})]}),e.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(X,{className:"-ml-1 mr-2 h-5 w-5"}),"New Announcement"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Range"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-10 text-center text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx($,{className:"h-10 w-10 text-gray-300"}),e.jsx("p",{children:"No announcements yet."}),f&&e.jsx("button",{type:"button",onClick:f,className:"px-3 py-2 text-sm font-medium text-blue-600 hover:text-blue-700",children:"Refresh"})]})})}):o.map(a=>{var y,x;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-full bg-blue-100 text-blue-600",children:e.jsx($,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.title}),e.jsxs("div",{className:"text-sm text-gray-500 line-clamp-1",children:[(y=a.message)==null?void 0:y.substring(0,80),((x=a.message)==null?void 0:x.length)>80?"…":""]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[oe(a.type),e.jsx("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:a.type})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:a.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{children:[e.jsx("div",{children:a.start_date?A(new Date(a.start_date),"MMM d, yyyy"):"No start"}),e.jsx("div",{className:"text-xs text-gray-400",children:a.end_date?"to ".concat(A(new Date(a.end_date),"MMM d, yyyy")):"No end"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>p==null?void 0:p(a),className:"p-1 rounded-md ".concat(a.is_active?"text-yellow-600 hover:bg-yellow-100":"text-green-600 hover:bg-green-100"),title:a.is_active?"Deactivate":"Activate",children:a.is_active?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>m==null?void 0:m(a),className:"text-blue-600 hover:text-blue-900 p-1 rounded-md hover:bg-blue-50",title:"Edit",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>g==null?void 0:g(a),className:"text-red-600 hover:text-red-900 p-1 rounded-md hover:bg-red-50",title:"Delete",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},a.id)})})]})})]})}const xe=["admin","user","manager","support"],pe=[{value:"info",label:"Info"},{value:"warning",label:"Warning"},{value:"important",label:"Important"}],z={title:"",message:"",type:"info",start_date:"",end_date:"",target_roles:[],is_active:!0};function st(){const{props:o}=se(),C=l.useMemo(()=>{var t,s;return(s=(t=o.announcements)==null?void 0:t.data)!=null?s:[]},[o.announcements]),[S,m]=l.useState(C),[g,p]=l.useState(!1),[f,a]=l.useState(!1),[y,x]=l.useState(!1),[r,n]=l.useState(z),[k,M]=l.useState(null),[u,F]=l.useState(null),[v,N]=l.useState(!1),D=()=>{n(z),M(null)},E=()=>{D(),a(!0)},q=t=>{var s;M(t),n({title:t.title,message:t.message,type:t.type,start_date:t.start_date?A(new Date(t.start_date),"yyyy-MM-dd'T'HH:mm"):"",end_date:t.end_date?A(new Date(t.end_date),"yyyy-MM-dd'T'HH:mm"):"",target_roles:(s=t.target_roles)!=null?s:[],is_active:t.is_active}),a(!0)},I=async()=>{try{p(!0);const t=await j.get("/api/v1/announcements/admin");m(t.data.data||[])}catch(t){console.error("Error fetching announcements:",t),d.error("Failed to refresh announcements")}finally{p(!1)}},G=async t=>{try{const s=await j.post("/api/v1/announcements/".concat(t.id,"/toggle-status")),{is_active:i}=s.data;m(b=>b.map(h=>h.id===t.id?{...h,is_active:i}:h)),d.success("Announcement ".concat(i?"activated":"deactivated"," successfully"))}catch(s){console.error("Error toggling announcement status:",s),d.error("Failed to update announcement status")}},V=async()=>{if(u)try{N(!0),await j.delete("/api/v1/announcements/".concat(u.id)),m(t=>t.filter(s=>s.id!==u.id)),d.success("Announcement deleted successfully"),x(!1),F(null)}catch(t){console.error("Error deleting announcement:",t),d.error("Failed to delete announcement")}finally{N(!1)}},J=async t=>{var i,b,h,L;t.preventDefault();const s={...r,start_date:r.start_date||null,end_date:r.end_date||null,target_roles:r.target_roles};try{N(!0),k?(await j.put("/api/v1/announcements/".concat(k.id),s),d.success("Announcement updated successfully")):(await j.post("/api/v1/announcements",s),d.success("Announcement created successfully")),a(!1),D(),await I()}catch(w){console.error("Error saving announcement:",w);const U=((b=(i=w.response)==null?void 0:i.data)==null?void 0:b.message)||((L=(h=w.response)==null?void 0:h.data)!=null&&L.errors?Object.values(w.response.data.errors).flat().join("\n"):null)||"Failed to save announcement";d.error(U)}finally{N(!1)}},K=t=>{n(s=>{const i=new Set(s.target_roles);return i.has(t)?i.delete(t):i.add(t),{...s,target_roles:Array.from(i)}})};return e.jsxs(W,{title:"Announcements",description:"Create and manage announcements for all users",url:route("superadmin.announcements.index"),actions:[{label:"New Announcement",icon:e.jsx("span",{className:"mr-1",children:"+"}),variant:"default",onClick:E}],children:[e.jsx(me,{announcements:S,isLoading:g,onCreate:E,onEdit:q,onDelete:t=>{F(t),x(!0)},onToggleStatus:G,onRetry:I}),e.jsx(O,{open:f,onOpenChange:t=>{a(t),t||D()},children:e.jsx(P,{className:"max-w-2xl",children:e.jsxs("form",{onSubmit:J,children:[e.jsx(R,{children:e.jsx(H,{children:k?"Edit Announcement":"New Announcement"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"title",children:"Title"}),e.jsx(T,{id:"title",value:r.title,onChange:t=>n(s=>({...s,title:t.target.value})),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"message",children:"Message"}),e.jsx(ie,{id:"message",rows:4,value:r.message,onChange:t=>n(s=>({...s,message:t.target.value})),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(c,{children:"Type"}),e.jsx(le,{value:r.type,onValueChange:t=>n(s=>({...s,type:t})),className:"flex flex-wrap gap-4",children:pe.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{value:t.value,id:"type-".concat(t.value)}),e.jsx(c,{htmlFor:"type-".concat(t.value),className:"capitalize",children:t.label})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"start_date",children:"Start date"}),e.jsx(T,{id:"start_date",type:"datetime-local",value:r.start_date,onChange:t=>n(s=>({...s,start_date:t.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty to start immediately."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"end_date",children:"End date"}),e.jsx(T,{id:"end_date",type:"datetime-local",min:r.start_date||void 0,value:r.end_date,onChange:t=>n(s=>({...s,end_date:t.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty for no end date."})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{children:"Target roles"}),e.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:xe.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{id:"role-".concat(t),checked:r.target_roles.includes(t),onCheckedChange:()=>K(t)}),e.jsx(c,{htmlFor:"role-".concat(t),className:"capitalize",children:t})]},t))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty to show to all users."})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{id:"is_active",checked:r.is_active,onCheckedChange:t=>n(s=>({...s,is_active:t}))}),e.jsx(c,{htmlFor:"is_active",children:"Active"})]})]}),e.jsxs(B,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(_,{type:"submit",disabled:v,children:v?"Saving…":"Save Announcement"})]})]})})}),e.jsx(O,{open:y,onOpenChange:t=>{x(t),t||F(null)},children:e.jsxs(P,{children:[e.jsx(R,{children:e.jsx(H,{children:"Delete announcement"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Are you sure you want to delete “",u==null?void 0:u.title,"”? This action cannot be undone."]}),e.jsxs(B,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(_,{type:"button",variant:"destructive",onClick:V,disabled:v,children:v?"Deleting…":"Delete"})]})]})})]})}export{st as default};
