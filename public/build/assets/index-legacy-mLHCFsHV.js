!function(){function e(e,a){return function(e){if(Array.isArray(e))return e}(e)||function(e,s){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var l,r,t,i,n=[],c=!0,d=!1;try{if(t=(a=a.call(e)).next,0===s){if(Object(a)!==a)return;c=!1}else for(;!(c=(l=t.call(a)).done)&&(n.push(l.value),n.length!==s);c=!0);}catch(e){d=!0,r=e}finally{try{if(!c&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(d)throw r}}return n}}(e,a)||function(e,a){if(e){if("string"==typeof e)return s(e,a);var l={}.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?s(e,a):void 0}}(e,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,s){(null==s||s>e.length)&&(s=e.length);for(var a=0,l=Array(s);a<s;a++)l[a]=e[a];return l}System.register(["./ui-legacy-Df76W54t.js","./app-legacy-Ccoue2ey.js","./alert-legacy-gIldiGzz.js","./progress-legacy-C-1V4zkv.js","./circle-check-big-legacy-uwkT3K8H.js","./circle-x-legacy-Dw3jV4Da.js","./download-legacy-CX44wdxP.js","./refresh-cw-legacy-BCVgmD54.js","./clock-legacy-C2ey8uhF.js","./vendor-legacy-DNs0y6R6.js","./utils-legacy-4AQaPo1J.js"],function(s,a){"use strict";var l,r,t,i,n,c,d,o,u,x,h,m,p,j,g,f,y,N,b,v,w,k,S,C;return{setters:[function(e){l=e.r,r=e.j},function(e){t=e.u,i=e.m,n=e.n,c=e.C,d=e.d,o=e.e,u=e.ag,x=e.f,h=e.g,m=e.ak,p=e.B,j=e.U,g=e.S,f=e.i},function(e){y=e.A,N=e.a},function(e){b=e.P},function(e){v=e.C},function(e){w=e.C},function(e){k=e.D},function(e){S=e.R},function(e){C=e.C},null,null],execute:function(){s("default",function(s){var a=s.uploadedFile,U=s.healthStatus,A=s.availableBackups,M=(t().t,e(l.useState(!1),2)),F=M[0],P=M[1],_=e(l.useState(!1),2),B=_[0],I=_[1],R=e(l.useState(!1),2),E=R[0],T=R[1],D=e(l.useState(0),2),z=D[0],K=D[1],O=e(l.useState("idle"),2),G=O[0],H=O[1],Z=e(l.useState(""),2),q=Z[0],L=Z[1],V=l.useRef(null),Y=function(e){if(0===e)return"0 Bytes";var s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},$=i({upgrade_file:null}),J=$.data,Q=$.setData,W=$.post,X=($.processing,$.errors);$.reset;return r.jsxs(r.Fragment,{children:[r.jsx(n,{title:"System Upgrade"}),r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Upgrade"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Upload and apply system upgrades to keep your application updated with the latest features and security patches."})]}),r.jsxs(c,{className:"mb-6",children:[r.jsx(d,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(u,{className:"w-5 h-5"}),"Upgrade Status"]}),r.jsx(x,{children:"Current upgrade status and progress"})]}),function(){switch(G){case"uploading":case"applying":return r.jsxs(f,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[r.jsx(C,{className:"w-3 h-3 mr-1"}),"In Progress"]});case"uploaded":return r.jsxs(f,{variant:"secondary",className:"bg-green-100 text-green-800",children:[r.jsx(v,{className:"w-3 h-3 mr-1"}),"Ready to Apply"]});case"completed":return r.jsxs(f,{variant:"secondary",className:"bg-green-100 text-green-800",children:[r.jsx(v,{className:"w-3 h-3 mr-1"}),"Completed"]});case"failed":return r.jsxs(f,{variant:"destructive",children:[r.jsx(w,{className:"w-3 h-3 mr-1"}),"Failed"]});default:return r.jsx(f,{variant:"outline",children:"Idle"})}}()]})}),r.jsxs(h,{children:["idle"!==G&&r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[r.jsx("span",{children:q||"Processing..."}),r.jsxs("span",{children:[Math.round(z),"%"]})]}),r.jsx(b,{value:z,className:"w-full"})]})}),a&&"uploaded"===G&&r.jsxs(y,{className:"mt-4",children:[r.jsx(v,{className:"h-4 w-4"}),r.jsx(N,{children:'Upgrade file uploaded successfully. Click "Apply Upgrade" to proceed.'})]}),"completed"===G&&r.jsxs(y,{className:"mt-4",children:[r.jsx(v,{className:"h-4 w-4"}),r.jsx(N,{children:"Upgrade completed successfully! Your system has been updated."})]}),"failed"===G&&r.jsxs(y,{variant:"destructive",className:"mt-4",children:[r.jsx(w,{className:"h-4 w-4"}),r.jsx(N,{children:"Upgrade failed. Please check the logs and try again."})]})]})]}),U&&r.jsxs(c,{className:"mb-6",children:[r.jsxs(d,{children:[r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(v,{className:"w-5 h-5"}),"System Health Status"]}),r.jsx(x,{children:"Check if your system is ready for upgrade"})]}),r.jsxs(h,{children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[U.database?r.jsx(v,{className:"w-4 h-4 text-green-500"}):r.jsx(w,{className:"w-4 h-4 text-red-500"}),r.jsx("span",{className:"text-sm",children:"Database"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[U.storage?r.jsx(v,{className:"w-4 h-4 text-green-500"}):r.jsx(w,{className:"w-4 h-4 text-red-500"}),r.jsx("span",{className:"text-sm",children:"Storage"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[U.cache?r.jsx(v,{className:"w-4 h-4 text-green-500"}):r.jsx(w,{className:"w-4 h-4 text-red-500"}),r.jsx("span",{className:"text-sm",children:"Cache"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[U.permissions?r.jsx(v,{className:"w-4 h-4 text-green-500"}):r.jsx(w,{className:"w-4 h-4 text-red-500"}),r.jsx("span",{className:"text-sm",children:"Permissions"})]})]}),(!U.database||!U.storage)&&r.jsxs(y,{variant:"destructive",className:"mt-4",children:[r.jsx(m,{className:"h-4 w-4"}),r.jsx(N,{children:"System health check failed. Please resolve the issues before attempting an upgrade."})]})]})]}),A&&A.length>0&&r.jsxs(c,{className:"mb-6",children:[r.jsxs(d,{children:[r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(k,{className:"w-5 h-5"}),"Available Backups"]}),r.jsx(x,{children:"Previous system backups for rollback if needed"})]}),r.jsx(h,{children:r.jsx("div",{className:"space-y-3",children:A.map(function(e){return r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:e.id}),r.jsxs("div",{className:"text-sm text-gray-500",children:[(s=e.created_at,new Date(1e3*s).toLocaleString())," â€¢ ",Y(e.size)]})]}),r.jsxs(p,{variant:"outline",size:"sm",onClick:function(){return s=e.id,void(confirm("Are you sure you want to rollback to this backup? This action cannot be undone.")&&(T(!0),H("applying"),L("Rolling back to previous version..."),K(0),W(route("upgrade.rollback"),{data:{backup_id:s},onSuccess:function(){T(!1),H("completed"),K(100),L("Rollback completed successfully!"),setTimeout(function(){return g.reload()},2e3)},onError:function(){T(!1),H("failed"),K(0),L("Rollback failed")}})));var s},disabled:B||E,children:[r.jsx(S,{className:"w-4 h-4 mr-2"}),"Rollback"]})]},e.id);var s})})})]}),r.jsxs(c,{className:"mb-6",children:[r.jsxs(d,{children:[r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(j,{className:"w-5 h-5"}),"Upload Upgrade File"]}),r.jsx(x,{children:"Upload a ZIP file containing the upgrade files. Make sure it's a valid upgrade package."})]}),r.jsx(h,{children:r.jsx("form",{onSubmit:function(e){e.preventDefault(),J.upgrade_file&&(P(!0),H("uploading"),K(0),W(route("upgrade.upload"),{onSuccess:function(){P(!1),H("uploaded"),K(100)},onError:function(){P(!1),H("failed"),K(0)},onProgress:function(e){K(e)}}))},children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("input",{ref:V,type:"file",accept:".zip",onChange:function(e){var s,a=null===(s=e.target.files)||void 0===s?void 0:s[0];a&&(Q("upgrade_file",a),H("idle"))},className:"hidden",id:"upgrade-file"}),r.jsx("label",{htmlFor:"upgrade-file",className:"flex items-center justify-center w-full h-32 px-4 transition bg-gray-50 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:border-gray-400",children:r.jsxs("div",{className:"text-center",children:[r.jsx(j,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-500",children:J.upgrade_file?J.upgrade_file.name:"Click to select upgrade ZIP file"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Maximum file size: 100MB"})]})})]}),X.upgrade_file&&r.jsxs(y,{variant:"destructive",children:[r.jsx(m,{className:"h-4 w-4"}),r.jsx(N,{children:X.upgrade_file})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(p,{type:"submit",disabled:!J.upgrade_file||F||B,className:"flex-1",children:F?r.jsxs(r.Fragment,{children:[r.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):r.jsxs(r.Fragment,{children:[r.jsx(j,{className:"w-4 h-4 mr-2"}),"Upload File"]})}),(a||"completed"===G||"failed"===G)&&r.jsxs(p,{type:"button",variant:"outline",onClick:function(){H("idle"),K(0),L(""),Q("upgrade_file",null),V.current&&(V.current.value=""),g.reload()},disabled:B,children:[r.jsx(S,{className:"w-4 h-4 mr-2"}),"Reset"]})]})]})})})]}),a&&"uploaded"===G&&r.jsxs(c,{className:"mb-6",children:[r.jsxs(d,{children:[r.jsxs(o,{className:"flex items-center gap-2",children:[r.jsx(k,{className:"w-5 h-5"}),"Apply Upgrade"]}),r.jsx(x,{children:"Apply the uploaded upgrade to your system. This process will:"})]}),r.jsx(h,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"Create a backup of essential files"}),r.jsx("li",{children:"Extract and apply the upgrade files"}),r.jsx("li",{children:"Run database migrations if needed"}),r.jsx("li",{children:"Clear system caches"}),r.jsx("li",{children:"Verify the upgrade was successful"})]}),r.jsxs(y,{children:[r.jsx(m,{className:"h-4 w-4"}),r.jsxs(N,{children:[r.jsx("strong",{children:"Important:"})," This action cannot be undone. Make sure you have a recent backup."]})]}),r.jsx(p,{onClick:function(){if(a){I(!0),H("applying"),K(0),L("Creating backup...");var e=[{step:"Creating backup...",duration:2e3},{step:"Extracting files...",duration:3e3},{step:"Applying changes...",duration:4e3},{step:"Running migrations...",duration:2e3},{step:"Clearing caches...",duration:1e3},{step:"Finalizing upgrade...",duration:1e3}],s=0;e.forEach(function(a,l){setTimeout(function(){L(a.step),s+=100/e.length,K(Math.min(s,95))},e.slice(0,l+1).reduce(function(e,s){return e+s.duration},0))}),W(route("upgrade.apply"),{data:{file_path:a},onSuccess:function(){I(!1),H("completed"),K(100),L("Upgrade completed successfully!")},onError:function(){I(!1),H("failed"),K(0),L("Upgrade failed")}})}},disabled:B,className:"w-full",size:"lg",children:B?r.jsxs(r.Fragment,{children:[r.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}),"Applying Upgrade..."]}):r.jsxs(r.Fragment,{children:[r.jsx(k,{className:"w-4 h-4 mr-2"}),"Apply Upgrade"]})})]})})]}),r.jsxs(c,{children:[r.jsx(d,{children:r.jsx(o,{children:"Important Information"})}),r.jsxs(h,{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"Before Upgrading:"}),r.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"Create a full backup of your database and files"}),r.jsx("li",{children:"Test the upgrade on a staging environment first"}),r.jsx("li",{children:"Ensure you have sufficient disk space"}),r.jsx("li",{children:"Check that all required PHP extensions are installed"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"During Upgrade:"}),r.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"Do not interrupt the upgrade process"}),r.jsx("li",{children:"Keep the page open until completion"}),r.jsx("li",{children:"Monitor the progress and status messages"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"After Upgrade:"}),r.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"Clear browser cache and cookies"}),r.jsx("li",{children:"Test all major functionality"}),r.jsx("li",{children:"Check that user data is intact"}),r.jsx("li",{children:"Monitor system logs for any errors"})]})]})]})]})]})})]})})}}})}();
