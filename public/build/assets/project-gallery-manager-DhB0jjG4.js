import{r as x,j as e}from"./ui-XtzbmeJx.js";import{u as X,n as Y,C as I,d as Z,e as $,g as M,L as j,I as k,M as z,B as y,t as g,o as P,k as ee,v as se}from"./app--U2u_Nco.js";import{P as te}from"./page-template-_w_TezBb.js";import{T as ae}from"./textarea-DI5KsTzY.js";import{S as re,a as ie,b as le,c as de,d as B}from"./select-DPTsfyZo.js";import{S as ne}from"./switch-DN11QdvS.js";import{L as O}from"./loader-circle-sCJ-o5H7.js";import{V as q}from"./video-HQyazN4q.js";import{a as oe,A as ce}from"./arrow-up-BDNmLXQl.js";import{P as me}from"./pencil-ClGax6i7.js";import{T as pe}from"./trash-2-CioPUL_a.js";import"./vendor-CxtKjBZA.js";import"./utils-CCVAIzGD.js";import"./app-layout-2q3qeuPG.js";import"./app-sidebar-layout-B8sCBDfP.js";import"./react-country-flag.esm-B3QM5-4S.js";import"./language-DYlIyiUn.js";import"./sparkles-CjzlGYDC.js";import"./copy-C3tPhgbj.js";import"./chevron-up-Cb1PVDjg.js";import"./chevron-right-BNDDuqe9.js";import"./language-switcher-CoqxIfsY.js";import"./globe-D7cjKJp0.js";import"./chart-column-I-WbOlTU.js";import"./briefcase-D8uqggDK.js";import"./package-sLSwB21j.js";import"./credit-card-BnHKQyNb.js";import"./dollar-sign-iDXPpovF.js";import"./mail-CeMU5Fvk.js";import"./users-DAfK_cju.js";import"./settings-DvHmCXCi.js";import"./message-square-PGEHhf8N.js";import"./calendar-BvntvMDr.js";import"./wallet-BJ9Z1Mvd.js";import"./shopping-bag-D4ViwlKW.js";import"./user-Cz4gw8yj.js";import"./arrow-left-DKs6FA6H.js";import"./use-favicon-8c0NNY31.js";import"./cookie-consent-CREhfCi9.js";import"./index-C0g6bluz.js";const H={media_type:"image",media_url:"",thumbnail_url:"",title:"",description:"",order_index:""},es=({business:n,gallery:u,items:C})=>{const{t}=X(),[A,f]=x.useState(()=>C!=null?C:[]),[i,w]=x.useState(H),[S,D]=x.useState(!1),[L,U]=x.useState(null),[c,V]=x.useState(null),[T,F]=x.useState(!0),v=x.useMemo(()=>[...A].sort((s,a)=>{var r,l;return((r=s.order_index)!=null?r:0)-((l=a.order_index)!=null?l:0)}),[A]),E=()=>{w(H),V(null),F(!0)},_=(s,a)=>{w(r=>({...r,[s]:a}))},G=(s,a)=>{w(r=>({...r,[a]:s}))},J=s=>{var a;V(s),w({media_type:s.media_type,media_url:s.media_url||"",thumbnail_url:s.thumbnail_url||"",title:s.title||"",description:s.description||"",order_index:String((a=s.order_index)!=null?a:"")}),F(s.order_index!==null&&s.order_index!==void 0),window.scrollTo({top:0,behavior:"smooth"})},K=async s=>{var r,l,h,m,o;if(s.preventDefault(),!i.media_url){g.error(i.media_type==="image"?t("Please select an image."):t("Please provide a video URL."));return}D(!0);const a={media_type:i.media_type,media_url:i.media_url.trim(),thumbnail_url:i.thumbnail_url.trim()||null,title:i.title.trim()||null,description:i.description.trim()||null,order_index:T&&i.order_index.trim()!==""?Number(i.order_index.trim()):null};Number.isNaN(a.order_index)&&(a.order_index=null);try{const d=c?route("vcard-builder.gallery.items.update",[n.id,u.id,c.id]):route("vcard-builder.gallery.items.store",[n.id,u.id]),b=await P({method:c?"put":"post",url:d,data:a,headers:{Accept:"application/json"}}),p=(l=(r=b.data)==null?void 0:r.items)!=null?l:[];f(p),g.success(((h=b.data)==null?void 0:h.message)||t("Gallery saved successfully.")),window.dispatchEvent(new CustomEvent("catalog:updated",{detail:{businessId:n.id}})),E()}catch(d){const N=((o=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:o.message)||t("Failed to save gallery item.");g.error(N)}finally{D(!1)}},Q=async s=>{var a,r,l,h,m;if(confirm(t("Remove this gallery item?"))){U(s.id);try{const o=route("vcard-builder.gallery.items.destroy",[n.id,u.id,s.id]),d=await P.delete(o,{headers:{Accept:"application/json"}});f((r=(a=d.data)==null?void 0:a.items)!=null?r:[]),g.success(((l=d.data)==null?void 0:l.message)||t("Gallery item removed successfully.")),window.dispatchEvent(new CustomEvent("catalog:updated",{detail:{businessId:n.id}})),(c==null?void 0:c.id)===s.id&&E()}catch(o){const d=((m=(h=o==null?void 0:o.response)==null?void 0:h.data)==null?void 0:m.message)||t("Failed to remove gallery item.");g.error(d)}finally{U(null)}}},R=async(s,a)=>{var m,o,d,N,b;const r=s+a;if(r<0||r>=v.length)return;const l=[...v],[h]=l.splice(s,1);l.splice(r,0,h),f(l);try{const p=await P.post(route("vcard-builder.gallery.items.reorder",[n.id,u.id]),{order:l.map(W=>W.id)},{headers:{Accept:"application/json"}});f((o=(m=p.data)==null?void 0:m.items)!=null?o:l),g.success(((d=p.data)==null?void 0:d.message)||t("Gallery order updated.")),window.dispatchEvent(new CustomEvent("catalog:updated",{detail:{businessId:n.id}}))}catch(p){g.error(((b=(N=p==null?void 0:p.response)==null?void 0:N.data)==null?void 0:b.message)||t("Failed to update order.")),f(v)}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:t("Project Gallery")}),e.jsx(te,{title:t("Media Gallery"),description:t("Manage the images and videos for your vCard."),url:route("vcard-builder.gallery.manage",n.id),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(Z,{children:e.jsx($,{children:t(c?"Edit gallery item":"Add gallery item")})}),e.jsx(M,{children:e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"media_type",children:t("Media type")}),e.jsxs(re,{value:i.media_type,onValueChange:s=>_("media_type",s),children:[e.jsx(ie,{id:"media_type",children:e.jsx(le,{placeholder:t("Select media type")})}),e.jsxs(de,{children:[e.jsx(B,{value:"image",children:t("Image")}),e.jsx(B,{value:"video",children:t("Video")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"order_index",children:t("Custom order")}),e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("Set custom display order")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("Disable to append automatically to the end.")})]}),e.jsx(ne,{checked:T,onCheckedChange:s=>F(s)})]}),T&&e.jsx(k,{id:"order_index",type:"number",min:"0",value:i.order_index,onChange:s=>_("order_index",s.target.value),placeholder:t("e.g. 3")})]})]}),i.media_type==="image"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:t("Image")}),e.jsx(z,{value:i.media_url,onChange:s=>G(s,"media_url"),placeholder:t("Select an image")})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"media_url",children:t("Video URL")}),e.jsx(k,{id:"media_url",value:i.media_url,onChange:s=>_("media_url",s.target.value),placeholder:"https://www.youtube.com/watch?v=..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:t("Thumbnail")}),e.jsx(z,{value:i.thumbnail_url,onChange:s=>G(s,"thumbnail_url"),placeholder:t("Thumbnail image (optional)")})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"title",children:t("Title")}),e.jsx(k,{id:"title",value:i.title,onChange:s=>_("title",s.target.value),placeholder:t("Title (optional)")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"description",children:t("Description")}),e.jsx(ae,{id:"description",value:i.description,onChange:s=>_("description",s.target.value),placeholder:t("Description (optional)"),rows:3})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{type:"submit",disabled:S,children:[S&&e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),t(c?"Update item":"Add item")]}),c&&e.jsx(y,{type:"button",variant:"outline",onClick:E,disabled:S,children:t("Cancel edit")})]})]})})]}),e.jsx("div",{className:"space-y-4",children:v.length===0?e.jsx(I,{children:e.jsx(M,{className:"py-8 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:t("No media items yet. Add images or videos to showcase your work.")})})}):v.map((s,a)=>{var r;return e.jsx(I,{className:"overflow-hidden border border-dashed",children:e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("div",{className:"sm:w-40 bg-muted/40 flex items-center justify-center",children:s.media_type==="image"&&s.media_url?e.jsx("img",{src:s.thumbnail_url||s.media_url,alt:s.title||"",className:"h-32 w-full object-cover"}):e.jsxs("div",{className:"flex h-32 w-full flex-col items-center justify-center text-muted-foreground",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs mt-1",children:t("Video")})]})}),e.jsxs(M,{className:"flex-1 space-y-3 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{type:s.media_type}),e.jsx("p",{className:"text-sm font-semibold",children:s.title||t("Untitled item")})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-line",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{type:"button",variant:"outline",size:"icon",onClick:()=>R(a,-1),disabled:a===0,title:t("Move up"),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(y,{type:"button",variant:"outline",size:"icon",onClick:()=>R(a,1),disabled:a===v.length-1,title:t("Move down"),children:e.jsx(ce,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid gap-2 text-xs text-muted-foreground sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[t("Media URL"),":"]}),e.jsx("p",{className:"truncate",title:s.media_url,children:s.media_url})]}),s.thumbnail_url&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[t("Thumbnail"),":"]}),e.jsx("p",{className:"truncate",title:s.thumbnail_url,children:s.thumbnail_url})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[t("Order"),":"]})," ",(r=s.order_index)!=null?r:"â€”"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 border-t pt-3",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>J(s),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),t("Edit")]}),e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>Q(s),disabled:L===s.id,children:[L===s.id?e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pe,{className:"mr-2 h-4 w-4"}),t("Delete")]})]})]})]})},s.id)})})]})})]})},ue=({type:n})=>{const u="h-3 w-3";return e.jsxs("span",{className:ee("inline-flex items-center gap-1 rounded-full px-2 py-1 text-[10px] font-medium uppercase",n==="image"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"),children:[n==="image"?e.jsx(se,{className:u}):e.jsx(q,{className:u}),n]})};export{es as default};
