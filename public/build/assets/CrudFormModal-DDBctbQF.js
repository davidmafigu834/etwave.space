import{r as w,j as a}from"./ui-XtzbmeJx.js";import{i as ee,X as ae,u as se,D as te,a as ne,b as re,c as ce,A as le,L as C,E as me,B as H,I,M as oe}from"./app-BNDAg-x0.js";import{T as ie}from"./textarea-BAxIzAY1.js";import{S as ue,a as xe,b as pe,c as he,d as Q}from"./select-CWuHpsTP.js";import{R as de,a as ye}from"./radio-group-zr_nflIR.js";import{C as je}from"./checkbox-BS0_5fJl.js";import{S as ge}from"./switch-BcnxnoGE.js";import{S as be}from"./scroll-area-dkYqv76s.js";function ve({options:u,selected:p,onChange:S,placeholder:m="Select options",className:i}){const[E,l]=w.useState(!1),[q,d]=w.useState(""),t=w.useRef(null);w.useEffect(()=>{function o(y){t.current&&!t.current.contains(y.target)&&l(!1)}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]);const T=o=>{p.includes(o)||S([...p,o]),d(""),setTimeout(()=>{var b;const y=(b=t.current)==null?void 0:b.querySelector("input");y&&y.focus()},10)},x=o=>{S(p.filter(y=>y!==o))},N=u.filter(o=>(q||!p.includes(o.value))&&o.label.toLowerCase().includes(q.toLowerCase()));return a.jsxs("div",{ref:t,className:"relative ".concat(i),children:[a.jsxs("div",{className:"flex flex-wrap gap-1 p-2 border rounded-md min-h-[38px] cursor-text",onClick:()=>l(!0),children:[p.map(o=>{const y=u.find(b=>b.value===o);return a.jsxs(ee,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[(y==null?void 0:y.label)||o,a.jsx("button",{type:"button",className:"ml-1 rounded-sm",onClick:b=>{b.stopPropagation(),x(o)},children:a.jsx(ae,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},o)}),a.jsx("input",{type:"text",value:q,onChange:o=>d(o.target.value),onFocus:()=>l(!0),placeholder:p.length===0?m:"",className:"flex-1 outline-none bg-transparent min-w-[50px]"})]}),E&&N.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-[200px] overflow-y-auto",children:N.map(o=>a.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{T(o.value),l(!0)},children:o.label},o.value))})]})}function we({field:u,formData:p,handleChange:S}){const m=Array.isArray(p[u.name])?p[u.name]:p[u.name]?[p[u.name].toString()]:[];return a.jsx(ve,{options:u.options||[],selected:m,onChange:i=>S(u.name,i),placeholder:u.placeholder||"Select ".concat(u.label)})}function Ce({isOpen:u,onClose:p,onSubmit:S,formConfig:m,initialData:i={},title:E,mode:l,description:q}){var O,P,U,B;const{t:d}=se(),[t,T]=w.useState({}),[x,N]=w.useState({}),[o,y]=w.useState({}),b=()=>{if(!m.priceSummary)return 0;const e=t[m.priceSummary.quantityFieldName||"quantity"]||m.priceSummary.quantity||1;return m.priceSummary.unitPrice*e};w.useEffect(()=>{if(u){const e={...i};m.fields.forEach(c=>{c.type==="multi-select"&&e[c.name]&&!Array.isArray(e[c.name])&&(e[c.name]=Array.isArray(e[c.name])?e[c.name]:e[c.name]?[e[c.name].toString()]:[]),l==="create"&&(e[c.name]===void 0||e[c.name]===null)&&c.defaultValue!==void 0&&(e[c.name]=c.defaultValue)}),T(e||{}),N({}),m.fields.forEach(c=>{c.relation&&c.relation.endpoint&&fetch(c.relation.endpoint).then(r=>r.json()).then(r=>{y(h=>({...h,[c.name]:Array.isArray(r)?r:r.data||[]}))}).catch(r=>{})})}},[u,i,m.fields,l]);const j=(e,c)=>{T(r=>({...r,[e]:c})),x[e]&&N(r=>{const h={...r};return delete h[e],h})},L=e=>{e.preventDefault();const c={...t};m.fields.forEach(n=>{n.type==="multi-select"&&c[n.name]&&(Array.isArray(c[n.name])||(c[n.name]=[c[n.name].toString()]))}),T(c);const r={};if(m.fields.forEach(n=>{if(n.type==="file"&&l==="edit")return;const k=n.conditional?n.conditional(l,t):!0;if(n.required&&k&&!t[n.name]&&(r[n.name]="".concat(n.label," is required")),n.type==="file"&&t[n.name]&&n.fileValidation){const F=t[n.name];if(n.fileValidation.maxSize&&F.size>n.fileValidation.maxSize){const g=n.fileValidation.maxSize/1048576;r[n.name]="File size must be less than ".concat(g,"MB")}if(n.fileValidation.mimeTypes&&n.fileValidation.mimeTypes.length>0&&(n.fileValidation.mimeTypes.includes(F.type)||(r[n.name]="File type must be one of: ".concat(n.fileValidation.mimeTypes.join(", ")))),n.fileValidation.extensions&&n.fileValidation.extensions.length>0){const g=F.name,v=g.substring(g.lastIndexOf(".")).toLowerCase();n.fileValidation.extensions.includes(v)||(r[n.name]="File extension must be one of: ".concat(n.fileValidation.extensions.join(", ")))}}}),Object.keys(r).length>0){N(r);return}const h={...t};m.fields.forEach(n=>{n.type==="multi-select"&&h[n.name]&&(Array.isArray(h[n.name])||(h[n.name]=[h[n.name].toString()]))}),S(h)},R=e=>{var c,r,h,n,k,F;if(e.conditional&&!e.conditional(l,t))return null;if(e.render)return e.render(e,t,j);if(l==="view"){if(e.type==="multi-select"){const v=(Array.isArray(t[e.name])?t[e.name]:[]).map(V=>{var z;const $=(z=e.options)==null?void 0:z.find(A=>A.value===V);return $?$.label:V}).join(", ");return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:v||"-"})}return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:e.type==="select"&&e.options?((c=e.options.find(g=>g.value===String(t[e.name])))==null?void 0:c.label)||t[e.name]||"-":t[e.name]||"-"})}switch(e.type){case"text":case"email":case"password":case"time":return a.jsx(I,{id:e.name,name:e.name,type:e.type,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"date":const g=t[e.name]?t[e.name]instanceof Date?t[e.name].toISOString().split("T")[0]:typeof t[e.name]=="string"&&t[e.name].includes("T")?t[e.name].split("T")[0]:t[e.name]:"";return a.jsx(I,{id:e.name,name:e.name,type:"date",placeholder:e.placeholder,value:g,onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"number":return a.jsx(I,{id:e.name,name:e.name,type:"number",placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value?parseFloat(s.target.value):""),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"textarea":return a.jsx(ie,{id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:s=>j(e.name,s.target.value),required:e.required,className:x[e.name]?"border-red-500":"",disabled:l==="view"});case"select":const v=e.relation?o[e.name]||[]:e.options||[],V=String(t[e.name]||""),$=e.relation?v.find(s=>String(s[e.relation.valueField])===V):v.find(s=>String(s.value)===V),z=$?e.relation?$[e.relation.labelField]:$.label:"";return a.jsxs(ue,{value:V,onValueChange:s=>j(e.name,s),disabled:l==="view",children:[a.jsx(xe,{className:x[e.name]?"border-red-500":"",children:a.jsx(pe,{placeholder:e.placeholder||"Select ".concat(e.label),children:z||e.placeholder||"Select ".concat(e.label)})}),a.jsx(he,{className:"z-[60000]",children:e.relation?v.map(s=>a.jsx(Q,{value:String(s[e.relation.valueField]),children:s[e.relation.labelField]},s[e.relation.valueField])):v.map(s=>a.jsx(Q,{value:String(s.value),children:s.label},s.value))})]});case"radio":return a.jsx(de,{value:t[e.name]||"",onValueChange:s=>j(e.name,s),disabled:l==="view",className:"flex gap-4",children:(r=e.options)==null?void 0:r.map(s=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ye,{value:s.value,id:"".concat(e.name,"-").concat(s.value)}),a.jsx(C,{htmlFor:"".concat(e.name,"-").concat(s.value),children:s.label})]},s.value))});case"checkbox":return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(je,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:l==="view"}),a.jsx(C,{htmlFor:e.name,children:e.placeholder||e.label})]});case"switch":return a.jsx(ge,{id:e.name,checked:!!t[e.name],onCheckedChange:s=>j(e.name,s),disabled:l==="view"});case"multi-select":return a.jsx(we,{field:e,formData:t,handleChange:j});case"media-picker":let A=t[e.name]||"";!A&&l==="edit"&&i[e.name]&&(A=i[e.name]);const Z=s=>{var G,_,D;return!s||s.startsWith("http")?s:s.startsWith("/storage/")?"".concat(((G=window.appSettings)==null?void 0:G.baseUrl)||"").concat(s):s.startsWith("/")?"".concat(((_=window.appSettings)==null?void 0:_.baseUrl)||"").concat(s):s.startsWith("/")?"".concat(((D=window.appSettings)==null?void 0:D.baseUrl)||"").concat(s):s};return a.jsx(oe,{value:Z(A),onChange:s=>j(e.name,s),placeholder:e.placeholder||"Select ".concat(e.label),showPreview:!0});case"file":const W=((h=e.fileValidation)==null?void 0:h.accept)||"",f=W.includes("image")||((F=(k=(n=e.fileValidation)==null?void 0:n.mimeTypes)==null?void 0:k.some(s=>s.startsWith("image/")))!=null?F:!1);return a.jsxs(a.Fragment,{children:[a.jsx(I,{id:e.name,name:e.name,type:"file",accept:W,onChange:s=>{s.target.files&&s.target.files[0]&&j(e.name,s.target.files[0])},className:x[e.name]?"border-red-500":"",disabled:l==="view"}),l==="edit"&&i[e.name]&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current file: ",i.featured_image_original_name||i[e.name]]}),e.fileValidation&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.fileValidation.extensions&&a.jsxs("span",{children:[d("Allowed extensions"),": ",e.fileValidation.extensions.join(", ")," "]}),e.fileValidation.maxSize&&a.jsxs("span",{children:[d("Max size"),": ",(e.fileValidation.maxSize/(1024*1024)).toFixed(1),"MB"]})]}),f&&a.jsx("div",{className:"mt-2",children:t[e.name]&&t[e.name]instanceof File?a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Preview"),":"]}),a.jsx("img",{src:URL.createObjectURL(t[e.name]),alt:"Preview",className:"h-24 w-auto rounded-md object-cover shadow-sm"})]}):l==="edit"&&i[e.name]&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[d("Current image"),":"]}),a.jsx("img",{src:typeof i[e.name]=="string"&&i[e.name].startsWith&&i[e.name].startsWith("http")?i[e.name]:"/storage/".concat(i[e.name]),alt:"Current",className:"h-24 w-auto rounded-md object-cover shadow-sm",onError:s=>{s.currentTarget.src="https://placehold.co/200x150?text=Image+Not+Found"}})]})})]});default:return null}},X=()=>{const e={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl","3xl":"sm:max-w-3xl","4xl":"sm:max-w-4xl","5xl":"sm:max-w-5xl",full:"sm:max-w-full"};return m.modalSize?e[m.modalSize]:"sm:max-w-md"},J=()=>{const e={};return m.fields.forEach(c=>{const r=c.row||0;e[r]||(e[r]=[]),e[r].push(c)}),Object.entries(e).sort(([c],[r])=>parseInt(c)-parseInt(r))},M=m.layout||"default",K=m.columns||1,Y="crud-modal-".concat(l,"-").concat(E.replace(/\s+/g,"-").toLowerCase(),"-").concat(Date.now());return a.jsx(te,{open:u,onOpenChange:p,children:a.jsxs(ne,{className:"".concat(X()," max-h-[90vh]"),modalId:Y,children:[a.jsxs(re,{children:[a.jsx(ce,{children:E}),a.jsx(le,{children:q||" "})]}),a.jsx(be,{className:"max-h-[70vh] pr-4",children:a.jsxs("form",{onSubmit:L,className:"space-y-4",children:[m.priceSummary&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Unit Price"),":"]}),a.jsxs("span",{className:"font-medium",children:[((P=(O=window==null?void 0:window.appSettings)==null?void 0:O.currencySettings)==null?void 0:P.currencySymbol)||"$",m.priceSummary.unitPrice.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[d("Quantity"),":"]}),a.jsx("span",{className:"font-medium",children:t[m.priceSummary.quantityFieldName||"quantity"]||m.priceSummary.quantity||1})]}),a.jsx("div",{className:"border-t pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold",children:[d("Total Price"),":"]}),a.jsxs("span",{className:"font-bold text-lg text-primary",children:[((B=(U=window==null?void 0:window.appSettings)==null?void 0:U.currencySettings)==null?void 0:B.currencySymbol)||"$",b().toFixed(2)]})]})})]}),M==="grid"?a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(K,", 1fr)"),gap:"1rem"},children:m.fields.map(e=>e.conditional&&!e.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{gridColumn:e.colSpan?"span ".concat(e.colSpan):"span 1",width:"100%"},children:[a.jsxs(C,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),R(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):M==="flex"?a.jsx("div",{className:"flex flex-wrap gap-4",children:m.fields.map(e=>e.conditional&&!e.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:e.width||"100%",flexGrow:e.width?0:1},children:[a.jsxs(C,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),R(e),x[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[e.name]})]},e.name))}):J().map(([e,c])=>a.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:c.map(r=>r.conditional&&!r.conditional(l,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:r.width||"100%"},children:[a.jsxs(C,{htmlFor:r.name,className:"text-sm font-medium",children:[r.label," ",r.required&&!(r.type==="file"&&l==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),R(r),x[r.name]&&a.jsx("p",{className:"text-xs text-red-500",children:x[r.name]})]},r.name))},e))]})}),a.jsxs(me,{className:"sm:justify-end",children:[a.jsx(H,{type:"button",variant:"outline",onClick:p,children:d("Cancel")}),l!=="view"&&a.jsx(H,{type:"button",onClick:L,children:d("Save")})]})]})})}export{Ce as C};
