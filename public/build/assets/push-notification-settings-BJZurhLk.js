import{r as d,j as e}from"./ui-XtzbmeJx.js";import{u as w,K as N,q,r as C,L as g,I as E,B as F,w as T,at as k,t as y,au as D}from"./app--U2u_Nco.js";import{S as I}from"./switch-DN11QdvS.js";import{S as B,a as M,b as R,c as L,d as l}from"./select-DPTsfyZo.js";import{B as O}from"./bell-ring-CqDTHAeg.js";import"./vendor-CxtKjBZA.js";import"./utils-CCVAIzGD.js";import"./index-C0g6bluz.js";import"./chevron-up-Cb1PVDjg.js";const a={web_push_subscribed:!0,frequency:"daily",send_time:"08:00"};function H(){var h;const{t}=w(),{auth:r={}}=N().props,o=d.useMemo(()=>{var i,p,f,b,x;const s=(p=(i=r==null?void 0:r.user)==null?void 0:i.notification_preferences)!=null?p:{};return{...a,...s,web_push_subscribed:(f=s==null?void 0:s.web_push_subscribed)!=null?f:a.web_push_subscribed,frequency:(b=s==null?void 0:s.frequency)!=null?b:a.frequency,send_time:(x=s==null?void 0:s.send_time)!=null?x:a.send_time}},[(h=r==null?void 0:r.user)==null?void 0:h.notification_preferences]),[n,c]=d.useState(o),[u,m]=d.useState(!1);d.useEffect(()=>{c(o)},[o]);const j=s=>{c(i=>({...i,web_push_subscribed:s}))},S=s=>{c(i=>({...i,frequency:s}))},_=s=>{c(i=>({...i,send_time:s||a.send_time}))},v=async s=>{s.preventDefault(),m(!0);try{await k(n),y.success(t("Notification preferences updated")),n.web_push_subscribed&&D()}catch(i){y.error(t("Failed to update notification preferences"))}finally{m(!1)}};return e.jsx(q,{title:t("Web Push Notifications"),description:t("Manage OneSignal web push subscription and digest schedule."),action:e.jsxs(F,{type:"submit",form:"push-notification-settings-form",size:"sm",disabled:u,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),t(u?"Saving...":"Save Changes")]}),children:e.jsxs("form",{id:"push-notification-settings-form",onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-md border bg-muted/20 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-primary"}),e.jsx("p",{className:"font-medium",children:t("Enable web push alerts")})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("Stay informed about visitor activity with instant web push notifications.")})]}),e.jsx(I,{id:"web-push-enabled",checked:n.web_push_subscribed,onCheckedChange:j})]}),e.jsx("div",{className:"rounded-md border border-dashed bg-muted/10 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(C,{className:"mt-0.5 h-4 w-4"}),e.jsx("p",{children:t("Make sure the OneSignal prompt is accepted in your browser so we can deliver notifications. You can always re-enable the prompt from your browser settings if dismissed.")})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"push-frequency",children:t("Digest Frequency")}),e.jsxs(B,{value:n.frequency,onValueChange:s=>S(s),disabled:!n.web_push_subscribed,children:[e.jsx(M,{id:"push-frequency",children:e.jsx(R,{placeholder:t("Select frequency")})}),e.jsxs(L,{children:[e.jsx(l,{value:"daily",children:t("Daily")}),e.jsx(l,{value:"weekly",children:t("Weekly")}),e.jsx(l,{value:"monthly",children:t("Monthly")})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("Choose how often we should send you a digest of your visitor metrics.")})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"push-send-time",children:t("Digest Send Time")}),e.jsx(E,{id:"push-send-time",type:"time",value:n.send_time,onChange:s=>_(s.target.value),disabled:!n.web_push_subscribed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("We will queue your digest around this time in your selected timezone.")})]})]})]})})}export{H as default};
