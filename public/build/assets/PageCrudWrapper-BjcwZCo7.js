import{r as S,j as f}from"./ui-XtzbmeJx.js";import{P as ae}from"./page-template-CFccWGHX.js";import{u as ie,K as ne,a7 as B,P as oe,S as m,t as o}from"./app-BNDAg-x0.js";import{P as le}from"./pagination-C4qAnUGE.js";import{S as ce}from"./search-and-filter-bar-Cv6CmNrA.js";import{C as pe}from"./CrudTable-Cr_o23J5.js";import{C as de}from"./CrudFormModal-DDBctbQF.js";import{C as me}from"./CrudDeleteModal-77wRveK6.js";function Fe({config:F,title:k,url:z,buttons:P=[],breadcrumbs:I}){var T;const{t:p}=ie(),{entity:t,table:O,filters:y=[],form:C,hooks:n}=F,{auth:v,...x}=ne().props,_=(v==null?void 0:v.permissions)||[],j=x[t.name]||{data:[],links:[]},c=x.filters||{},[d,N]=S.useState(c.search||""),[b,$]=S.useState({}),[K,U]=S.useState(!1),[R,g]=S.useState(!1),[V,w]=S.useState(!1),[h,D]=S.useState(null),[u,A]=S.useState("create");S.useEffect(()=>{const e={};y.forEach(s=>{const i=s.name||s.key;e[i]=c[i]||""}),$(e)},[]);const W=()=>Object.entries(b).some(([e,s])=>s&&s!=="")||d!=="",q=()=>Object.entries(b).filter(([e,s])=>s&&s!=="").length+(d?1:0),G=e=>{e.preventDefault(),H()},H=()=>{const e={page:1};d&&(e.search=d),Object.entries(b).forEach(([s,i])=>{i&&i!==""&&(e[s]=i)}),c.per_page&&(e.per_page=c.per_page),m.get(t.endpoint,e,{preserveState:!0,preserveScroll:!0})},J=(e,s)=>{$(l=>({...l,[e]:s}));const i={page:1};d&&(i.search=d);const a={...b,[e]:s};Object.entries(a).forEach(([l,r])=>{r&&r!==""&&(i[l]=r)}),c.per_page&&(i.per_page=c.per_page),m.get(t.endpoint,i,{preserveState:!0,preserveScroll:!0})},L=e=>{const s=c.sort_field===e&&c.sort_direction==="asc"?"desc":"asc",i={sort_field:e,sort_direction:s,page:1};d&&(i.search=d),Object.entries(b).forEach(([a,l])=>{l&&l!==""&&(i[a]=l)}),c.per_page&&(i.per_page=c.per_page),m.get(t.endpoint,i,{preserveState:!0,preserveScroll:!0})},Q=(e,s)=>{switch(D(s),e){case"view":A("view"),g(!0);break;case"edit":A("edit"),g(!0);break;case"delete":w(!0);break}},X=()=>{D(null),A("create"),g(!0)},Y=e=>{const s={...e};if(t.name==="roles"){if(s.permissions&&Array.isArray(s.permissions)){const l=s.permissions.map(r=>typeof r=="object"&&r!==null&&r.name?r.name:String(r));s.permissions=l}const a={label:s.label,description:s.description||"",permissions:s.permissions||[]};Object.keys(s).forEach(l=>{delete s[l]}),Object.assign(s,a)}else if(s.permissions&&Array.isArray(s.permissions)){const a={};s.permissions.forEach((l,r)=>{a[r]=String(l)}),s.permissions=a}if(t.name==="permissions"&&u==="edit"&&delete s.name,C.fields.some(a=>a.type==="file")){const a=C.fields.filter(r=>r.type==="file").map(r=>r.name),l=new FormData;Object.keys(s).forEach(r=>{if(a.includes(r)&&u==="edit"){s[r]&&typeof s[r]=="object"&&l.append(r,s[r]);return}l.append(r,s[r])}),u==="create"?(o.loading(p("Creating...")),m.post(t.endpoint,l,{onSuccess:r=>{g(!1),o.dismiss(),n!=null&&n.afterCreate&&n.afterCreate(e,r.props[t.name])},onError:r=>{o.dismiss(),o.error(p("Failed to create ".concat(t.name.slice(0,-1),": ").concat(Object.values(r).join(", "))))}})):u==="edit"&&(o.loading(p("Updating...")),m.post("".concat(t.endpoint,"/").concat(h.id,"?_method=PUT"),l,{onSuccess:r=>{g(!1),o.dismiss(),n!=null&&n.afterUpdate&&n.afterUpdate(e,r.props[t.name])},onError:r=>{o.dismiss(),o.error(p("Failed to update ".concat(t.name.slice(0,-1),": ").concat(Object.values(r).join(", "))))}}));return}u==="create"?(o.loading(p("Creating...")),m.post(t.endpoint,s,{onSuccess:a=>{g(!1),o.dismiss(),n!=null&&n.afterCreate&&n.afterCreate(e,a.props[t.name])},onError:a=>{o.dismiss(),o.error(p("Failed to create ".concat(t.name.slice(0,-1),": ").concat(Object.values(a).join(", "))))}})):u==="edit"&&(o.loading(p("Updating...")),m.put("".concat(t.endpoint,"/").concat(h.id),s,{onSuccess:a=>{g(!1),o.dismiss(),n!=null&&n.afterUpdate&&n.afterUpdate(e,a.props[t.name])},onError:a=>{o.dismiss(),o.error(p("Failed to update ".concat(t.name.slice(0,-1),": ").concat(Object.values(a).join(", "))))}}))},Z=()=>{o.loading(p("Deleting...")),m.delete("".concat(t.endpoint,"/").concat(h.id),{onSuccess:()=>{w(!1),o.dismiss(),n!=null&&n.afterDelete&&n.afterDelete(h.id)},onError:e=>{o.dismiss(),o.error(p("Failed to delete ".concat(t.name.slice(0,-1),": ").concat(Object.values(e).join(", "))))}})},ee=()=>{const e={};y.forEach(s=>{e[s.key]=s.type==="select"?"all":""}),$(e),N(""),U(!1),m.get(t.endpoint,{page:1,per_page:c.per_page},{preserveState:!0,preserveScroll:!0})},se=P.every(e=>e.showAddButton!==!1),E=[];P.forEach(e=>{(!e.permission||B(_,e.permission))&&E.push({label:e.label,icon:e.icon,variant:e.variant,onClick:e.onClick})}),se&&B(_,t.permissions.create)&&E.push({label:"Add New ".concat(t.name.slice(0,-1).charAt(0).toUpperCase()+t.name.slice(0,-1).slice(1)),icon:f.jsx(oe,{className:"h-4 w-4"}),variant:"default",onClick:()=>X()});const M=k||t.name.charAt(0).toUpperCase()+t.name.slice(1),te=[{title:p("Dashboard"),href:route("dashboard")},{title:M}],re=I||te;return f.jsxs(ae,{title:M,url:z,actions:E,breadcrumbs:re,noPadding:!0,children:[f.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4",children:f.jsx("div",{className:"p-4",children:f.jsx(ce,{searchTerm:d,onSearchChange:e=>N(e),onSearch:G,filters:y.map(e=>{const s=e.name||e.key;return{name:s,label:e.label,type:e.type,options:e.options,value:b[s]||"",onChange:i=>J(s,i)}}),showFilters:K,setShowFilters:U,hasActiveFilters:W,activeFilterCount:q,onResetFilters:ee,currentPerPage:((T=c.per_page)==null?void 0:T.toString())||"10",onPerPageChange:e=>{const s={page:1,per_page:parseInt(e)};d&&(s.search=d),Object.entries(b).forEach(([i,a])=>{a&&a!==""&&(s[i]=a)}),m.get(t.endpoint,s,{preserveState:!0,preserveScroll:!0})},perPageOptions:[10,25,50,100]})})}),f.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[f.jsx(pe,{columns:O.columns,actions:O.actions,data:j.data,from:j.from||1,onAction:Q,sortField:c.sort_field,sortDirection:c.sort_direction,onSort:L,statusColors:O.statusColors,permissions:_,entityPermissions:t.permissions}),f.jsx(le,{from:j.from||0,to:j.to||0,total:j.total,links:j.links,entityName:t.name,onPageChange:e=>m.get(e,{},{preserveState:!0,preserveScroll:!0}),className:"border-t dark:border-gray-700"})]}),f.jsx(de,{isOpen:R,onClose:()=>g(!1),onSubmit:Y,formConfig:{...C,modalSize:F.modalSize||C.modalSize},initialData:h,title:u==="create"?"Add New ".concat(t.name.slice(0,-1).charAt(0).toUpperCase()+t.name.slice(0,-1).slice(1)):u==="edit"?"Edit ".concat(t.name.slice(0,-1).charAt(0).toUpperCase()+t.name.slice(0,-1).slice(1)):"View ".concat(t.name.slice(0,-1).charAt(0).toUpperCase()+t.name.slice(0,-1).slice(1)),mode:u,description:F.description}),f.jsx(me,{isOpen:V,onClose:()=>w(!1),onConfirm:Z,itemName:(h==null?void 0:h.name)||"",entityName:t.name.slice(0,-1)})]})}export{Fe as P};
