import{R as o,j as t}from"./ui-XtzbmeJx.js";import{u as je,C as _e,L as C,I as ne,B as z,o as Se,t as oe}from"./app-CHRIhyY0.js";import{T as ke}from"./textarea-aJ3buVnx.js";import{S as we}from"./scroll-area-RBjlp-Q2.js";import{r as Ne,g as Ae}from"./index-Zk2FuNHf.js";import"./vendor-CxtKjBZA.js";import"./utils-CCVAIzGD.js";import"./borehole-drilling-DO2azVu5.js";import"./language-DYlIyiUn.js";const I=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2),Ce={construction:["hero","service_highlights","contact","why_choose_us","about","projects","process","packages","social","cta_banner","business_hours","appointments","testimonials","contact_form","footer","copyright"],"construction-sales":["hero","service_highlights","contact","why_choose_us","about","projects","process","packages","social","cta_banner","business_hours","appointments","testimonials","contact_form","footer","copyright"]},ie=(s,a)=>{if(a===null||typeof a>"u")return s;if(Array.isArray(a))return a;if(typeof a=="object"&&a!==null){const d={...typeof s=="object"&&s!==null&&!Array.isArray(s)?s:{}};return Object.entries(a).forEach(([m,U])=>{d[m]=ie(d[m],U)}),d}return a},Ie=(s,a)=>{const l={...s};return Object.entries(a||{}).forEach(([d,m])=>{d==="_meta"||typeof m>"u"||(l[d]=ie(l[d],m))}),l},Ee="Hi there! I'm your AI assistant. I'll guide you section by section and fill in your digital card automatically. We'll start with the basics about your business.",Le=[{value:"professional",label:"Professional"},{value:"friendly",label:"Friendly"},{value:"inspirational",label:"Inspirational"},{value:"conversational",label:"Conversational"}],Me=[{value:"en",label:"English"},{value:"es",label:"Spanish"},{value:"fr",label:"French"},{value:"de",label:"German"}],re=800,Te={hero:"Tell me your company name, what you do best, and the main call-to-action you'd like visitors to take (for example: request a quote, book a call).",service_highlights:"List your core services. For each, share a title and one sentence describing what makes it valuable.",why_choose_us:"Give me 2-3 reasons customers choose you. Mention differentiators like experience, certifications, guarantees, or success stories.",about:"Share your story, mission, experience, and any proof points that introduce your company.",projects:"Describe your standout projects. For each, include the project name, location, scope, and a key result or testimonial.",testimonials:"Provide customer testimonials. Include the client name, a short quote, and the project type if you have it.",process:"Outline the steps you follow from first contact to project completion. Share 3-5 steps with short descriptions.",packages:"List your packages or service tiers. Include the package name, what is included, and any pricing or timelines.",cta_banner:"What urgent offer or message should appear in the call-to-action banner? Include headline, supporting line, and desired button texts.",appointments:"How can customers book you? Share booking links, preferred contact method, and any key instructions.",contact_form:"What fields should the contact form collect, and what message encourages people to reach out?",contact:"Share your contact details: phone numbers, emails, physical address, and any map or directions.",business_hours:"Provide your business hours or availability for each day of the week.",social:"List the social media profiles or platforms you would like to feature, with full URLs.",language:"Do you need specific language preferences or translations noted?",seo:"List important keywords, page titles, and meta descriptions you want included for search engines.",pixels:"Provide any tracking pixels, analytics codes, or marketing tags to embed.",footer:"Share what should appear in the footerâ€”navigation links, disclaimers, or additional notes.",copyright:"Provide the legal business name and current year for the copyright notice."},W=new Set(["service_highlights","packages","projects","gallery","contact"]),H=s=>{if(!s||typeof s!="object")return{};const a={};return Object.entries(s).forEach(([l,d])=>{(l.startsWith("_")||!W.has(l))&&(a[l]=d)}),a},V=(s,a)=>a&&a.trim().length>0?a:s.replace(/[-_]/g," ").replace(/\b\w/g,l=>l.toUpperCase()),Oe=(s,a)=>{var m;const l=V(s,a),d=(m=Te[s])!=null?m:"Share the key details you want in the ".concat(l," section.");return"Let's work on the ".concat(l," section. ").concat(d," I will turn your notes into polished content.")},Y=s=>s===null||typeof s>"u"?!1:typeof s=="string"?s.trim().length>0:typeof s=="number"||typeof s=="boolean"?!0:Array.isArray(s)?s.some(a=>Y(a)):typeof s=="object"?Object.values(s).some(a=>Y(a)):!1,K=(s,a,l=[])=>!a||typeof a!="object"||l.includes(s)?!1:Y(a[s]),Ve=({userPlan:s,planFeatures:a,userRole:l,businessName:d,businessType:m,defaultTone:U="professional",defaultLanguage:ce="en",onboardingSections:D,onResult:E})=>{const{t:n}=je(),[G,le]=o.useState([{id:I(),role:"assistant",content:n(Ee)}]),[L,Q]=o.useState(""),[w,$]=o.useState(!1),[P,de]=o.useState(U),[X,ue]=o.useState(ce),[F,me]=o.useState(d!=null?d:""),[M,fe]=o.useState(m!=null?m:""),[h,he]=o.useState(()=>H(D!=null?D:{})),[p,pe]=o.useState([]),[c,J]=o.useState(null),[y,Z]=o.useState(!1),[x,Re]=o.useState([]),T=o.useRef(null),q=o.useRef(null),ee=o.useRef(""),N=o.useRef(!1),_=o.useMemo(()=>p.map(e=>e.key),[p]),te=o.useMemo(()=>p.filter(e=>K(e.key,h,x)).map(e=>e.key),[p,h,x]),B=o.useMemo(()=>p.filter(e=>!K(e.key,h,x)).map(e=>e.key),[p,h,x]),ge=o.useMemo(()=>{const e=new Set;return c!=null&&c.key&&e.add(c.key),x.forEach(r=>{_.includes(r)&&e.add(r)}),B.slice(0,3).forEach(r=>{_.includes(r)&&e.add(r)}),e.size===0&&_.length>0&&_.slice(0,Math.min(2,_.length)).forEach(r=>e.add(r)),Array.from(e)},[x,c,B,_]),ye=p.length,xe=te.length,se=c?V(c.key,c.name):null,k=o.useMemo(()=>l==="superadmin"?!0:(a==null?void 0:a.ai_integration)===!0,[a==null?void 0:a.ai_integration,l]);o.useEffect(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[G]);const S=o.useCallback(e=>{le(r=>[...r,e])},[]);o.useEffect(()=>{const e=Ne(M||m||ee.current||"");ee.current=e;const r=Ae(e);let u=Array.isArray(r==null?void 0:r.sections)?r.sections.filter(i=>i==null?void 0:i.key).map(i=>({key:i.key,name:i.name})):[];u=u.filter(i=>!W.has(i.key)),u.length===0&&(u=Object.keys(h||{}).filter(f=>f!=="_allowed_sections"&&f!=="_meta"&&!W.has(f)).map(f=>({key:f,name:V(f)})));const b=Ce[e];if(b&&b.length>0&&u.length>0){const i=new Map;u.forEach(g=>{i.set(g.key,g)});const f=[];b.forEach(g=>{const v=i.get(g);v&&(f.push(v),i.delete(g))}),i.forEach(g=>{f.push(g)}),u=f}pe(i=>i.length===u.length&&i.every((v,O)=>{const j=u[O];return v.key===j.key&&v.name===j.name})?i:(q.current=null,u))},[h,m,M]),o.useEffect(()=>{if(p.length===0){J(null),Z(!1);return}const e=p.find(r=>!K(r.key,h,x));J(r=>!e&&!r||e&&r&&e.key===r.key?r:e!=null?e:null),Z(!e)},[p,h,x]),o.useEffect(()=>{y||(N.current=!1)},[y]),o.useEffect(()=>{if(!c||y)return;const e=c.key;if(!e||q.current===e)return;const r=Oe(e,c.name);q.current=e,N.current=!1,S({id:I(),role:"assistant",content:r})},[S,c,y]),o.useEffect(()=>{!y||N.current||(N.current=!0,S({id:I(),role:"assistant",content:n("Great! I have filled in every section. You can review and make adjustments anytime or tell me what to tweak.")}))},[S,y,n]);const be=o.useCallback(e=>{const r={id:I(),role:"assistant",content:e.reply||n("I have updated your sections. Let me know if you want to adjust anything else!")};S(r);const u=H(e.sections||{}),b=Ie(h,u),i=H(b);he(i),N.current=!1,E==null||E(i,{reply:e.reply,done:e.done,followUps:e.follow_up_questions})},[h,S,c,E,p,n]),ve=async e=>{var b,i,f,g,v,O;const r=L.trim();if(!r||!k||w)return;const u={id:I(),role:"user",content:r};Q(""),S(u),$(!0);try{const j={business_name:F||void 0,business_type:M||void 0,tone:P,language:X,sections:h,active_section:c==null?void 0:c.key,section_label:c==null?void 0:c.name,template_sections:_,requested_sections:ge,pending_sections:B,completed_sections:te,chat:[...G,u].map(R=>({role:R.role,content:R.content}))},A=await Se.post(route("vcard-builder.ai.chat"),j);if((b=A.data)!=null&&b.success)be(A.data.data);else{const R=(f=(i=A.data)==null?void 0:i.message)!=null?f:n("Unable to generate AI response. Please try again.");oe.error(R)}}catch(j){const A=(O=(v=(g=j==null?void 0:j.response)==null?void 0:g.data)==null?void 0:v.message)!=null?O:n("Unable to generate AI response. Please try again later.");oe.error(A)}finally{$(!1)}},ae=o.useMemo(()=>k?null:s!=null&&s.name?n("AI chat is not included in your current plan ({{plan}}). Upgrade to unlock this feature.",{plan:s.name}):n("AI chat is not available for your account."),[k,n,s==null?void 0:s.name]);return t.jsxs(_e,{className:"border border-dashed",children:[t.jsx("div",{className:"border-b bg-muted/30 px-6 py-4",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("h2",{className:"text-lg font-semibold",children:n("AI Conversation")}),t.jsx("p",{className:"text-sm text-muted-foreground",children:n("Chat with the assistant to fill in your business card automatically. We will save each section as we go.")})]})}),t.jsxs("div",{className:"grid gap-6 p-6",children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-lg border bg-muted/10 px-4 py-3 text-sm text-muted-foreground",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-medium text-foreground",children:n("Progress: {{completed}} of {{total}} sections complete",{completed:xe,total:ye})}),se&&!y&&t.jsx("span",{children:n("Currently collecting: {{section}}",{section:se})}),y&&t.jsx("span",{children:n("All sections are filled. Ask me for tweaks or more ideas!")})]})}),t.jsxs("div",{className:"grid gap-4 rounded-lg border bg-muted/20 p-4",children:[t.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[t.jsxs("div",{className:"grid gap-1.5",children:[t.jsx(C,{htmlFor:"business_name",children:n("Business name")}),t.jsx(ne,{id:"business_name",value:F,placeholder:n("e.g. Horizon Builders"),onChange:e=>me(e.target.value)})]}),t.jsxs("div",{className:"grid gap-1.5",children:[t.jsx(C,{htmlFor:"business_type",children:n("Business category")}),t.jsx(ne,{id:"business_type",value:M,placeholder:n("e.g. construction, agency, salon"),onChange:e=>fe(e.target.value)})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-4",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx(C,{children:n("Tone")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Le.map(e=>t.jsx(z,{type:"button",size:"sm",variant:P===e.value?"default":"outline",onClick:()=>de(e.value),children:n(e.label)},e.value))})]}),t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx(C,{children:n("Language")}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Me.map(e=>t.jsx(z,{type:"button",size:"sm",variant:X===e.value?"default":"outline",onClick:()=>ue(e.value),children:n(e.label)},e.value))})]})]})]}),t.jsx("div",{className:"flex flex-col gap-3",children:t.jsx("div",{className:"relative rounded-lg border bg-background",children:t.jsx(we,{className:"h-[22rem]",children:t.jsxs("div",{ref:T,className:"flex flex-col gap-3 p-4",children:[G.map(e=>t.jsxs("div",{className:"rounded-xl border bg-muted/30 px-4 py-3 text-sm",children:[t.jsx("div",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:e.role==="assistant"?n("Assistant"):n("You")}),t.jsx("div",{className:"whitespace-pre-wrap text-foreground",children:e.content})]},e.id)),w&&t.jsx("div",{className:"flex justify-start",children:t.jsxs("div",{className:"flex items-center gap-2 rounded-2xl bg-muted px-4 py-2 text-sm text-muted-foreground",children:[t.jsx("span",{className:"inline-flex h-2 w-2 animate-ping rounded-full bg-primary"}),n("Assistant is thinking...")]})})]})})})}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(C,{htmlFor:"chat_message",children:n("Your message")}),t.jsx(ke,{id:"chat_message",placeholder:n("Share details about your services, clients, experience, or anything else you want on the card."),rows:3,maxLength:re,value:L,onChange:e=>Q(e.target.value),disabled:!k||w}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[t.jsx("span",{children:n("{{count}} characters remaining",{count:re-L.length})}),!k&&ae&&t.jsx("span",{className:"text-amber-600",children:ae})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(z,{onClick:()=>ve(),disabled:!k||w||!L.trim(),children:n(w?"Sending...":"Send message")})})]})]})]})};export{Ve as default};
