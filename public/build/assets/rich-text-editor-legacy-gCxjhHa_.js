!function(){var t=["editor","innerRef"],e=["start"];function n(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function r(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function s(t,e,n){return(e=C(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,s,a=[],u=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function c(t,e){if(t){if("string"==typeof t)return l(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e,n,r){var o=d(y(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function d(){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=y(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},d.apply(null,arguments)}function h(t,e,n){return e=y(e),function(t,e){if(e&&("object"==k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,m()?Reflect.construct(e,n||[],y(t).constructor):e.apply(t,n))}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}function v(t){var e="function"==typeof Map?new Map:void 0;return v=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(m())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&g(o,n.prototype),o}(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),g(n,t)},v(t)}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(m=function(){return!!t})()}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function w(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function C(t){var e=function(t,e){if("object"!=k(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==k(e)?e:e+""}System.register(["./ui-legacy-Df76W54t.js","./app-legacy-Ccoue2ey.js","./unlink-legacy-D8IWcxgG.js","./list-legacy-CJUMNP_u.js","./quote-legacy-joeQdhGw.js","./app-sidebar-layout-legacy-CLHyWU4i.js","./code-legacy-BMrwBJql.js"],function(o,c){"use strict";var l,d,m,g,y,b,C,x,E,A,S,M,O,T,F,N,B,R,I,P,L;return{setters:[function(t){l=t.R,d=t.r,m=t.q,g=t.j},function(t){y=t.k,b=t.B,C=t.an},function(t){x=t.B,E=t.I,A=t.S,S=t.a,M=t.A,O=t.b,T=t.L,F=t.c,N=t.U,B=t.R},function(t){R=t.L},function(t){I=t.Q},function(t){P=t.a},function(t){L=t.C}],execute:function(){function c(t){this.content=t}function z(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=z(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function j(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),u=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){for(var c=0,l=Math.min(s.text.length,a.text.length);c<l&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var f=j(s.content,a.content,n-1,r-1);if(f)return f}n-=u,r-=u}else n-=u,r-=u}}c.prototype={constructor:c,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new c(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new c(n)},addToStart:function(t,e){return new c([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new c(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new c(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=c.from(t)).size?new c(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=c.from(t)).size?new c(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=c.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}},c.from=function(t){if(t instanceof c)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new c(e)};var $=function(){function t(e,n){if(D(this,t),this.content=e,this.size=n||0,null==n)for(var r=0;r<e.length;r++)this.size+=e[r].nodeSize}return w(t,[{key:"nodesBetween",value:function(t,e,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,i=0,s=0;s<e;i++){var a=this.content[i],u=s+a.nodeSize;if(u>t&&!1!==n(a,r+s,o||null,i)&&a.content.size){var c=s+1;a.nodesBetween(Math.max(0,t-c),Math.min(a.content.size,e-c),n,r+c)}s=u}}},{key:"descendants",value:function(t){this.nodesBetween(0,this.size,t)}},{key:"textBetween",value:function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,function(s,a){var u=s.isText?s.text.slice(Math.max(t,a)-a,e-a):s.isLeaf?r?"function"==typeof r?r(s):r:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&u||s.isTextblock)&&n&&(i?i=!1:o+=n),o+=u},0),o}},{key:"append",value:function(e){if(!e.size)return this;if(!this.size)return e;var n=this.lastChild,r=e.firstChild,o=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(o[o.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)o.push(e.content[i]);return new t(o,this.size+e.size)}},{key:"cut",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size;if(0==e&&n==this.size)return this;var r=[],o=0;if(n>e)for(var i=0,s=0;s<n;i++){var a=this.content[i],u=s+a.nodeSize;u>e&&((s<e||u>n)&&(a=a.isText?a.cut(Math.max(0,e-s),Math.min(a.text.length,n-s)):a.cut(Math.max(0,e-s-1),Math.min(a.content.size,n-s-1))),r.push(a),o+=a.nodeSize),s=u}return new t(r,o)}},{key:"cutByIndex",value:function(e,n){return e==n?t.empty:0==e&&n==this.content.length?this:new t(this.content.slice(e,n))}},{key:"replaceChild",value:function(e,n){var r=this.content[e];if(r==n)return this;var o=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return o[e]=n,new t(o,i)}},{key:"addToStart",value:function(e){return new t([e].concat(this.content),this.size+e.nodeSize)}},{key:"addToEnd",value:function(e){return new t(this.content.concat(e),this.size+e.nodeSize)}},{key:"eq",value:function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}},{key:"childCount",get:function(){return this.content.length}},{key:"child",value:function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}},{key:"maybeChild",value:function(t){return this.content[t]||null}},{key:"forEach",value:function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}}},{key:"findDiffStart",value:function(t){return z(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)}},{key:"findDiffEnd",value:function(t){return j(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.size)}},{key:"findIndex",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(0==t)return H(0,t);if(t==this.size)return H(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position ".concat(t," outside of fragment (").concat(this,")"));for(var n=0,r=0;;n++){var o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?H(n+1,o):H(n,r);r=o}}},{key:"toString",value:function(){return"<"+this.toStringInner()+">"}},{key:"toStringInner",value:function(){return this.content.join(", ")}},{key:"toJSON",value:function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null}}],[{key:"fromJSON",value:function(e,n){if(!n)return t.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new t(n.map(e.nodeFromJSON))}},{key:"fromArray",value:function(e){if(!e.length)return t.empty;for(var n,r=0,o=0;o<e.length;o++){var i=e[o];r+=i.nodeSize,o&&i.isText&&e[o-1].sameMarkup(i)?(n||(n=e.slice(0,o)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new t(n||e,r)}},{key:"from",value:function(e){if(!e)return t.empty;if(e instanceof t)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new t([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}])}();$.empty=new $([],0);var V={index:0,offset:0};function H(t,e){return V.index=t,V.offset=e,V}function W(t,e){if(t===e)return!0;if(!t||"object"!=k(t)||!e||"object"!=k(e))return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!W(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!W(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}var _=function(){function t(e,n){D(this,t),this.type=e,this.attrs=n}return w(t,[{key:"addToSet",value:function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e}},{key:"removeFromSet",value:function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}},{key:"isInSet",value:function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}},{key:"eq",value:function(t){return this==t||this.type==t.type&&W(this.attrs,t.attrs)}},{key:"toJSON",value:function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t}}],[{key:"fromJSON",value:function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type ".concat(e.type," in this schema"));var r=n.create(e.attrs);return n.checkAttrs(r.attrs),r}},{key:"sameSet",value:function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}},{key:"setFrom",value:function(e){if(!e||Array.isArray(e)&&0==e.length)return t.none;if(e instanceof t)return[e];var n=e.slice();return n.sort(function(t,e){return t.type.rank-e.type.rank}),n}}])}();_.none=[];var q=function(t){function e(){return D(this,e),h(this,e,arguments)}return p(e,t),w(e)}(v(Error)),K=function(){function t(e,n,r){D(this,t),this.content=e,this.openStart=n,this.openEnd=r}return w(t,[{key:"size",get:function(){return this.content.size-this.openStart-this.openEnd}},{key:"insertAt",value:function(e,n){var r=U(this.content,e+this.openStart,n);return r&&new t(r,this.openStart,this.openEnd)}},{key:"removeBetween",value:function(e,n){return new t(J(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}},{key:"eq",value:function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}},{key:"toString",value:function(){return this.content+"("+this.openStart+","+this.openEnd+")"}},{key:"toJSON",value:function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}}],[{key:"fromJSON",value:function(e,n){if(!n)return t.empty;var r=n.openStart||0,o=n.openEnd||0;if("number"!=typeof r||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new t($.fromJSON(e,n.content),r,o)}},{key:"maxOpen",value:function(e){for(var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=0,o=0,i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(var s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)o++;return new t(e,r,o)}}])}();function J(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),u=a.index,c=a.offset;if(i==e||s.isText){if(c!=n&&!t.child(u).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=u)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(J(s.content,e-i-1,n-i-1)))}function U(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return t.cut(0,e).append(n).append(t.cut(e));var u=U(a.content,e-s-1,n);return u&&t.replaceChild(i,a.copy(u))}function G(t,e,n){if(n.openStart>t.depth)throw new q("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new q("Inconsistent open depths");return Q(t,e,n,0)}function Q(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=Q(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=function(t,e){for(var n=e.depth-t.openStart,r=e.node(n).copy(t.content),o=n-1;o>=0;o--)r=e.node(o).copy($.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return et(i,nt(t,a.start,a.end,e,r))}var u=t.parent,c=u.content;return et(u,c.cut(0,t.parentOffset).append(n.content).append(c.cut(e.parentOffset)))}return et(i,rt(t,e,r))}function Y(t,e){if(!e.type.compatibleContent(t.type))throw new q("Cannot join "+e.type.name+" onto "+t.type.name)}function X(t,e,n){var r=t.node(n);return Y(r,e.node(n)),r}function Z(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function tt(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Z(t.nodeAfter,r),i++));for(var a=i;a<s;a++)Z(o.child(a),r);e&&e.depth==n&&e.textOffset&&Z(e.nodeBefore,r)}function et(t,e){return t.type.checkContent(e),t.copy(e)}function nt(t,e,n,r,o){var i=t.depth>o&&X(t,e,o+1),s=r.depth>o&&X(n,r,o+1),a=[];return tt(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(Y(i,s),Z(et(i,nt(t,e,n,r,o+1)),a)):(i&&Z(et(i,rt(t,e,o+1)),a),tt(e,n,o,a),s&&Z(et(s,rt(n,r,o+1)),a)),tt(r,null,o,a),new $(a)}function rt(t,e,n){var r=[];(tt(null,t,n,r),t.depth>n)&&Z(et(X(t,e,n+1),rt(t,e,n+1)),r);return tt(e,null,n,r),new $(r)}K.empty=new K($.empty,0,0);var ot=function(){function t(e,n,r){D(this,t),this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}return w(t,[{key:"resolveDepth",value:function(t){return null==t?this.depth:t<0?this.depth+t:t}},{key:"parent",get:function(){return this.node(this.depth)}},{key:"doc",get:function(){return this.node(0)}},{key:"node",value:function(t){return this.path[3*this.resolveDepth(t)]}},{key:"index",value:function(t){return this.path[3*this.resolveDepth(t)+1]}},{key:"indexAfter",value:function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}},{key:"start",value:function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}},{key:"end",value:function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}},{key:"before",value:function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}},{key:"after",value:function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}},{key:"textOffset",get:function(){return this.pos-this.path[this.path.length-1]}},{key:"nodeAfter",get:function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}},{key:"nodeBefore",get:function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}},{key:"posAtIndex",value:function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r}},{key:"marks",value:function(){var t=this.parent,e=this.index();if(0==t.content.size)return _.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i}},{key:"marksAcross",value:function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n}},{key:"sharedDepth",value:function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}},{key:"blockRange",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments.length>1?arguments[1]:void 0;if(t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new ut(this,t,n);return null}},{key:"sameParent",value:function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}},{key:"max",value:function(t){return t.pos>this.pos?t:this}},{key:"min",value:function(t){return t.pos<this.pos?t:this}},{key:"toString",value:function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}}],[{key:"resolve",value:function(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");for(var r=[],o=0,i=n,s=e;;){var a=s.content.findIndex(i),u=a.index,c=a.offset,l=i-c;if(r.push(s,u,o+c),!l)break;if((s=s.child(u)).isText)break;i=l-1,o+=c+1}return new t(n,r,i)}},{key:"resolveCached",value:function(e,n){var r=at.get(e);if(r)for(var o=0;o<r.elts.length;o++){var i=r.elts[o];if(i.pos==n)return i}else at.set(e,r=new it);var s=r.elts[r.i]=t.resolve(e,n);return r.i=(r.i+1)%st,s}}])}(),it=w(function t(){D(this,t),this.elts=[],this.i=0}),st=12,at=new WeakMap,ut=function(){return w(function t(e,n,r){D(this,t),this.$from=e,this.$to=n,this.depth=r},[{key:"start",get:function(){return this.$from.before(this.depth+1)}},{key:"end",get:function(){return this.$to.after(this.depth+1)}},{key:"parent",get:function(){return this.$from.node(this.depth)}},{key:"startIndex",get:function(){return this.$from.index(this.depth)}},{key:"endIndex",get:function(){return this.$to.indexAfter(this.depth)}}])}(),ct=Object.create(null),lt=function(){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_.none;D(this,t),this.type=e,this.attrs=n,this.marks=o,this.content=r||$.empty}return w(t,[{key:"children",get:function(){return this.content.content}},{key:"nodeSize",get:function(){return this.isLeaf?1:2+this.content.size}},{key:"childCount",get:function(){return this.content.childCount}},{key:"child",value:function(t){return this.content.child(t)}},{key:"maybeChild",value:function(t){return this.content.maybeChild(t)}},{key:"forEach",value:function(t){this.content.forEach(t)}},{key:"nodesBetween",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.content.nodesBetween(t,e,n,r,this)}},{key:"descendants",value:function(t){this.nodesBetween(0,this.content.size,t)}},{key:"textContent",get:function(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}},{key:"textBetween",value:function(t,e,n,r){return this.content.textBetween(t,e,n,r)}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"eq",value:function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}},{key:"sameMarkup",value:function(t){return this.hasMarkup(t.type,t.attrs,t.marks)}},{key:"hasMarkup",value:function(t,e,n){return this.type==t&&W(this.attrs,e||t.defaultAttrs||ct)&&_.sameSet(this.marks,n||_.none)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e==this.content?this:new t(this.type,this.attrs,e,this.marks)}},{key:"mark",value:function(e){return e==this.marks?this:new t(this.type,this.attrs,this.content,e)}},{key:"cut",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.content.size;return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}},{key:"slice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.content.size,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t==e)return K.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new K(a,r.depth-i,o.depth-i)}},{key:"replace",value:function(t,e,n){return G(this.resolve(t),this.resolve(e),n)}},{key:"nodeAt",value:function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(!(e=e.maybeChild(r)))return null;if(o==t||e.isText)return e;t-=o+1}}},{key:"childAfter",value:function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}}},{key:"childBefore",value:function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}}},{key:"resolve",value:function(t){return ot.resolveCached(this,t)}},{key:"resolveNoCache",value:function(t){return ot.resolve(this,t)}},{key:"rangeHasMark",value:function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,function(t){return n.isInSet(t.marks)&&(r=!0),!r}),r}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"inlineContent",get:function(){return this.type.inlineContent}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"isLeaf",get:function(){return this.type.isLeaf}},{key:"isAtom",get:function(){return this.type.isAtom}},{key:"toString",value:function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),dt(this.marks,t)}},{key:"contentMatchAt",value:function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}},{key:"canReplace",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$.empty,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.childCount,i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}},{key:"canReplaceWith",value:function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd}},{key:"canAppend",value:function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}},{key:"check",value:function(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);for(var t=_.none,e=0;e<this.marks.length;e++){var n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!_.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node ".concat(this.type.name,": ").concat(this.marks.map(function(t){return t.type.name})));this.content.forEach(function(t){return t.check()})}},{key:"toJSON",value:function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(t){return t.toJSON()})),t}}],[{key:"fromJSON",value:function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=void 0;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=$.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,r,n);return o.type.checkAttrs(o.attrs),o}}])}();lt.prototype.text=void 0;var ft=function(t){function e(t,n,r,o){var i;if(D(this,e),i=h(this,e,[t,n,null,o]),!r)throw new RangeError("Empty text nodes are not allowed");return i.text=r,i}return p(e,t),w(e,[{key:"toString",value:function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):dt(this.marks,JSON.stringify(this.text))}},{key:"textContent",get:function(){return this.text}},{key:"textBetween",value:function(t,e){return this.text.slice(t,e)}},{key:"nodeSize",get:function(){return this.text.length}},{key:"mark",value:function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)}},{key:"withText",value:function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)}},{key:"cut",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.text.length;return 0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))}},{key:"eq",value:function(t){return this.sameMarkup(t)&&this.text==t.text}},{key:"toJSON",value:function(){var t=f(e,"toJSON",this,3)([]);return t.text=this.text,t}}])}(lt);function dt(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var ht=function(){function t(e){D(this,t),this.validEnd=e,this.next=[],this.wrapCache=[]}return w(t,[{key:"matchType",value:function(t){for(var e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}},{key:"matchFragment",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.childCount,r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r}},{key:"inlineContent",get:function(){return 0!=this.next.length&&this.next[0].type.isInline}},{key:"defaultType",get:function(){for(var t=0;t<this.next.length;t++){var e=this.next[t].type;if(!e.isText&&!e.hasRequiredAttrs())return e}return null}},{key:"compatible",value:function(t){for(var e=0;e<this.next.length;e++)for(var n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}},{key:"fillBefore",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[this];return function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return $.from(s.map(function(t){return t.createAndFill()}));for(var u=0;u<i.next.length;u++){var c=i.next[u],l=c.type,f=c.next;if(!l.isText&&!l.hasRequiredAttrs()&&-1==r.indexOf(f)){r.push(f);var d=o(f,s.concat(l));if(d)return d}}return null}(this,[])}},{key:"findWrapping",value:function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n}},{key:"computeWrapping",value:function(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a++){var u=o.next[a],c=u.type,l=u.next;c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!l.validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}return null}},{key:"edgeCount",get:function(){return this.next.length}},{key:"edge",value:function(t){if(t>=this.next.length)throw new RangeError("There's no ".concat(t,"th edge in this content match"));return this.next[t]}},{key:"toString",value:function(){var t=[];return function e(n){t.push(n);for(var r=0;r<n.next.length;r++)-1==t.indexOf(n.next[r].next)&&e(n.next[r].next)}(this),t.map(function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o++)r+=(o?", ":"")+e.next[o].type.name+"->"+t.indexOf(e.next[o].next);return r}).join("\n")}}],[{key:"parse",value:function(e,n){var r=new pt(e,n);if(null==r.next)return t.empty;var o=vt(r);r.next&&r.err("Unexpected trailing text");var i=wt(function(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach(function(t){return t.to=e})}function i(t,e){if("choice"==t.type)return t.exprs.reduce(function(t,n){return t.concat(i(n,e))},[]);if("seq"!=t.type){if("star"==t.type){var s=n();return r(e,s),o(i(t.expr,s),s),[r(s)]}if("plus"==t.type){var a=n();return o(i(t.expr,e),a),o(i(t.expr,a),a),[r(a)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var u=e,c=0;c<t.min;c++){var l=n();o(i(t.expr,u),l),u=l}if(-1==t.max)o(i(t.expr,u),u);else for(var f=t.min;f<t.max;f++){var d=n();r(u,d),o(i(t.expr,u),d),u=d}return[r(u)]}if("name"==t.type)return[r(e,void 0,t.value)];throw new Error("Unknown expr type")}for(var h=0;;h++){var p=i(t.exprs[h],e);if(h==t.exprs.length-1)return p;o(p,e=n())}}}(o));return function(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a++){var u=o.next[a],c=u.type,l=u.next;s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(l)&&r.push(l)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,r),i}}])}();ht.empty=new ht(!0);var pt=function(){return w(function t(e,n){D(this,t),this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},[{key:"next",get:function(){return this.tokens[this.pos]}},{key:"eat",value:function(t){return this.next==t&&(this.pos++||!0)}},{key:"err",value:function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}])}();function vt(t){var e=[];do{e.push(mt(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function mt(t){var e=[];do{e.push(gt(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function gt(t){for(var e=function(t){if(t.eat("(")){var e=vt(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=function(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.isInGroup(e)&&o.push(s)}0==o.length&&t.err("No node type or group '"+e+"' found");return o}(t,t.next).map(function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}});return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=kt(t,e)}return e}function yt(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function kt(t,e){var n=yt(t),r=n;return t.eat(",")&&(r="}"!=t.next?yt(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Dt(t,e){return e-t}function bt(t,e){var n=[];return function e(r){var o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,u=s.to;a||-1!=n.indexOf(u)||e(u)}}(e),n.sort(Dt)}function wt(t){var e=Object.create(null);return function n(r){var o=[];r.forEach(function(e){t[e].forEach(function(e){var n=e.term,r=e.to;if(n){for(var i,s=0;s<o.length;s++)o[s][0]==n&&(i=o[s][1]);bt(t,r).forEach(function(t){i||o.push([n,i=[]]),-1==i.indexOf(t)&&i.push(t)})}})});for(var i=e[r.join(",")]=new ht(r.indexOf(t.length-1)>-1),s=0;s<o.length;s++){var a=o[s][1].sort(Dt);i.next.push({type:o[s][0],next:e[a.join(",")]||n(a)})}return i}(bt(t,0))}function Ct(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function xt(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function Et(t,e,n,r){for(var o in e)if(!(o in t))throw new RangeError("Unsupported attribute ".concat(o," for ").concat(n," of type ").concat(o));for(var i in t){var s=t[i];s.validate&&s.validate(e[i])}}function At(t,e){var n=Object.create(null);if(e)for(var r in e)n[r]=new Mt(t,r,e[r]);return n}var St=function(){function t(e,n,r){D(this,t),this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=At(e,r.attrs),this.defaultAttrs=Ct(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||"text"==e),this.isText="text"==e}return w(t,[{key:"isInline",get:function(){return!this.isBlock}},{key:"isTextblock",get:function(){return this.isBlock&&this.inlineContent}},{key:"isLeaf",get:function(){return this.contentMatch==ht.empty}},{key:"isAtom",get:function(){return this.isLeaf||!!this.spec.atom}},{key:"isInGroup",value:function(t){return this.groups.indexOf(t)>-1}},{key:"whitespace",get:function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}},{key:"hasRequiredAttrs",value:function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}},{key:"compatibleContent",value:function(t){return this==t||this.contentMatch.compatible(t.contentMatch)}},{key:"computeAttrs",value:function(t){return!t&&this.defaultAttrs?this.defaultAttrs:xt(this.attrs,t)}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new lt(this,this.computeAttrs(t),$.from(e),_.setFrom(n))}},{key:"createChecked",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e=$.from(e),this.checkContent(e),new lt(this,this.computeAttrs(t),e,_.setFrom(n))}},{key:"createAndFill",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(t=this.computeAttrs(t),(e=$.from(e)).size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e),i=o&&o.fillBefore($.empty,!0);return i?new lt(this,t,e.append(i),_.setFrom(n)):null}},{key:"validContent",value:function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}},{key:"checkContent",value:function(t){if(!this.validContent(t))throw new RangeError("Invalid content for node ".concat(this.name,": ").concat(t.toString().slice(0,50)))}},{key:"checkAttrs",value:function(t){Et(this.attrs,t,"node",this.name)}},{key:"allowsMarkType",value:function(t){return null==this.markSet||this.markSet.indexOf(t)>-1}},{key:"allowsMarks",value:function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}},{key:"allowedMarks",value:function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:_.none:t}}],[{key:"compile",value:function(e,n){var r=Object.create(null);e.forEach(function(e,o){return r[e]=new t(e,n,o)});var o=n.spec.topNode||"doc";if(!r[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}])}();var Mt=function(){return w(function t(e,n,r){D(this,t),this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate="string"==typeof r.validate?function(t,e,n){var r=n.split("|");return function(n){var o=null===n?"null":k(n);if(r.indexOf(o)<0)throw new RangeError("Expected value of type ".concat(r," for attribute ").concat(e," on type ").concat(t,", got ").concat(o))}}(e,n,r.validate):r.validate},[{key:"isRequired",get:function(){return!this.hasDefault}}])}(),Ot=function(){function t(e,n,r,o){D(this,t),this.name=e,this.rank=n,this.schema=r,this.spec=o,this.attrs=At(e,o.attrs),this.excluded=null;var i=Ct(this.attrs);this.instance=i?new _(this,i):null}return w(t,[{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!t&&this.instance?this.instance:new _(this,xt(this.attrs,t))}},{key:"removeFromSet",value:function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}},{key:"isInSet",value:function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]}},{key:"checkAttrs",value:function(t){Et(this.attrs,t,"mark",this.name)}},{key:"excludes",value:function(t){return this.excluded.indexOf(t)>-1}}],[{key:"compile",value:function(e,n){var r=Object.create(null),o=0;return e.forEach(function(e,i){return r[e]=new t(e,o++,n,i)}),r}}])}(),Tt=function(){return w(function t(e){D(this,t),this.linebreakReplacement=null,this.cached=Object.create(null);var n=this.spec={};for(var r in e)n[r]=e[r];n.nodes=c.from(e.nodes),n.marks=c.from(e.marks||{}),this.nodes=St.compile(this.spec.nodes,this),this.marks=Ot.compile(this.spec.marks,this);var o=Object.create(null);for(var i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");var s=this.nodes[i],a=s.spec.content||"",u=s.spec.marks;if(s.contentMatch=o[a]||(o[a]=ht.parse(a,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet="_"==u?null:u?Ft(this,u.split(" ")):""!=u&&s.inlineContent?null:[]}for(var l in this.marks){var f=this.marks[l],d=f.spec.excludes;f.excluded=null==d?[f]:""==d?[]:Ft(this,d.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)},[{key:"node",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof St))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)}},{key:"text",value:function(t,e){var n=this.nodes.text;return new ft(n,n.defaultAttrs,t,_.setFrom(e))}},{key:"mark",value:function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)}},{key:"nodeFromJSON",value:function(t){return lt.fromJSON(this,t)}},{key:"markFromJSON",value:function(t){return _.fromJSON(this,t)}},{key:"nodeType",value:function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}])}();function Ft(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var u=t.marks[a];("_"==o||u.spec.group&&u.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=u)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}var Nt=function(){function t(e,n){var r=this;D(this,t),this.schema=e,this.rules=n,this.tags=[],this.styles=[];var o=this.matchedStyles=[];n.forEach(function(t){if(function(t){return null!=t.tag}(t))r.tags.push(t);else if(function(t){return null!=t.style}(t)){var e=/[^=]*/.exec(t.style)[0];o.indexOf(e)<0&&o.push(e),r.styles.push(t)}}),this.normalizeLists=!this.tags.some(function(t){if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;var n=e.nodes[t.node];return n.contentMatch.matchType(n)})}return w(t,[{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new zt(this,e,!1);return n.addAll(t,_.none,e.from,e.to),n.finish()}},{key:"parseSlice",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new zt(this,e,!0);return n.addAll(t,_.none,e.from,e.to),K.maxOpen(n.finish())}},{key:"matchTag",value:function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if(jt(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i||void 0}return o}}}},{key:"matchStyle",value:function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o],s=i.style;if(!(0!=s.indexOf(t)||i.context&&!n.matchesContext(i.context)||s.length>t.length&&(61!=s.charCodeAt(t.length)||s.slice(t.length+1)!=e))){if(i.getAttrs){var a=i.getAttrs(e);if(!1===a)continue;i.attrs=a||void 0}return i}}}}],[{key:"schemaRules",value:function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r];if((null==o.priority?50:o.priority)<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach(function(t){n(t=$t(t)),t.mark||t.ignore||t.clearMark||(t.mark=e)})};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[e].spec.parseDOM;r&&r.forEach(function(t){n(t=$t(t)),t.node||t.ignore||t.mark||(t.node=e)})};for(var s in t.nodes)i(s);return e}},{key:"fromSchema",value:function(e){return e.cached.domParser||(e.cached.domParser=new t(e,t.schemaRules(e)))}}])}(),Bt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Rt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},It={ol:!0,ul:!0};function Pt(t,e,n){return null!=e?(e?1:0)|("full"===e?2:0):t&&"pre"==t.whitespace?3:-5&n}var Lt=function(){return w(function t(e,n,r,o,i,s){D(this,t),this.type=e,this.attrs=n,this.marks=r,this.solid=o,this.options=s,this.content=[],this.activeMarks=_.none,this.match=i||(4&s?null:e.contentMatch)},[{key:"findWrapping",value:function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore($.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}},{key:"finish",value:function(t){if(!(1&this.options)){var e,n=this.content[this.content.length-1];if(n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))){var r=n;n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-e[0].length))}}var o=$.from(this.content);return!t&&this.match&&(o=o.append(this.match.fillBefore($.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o}},{key:"inlineContext",value:function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Bt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}])}(),zt=function(){return w(function t(e,n,r){D(this,t),this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;var o,i=n.topNode,s=Pt(null,n.preserveWhitespace,0)|(r?4:0);o=i?new Lt(i.type,i.attrs,_.none,!0,n.topMatch||i.type.contentMatch,s):new Lt(r?null:e.schema.topNodeType,null,_.none,!0,null,s),this.nodes=[o],this.find=n.findPositions,this.needsBlock=!1},[{key:"top",get:function(){return this.nodes[this.open]}},{key:"addDOM",value:function(t,e){3==t.nodeType?this.addTextNode(t,e):1==t.nodeType&&this.addElement(t,e)}},{key:"addTextNode",value:function(t,e){var n=t.nodeValue,r=this.top,o=2&r.options?"full":this.localPreserveWS||(1&r.options)>0;if("full"===o||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(o)n="full"!==o?n.replace(/\r?\n|\r/g," "):n.replace(/\r\n?/g,"\n");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){var i=r.content[r.content.length-1],s=t.previousSibling;(!i||s&&"BR"==s.nodeName||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)}},{key:"addElement",value:function(t,e,n){var r=this.localPreserveWS,o=this.top;("PRE"==t.tagName||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);var i,s=t.nodeName.toLowerCase();It.hasOwnProperty(s)&&this.parser.normalizeLists&&function(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&It.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}(t);var a=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,n));t:if(a?a.ignore:Rt.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(t=a.skip);var u,c=this.needsBlock;if(Bt.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),u=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}var l=a&&a.skip?e:this.readStyles(t,e);l&&this.addAll(t,l),u&&this.sync(o),this.needsBlock=c}else{var f=this.readStyles(t,e);f&&this.addElementByRule(t,a,f,!1===a.consuming?i:void 0)}this.localPreserveWS=r}},{key:"leafFallback",value:function(t,e){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"),e)}},{key:"ignoreFallback",value:function(t,e){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),e,!0)}},{key:"readStyles",value:function(t,e){var n=this,r=t.style;if(r&&r.length)for(var o=0;o<this.parser.matchedStyles.length;o++){var i=this.parser.matchedStyles[o],s=r.getPropertyValue(i);if(s)for(var a,u=function(t){var r=n.parser.matchStyle(i,s,n,t);return r?r.ignore?{v:null}:(e=r.clearMark?e.filter(function(t){return!r.clearMark(t)}):e.concat(n.parser.schema.marks[r.mark].create(r.attrs)),!1!==r.consuming?(c=t,0):void(c=t=r)):(c=t,0)},c=void 0;0!==(a=u(c));)if(a)return a.v}return e}},{key:"addElementByRule",value:function(t,e,n,r){var o,i,s=this;if(e.node)if((i=this.parser.schema.nodes[e.node]).isLeaf)this.insertNode(i.create(e.attrs),n,"BR"==t.nodeName)||this.leafFallback(t,n);else{var a=this.enter(i,e.attrs||null,n,e.preserveWhitespace);a&&(o=!0,n=a)}else{var u=this.parser.schema.marks[e.mark];n=n.concat(u.create(e.attrs))}var c=this.top;if(i&&i.isLeaf)this.findInside(t);else if(r)this.addElement(t,n,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(t){return s.insertNode(t,n,!1)});else{var l=t;"string"==typeof e.contentElement?l=t.querySelector(e.contentElement):"function"==typeof e.contentElement?l=e.contentElement(t):e.contentElement&&(l=e.contentElement),this.findAround(t,l,!0),this.addAll(l,n),this.findAround(t,l,!1)}o&&this.sync(c)&&this.open--}},{key:"addAll",value:function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i,e);this.findAtPoint(t,o)}},{key:"findPlace",value:function(t,e,n){for(var r,o,i=this.open,s=0;i>=0;i--){var a=this.nodes[i],u=a.findWrapping(t);if(u&&(!r||r.length>u.length+s)&&(r=u,o=a,!u.length))break;if(a.solid){if(n)break;s+=2}}if(!r)return null;this.sync(o);for(var c=0;c<r.length;c++)e=this.enterInner(r[c],null,e,!1);return e}},{key:"insertNode",value:function(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&(e=this.enterInner(r,null,e))}var o=this.findPlace(t,e,n);if(o){this.closeExtra();var i=this.top;i.match&&(i.match=i.match.matchType(t.type));var s,a=_.none,c=u(o.concat(t.marks));try{for(c.s();!(s=c.n()).done;){var l=s.value;(i.type?i.type.allowsMarkType(l.type):Vt(l.type,t.type))&&(a=l.addToSet(a))}}catch(f){c.e(f)}finally{c.f()}return i.content.push(t.mark(a)),!0}return!1}},{key:"enter",value:function(t,e,n,r){var o=this.findPlace(t.create(e),n,!1);return o&&(o=this.enterInner(t,e,n,!0,r)),o}},{key:"enterInner",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;this.closeExtra();var i=this.top;i.match=i.match&&i.match.matchType(t);var s=Pt(t,o,i.options);4&i.options&&0==i.content.length&&(s|=4);var a=_.none;return n=n.filter(function(e){return!(i.type?i.type.allowsMarkType(e.type):Vt(e.type,t))||(a=e.addToSet(a),!1)}),this.nodes.push(new Lt(t,e,a,r,null,s)),this.open++,n}},{key:"closeExtra",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}},{key:"finish",value:function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}},{key:"sync",value:function(t){for(var e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=1)}return!1}},{key:"currentPos",get:function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t}},{key:"findAtPoint",value:function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}},{key:"findInside",value:function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}},{key:"findAround",value:function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++){if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node))e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}},{key:"findInText",value:function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}},{key:"matchesContext",value:function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var u=n[t];if(""==u){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var c=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;a--}return!0};return s(n.length-1,this.open)}},{key:"textblockFromContext",value:function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}}}])}();function jt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function $t(t){var e={};for(var n in t)e[n]=t[n];return e}function Vt(t,e){var n,r=e.schema.nodes,o=function(){var n=r[i];if(!n.allowsMarkType(t))return 0;var o=[],s=function(t){o.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),i=r.type,a=r.next;if(i==e)return!0;if(o.indexOf(a)<0&&s(a))return!0}};return s(n.contentMatch)?{v:!0}:void 0};for(var i in r)if(0!==(n=o())&&n)return n.v}var Ht=function(){function t(e,n){D(this,t),this.nodes=e,this.marks=n}return w(t,[{key:"serializeFragment",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;r||(r=_t(n).createDocumentFragment());var o=r,i=[];return t.forEach(function(t){if(i.length||t.marks.length){for(var r=0,s=0;r<i.length&&s<t.marks.length;){var a=t.marks[s];if(e.marks[a.type.name]){if(!a.eq(i[r][0])||!1===a.type.spec.spanning)break;r++,s++}else s++}for(;r<i.length;)o=i.pop()[1];for(;s<t.marks.length;){var u=t.marks[s++],c=e.serializeMark(u,t.isInline,n);c&&(i.push([u,o]),o.appendChild(c.dom),o=c.contentDOM||c.dom)}}o.appendChild(e.serializeNodeInner(t,n))}),r}},{key:"serializeNodeInner",value:function(t,e){var n=Jt(_t(e),this.nodes[t.type.name](t),null,t.attrs),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,o)}return r}},{key:"serializeNode",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.serializeNodeInner(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n}},{key:"serializeMark",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.marks[t.type.name];return r&&Jt(_t(n),r(t,e),null,t.attrs)}}],[{key:"renderSpec",value:function(t,e){return Jt(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0)}},{key:"fromSchema",value:function(e){return e.cached.domSerializer||(e.cached.domSerializer=new t(this.nodesFromSchema(e),this.marksFromSchema(e)))}},{key:"nodesFromSchema",value:function(t){var e=Wt(t.nodes);return e.text||(e.text=function(t){return t.text}),e}},{key:"marksFromSchema",value:function(t){return Wt(t.marks)}}])}();function Wt(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function _t(t){return t.document||window.document}var qt=new WeakMap;function Kt(t){var e=qt.get(t);return void 0===e&&qt.set(t,e=function(t){var e=null;function n(t){if(t&&"object"==k(t))if(Array.isArray(t))if("string"==typeof t[0])e||(e=[]),e.push(t);else for(var r=0;r<t.length;r++)n(t[r]);else for(var o in t)n(t[o])}return n(t),e}(t)),e}function Jt(t,e,n,r){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var o,i=e[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=Kt(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");var s,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));var u=n?t.createElementNS(n,i):t.createElement(i),c=e[1],l=1;if(c&&"object"==k(c)&&null==c.nodeType&&!Array.isArray(c))for(var f in l=2,c)if(null!=c[f]){var d=f.indexOf(" ");d>0?u.setAttributeNS(f.slice(0,d),f.slice(d+1),c[f]):u.setAttribute(f,c[f])}for(var h=l;h<e.length;h++){var p=e[h];if(0===p){if(h<e.length-1||h>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:u,contentDOM:u}}var v=Jt(t,p,n,r),m=v.dom,g=v.contentDOM;if(u.appendChild(m),g){if(s)throw new RangeError("Multiple content holes");s=g}}return{dom:u,contentDOM:s}}var Ut=Math.pow(2,16);function Gt(t,e){return t+e*Ut}function Qt(t){return 65535&t}var Yt=function(){return w(function t(e,n,r){D(this,t),this.pos=e,this.delInfo=n,this.recover=r},[{key:"deleted",get:function(){return(8&this.delInfo)>0}},{key:"deletedBefore",get:function(){return(5&this.delInfo)>0}},{key:"deletedAfter",get:function(){return(6&this.delInfo)>0}},{key:"deletedAcross",get:function(){return(4&this.delInfo)>0}}])}(),Xt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(D(this,t),this.ranges=e,this.inverted=n,!e.length&&t.empty)return t.empty}return w(t,[{key:"recover",value:function(t){var e=0,n=Qt(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/Ut}(t)}},{key:"mapResult",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._map(t,e,!1)}},{key:"map",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._map(t,e,!0)}},{key:"_map",value:function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var u=this.ranges[s+o],c=this.ranges[s+i],l=a+u;if(t<=l){var f=a+r+((u?t==a?-1:t==l?1:e:e)<0?0:c);if(n)return f;var d=t==(e<0?a:l)?null:Gt(s/3,t-a),h=t==a?2:t==l?1:4;return(e<0?t!=a:t!=l)&&(h|=8),new Yt(f,h,d)}r+=c-u}return n?t+r:new Yt(t+r,0,null)}},{key:"touches",value:function(t,e){for(var n=0,r=Qt(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var u=this.ranges[s+o];if(t<=a+u&&s==3*r)return!0;n+=this.ranges[s+i]-u}return!1}},{key:"forEach",value:function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),u=this.ranges[r+e],c=this.ranges[r+n];t(s,s+u,a,a+c),o+=c-u}}},{key:"invert",value:function(){return new t(this.ranges,!this.inverted)}},{key:"toString",value:function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}}],[{key:"offset",value:function(e){return 0==e?t.empty:new t(e<0?[0,-e,0]:[0,0,e])}}])}();Xt.empty=new Xt([]);var Zt=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e?e.length:0;D(this,t),this.mirror=n,this.from=r,this.to=o,this._maps=e||[],this.ownData=!(e||n)}return w(t,[{key:"maps",get:function(){return this._maps}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maps.length;return new t(this._maps,this.mirror,e,n)}},{key:"appendMap",value:function(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),null!=e&&this.setMirror(this._maps.length-1,e)}},{key:"appendMapping",value:function(t){for(var e=0,n=this._maps.length;e<t._maps.length;e++){var r=t.getMirror(e);this.appendMap(t._maps[e],null!=r&&r<e?n+r:void 0)}}},{key:"getMirror",value:function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}},{key:"setMirror",value:function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}},{key:"appendMappingInverted",value:function(t){for(var e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t._maps[e].invert(),null!=r&&r>e?n-r-1:void 0)}}},{key:"invert",value:function(){var e=new t;return e.appendMappingInverted(this),e}},{key:"map",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t}},{key:"mapResult",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._map(t,e,!1)}},{key:"_map",value:function(t,e,n){for(var r=0,o=this.from;o<this.to;o++){var i=this._maps[o].mapResult(t,e);if(null!=i.recover){var s=this.getMirror(o);if(null!=s&&s>o&&s<this.to){o=s,t=this._maps[s].recover(i.recover);continue}}r|=i.delInfo,t=i.pos}return n?t:new Yt(t,r,null)}}])}(),te=Object.create(null),ee=function(){return w(function t(){D(this,t)},[{key:"getMap",value:function(){return Xt.empty}},{key:"merge",value:function(t){return null}}],[{key:"fromJSON",value:function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=te[e.stepType];if(!n)throw new RangeError("No step type ".concat(e.stepType," defined"));return n.fromJSON(t,e)}},{key:"jsonID",value:function(t,e){if(t in te)throw new RangeError("Duplicate use of step JSON ID "+t);return te[t]=e,e.prototype.jsonID=t,e}}])}(),ne=function(){function t(e,n){D(this,t),this.doc=e,this.failed=n}return w(t,null,[{key:"ok",value:function(e){return new t(e,null)}},{key:"fail",value:function(e){return new t(null,e)}},{key:"fromReplace",value:function(e,n,r,o){try{return t.ok(e.replace(n,r,o))}catch(i){if(i instanceof q)return t.fail(i.message);throw i}}}])}();function re(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(re(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return $.fromArray(r)}var oe=function(t){function e(t,n,r){var o;return D(this,e),(o=h(this,e)).from=t,o.to=n,o.mark=r,o}return p(e,t),w(e,[{key:"apply",value:function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new K(re(n.content,function(t,n){return t.isAtom&&n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t},o),n.openStart,n.openEnd);return ne.fromReplace(t,this.from,this.to,i)}},{key:"invert",value:function(){return new ie(this.from,this.to,this.mark)}},{key:"map",value:function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}},{key:"merge",value:function(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}},{key:"toJSON",value:function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}}])}(ee);ee.jsonID("addMark",oe);var ie=function(t){function e(t,n,r){var o;return D(this,e),(o=h(this,e)).from=t,o.to=n,o.mark=r,o}return p(e,t),w(e,[{key:"apply",value:function(t){var e=this,n=t.slice(this.from,this.to),r=new K(re(n.content,function(t){return t.mark(e.mark.removeFromSet(t.marks))},t),n.openStart,n.openEnd);return ne.fromReplace(t,this.from,this.to,r)}},{key:"invert",value:function(){return new oe(this.from,this.to,this.mark)}},{key:"map",value:function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)}},{key:"merge",value:function(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}},{key:"toJSON",value:function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))}}])}(ee);ee.jsonID("removeMark",ie);var se=function(t){function e(t,n){var r;return D(this,e),(r=h(this,e)).pos=t,r.mark=n,r}return p(e,t),w(e,[{key:"apply",value:function(t){var e=t.nodeAt(this.pos);if(!e)return ne.fail("No node at mark step's position");var n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return ne.fromReplace(t,this.pos,this.pos+1,new K($.from(n),0,e.isLeaf?0:1))}},{key:"invert",value:function(t){var n=t.nodeAt(this.pos);if(n){var r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(var o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(r))return new e(this.pos,n.marks[o]);return new e(this.pos,this.mark)}}return new ae(this.pos,this.mark)}},{key:"map",value:function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}},{key:"toJSON",value:function(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}}])}(ee);ee.jsonID("addNodeMark",se);var ae=function(t){function e(t,n){var r;return D(this,e),(r=h(this,e)).pos=t,r.mark=n,r}return p(e,t),w(e,[{key:"apply",value:function(t){var e=t.nodeAt(this.pos);if(!e)return ne.fail("No node at mark step's position");var n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return ne.fromReplace(t,this.pos,this.pos+1,new K($.from(n),0,e.isLeaf?0:1))}},{key:"invert",value:function(t){var e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new se(this.pos,this.mark):this}},{key:"map",value:function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)}},{key:"toJSON",value:function(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))}}])}(ee);ee.jsonID("removeNodeMark",ae);var ue=function(t){function e(t,n,r){var o,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return D(this,e),(o=h(this,e)).from=t,o.to=n,o.slice=r,o.structure=i,o}return p(e,t),w(e,[{key:"apply",value:function(t){return this.structure&&le(t,this.from,this.to)?ne.fail("Structure replace would overwrite content"):ne.fromReplace(t,this.from,this.to,this.slice)}},{key:"getMap",value:function(){return new Xt([this.from,this.to-this.from,this.slice.size])}},{key:"invert",value:function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}},{key:"map",value:function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}},{key:"merge",value:function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?K.empty:new K(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?K.empty:new K(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)}},{key:"toJSON",value:function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,K.fromJSON(t,n.slice),!!n.structure)}}])}(ee);ee.jsonID("replace",ue);var ce=function(t){function e(t,n,r,o,i,s){var a,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return D(this,e),(a=h(this,e)).from=t,a.to=n,a.gapFrom=r,a.gapTo=o,a.slice=i,a.insert=s,a.structure=u,a}return p(e,t),w(e,[{key:"apply",value:function(t){if(this.structure&&(le(t,this.from,this.gapFrom)||le(t,this.gapTo,this.to)))return ne.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return ne.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?ne.fromReplace(t,this.from,this.to,n):ne.fail("Content does not fit in gap")}},{key:"getMap",value:function(){return new Xt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}},{key:"invert",value:function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}},{key:"map",value:function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:t.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)}},{key:"toJSON",value:function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,K.fromJSON(t,n.slice),n.insert,!!n.structure)}}])}(ee);function le(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function fe(t,e,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.contentMatch,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=t.doc.nodeAt(e),s=[],a=e+1,u=0;u<i.childCount;u++){var c=i.child(u),l=a+c.nodeSize,f=r.matchType(c.type);if(f){r=f;for(var d=0;d<c.marks.length;d++)n.allowsMarkType(c.marks[d].type)||t.step(new ie(a,l,c.marks[d]));if(o&&c.isText&&"pre"!=n.whitespace)for(var h=void 0,p=/\r?\n|\r/g,v=void 0;h=p.exec(c.text);)v||(v=new K($.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),s.push(new ue(a+h.index,a+h.index+h[0].length,v))}else s.push(new ue(a,l,K.empty));a=l}if(!r.validEnd){var m=r.fillBefore($.empty,!0);t.replace(a,a,new K(m,0,0))}for(var g=s.length-1;g>=0;g--)t.step(s[g])}function de(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function he(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),n=t.depth;;--n){var r=t.$from.node(n),o=t.$from.index(n),i=t.$to.indexAfter(n);if(n<t.depth&&r.canReplace(o,i,e))return n;if(0==n||r.type.spec.isolating||!de(r,o,i))break}return null}function pe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,o=function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return n.canReplaceWith(r,o,s)?i:null}(t,e),i=o&&function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.child(r),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var a=(s.length?s[s.length-1]:e).contentMatch,u=r;a&&u<o;u++)a=a.matchType(n.child(u).type);return a&&a.validEnd?s:null}(r,e);return i?o.map(ve).concat({type:e,attrs:n}).concat(i.map(ve)):null}function ve(t){return{type:t,attrs:null}}function me(t,e,n,r){e.forEach(function(o,i){if(o.isText)for(var s,a=/\r?\n|\r/g;s=a.exec(o.text);){var u=t.mapping.slice(r).map(n+1+i+s.index);t.replaceWith(u,u+1,e.type.schema.linebreakReplacement.create())}})}function ge(t,e,n,r){e.forEach(function(o,i){if(o.type==o.type.schema.linebreakReplacement){var s=t.mapping.slice(r).map(n+1+i);t.replaceWith(s,s+1,e.type.schema.text("\n"))}})}function ye(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,u=n-2;a>i;a--,u--){var c=o.node(a),l=o.index(a);if(c.type.spec.isolating)return!1;var f=c.content.cutByIndex(l,c.childCount),d=r&&r[u+1];d&&(f=f.replaceChild(0,d.type.create(d.attrs)));var h=r&&r[u]||c;if(!c.canReplace(l+1,c.childCount)||!h.type.validContent(f))return!1}var p=o.indexAfter(i),v=r&&r[0];return o.node(i).canReplaceWith(p,p,v?v.type:o.node(i+1).type)}function ke(t,e){var n=t.resolve(e),r=n.index();return De(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function De(t,e){return!(!t||!e||t.isLeaf||!function(t,e){e.content.size||t.type.compatibleContent(e.type);for(var n=t.contentMatchAt(t.childCount),r=t.type.schema.linebreakReplacement,o=0;o<e.childCount;o++){var i=e.child(o),s=i.type==r?t.type.schema.nodes.text:i.type;if(!(n=n.matchType(s)))return!1;if(!t.type.allowsMarks(i.marks))return!1}return n.validEnd}(t,e))}function be(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=t.resolve(e),o=r.depth;;o--){var i=void 0,s=void 0,a=r.index(o);if(o==r.depth?(i=r.nodeBefore,s=r.nodeAfter):n>0?(i=r.node(o+1),a++,s=r.node(o).maybeChild(a)):(i=r.node(o).maybeChild(a-1),s=r.node(o+1)),i&&!i.isTextblock&&De(i,s)&&r.node(o).canReplace(a,a+1))return e;if(0==o)break;e=n<0?r.before(o):r.after(o)}}function we(t,e,n){var r=t.resolve(e);if(!n.content.size)return e;for(var o=n.content,i=0;i<n.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(var a=r.depth;a>=0;a--){var u=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,c=r.index(a)+(u>0?1:0),l=r.node(a),f=!1;if(1==s)f=l.canReplace(c,c,o);else{var d=l.contentMatchAt(c).findWrapping(o.firstChild.type);f=d&&l.canReplaceWith(c,c,d[0])}if(f)return 0==u?r.pos:u<0?r.before(a+1):r.after(a+1)}return null}function Ce(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.empty;if(e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return xe(o,i,r)?new ue(e,n,r):new Ee(o,i,r).fit()}function xe(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}ee.jsonID("replaceAround",ce);var Ee=function(){return w(function t(e,n,r){D(this,t),this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=$.empty;for(var o=0;o<=e.depth;o++){var i=e.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(o))})}for(var s=e.depth;s>0;s--)this.placed=$.from(e.node(s).copy(this.placed))},[{key:"depth",get:function(){return this.frontier.length-1}},{key:"fit",value:function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;for(var i=this.placed,s=r.depth,a=o.depth;s&&a&&1==i.childCount;)i=i.firstChild.content,s--,a--;var u=new K(i,s,a);return e>-1?new ce(r.pos,e,this.$to.pos,this.$to.end(),u,n):u.size||r.pos!=this.$to.pos?new ue(r.pos,o.pos,u):null}},{key:"findFittable",value:function(){for(var t=this.unplaced.openStart,e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){var o=e.firstChild;if(e.childCount>1&&(r=0),o.type.spec.isolating&&r<=n){t=n;break}e=o.content}for(var i=1;i<=2;i++)for(var s=1==i?t:this.unplaced.openStart;s>=0;s--)for(var a=null,u=(s?(a=Me(this.unplaced.content,s-1).firstChild).content:this.unplaced.content).firstChild,c=this.depth;c>=0;c--){var l=this.frontier[c],f=l.type,d=l.match,h=void 0,p=null;if(1==i&&(u?d.matchType(u.type)||(p=d.fillBefore($.from(u),!1)):a&&f.compatibleContent(a.type)))return{sliceDepth:s,frontierDepth:c,parent:a,inject:p};if(2==i&&u&&(h=d.findWrapping(u.type)))return{sliceDepth:s,frontierDepth:c,parent:a,wrap:h};if(a&&d.matchType(a.type))break}}},{key:"openMore",value:function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Me(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new K(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)}},{key:"dropNode",value:function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Me(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new K(Ae(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new K(Ae(e,n,1),n,r)}},{key:"placeNodes",value:function(t){for(var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;this.depth>n;)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,u=r?r.content:a.content,c=a.openStart-e,l=0,f=[],d=this.frontier[n],h=d.match,p=d.type;if(o){for(var v=0;v<o.childCount;v++)f.push(o.child(v));h=h.matchFragment(o)}for(var m=u.size+e-(a.content.size-a.openEnd);l<u.childCount;){var g=u.child(l),y=h.matchType(g.type);if(!y)break;(++l>1||0==c||g.content.size)&&(h=y,f.push(Oe(g.mark(p.allowedMarks(g.marks)),1==l?c:0,l==u.childCount?m:-1)))}var k=l==u.childCount;k||(m=-1),this.placed=Se(this.placed,n,$.from(f)),this.frontier[n].match=h,k&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var D=0,b=u;D<m;D++){var w=b.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),b=w.content}this.unplaced=k?0==e?K.empty:new K(Ae(a.content,e-1,1),e-1,m<0?a.openEnd:e-1):new K(Ae(a.content,e,l),a.openStart,a.openEnd)}},{key:"mustMoveInline",value:function(){if(!this.$to.parent.isTextblock)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Te(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var n=this.$to.depth,r=this.$to.after(n);n>1&&r==this.$to.end(--n);)++r;return r}},{key:"findCloseLevel",value:function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Te(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var u=this.frontier[a],c=u.match,l=Te(t,a,u.type,c,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}}},{key:"close",value:function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Se(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t}},{key:"openFrontierNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Se(this.placed,this.depth,$.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}},{key:"closeFrontierNode",value:function(){var t=this.frontier.pop().match.fillBefore($.empty,!0);t.childCount&&(this.placed=Se(this.placed,this.frontier.length,t))}}])}();function Ae(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Ae(t.firstChild.content,e-1,n)))}function Se(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Se(t.lastChild.content,e-1,n)))}function Me(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function Oe(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,Oe(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore($.empty,!0)))),t.copy(r)}function Te(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!function(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}(n,i.content,s)?a:null}function Fe(t){return t.spec.defining||t.spec.definingForContent}function Ne(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(Ne(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore($.empty,!0))}return t}function Be(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(o==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==o-1)&&n.push(r)}return n}var Re=function(t){function e(t,n,r){var o;return D(this,e),(o=h(this,e)).pos=t,o.attr=n,o.value=r,o}return p(e,t),w(e,[{key:"apply",value:function(t){var e=t.nodeAt(this.pos);if(!e)return ne.fail("No node at attribute step's position");var n=Object.create(null);for(var r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;var o=e.type.create(n,null,e.marks);return ne.fromReplace(t,this.pos,this.pos+1,new K($.from(o),0,e.isLeaf?0:1))}},{key:"getMap",value:function(){return Xt.empty}},{key:"invert",value:function(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}},{key:"map",value:function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)}},{key:"toJSON",value:function(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.pos||"string"!=typeof n.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new e(n.pos,n.attr,n.value)}}])}(ee);ee.jsonID("attr",Re);var Ie=function(t){function e(t,n){var r;return D(this,e),(r=h(this,e)).attr=t,r.value=n,r}return p(e,t),w(e,[{key:"apply",value:function(t){var e=Object.create(null);for(var n in t.attrs)e[n]=t.attrs[n];e[this.attr]=this.value;var r=t.type.create(e,t.content,t.marks);return ne.ok(r)}},{key:"getMap",value:function(){return Xt.empty}},{key:"invert",value:function(t){return new e(this.attr,t.attrs[this.attr])}},{key:"map",value:function(t){return this}},{key:"toJSON",value:function(){return{stepType:"docAttr",attr:this.attr,value:this.value}}}],[{key:"fromJSON",value:function(t,n){if("string"!=typeof n.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new e(n.attr,n.value)}}])}(ee);ee.jsonID("docAttr",Ie);var Pe=Error;((Pe=function t(e){var n=Error.call(this,e);return n.__proto__=t.prototype,n}).prototype=Object.create(Error.prototype)).constructor=Pe,Pe.prototype.name="TransformError";var Le=function(){return w(function t(e){D(this,t),this.doc=e,this.steps=[],this.docs=[],this.mapping=new Zt},[{key:"before",get:function(){return this.docs.length?this.docs[0]:this.doc}},{key:"step",value:function(t){var e=this.maybeStep(t);if(e.failed)throw new Pe(e.failed);return this}},{key:"maybeStep",value:function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}},{key:"docChanged",get:function(){return this.steps.length>0}},{key:"addStep",value:function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}},{key:"replace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.empty,r=Ce(this.doc,t,e,n);return r&&this.step(r),this}},{key:"replaceWith",value:function(t,e,n){return this.replace(t,e,new K($.from(n),0,0))}},{key:"delete",value:function(t,e){return this.replace(t,e,K.empty)}},{key:"insert",value:function(t,e){return this.replaceWith(t,t,e)}},{key:"replaceRange",value:function(t,e,n){return function(t,e,n,r){if(!r.size)return t.deleteRange(e,n);var o=t.doc.resolve(e),i=t.doc.resolve(n);if(xe(o,i,r))return t.step(new ue(e,n,r));var s=Be(o,t.doc.resolve(n));0==s[s.length-1]&&s.pop();var a=-(o.depth+1);s.unshift(a);for(var u=o.depth,c=o.pos-1;u>0;u--,c--){var l=o.node(u).type.spec;if(l.defining||l.definingAsContext||l.isolating)break;s.indexOf(u)>-1?a=u:o.before(u)==c&&s.splice(1,0,-u)}for(var f=s.indexOf(a),d=[],h=r.openStart,p=r.content,v=0;;v++){var m=p.firstChild;if(d.push(m),v==r.openStart)break;p=m.content}for(var g=h-1;g>=0;g--){var y=d[g],k=Fe(y.type);if(k&&!y.sameMarkup(o.node(Math.abs(a)-1)))h=g;else if(k||!y.type.isTextblock)break}for(var D=r.openStart;D>=0;D--){var b=(D+h+1)%(r.openStart+1),w=d[b];if(w)for(var C=0;C<s.length;C++){var x=s[(C+f)%s.length],E=!0;x<0&&(E=!1,x=-x);var A=o.node(x-1),S=o.index(x-1);if(A.canReplaceWith(S,S,w.type,w.marks))return t.replace(o.before(x),E?i.after(x):n,new K(Ne(r.content,0,r.openStart,b),b,r.openEnd))}}for(var M=t.steps.length,O=s.length-1;O>=0&&(t.replace(e,n,r),!(t.steps.length>M));O--){var T=s[O];T<0||(e=o.before(T),n=i.after(T))}}(this,t,e,n),this}},{key:"replaceRangeWith",value:function(t,e,n){return function(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){var o=function(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}return null}(t.doc,e,r.type);null!=o&&(e=n=o)}t.replaceRange(e,n,new K($.from(r),0,0))}(this,t,e,n),this}},{key:"deleteRange",value:function(t,e){return function(t,e,n){for(var r=t.doc.resolve(e),o=t.doc.resolve(n),i=Be(r,o),s=0;s<i.length;s++){var a=i[s],u=s==i.length-1;if(u&&0==a||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),o.end(a));if(a>0&&(u||r.node(a-1).canReplace(r.index(a-1),o.indexAfter(a-1))))return t.delete(r.before(a),o.after(a))}for(var c=1;c<=r.depth&&c<=o.depth;c++)if(e-r.start(c)==r.depth-c&&n>r.end(c)&&o.end(c)-n!=o.depth-c&&r.start(c-1)==o.start(c-1)&&r.node(c-1).canReplace(r.index(c-1),o.index(c-1)))return t.delete(r.before(c),n);t.delete(e,n)}(this,t,e),this}},{key:"lift",value:function(t,e){return function(t,e,n){for(var r=e.$from,o=e.$to,i=e.depth,s=r.before(i+1),a=o.after(i+1),u=s,c=a,l=$.empty,f=0,d=i,h=!1;d>n;d--)h||r.index(d)>0?(h=!0,l=$.from(r.node(d).copy(l)),f++):u--;for(var p=$.empty,v=0,m=i,g=!1;m>n;m--)g||o.after(m+1)<o.end(m)?(g=!0,p=$.from(o.node(m).copy(p)),v++):c++;t.step(new ce(u,c,s,a,new K(l.append(p),f,v),l.size-f,!0))}(this,t,e),this}},{key:"join",value:function(t){return function(t,e,n){var r=null,o=t.doc.type.schema.linebreakReplacement,i=t.doc.resolve(e-n),s=i.node().type;if(o&&s.inlineContent){var a="pre"==s.whitespace,u=!!s.contentMatch.matchType(o);a&&!u?r=!1:!a&&u&&(r=!0)}var c=t.steps.length;if(!1===r){var l=t.doc.resolve(e+n);ge(t,l.node(),l.before(),c)}s.inlineContent&&fe(t,e+n-1,s,i.node().contentMatchAt(i.index()),null==r);var f=t.mapping.slice(c),d=f.map(e-n);if(t.step(new ue(d,f.map(e+n,-1),K.empty,!0)),!0===r){var h=t.doc.resolve(d);me(t,h.node(),h.before(),t.steps.length)}}(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this}},{key:"wrap",value:function(t,e){return function(t,e,n){for(var r=$.empty,o=n.length-1;o>=0;o--){if(r.size){var i=n[o].type.contentMatch.matchFragment(r);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=$.from(n[o].type.create(n[o].attrs,r))}var s=e.start,a=e.end;t.step(new ce(s,a,s,a,new K(r,0,0),n.length,!0))}(this,t,e),this}},{key:"setBlockType",value:function(t){return function(t,e,n,r,o){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=t.steps.length;t.doc.nodesBetween(e,n,function(e,n){var s="function"==typeof o?o(e):o;if(e.isTextblock&&!e.hasMarkup(r,s)&&function(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(t.doc,t.mapping.slice(i).map(n),r)){var a=null;if(r.schema.linebreakReplacement){var u="pre"==r.whitespace,c=!!r.contentMatch.matchType(r.schema.linebreakReplacement);u&&!c?a=!1:!u&&c&&(a=!0)}!1===a&&ge(t,e,n,i),fe(t,t.mapping.slice(i).map(n,1),r,void 0,null===a);var l=t.mapping.slice(i),f=l.map(n,1),d=l.map(n+e.nodeSize,1);return t.step(new ce(f,d,f+1,d-1,new K($.from(r.create(s,null,e.marks)),0,0),1,!0)),!0===a&&me(t,e,n,i),!1}})}(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,arguments.length>2?arguments[2]:void 0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this}},{key:"setNodeMarkup",value:function(t,e){return function(t,e,n,r,o){var i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);var s=n.create(r,null,o||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,s);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new ce(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new K($.from(s),0,0),1,!0))}(this,t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0),this}},{key:"setNodeAttribute",value:function(t,e,n){return this.step(new Re(t,e,n)),this}},{key:"setDocAttribute",value:function(t,e){return this.step(new Ie(t,e)),this}},{key:"addNodeMark",value:function(t,e){return this.step(new se(t,e)),this}},{key:"removeNodeMark",value:function(t,e){var n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof _)e.isInSet(n.marks)&&this.step(new ae(t,e));else{for(var r,o=n.marks,i=[];r=e.isInSet(o);)i.push(new ae(t,r)),o=r.removeFromSet(o);for(var s=i.length-1;s>=0;s--)this.step(i[s])}return this}},{key:"split",value:function(t){return function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,o=t.doc.resolve(e),i=$.empty,s=$.empty,a=o.depth,u=o.depth-n,c=n-1;a>u;a--,c--){i=$.from(o.node(a).copy(i));var l=r&&r[c];s=$.from(l?l.type.create(l.attrs,s):o.node(a).copy(s))}t.step(new ue(e,e,new K(i.append(s),n,n),!0))}(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2?arguments[2]:void 0),this}},{key:"addMark",value:function(t,e,n){return function(t,e,n,r){var o,i,s=[],a=[];t.doc.nodesBetween(e,n,function(t,u,c){if(t.isInline){var l=t.marks;if(!r.isInSet(l)&&c.type.allowsMarkType(r.type)){for(var f=Math.max(u,e),d=Math.min(u+t.nodeSize,n),h=r.addToSet(l),p=0;p<l.length;p++)l[p].isInSet(h)||(o&&o.to==f&&o.mark.eq(l[p])?o.to=d:s.push(o=new ie(f,d,l[p])));i&&i.to==f?i.to=d:a.push(i=new oe(f,d,r))}}}),s.forEach(function(e){return t.step(e)}),a.forEach(function(e){return t.step(e)})}(this,t,e,n),this}},{key:"removeMark",value:function(t,e,n){return function(t,e,n,r){var o=[],i=0;t.doc.nodesBetween(e,n,function(t,s){if(t.isInline){i++;var a=null;if(r instanceof Ot)for(var u,c=t.marks;u=r.isInSet(c);)(a||(a=[])).push(u),c=u.removeFromSet(c);else r?r.isInSet(t.marks)&&(a=[r]):a=t.marks;if(a&&a.length)for(var l=Math.min(s+t.nodeSize,n),f=0;f<a.length;f++){for(var d=a[f],h=void 0,p=0;p<o.length;p++){var v=o[p];v.step==i-1&&d.eq(o[p].style)&&(h=v)}h?(h.to=l,h.step=i):o.push({style:d,from:Math.max(s,e),to:l,step:i})}}}),o.forEach(function(e){return t.step(new ie(e.from,e.to,e.style))})}(this,t,e,n),this}},{key:"clearIncompatible",value:function(t,e,n){return fe(this,t,e,n),this}}])}(),ze=Object.create(null),je=function(){return w(function t(e,n,r){D(this,t),this.$anchor=e,this.$head=n,this.ranges=r||[new $e(e.min(n),e.max(n))]},[{key:"anchor",get:function(){return this.$anchor.pos}},{key:"head",get:function(){return this.$head.pos}},{key:"from",get:function(){return this.$from.pos}},{key:"to",get:function(){return this.$to.pos}},{key:"$from",get:function(){return this.ranges[0].$from}},{key:"$to",get:function(){return this.ranges[0].$to}},{key:"empty",get:function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}},{key:"content",value:function(){return this.$from.doc.slice(this.from,this.to,!0)}},{key:"replace",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.empty,n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var u=s[a],c=u.$from,l=u.$to,f=t.mapping.slice(i);t.replaceRange(f.map(c.pos),f.map(l.pos),a?K.empty:e),0==a&&Qe(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}},{key:"replaceWith",value:function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,u=t.mapping.slice(n),c=u.map(s.pos),l=u.map(a.pos);o?t.deleteRange(c,l):(t.replaceRangeWith(c,l,e),Qe(t,n,e.isInline?-1:1))}}},{key:"getBookmark",value:function(){return We.between(this.$anchor,this.$head).getBookmark()}}],[{key:"findFrom",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.parent.inlineContent?new We(t):Ge(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?Ge(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Ge(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}return null}},{key:"near",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.findFrom(t,e)||this.findFrom(t,-e)||new Je(t.node(0))}},{key:"atStart",value:function(t){return Ge(t,t,0,0,1)||new Je(t)}},{key:"atEnd",value:function(t){return Ge(t,t,t.content.size,t.childCount,-1)||new Je(t)}},{key:"fromJSON",value:function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=ze[e.type];if(!n)throw new RangeError("No selection type ".concat(e.type," defined"));return n.fromJSON(t,e)}},{key:"jsonID",value:function(t,e){if(t in ze)throw new RangeError("Duplicate use of selection JSON ID "+t);return ze[t]=e,e.prototype.jsonID=t,e}}])}();je.prototype.visible=!0;var $e=w(function t(e,n){D(this,t),this.$from=e,this.$to=n}),Ve=!1;function He(t){Ve||t.parent.inlineContent||(Ve=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}var We=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return D(this,e),He(t),He(n),h(this,e,[t,n])}return p(e,t),w(e,[{key:"$cursor",get:function(){return this.$anchor.pos==this.$head.pos?this.$head:null}},{key:"map",value:function(t,n){var r=t.resolve(n.map(this.head));if(!r.parent.inlineContent)return je.near(r);var o=t.resolve(n.map(this.anchor));return new e(o.parent.inlineContent?o:r,r)}},{key:"replace",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.empty;if(f(e,"replace",this,3)([t,n]),n==K.empty){var r=this.$from.marksAcross(this.$to);r&&t.ensureMarks(r)}}},{key:"eq",value:function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head}},{key:"getBookmark",value:function(){return new _e(this.anchor,this.head)}},{key:"toJSON",value:function(){return{type:"text",anchor:this.anchor,head:this.head}}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))}},{key:"create",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}},{key:"between",value:function(t,n,r){var o=t.pos-n.pos;if(r&&!o||(r=o>=0?1:-1),!n.parent.inlineContent){var i=je.findFrom(n,r,!0)||je.findFrom(n,-r,!0);if(!i)return je.near(n,r);n=i.$head}return t.parent.inlineContent||(0==o||(t=(je.findFrom(t,-r,!0)||je.findFrom(t,r,!0)).$anchor).pos<n.pos!=o<0)&&(t=n),new e(t,n)}}])}(je);je.jsonID("text",We);var _e=function(){function t(e,n){D(this,t),this.anchor=e,this.head=n}return w(t,[{key:"map",value:function(e){return new t(e.map(this.anchor),e.map(this.head))}},{key:"resolve",value:function(t){return We.between(t.resolve(this.anchor),t.resolve(this.head))}}])}(),qe=function(t){function e(t){var n;D(this,e);var r=t.nodeAfter,o=t.node(0).resolve(t.pos+r.nodeSize);return(n=h(this,e,[t,o])).node=r,n}return p(e,t),w(e,[{key:"map",value:function(t,n){var r=n.mapResult(this.anchor),o=r.deleted,i=r.pos,s=t.resolve(i);return o?je.near(s):new e(s)}},{key:"content",value:function(){return new K($.from(this.node),0,0)}},{key:"eq",value:function(t){return t instanceof e&&t.anchor==this.anchor}},{key:"toJSON",value:function(){return{type:"node",anchor:this.anchor}}},{key:"getBookmark",value:function(){return new Ke(this.anchor)}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))}},{key:"create",value:function(t,n){return new e(t.resolve(n))}},{key:"isSelectable",value:function(t){return!t.isText&&!1!==t.type.spec.selectable}}])}(je);qe.prototype.visible=!1,je.jsonID("node",qe);var Ke=function(){function t(e){D(this,t),this.anchor=e}return w(t,[{key:"map",value:function(e){var n=e.mapResult(this.anchor),r=n.deleted,o=n.pos;return r?new _e(o,o):new t(o)}},{key:"resolve",value:function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&qe.isSelectable(n)?new qe(e):je.near(e)}}])}(),Je=function(t){function e(t){return D(this,e),h(this,e,[t.resolve(0),t.resolve(t.content.size)])}return p(e,t),w(e,[{key:"replace",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.empty;if(n==K.empty){t.delete(0,t.doc.content.size);var r=je.atStart(t.doc);r.eq(t.selection)||t.setSelection(r)}else f(e,"replace",this,3)([t,n])}},{key:"toJSON",value:function(){return{type:"all"}}},{key:"map",value:function(t){return new e(t)}},{key:"eq",value:function(t){return t instanceof e}},{key:"getBookmark",value:function(){return Ue}}],[{key:"fromJSON",value:function(t){return new e(t)}}])}(je);je.jsonID("all",Je);var Ue={map:function(){return this},resolve:function(t){return new Je(t)}};function Ge(t,e,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e.inlineContent)return We.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&qe.isSelectable(a))return qe.create(t,n-(o<0?a.nodeSize:0))}else{var u=Ge(t,a,n+o,o<0?a.childCount:0,o,i);if(u)return u}n+=a.nodeSize*o}return null}function Qe(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o,i=t.steps[r];if(i instanceof ue||i instanceof ce)t.mapping.maps[r].forEach(function(t,e,n,r){null==o&&(o=r)}),t.setSelection(je.near(t.doc.resolve(o),n))}}var Ye=function(t){function e(t){var n;return D(this,e),(n=h(this,e,[t.doc])).curSelectionFor=0,n.updated=0,n.meta=Object.create(null),n.time=Date.now(),n.curSelection=t.selection,n.storedMarks=t.storedMarks,n}return p(e,t),w(e,[{key:"selection",get:function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}},{key:"setSelection",value:function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}},{key:"selectionSet",get:function(){return(1&this.updated)>0}},{key:"setStoredMarks",value:function(t){return this.storedMarks=t,this.updated|=2,this}},{key:"ensureMarks",value:function(t){return _.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}},{key:"addStoredMark",value:function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}},{key:"removeStoredMark",value:function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}},{key:"storedMarksSet",get:function(){return(2&this.updated)>0}},{key:"addStep",value:function(t,n){f(e,"addStep",this,3)([t,n]),this.updated=-3&this.updated,this.storedMarks=null}},{key:"setTime",value:function(t){return this.time=t,this}},{key:"replaceSelection",value:function(t){return this.selection.replace(this,t),this}},{key:"replaceSelectionWith",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||_.none))),n.replaceWith(this,t),this}},{key:"deleteSelection",value:function(){return this.selection.replace(this),this}},{key:"insertText",value:function(t,e,n){var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(null==n&&(n=e),n=null==n?e:n,!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(je.near(this.selection.$to)),this}},{key:"setMeta",value:function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this}},{key:"getMeta",value:function(t){return this.meta["string"==typeof t?t:t.key]}},{key:"isGeneric",get:function(){for(var t in this.meta)return!1;return!0}},{key:"scrollIntoView",value:function(){return this.updated|=4,this}},{key:"scrolledIntoView",get:function(){return(4&this.updated)>0}}])}(Le);function Xe(t,e){return e&&t?t.bind(e):t}var Ze=w(function t(e,n,r){D(this,t),this.name=e,this.init=Xe(n.init,r),this.apply=Xe(n.apply,r)}),tn=[new Ze("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Ze("selection",{init:function(t,e){return t.selection||je.atStart(e.doc)},apply:function(t){return t.selection}}),new Ze("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Ze("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],en=w(function t(e,n){var r=this;D(this,t),this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=tn.slice(),n&&n.forEach(function(t){if(r.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");r.plugins.push(t),r.pluginsByKey[t.key]=t,t.spec.state&&r.fields.push(new Ze(t.key,t.spec.state,t))})}),nn=function(){function t(e){D(this,t),this.config=e}return w(t,[{key:"schema",get:function(){return this.config.schema}},{key:"plugins",get:function(){return this.config.plugins}},{key:"apply",value:function(t){return this.applyTransaction(t).state}},{key:"filterTransaction",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0}},{key:"applyTransaction",value:function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,u=r?r[i].state:this,c=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,u,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",t),!r){r=[];for(var l=0;l<this.config.plugins.length;l++)r.push(l<i?{state:n,n:e.length}:{state:this,n:0})}e.push(c),n=n.applyInner(c),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}}},{key:"applyInner",value:function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var n=new t(this.config),r=this.config.fields,o=0;o<r.length;o++){var i=r[o];n[i.name]=i.apply(e,this[i.name],this,n)}return n}},{key:"tr",get:function(){return new Ye(this)}},{key:"reconfigure",value:function(e){for(var n=new en(this.schema,e.plugins),r=n.fields,o=new t(n),i=0;i<r.length;i++){var s=r[i].name;o[s]=this.hasOwnProperty(s)?this[s]:r[i].init(e,o)}return o}},{key:"toJSON",value:function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(t){return t.toJSON()})),t&&"object"==k(t))for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e}}],[{key:"create",value:function(e){for(var n=new en(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new t(n),o=0;o<n.fields.length;o++)r[n.fields[o].name]=n.fields[o].init(e,r);return r}},{key:"fromJSON",value:function(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var o=new en(e.schema,e.plugins),i=new t(o);return o.fields.forEach(function(t){if("doc"==t.name)i.doc=lt.fromJSON(e.schema,n.doc);else if("selection"==t.name)i.selection=je.fromJSON(i.doc,n.selection);else if("storedMarks"==t.name)n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(var o in r){var s=r[o],a=s.spec.state;if(s.key==t.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(n,o))return void(i[t.name]=a.fromJSON.call(s,e,n[o],i))}i[t.name]=t.init(e,i)}}),i}}])}();function rn(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=rn(o,e,{})),n[r]=o}return n}var on=function(){return w(function t(e){D(this,t),this.spec=e,this.props={},e.props&&rn(e.props,this,this.props),this.key=e.key?e.key.key:an("plugin")},[{key:"getState",value:function(t){return t[this.key]}}])}(),sn=Object.create(null);function an(t){return t in sn?t+"$"+ ++sn[t]:(sn[t]=0,t+"$")}var un=function(){return w(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"key";D(this,t),this.key=an(e)},[{key:"get",value:function(t){return t.config.pluginsByKey[this.key]}},{key:"getState",value:function(t){return t[this.key]}}])}(),cn=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},ln=function(t){var e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e},fn=null,dn=function(t,e,n){var r=fn||(fn=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},hn=function(t,e,n,r){return n&&(vn(t,e,n,r,-1)||vn(t,e,n,r,1))},pn=/^(img|br|input|textarea|hr)$/i;function vn(t,e,n,r,o){for(var i;;){if(t==n&&e==r)return!0;if(e==(o<0?0:mn(t))){var s=t.parentNode;if(!s||1!=s.nodeType||gn(t)||pn.test(t.nodeName)||"false"==t.contentEditable)return!1;e=cn(t)+(o<0?0:1),t=s}else{if(1!=t.nodeType)return!1;var a=t.childNodes[e+(o<0?-1:0)];if(1==a.nodeType&&"false"==a.contentEditable){if(!(null===(i=a.pmViewDesc)||void 0===i?void 0:i.ignoreForSelection))return!1;e+=o}else t=a,e=o<0?mn(t):0}}}function mn(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function gn(t){for(var e,n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var yn=function(t){return t.focusNode&&hn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function kn(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}var Dn="undefined"!=typeof navigator?navigator:null,bn="undefined"!=typeof document?document:null,wn=Dn&&Dn.userAgent||"",Cn=/Edge\/(\d+)/.exec(wn),xn=/MSIE \d/.exec(wn),En=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(wn),An=!!(xn||En||Cn),Sn=xn?document.documentMode:En?+En[1]:Cn?+Cn[1]:0,Mn=!An&&/gecko\/(\d+)/i.test(wn);Mn&&(/Firefox\/(\d+)/.exec(wn)||[0,0])[1];var On=!An&&/Chrome\/(\d+)/.exec(wn),Tn=!!On,Fn=On?+On[1]:0,Nn=!An&&!!Dn&&/Apple Computer/.test(Dn.vendor),Bn=Nn&&(/Mobile\/\w+/.test(wn)||!!Dn&&Dn.maxTouchPoints>2),Rn=Bn||!!Dn&&/Mac/.test(Dn.platform),In=!!Dn&&/Win/.test(Dn.platform),Pn=/Android \d/.test(wn),Ln=!!bn&&"webkitFontSmoothing"in bn.documentElement.style,zn=Ln?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function jn(t){var e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function $n(t,e){return"number"==typeof t?t:t[e]}function Vn(t){var e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function Hn(t,e,n){for(var r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=n||t.dom;s;)if(1==s.nodeType){var a=s,u=a==i.body,c=u?jn(i):Vn(a),l=0,f=0;if(e.top<c.top+$n(r,"top")?f=-(c.top-e.top+$n(o,"top")):e.bottom>c.bottom-$n(r,"bottom")&&(f=e.bottom-e.top>c.bottom-c.top?e.top+$n(o,"top")-c.top:e.bottom-c.bottom+$n(o,"bottom")),e.left<c.left+$n(r,"left")?l=-(c.left-e.left+$n(o,"left")):e.right>c.right-$n(r,"right")&&(l=e.right-c.right+$n(o,"right")),l||f)if(u)i.defaultView.scrollBy(l,f);else{var d=a.scrollLeft,h=a.scrollTop;f&&(a.scrollTop+=f),l&&(a.scrollLeft+=l);var p=a.scrollLeft-d,v=a.scrollTop-h;e={left:e.left-p,top:e.top-v,right:e.right-p,bottom:e.bottom-v}}var m=u?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(m))break;s="absolute"==m?s.offsetParent:ln(s)}else s=ln(s)}function Wn(t){for(var e=[],n=t.ownerDocument,r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=ln(r));return e}function _n(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var qn=null;function Kn(t,e){for(var n,r,o,i,s=2e8,a=0,u=e.top,c=e.top,l=t.firstChild,f=0;l;l=l.nextSibling,f++){var d=void 0;if(1==l.nodeType)d=l.getClientRects();else{if(3!=l.nodeType)continue;d=dn(l).getClientRects()}for(var h=0;h<d.length;h++){var p=d[h];if(p.top<=u&&p.bottom>=c){u=Math.max(p.bottom,u),c=Math.min(p.top,c);var v=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(v<s){n=l,s=v,r=v&&3==n.nodeType?{left:p.right<e.left?p.right:p.left,top:e.top}:e,1==l.nodeType&&v&&(a=f+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!o&&p.left<=e.left&&p.right>=e.left&&(o=l,i={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(a=f+1)}}return!n&&o&&(n=o,r=i,s=0),n&&3==n.nodeType?function(t,e){for(var n=t.nodeValue.length,r=document.createRange(),o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);var i=Yn(r,1);if(i.top!=i.bottom&&Jn(e,i))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}(n,r):!n||s&&1==n.nodeType?{node:t,offset:a}:Kn(n,r)}function Jn(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Un(t,e,n){var r=t.childNodes.length;if(r&&n.top<n.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){var s=t.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),u=0;u<a.length;u++){var c=a[u];if(Jn(e,c))return Un(s,e,c)}if((i=(i+1)%r)==o)break}return t}function Gn(t,e){var n,r=t.dom.ownerDocument,o=0,i=function(t,e,n){if(t.caretPositionFromPoint)try{var r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(mn(r.offsetNode),r.offset)}}catch(i){}if(t.caretRangeFromPoint){var o=t.caretRangeFromPoint(e,n);if(o)return{node:o.startContainer,offset:Math.min(mn(o.startContainer),o.startOffset)}}}(r,e.left,e.top);i&&(n=i.node,o=i.offset);var s,a=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top);if(!a||!t.dom.contains(1!=a.nodeType?a.parentNode:a)){var u=t.dom.getBoundingClientRect();if(!Jn(e,u))return null;if(!(a=Un(t.dom,e,u)))return null}if(Nn)for(var c=a;n&&c;c=ln(c))c.draggable&&(n=void 0);if(a=function(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(a,e),n){if(Mn&&1==n.nodeType&&(o=Math.min(o,n.childNodes.length))<n.childNodes.length){var l,f=n.childNodes[o];"IMG"==f.nodeName&&(l=f.getBoundingClientRect()).right<=e.left&&l.bottom>e.top&&o++}var d;Ln&&o&&1==n.nodeType&&1==(d=n.childNodes[o-1]).nodeType&&"false"==d.contentEditable&&d.getBoundingClientRect().top>=e.top&&o--,n==t.dom&&o==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:0!=o&&1==n.nodeType&&"BR"==n.childNodes[o-1].nodeName||(s=function(t,e,n,r){for(var o=-1,i=e,s=!1;i!=t.dom;){var a=t.docView.nearestDesc(i,!0),u=void 0;if(!a)return null;if(1==a.dom.nodeType&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((u=a.dom.getBoundingClientRect()).width||u.height)&&(a.node.isBlock&&a.parent&&(!s&&u.left>r.left||u.top>r.top?o=a.posBefore:(!s&&u.right<r.left||u.bottom<r.top)&&(o=a.posAfter),s=!0),!a.contentDOM&&o<0&&!a.node.isText))return(a.node.isBlock?r.top<(u.top+u.bottom)/2:r.left<(u.left+u.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,-1)}(t,n,o,e))}null==s&&(s=function(t,e,n){var r=Kn(e,n),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}(t,a,e));var h=t.docView.nearestDesc(a,!0);return{pos:s,inside:h?h.posAtStart-h.border:-1}}function Qn(t){return t.top<t.bottom||t.left<t.right}function Yn(t,e){var n=t.getClientRects();if(n.length){var r=n[e<0?0:n.length-1];if(Qn(r))return r}return Array.prototype.find.call(n,Qn)||t.getBoundingClientRect()}var Xn=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Zn(t,e,n){var r=t.docView.domFromPos(e,n<0?-1:1),o=r.node,i=r.offset,s=r.atom,a=Ln||Mn;if(3==o.nodeType){if(!a||!Xn.test(o.nodeValue)&&(n<0?i:i!=o.nodeValue.length)){var u=i,c=i,l=n<0?1:-1;return n<0&&!i?(c++,l=-1):n>=0&&i==o.nodeValue.length?(u--,l=1):n<0?u--:c++,tr(Yn(dn(o,u,c),l),l<0)}var f=Yn(dn(o,i,i),n);if(Mn&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var d=Yn(dn(o,i-1,i-1),-1);if(d.top==f.top){var h=Yn(dn(o,i,i+1),-1);if(h.top!=f.top)return tr(h,h.left<d.left)}}return f}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(null==s&&i&&(n<0||i==mn(o))){var p=o.childNodes[i-1];if(1==p.nodeType)return er(p.getBoundingClientRect(),!1)}if(null==s&&i<mn(o)){var v=o.childNodes[i];if(1==v.nodeType)return er(v.getBoundingClientRect(),!0)}return er(o.getBoundingClientRect(),n>=0)}if(null==s&&i&&(n<0||i==mn(o))){var m=o.childNodes[i-1],g=3==m.nodeType?dn(m,mn(m)-(a?0:1)):1!=m.nodeType||"BR"==m.nodeName&&m.nextSibling?null:m;if(g)return tr(Yn(g,1),!1)}if(null==s&&i<mn(o)){for(var y=o.childNodes[i];y.pmViewDesc&&y.pmViewDesc.ignoreForCoords;)y=y.nextSibling;var k=y?3==y.nodeType?dn(y,0,a?0:1):1==y.nodeType?y:null:null;if(k)return tr(Yn(k,-1),!0)}return tr(Yn(3==o.nodeType?dn(o):o,-n),n>=0)}function tr(t,e){if(0==t.width)return t;var n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function er(t,e){if(0==t.height)return t;var n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function nr(t,e,n){var r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}var rr=/[\u0590-\u08ac]/;var or=null,ir=null,sr=!1;function ar(t,e,n){return or==e&&ir==n?sr:(or=e,ir=n,sr="up"==n||"down"==n?function(t,e,n){var r=e.selection,o="up"==n?r.$from:r.$to;return nr(t,e,function(){for(var e=t.docView.domFromPos(o.pos,"up"==n?-1:1).node;;){var r=t.docView.nearestDesc(e,!0);if(!r)break;if(r.node.isBlock){e=r.contentDOM||r.dom;break}e=r.dom.parentNode}for(var i=Zn(t,o.pos,1),s=e.firstChild;s;s=s.nextSibling){var a=void 0;if(1==s.nodeType)a=s.getClientRects();else{if(3!=s.nodeType)continue;a=dn(s,0,s.nodeValue.length).getClientRects()}for(var u=0;u<a.length;u++){var c=a[u];if(c.bottom>c.top+1&&("up"==n?i.top-c.top>2*(c.bottom-i.top):c.bottom-i.bottom>2*(i.bottom-c.top)))return!1}}return!0})}(t,e,n):function(t,e,n){var r=e.selection.$head;if(!r.parent.isTextblock)return!1;var o=r.parentOffset,i=!o,s=o==r.parent.content.size,a=t.domSelection();return a?rr.test(r.parent.textContent)&&a.modify?nr(t,e,function(){var e=t.domSelectionRange(),o=e.focusNode,i=e.focusOffset,s=e.anchorNode,u=e.anchorOffset,c=a.caretBidiLevel;a.modify("move",n,"character");var l=r.depth?t.docView.domAfterPos(r.before()):t.dom,f=t.domSelectionRange(),d=f.focusNode,h=f.focusOffset,p=d&&!l.contains(1==d.nodeType?d:d.parentNode)||o==d&&i==h;try{a.collapse(s,u),o&&(o!=s||i!=u)&&a.extend&&a.extend(o,i)}catch(v){}return null!=c&&(a.caretBidiLevel=c),p}):"left"==n||"backward"==n?i:s:r.pos==r.start()||r.pos==r.end()}(t,e,n))}var ur=function(){return w(function t(e,n,r,o){D(this,t),this.parent=e,this.children=n,this.dom=r,this.contentDOM=o,this.dirty=0,r.pmViewDesc=this},[{key:"matchesWidget",value:function(t){return!1}},{key:"matchesMark",value:function(t){return!1}},{key:"matchesNode",value:function(t,e,n){return!1}},{key:"matchesHack",value:function(t){return!1}},{key:"parseRule",value:function(){return null}},{key:"stopEvent",value:function(t){return!1}},{key:"size",get:function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t}},{key:"border",get:function(){return 0}},{key:"destroy",value:function(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(var t=0;t<this.children.length;t++)this.children[t].destroy()}},{key:"posBeforeChild",value:function(t){for(var e=0,n=this.posAtStart;;e++){var r=this.children[e];if(r==t)return n;n+=r.size}}},{key:"posBefore",get:function(){return this.parent.posBeforeChild(this)}},{key:"posAtStart",get:function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}},{key:"posAfter",get:function(){return this.posBefore+this.size}},{key:"posAtEnd",get:function(){return this.posAtStart+this.size-2*this.border}},{key:"localPosFromDOM",value:function(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var r,o;if(t==this.contentDOM)r=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.previousSibling}for(;r&&(!(o=r.pmViewDesc)||o.parent!=this);)r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}var i,s;if(t==this.contentDOM)i=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;i=t.nextSibling}for(;i&&(!(s=i.pmViewDesc)||s.parent!=this);)i=i.nextSibling;return i?this.posBeforeChild(s):this.posAtEnd}var a;if(t==this.dom&&this.contentDOM)a=e>cn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var u=t;;u=u.parentNode){if(u==this.dom){a=!1;break}if(u.previousSibling)break}if(null==a&&e==t.childNodes.length)for(var c=t;;c=c.parentNode){if(c==this.dom){a=!0;break}if(c.nextSibling)break}}return(null==a?n>0:a)?this.posAtEnd:this.posAtStart}},{key:"nearestDesc",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r),i=void 0;if(o&&(!e||o.node)){if(!n||!(i=o.nodeDOM)||(1==i.nodeType?i.contains(1==t.nodeType?t:t.parentNode):i==t))return o;n=!1}}}},{key:"getDesc",value:function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e}},{key:"posFromDOM",value:function(t,e,n){for(var r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1}},{key:"descAt",value:function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){for(;!r.border&&r.children.length;)for(var i=0;i<r.children.length;i++){var s=r.children[i];if(s.size){r=s;break}}return r}if(t<o)return r.descAt(t-n-r.border);n=o}}},{key:"domFromPos",value:function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};for(var n,r=0,o=0,i=0;r<this.children.length;r++){var s=this.children[r],a=i+s.size;if(a>t||s instanceof vr){o=t-i;break}i=a}if(o)return this.children[r].domFromPos(o-this.children[r].border,e);for(;r&&!(n=this.children[r-1]).size&&n instanceof cr&&n.side>=0;r--);if(e<=0){for(var u,c=!0;(u=r?this.children[r-1]:null)&&u.dom.parentNode!=this.contentDOM;r--,c=!1);return u&&e&&c&&!u.border&&!u.domAtom?u.domFromPos(u.size,e):{node:this.contentDOM,offset:u?cn(u.dom)+1:0}}for(var l,f=!0;(l=r<this.children.length?this.children[r]:null)&&l.dom.parentNode!=this.contentDOM;r++,f=!1);return l&&f&&!l.border&&!l.domAtom?l.domFromPos(0,e):{node:this.contentDOM,offset:l?cn(l.dom):this.contentDOM.childNodes.length}}},{key:"parseRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=n,s=0;;s++){var a=this.children[s],u=i+a.size;if(-1==r&&t<=u){var c=i+a.border;if(t>=c&&e<=u-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,c);t=i;for(var l=s;l>0;l--){var f=this.children[l-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){r=cn(f.dom)+1;break}t-=f.size}-1==r&&(r=0)}if(r>-1&&(u>e||s==this.children.length-1)){e=u;for(var d=s+1;d<this.children.length;d++){var h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){o=cn(h.dom);break}e+=h.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=u}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}}},{key:"emptyChildAt",value:function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)}},{key:"domAfterPos",value:function(t){var e=this.domFromPos(t,0),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]}},{key:"setSelection",value:function(t,e,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Math.min(t,e),i=Math.max(t,e),s=0,a=0;s<this.children.length;s++){var u=this.children[s],c=a+u.size;if(o>a&&i<c)return u.setSelection(t-a-u.border,e-a-u.border,n,r);a=c}var l=this.domFromPos(t,t?-1:1),f=e==t?l:this.domFromPos(e,e?-1:1),d=n.root.getSelection(),h=n.domSelectionRange(),p=!1;if((Mn||Nn)&&t==e){var v=l,m=v.node,g=v.offset;if(3==m.nodeType){if((p=!(!g||"\n"!=m.nodeValue[g-1]))&&g==m.nodeValue.length)for(var y,k=m;k;k=k.parentNode){if(y=k.nextSibling){"BR"==y.nodeName&&(l=f={node:y.parentNode,offset:cn(y)+1});break}var D=k.pmViewDesc;if(D&&D.node&&D.node.isBlock)break}}else{var b=m.childNodes[g-1];p=b&&("BR"==b.nodeName||"false"==b.contentEditable)}}if(Mn&&h.focusNode&&h.focusNode!=f.node&&1==h.focusNode.nodeType){var w=h.focusNode.childNodes[h.focusOffset];w&&"false"==w.contentEditable&&(r=!0)}if(r||p&&Nn||!hn(l.node,l.offset,h.anchorNode,h.anchorOffset)||!hn(f.node,f.offset,h.focusNode,h.focusOffset)){var C=!1;if((d.extend||t==e)&&!p){d.collapse(l.node,l.offset);try{t!=e&&d.extend(f.node,f.offset),C=!0}catch(A){}}if(!C){if(t>e){var x=l;l=f,f=x}var E=document.createRange();E.setEnd(f.node,f.offset),E.setStart(l.node,l.offset),d.removeAllRanges(),d.addRange(E)}}}},{key:"ignoreMutation",value:function(t){return!this.contentDOM&&"selection"!=t.type}},{key:"contentLost",get:function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}},{key:"markDirty",value:function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var s=n+o.border,a=i-o.border;if(t>=s&&e<=a)return this.dirty=t==n||e==i?2:1,void(t!=s||e!=a||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-s,e-s):o.dirty=3);o.dirty=o.dom!=o.contentDOM||o.dom.parentNode!=this.contentDOM||o.children.length?3:2}n=i}this.dirty=2}},{key:"markParentsDirty",value:function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var n=1==t?2:1;e.dirty<n&&(e.dirty=n)}}},{key:"domAtom",get:function(){return!1}},{key:"ignoreForCoords",get:function(){return!1}},{key:"ignoreForSelection",get:function(){return!1}},{key:"isText",value:function(t){return!1}}])}(),cr=function(t){function e(t,n,r,o){var i;D(this,e);var s,a=n.type.toDOM;if("function"==typeof a&&(a=a(r,function(){return s?s.parent?s.parent.posBeforeChild(s):void 0:o})),!n.type.spec.raw){if(1!=a.nodeType){var u=document.createElement("span");u.appendChild(a),a=u}a.contentEditable="false",a.classList.add("ProseMirror-widget")}return(i=h(this,e,[t,[],a,null])).widget=n,i.widget=n,s=i,i}return p(e,t),w(e,[{key:"matchesWidget",value:function(t){return 0==this.dirty&&t.type.eq(this.widget.type)}},{key:"parseRule",value:function(){return{ignore:!0}}},{key:"stopEvent",value:function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)}},{key:"ignoreMutation",value:function(t){return"selection"!=t.type||this.widget.spec.ignoreSelection}},{key:"destroy",value:function(){this.widget.type.destroy(this.dom),f(e,"destroy",this,3)([])}},{key:"domAtom",get:function(){return!0}},{key:"ignoreForSelection",get:function(){return!!this.widget.type.spec.relaxedSide}},{key:"side",get:function(){return this.widget.type.side}}])}(ur),lr=function(t){function e(t,n,r,o){var i;return D(this,e),(i=h(this,e,[t,[],n,null])).textDOM=r,i.text=o,i}return p(e,t),w(e,[{key:"size",get:function(){return this.text.length}},{key:"localPosFromDOM",value:function(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}},{key:"domFromPos",value:function(t){return{node:this.textDOM,offset:t}}},{key:"ignoreMutation",value:function(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue}}])}(ur),fr=function(t){function e(t,n,r,o,i){var s;return D(this,e),(s=h(this,e,[t,[],r,o])).mark=n,s.spec=i,s}return p(e,t),w(e,[{key:"parseRule",value:function(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}},{key:"matchesMark",value:function(t){return 3!=this.dirty&&this.mark.eq(t)}},{key:"markDirty",value:function(t,n){if(f(e,"markDirty",this,3)([t,n]),0!=this.dirty){for(var r=this.parent;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=0}}},{key:"slice",value:function(t,n,r){var o=e.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;n<s&&(i=Mr(i,n,s,r)),t>0&&(i=Mr(i,0,t,r));for(var a=0;a<i.length;a++)i[a].parent=o;return o.children=i,o}},{key:"ignoreMutation",value:function(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):f(e,"ignoreMutation",this,3)([t])}},{key:"destroy",value:function(){this.spec.destroy&&this.spec.destroy(),f(e,"destroy",this,3)([])}}],[{key:"create",value:function(t,n,r,o){var i=o.nodeViews[n.type.name],s=i&&i(n,o,r);return s&&s.dom||(s=Ht.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new e(t,n,s.dom,s.contentDOM||s.dom,s)}}])}(ur),dr=function(t){function e(t,n,r,o,i,s,a,u,c){var l;return D(this,e),(l=h(this,e,[t,[],i,s])).node=n,l.outerDeco=r,l.innerDeco=o,l.nodeDOM=a,l}return p(e,t),w(e,[{key:"parseRule",value:function(){var t=this;if(this.node.type.spec.reparseInView)return null;var e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=function(){return $.empty})}else e.contentElement=this.contentDOM;else e.getContent=function(){return t.node.content};return e}},{key:"matchesNode",value:function(t,e,n){return 0==this.dirty&&t.eq(this.node)&&xr(e,this.outerDeco)&&n.eq(this.innerDeco)}},{key:"size",get:function(){return this.node.nodeSize}},{key:"border",get:function(){return this.node.isLeaf?0:1}},{key:"updateChildren",value:function(t,e){var n=this,r=this.node.inlineContent,o=e,i=t.composing?this.localCompositionInfo(t,e):null,s=i&&i.pos>-1?i:null,a=i&&i.pos<0,u=new Ar(this,s&&s.node,t);!function(t,e,n,r){var o=e.locals(t),i=0;if(0==o.length){for(var s=0;s<t.childCount;s++){var a=t.child(s);r(a,o,e.forChild(i,a),s),i+=a.nodeSize}return}for(var u=0,c=[],l=null,f=0;;){for(var d=void 0,h=void 0;u<o.length&&o[u].to==i;){var p=o[u++];p.widget&&(d?(h||(h=[d])).push(p):d=p)}if(d)if(h){h.sort(Sr);for(var v=0;v<h.length;v++)n(h[v],f,!!l)}else n(d,f,!!l);var m=void 0,g=void 0;if(l)g=-1,m=l,l=null;else{if(!(f<t.childCount))break;g=f,m=t.child(f++)}for(var y=0;y<c.length;y++)c[y].to<=i&&c.splice(y--,1);for(;u<o.length&&o[u].from<=i&&o[u].to>i;)c.push(o[u++]);var k=i+m.nodeSize;if(m.isText){var D=k;u<o.length&&o[u].from<D&&(D=o[u].from);for(var b=0;b<c.length;b++)c[b].to<D&&(D=c[b].to);D<k&&(l=m.cut(D-i),m=m.cut(0,D-i),k=D,g=-1)}else for(;u<o.length&&o[u].to<k;)u++;r(m,m.isInline&&!m.isLeaf?c.filter(function(t){return!t.inline}):c.slice(),e.forChild(i,m),g),i=k}}(this.node,this.innerDeco,function(e,i,s){e.spec.marks?u.syncToMarks(e.spec.marks,r,t):e.type.side>=0&&!s&&u.syncToMarks(i==n.node.childCount?_.none:n.node.child(i).marks,r,t),u.placeWidget(e,t,o)},function(e,n,s,c){var l;u.syncToMarks(e.marks,r,t),u.findNodeMatch(e,n,s,c)||a&&t.state.selection.from>o&&t.state.selection.to<o+e.nodeSize&&(l=u.findIndexWithChild(i.node))>-1&&u.updateNodeAt(e,n,s,l,t)||u.updateNextNode(e,n,s,t,c,o)||u.addNode(e,n,s,t,o),o+=e.nodeSize}),u.syncToMarks([],r,t),this.node.isTextblock&&u.addTextblockHacks(),u.destroyRest(),(u.changed||2==this.dirty)&&(s&&this.protectLocalComposition(t,s),gr(this.contentDOM,this.children,t),Bn&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom))}},{key:"localCompositionInfo",value:function(t,e){var n=t.state.selection,r=n.from,o=n.to;if(!(t.state.selection instanceof We)||r<e||o>e+this.node.content.size)return null;var i=t.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){var s=i.nodeValue,a=function(t,e,n,r){for(var o=0,i=0;o<t.childCount&&i<=r;){var s=t.child(o++),a=i;if(i+=s.nodeSize,s.isText){for(var u=s.text;o<t.childCount;){var c=t.child(o++);if(i+=c.nodeSize,!c.isText)break;u+=c.text}if(i>=n){if(i>=r&&u.slice(r-e.length-a,r-a)==e)return r-e.length;var l=a<r?u.lastIndexOf(e,r-a-1):-1;if(l>=0&&l+e.length+a>=n)return a+l;if(n==r&&u.length>=r+e.length-a&&u.slice(r-a,r-a+e.length)==e)return r}}}return-1}(this.node.content,s,r-e,o-e);return a<0?null:{node:i,pos:a,text:s}}return{node:i,pos:-1,text:""}}},{key:"protectLocalComposition",value:function(t,e){var n=e.node,r=e.pos,o=e.text;if(!this.getDesc(n)){for(var i=n;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}var s=new lr(this,i,n,o);t.input.compositionNodes.push(s),this.children=Mr(this.children,r,r+o.length,t,s)}}},{key:"update",value:function(t,e,n,r){return!(3==this.dirty||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)}},{key:"updateInner",value:function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0}},{key:"updateOuterDeco",value:function(t){if(!xr(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=br(this.dom,this.nodeDOM,Dr(this.outerDeco,this.node,e),Dr(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}}},{key:"selectNode",value:function(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}},{key:"deselectNode",value:function(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}},{key:"domAtom",get:function(){return this.node.isAtom}}],[{key:"create",value:function(t,n,r,o,i,s){var a,u=i.nodeViews[n.type.name],c=u&&u(n,i,function(){return a?a.parent?a.parent.posBeforeChild(a):void 0:s},r,o),l=c&&c.dom,f=c&&c.contentDOM;if(n.isText)if(l){if(3!=l.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else l=document.createTextNode(n.text);else if(!l){var d=Ht.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs);l=d.dom,f=d.contentDOM}f||n.isText||"BR"==l.nodeName||(l.hasAttribute("contenteditable")||(l.contentEditable="false"),n.type.spec.draggable&&(l.draggable=!0));var h=l;return l=Cr(l,r,n),c?a=new mr(t,n,r,o,l,f||null,h,c,i,s+1):n.isText?new pr(t,n,r,o,l,h,i):new e(t,n,r,o,l,f||null,h,i,s+1)}}])}(ur);function hr(t,e,n,r,o){Cr(r,e,t);var i=new dr(void 0,t,e,n,r,r,r,o,0);return i.contentDOM&&i.updateChildren(o,0),i}var pr=function(t){function e(t,n,r,o,i,s,a){return D(this,e),h(this,e,[t,n,r,o,i,null,s,a,0])}return p(e,t),w(e,[{key:"parseRule",value:function(){for(var t=this.nodeDOM.parentNode;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}},{key:"update",value:function(t,e,n,r){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=0,!0)}},{key:"inParent",value:function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}},{key:"domFromPos",value:function(t){return{node:this.nodeDOM,offset:t}}},{key:"localPosFromDOM",value:function(t,n,r){return t==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):f(e,"localPosFromDOM",this,3)([t,n,r])}},{key:"ignoreMutation",value:function(t){return"characterData"!=t.type&&"selection"!=t.type}},{key:"slice",value:function(t,n,r){var o=this.node.cut(t,n),i=document.createTextNode(o.text);return new e(this.parent,o,this.outerDeco,this.innerDeco,i,i,r)}},{key:"markDirty",value:function(t,n){f(e,"markDirty",this,3)([t,n]),this.dom==this.nodeDOM||0!=t&&n!=this.nodeDOM.nodeValue.length||(this.dirty=3)}},{key:"domAtom",get:function(){return!1}},{key:"isText",value:function(t){return this.node.text==t}}])}(dr),vr=function(t){function e(){return D(this,e),h(this,e,arguments)}return p(e,t),w(e,[{key:"parseRule",value:function(){return{ignore:!0}}},{key:"matchesHack",value:function(t){return 0==this.dirty&&this.dom.nodeName==t}},{key:"domAtom",get:function(){return!0}},{key:"ignoreForCoords",get:function(){return"IMG"==this.dom.nodeName}}])}(ur),mr=function(t){function e(t,n,r,o,i,s,a,u,c,l){var f;return D(this,e),(f=h(this,e,[t,n,r,o,i,s,a,c,l])).spec=u,f}return p(e,t),w(e,[{key:"update",value:function(t,n,r,o){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){var i=this.spec.update(t,n,r);return i&&this.updateInner(t,n,r,o),i}return!(!this.contentDOM&&!t.isLeaf)&&f(e,"update",this,3)([t,n,r,o])}},{key:"selectNode",value:function(){this.spec.selectNode?this.spec.selectNode():f(e,"selectNode",this,3)([])}},{key:"deselectNode",value:function(){this.spec.deselectNode?this.spec.deselectNode():f(e,"deselectNode",this,3)([])}},{key:"setSelection",value:function(t,n,r,o){this.spec.setSelection?this.spec.setSelection(t,n,r.root):f(e,"setSelection",this,3)([t,n,r,o])}},{key:"destroy",value:function(){this.spec.destroy&&this.spec.destroy(),f(e,"destroy",this,3)([])}},{key:"stopEvent",value:function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}},{key:"ignoreMutation",value:function(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):f(e,"ignoreMutation",this,3)([t])}}])}(dr);function gr(t,e,n){for(var r=t.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==t){for(;a!=r;)r=Er(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(a,r);if(s instanceof fr){var u=r?r.previousSibling:t.lastChild;gr(s.contentDOM,s.children,n),r=u?u.nextSibling:t.firstChild}}for(;r;)r=Er(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}var yr=function(t){t&&(this.nodeName=t)};yr.prototype=Object.create(null);var kr=[new yr];function Dr(t,e,n){if(0==t.length)return kr;for(var r=n?kr[0]:new yr,o=[r],i=0;i<t.length;i++){var s=t[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new yr(s.nodeName)),s){var u=s[a];null!=u&&(n&&1==o.length&&o.push(r=new yr(e.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+u:"style"==a?r.style=(r.style?r.style+";":"")+u:"nodeName"!=a&&(r[a]=u))}}return o}function br(t,e,n,r){if(n==kr&&r==kr)return e;for(var o=e,i=0;i<r.length;i++){var s=r[i],a=n[i];if(i){var u=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(u=o.parentNode)&&u.nodeName.toLowerCase()==s.nodeName||((u=document.createElement(s.nodeName)).pmIsDeco=!0,u.appendChild(o),a=kr[0]),o=u}wr(o,a||kr[0],s)}return o}function wr(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[],a=0;a<i.length;a++)-1==s.indexOf(i[a])&&t.classList.remove(i[a]);for(var u=0;u<s.length;u++)-1==i.indexOf(s[u])&&t.classList.add(s[u]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style)for(var c,l=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;c=l.exec(e.style);)t.style.removeProperty(c[1]);n.style&&(t.style.cssText+=n.style)}}function Cr(t,e,n){return br(t,t,kr,Dr(e,n,1!=t.nodeType))}function xr(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Er(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var Ar=function(){return w(function t(e,n,r){D(this,t),this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(t,e){var n=e,r=n.children.length,o=t.childCount,i=new Map,s=[];t:for(;o>0;){for(var a=void 0;;)if(r){var u=n.children[r-1];if(!(u instanceof fr)){a=u,r--;break}n=u,r=u.children.length}else{if(n==e)break t;r=n.parent.children.indexOf(n),n=n.parent}var c=a.node;if(c){if(c!=t.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(e.node.content,e)},[{key:"destroyBetween",value:function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}},{key:"destroyRest",value:function(){this.destroyBetween(this.index,this.top.children.length)}},{key:"syncToMarks",value:function(t,e,n){for(var r=0,o=this.stack.length>>1,i=Math.min(o,t.length);r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning;)r++;for(;r<o;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);for(var s=-1,a=this.index;a<Math.min(this.index+3,this.top.children.length);a++){var u=this.top.children[a];if(u.matchesMark(t[o])&&!this.isLocked(u.dom)){s=a;break}}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{var c=fr.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}}},{key:"findNodeMatch",value:function(t,e,n,r){var o,i=-1;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(t,e,n))i=this.top.children.indexOf(o,this.index);else for(var s=this.index,a=Math.min(this.top.children.length,s+5);s<a;s++){var u=this.top.children[s];if(u.matchesNode(t,e,n)&&!this.preMatch.matched.has(u)){i=s;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}},{key:"updateNodeAt",value:function(t,e,n,r,o){var i=this.top.children[r];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(t,e,n,o)&&(this.destroyBetween(this.index,r),this.index++,!0)}},{key:"findIndexWithChild",value:function(t){for(;;){var e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){var n=t.pmViewDesc;if(n)for(var r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==n)return r;return-1}t=e}}},{key:"updateNextNode",value:function(t,e,n,r,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof dr){var u=this.preMatch.matched.get(a);if(null!=u&&u!=o)return!1;var c=a.dom,l=void 0,f=this.isLocked(c)&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&xr(e,a.outerDeco));if(!f&&a.update(t,e,n,r))return this.destroyBetween(this.index,s),a.dom!=c&&(this.changed=!0),this.index++,!0;if(!f&&(l=this.recreateWrapper(a,t,e,n,r,i)))return this.destroyBetween(this.index,s),this.top.children[this.index]=l,l.contentDOM&&(l.dirty=2,l.updateChildren(r,i+1),l.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}},{key:"recreateWrapper",value:function(t,e,n,r,o,i){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!xr(n,t.outerDeco)||!r.eq(t.innerDeco))return null;var s=dr.create(this.top,e,n,r,o,i);if(s.contentDOM){s.children=t.children,t.children=[];var a,c=u(s.children);try{for(c.s();!(a=c.n()).done;){a.value.parent=s}}catch(l){c.e(l)}finally{c.f()}}return t.destroy(),s}},{key:"addNode",value:function(t,e,n,r,o){var i=dr.create(this.top,t,e,n,r,o);i.contentDOM&&i.updateChildren(r,o+1),this.top.children.splice(this.index++,0,i),this.changed=!0}},{key:"placeWidget",value:function(t,e,n){var r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){var o=new cr(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++}},{key:"addTextblockHacks",value:function(){for(var t=this.top.children[this.index-1],e=this.top;t instanceof fr;)t=(e=t).children[e.children.length-1];(!t||!(t instanceof pr)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Nn||Tn)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}},{key:"addHackNode",value:function(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{var n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");var r=new vr(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}},{key:"isLocked",value:function(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))}}])}();function Sr(t,e){return t.type.side-e.type.side}function Mr(t,e,n,r,o){for(var i=[],s=0,a=0;s<t.length;s++){var u=t[s],c=a,l=a+=u.size;c>=n||l<=e?i.push(u):(c<e&&i.push(u.slice(0,e-c,r)),o&&(i.push(o),o=void 0),l>n&&i.push(u.slice(n-c,u.size,r)))}return i}function Or(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;var o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;var u,c,l=r.resolve(s);if(yn(n)){for(u=s;o&&!o.node;)o=o.parent;var f=o.node;if(o&&f.isAtom&&qe.isSelectable(f)&&o.parent&&(!f.isInline||!function(t,e,n){for(var r=0==e,o=e==mn(t);r||o;){if(t==n)return!0;var i=cn(t);if(!(t=t.parentNode))return!1;r=r&&0==i,o=o&&i==mn(t)}}(n.focusNode,n.focusOffset,o.dom))){var d=o.posBefore;c=new qe(s==d?l:r.resolve(d))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){for(var h=s,p=s,v=0;v<n.rangeCount;v++){var m=n.getRangeAt(v);h=Math.min(h,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(h<0)return null;var g=a(p==t.state.selection.anchor?[p,h]:[h,p],2);u=g[0],s=g[1],l=r.resolve(s)}else u=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(u<0)return null}var y=r.resolve(u);c||(c=zr(t,y,l,"pointer"==e||t.state.selection.head<l.pos&&!i?1:-1));return c}function Tr(t){return t.editable?t.hasFocus():$r(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Fr(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.state.selection;if(Pr(t,n),Tr(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Tn){var r=t.domSelectionRange(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&hn(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){var e=t.domSelection(),n=document.createRange();if(!e)return;var r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setStart(r.parentNode,cn(r)+1):n.setStart(r,0);n.collapse(!0),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&An&&Sn<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{var i,s,a=n.anchor,u=n.head;!Nr||n instanceof We||(n.$from.parent.inlineContent||(i=Br(t,n.from)),n.empty||n.$from.parent.inlineContent||(s=Br(t,n.to))),t.docView.setSelection(a,u,t,e),Nr&&(i&&Ir(i),s&&Ir(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);var n=t.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(function(){Tr(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var Nr=Nn||Tn&&Fn<63;function Br(t,e){var n=t.docView.domFromPos(e,0),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(Nn&&i&&"false"==i.contentEditable)return Rr(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return Rr(i);if(s)return Rr(s)}}function Rr(t){return t.contentEditable="true",Nn&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Ir(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Pr(t,e){if(e instanceof qe){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Lr(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Lr(t)}function Lr(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function zr(t,e,n,r){return t.someProp("createSelectionBetween",function(r){return r(t,e,n)})||We.between(e,n,r)}function jr(t){return!(t.editable&&!t.hasFocus())&&$r(t)}function $r(t){var e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function Vr(t,e){var n=t.selection,r=n.$anchor,o=n.$head,i=e>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&je.findFrom(s,e)}function Hr(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Wr(t,e,n){var r=t.state.selection;if(!(r instanceof We)){if(r instanceof qe&&r.node.isInline)return Hr(t,new We(e>0?r.$to:r.$from));var o=Vr(t.state,e);return!!o&&Hr(t,o)}if(n.indexOf("s")>-1){var i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;var a=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Hr(t,new We(r.$anchor,a))}if(!r.empty)return!1;if(t.endOfTextblock(e>0?"forward":"backward")){var u=Vr(t.state,e);return!!(u&&u instanceof qe)&&Hr(t,u)}if(!(Rn&&n.indexOf("m")>-1)){var c,l=r.$head,f=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter;if(!f||f.isText)return!1;var d=e<0?l.pos-f.nodeSize:l.pos;return!!(f.isAtom||(c=t.docView.descAt(d))&&!c.contentDOM)&&(qe.isSelectable(f)?Hr(t,new qe(e<0?t.state.doc.resolve(l.pos-f.nodeSize):l)):!!Ln&&Hr(t,new We(t.state.doc.resolve(e<0?d:d+f.nodeSize))))}}function _r(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function qr(t,e){var n=t.pmViewDesc;return n&&0==n.size&&(e<0||t.nextSibling||"BR"!=t.nodeName)}function Kr(t,e){return e<0?function(t){var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;var o,i,s=!1;Mn&&1==n.nodeType&&r<_r(n)&&qr(n.childNodes[r],-1)&&(s=!0);for(;;)if(r>0){if(1!=n.nodeType)break;var a=n.childNodes[r-1];if(qr(a,-1))o=n,i=--r;else{if(3!=a.nodeType)break;r=(n=a).nodeValue.length}}else{if(Jr(n))break;for(var u=n.previousSibling;u&&qr(u,-1);)o=n.parentNode,i=cn(u),u=u.previousSibling;if(u)r=_r(n=u);else{if((n=n.parentNode)==t.dom)break;r=0}}s?Ur(t,n,r):o&&Ur(t,o,i)}(t):function(t){var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;for(var o,i,s=_r(n);;)if(r<s){if(1!=n.nodeType)break;if(!qr(n.childNodes[r],1))break;o=n,i=++r}else{if(Jr(n))break;for(var a=n.nextSibling;a&&qr(a,1);)o=a.parentNode,i=cn(a)+1,a=a.nextSibling;if(a)r=0,s=_r(n=a);else{if((n=n.parentNode)==t.dom)break;r=s=0}}o&&Ur(t,o,i)}(t)}function Jr(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ur(t,e,n){var r,o;3!=e.nodeType&&((o=function(t,e){for(;t&&e==t.childNodes.length&&!gn(t);)e=cn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){var n=t.childNodes[e];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=n,e=0}}(e,n))?(e=o,n=0):(r=function(t,e){for(;t&&!e&&!gn(t);)e=cn(t),t=t.parentNode;for(;t&&e;){var n=t.childNodes[e-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=(t=n).childNodes.length}}(e,n))&&(e=r,n=r.nodeValue.length));var i=t.domSelection();if(i){if(yn(i)){var s=document.createRange();s.setEnd(e,n),s.setStart(e,n),i.removeAllRanges(),i.addRange(s)}else i.extend&&i.extend(e,n);t.domObserver.setCurSelection();var a=t.state;setTimeout(function(){t.state==a&&Fr(t)},50)}}function Gr(t,e){var n=t.state.doc.resolve(e);if(!Tn&&!In&&n.parent.inlineContent){var r=t.coordsAtPos(e);if(e>n.start()){var o=t.coordsAtPos(e-1),i=(o.top+o.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(o.left-r.left)>1)return o.left<r.left?"ltr":"rtl"}if(e<n.end()){var s=t.coordsAtPos(e+1),a=(s.top+s.bottom)/2;if(a>r.top&&a<r.bottom&&Math.abs(s.left-r.left)>1)return s.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(t.dom).direction?"rtl":"ltr"}function Qr(t,e,n){var r=t.state.selection;if(r instanceof We&&!r.empty||n.indexOf("s")>-1)return!1;if(Rn&&n.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=Vr(t.state,e);if(s&&s instanceof qe)return Hr(t,s)}if(!o.parent.inlineContent){var a=e<0?o:i,u=r instanceof Je?je.near(a,e):je.findFrom(a,e);return!!u&&Hr(t,u)}return!1}function Yr(t,e){if(!(t.state.selection instanceof We))return!0;var n=t.state.selection,r=n.$head,o=n.$anchor,i=n.empty;if(!r.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),t.dispatch(a),!0}return!1}function Xr(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Zr(t,e){var n=e.keyCode,r=function(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);if(8==n||Rn&&72==n&&"c"==r)return Yr(t,-1)||Kr(t,-1);if(46==n&&!e.shiftKey||Rn&&68==n&&"c"==r)return Yr(t,1)||Kr(t,1);if(13==n||27==n)return!0;if(37==n||Rn&&66==n&&"c"==r){var o=37==n?"ltr"==Gr(t,t.state.selection.from)?-1:1:-1;return Wr(t,o,r)||Kr(t,o)}if(39==n||Rn&&70==n&&"c"==r){var i=39==n?"ltr"==Gr(t,t.state.selection.from)?1:-1:1;return Wr(t,i,r)||Kr(t,i)}return 38==n||Rn&&80==n&&"c"==r?Qr(t,-1,r)||Kr(t,-1):40==n||Rn&&78==n&&"c"==r?function(t){if(!Nn||t.state.selection.$head.parentOffset>0)return!1;var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(n&&1==n.nodeType&&0==r&&n.firstChild&&"false"==n.firstChild.contentEditable){var o=n.firstChild;Xr(t,o,"true"),setTimeout(function(){return Xr(t,o,"false")},20)}return!1}(t)||Qr(t,1,r)||Kr(t,1):r==(Rn?"m":"c")&&(66==n||73==n||89==n||90==n)}function to(t,e){t.someProp("transformCopied",function(n){e=n(e,t)});for(var n=[],r=e,o=r.content,i=r.openStart,s=r.openEnd;i>1&&s>1&&1==o.childCount&&1==o.firstChild.childCount;){i--,s--;var a=o.firstChild;n.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),o=a.content}var u=t.someProp("clipboardSerializer")||Ht.fromSchema(t.state.schema),c=lo(),l=c.createElement("div");l.appendChild(u.serializeFragment(o,{document:c}));for(var f,d=l.firstChild,h=0;d&&1==d.nodeType&&(f=uo[d.nodeName.toLowerCase()]);){for(var p=f.length-1;p>=0;p--){for(var v=c.createElement(f[p]);l.firstChild;)v.appendChild(l.firstChild);l.appendChild(v),h++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice","".concat(i," ").concat(s).concat(h?" -".concat(h):""," ").concat(JSON.stringify(n))),{dom:l,text:t.someProp("clipboardTextSerializer",function(n){return n(e,t)})||e.content.textBetween(0,e.content.size,"\n\n"),slice:e}}function eo(t,e,n,r,o){var i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;var u=e&&(r||a||!n);if(u){if(t.someProp("transformPastedText",function(n){e=n(e,a||r,t)}),a)return e?new K($.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):K.empty;var c=t.someProp("clipboardTextParser",function(n){return n(e,o,r,t)});if(c)s=c;else{var l=o.marks(),f=t.state.schema,d=Ht.fromSchema(f);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(t){var e=i.appendChild(document.createElement("p"));t&&e.appendChild(d.serializeNode(f.text(t,l)))})}}else t.someProp("transformPastedHTML",function(e){n=e(n,t)}),i=function(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=lo().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t);(n=o&&uo[o[1].toLowerCase()])&&(t=n.map(function(t){return"<"+t+">"}).join("")+t+n.map(function(t){return"</"+t+">"}).reverse().join(""));if(r.innerHTML=function(t){var e=window.trustedTypes;if(!e)return t;fo||(fo=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:function(t){return t}}));return fo.createHTML(t)}(t),n)for(var i=0;i<n.length;i++)r=r.querySelector(n[i])||r;return r}(n),Ln&&function(t){for(var e=t.querySelectorAll(Tn?"span:not([class]):not([style])":"span.Apple-converted-space"),n=0;n<e.length;n++){var r=e[n];1==r.childNodes.length&&""==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(i);var h=i&&i.querySelector("[data-pm-slice]"),p=h&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(h.getAttribute("data-pm-slice")||"");if(p&&p[3])for(var v=+p[3];v>0;v--){for(var m=i.firstChild;m&&1!=m.nodeType;)m=m.nextSibling;if(!m)break;i=m}if(!s){var g=t.someProp("clipboardParser")||t.someProp("domParser")||Nt.fromSchema(t.state.schema);s=g.parseSlice(i,{preserveWhitespace:!(!u&&!p),context:o,ruleFromNode:function(t){return"BR"!=t.nodeName||t.nextSibling||!t.parentNode||no.test(t.parentNode.nodeName)?null:{ignore:!0}}})}if(p)s=function(t,e){if(!t.size)return t;var n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(c){return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var u=r.nodes[n[a]];if(!u||u.hasRequiredAttrs())break;o=$.from(u.create(n[a+1],o)),i++,s++}return new K(o,i,s)}(ao(s,+p[1],+p[2]),p[4]);else if(s=K.maxOpen(function(t,e){if(t.childCount<2)return t;for(var n,r=function(){var n,r=e.node(o).contentMatchAt(e.index(o)),i=[];if(t.forEach(function(t){if(i){var e,o=r.findWrapping(t.type);if(!o)return i=null;if(e=i.length&&n.length&&oo(o,n,t,i[i.length-1],0))i[i.length-1]=e;else{i.length&&(i[i.length-1]=io(i[i.length-1],n.length));var s=ro(t,o);i.push(s),r=r.matchType(s.type),n=o}}}),i)return{v:$.from(i)}},o=e.depth;o>=0;o--)if(n=r())return n.v;return t}(s.content,o),!0),s.openStart||s.openEnd){for(var y=0,k=0,D=s.content.firstChild;y<s.openStart&&!D.type.spec.isolating;y++,D=D.firstChild);for(var b=s.content.lastChild;k<s.openEnd&&!b.type.spec.isolating;k++,b=b.lastChild);s=ao(s,y,k)}return t.someProp("transformPasted",function(e){s=e(s,t)}),s}var no=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ro(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.length-1;r>=n;r--)t=e[r].create(null,$.from(t));return t}function oo(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=oo(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append($.from(ro(n,t,o+1))))}}function io(t,e){if(0==e)return t;var n=t.content.replaceChild(t.childCount-1,io(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore($.empty,!0);return t.copy(n.append(r))}function so(t,e,n,r,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(i=0),o<r-1&&(a=so(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore($.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function ao(t,e,n){return e<t.openStart&&(t=new K(so(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new K(so(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var uo={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},co=null;function lo(){return co||(co=document.implementation.createHTMLDocument("title"))}var fo=null;var ho={},po={},vo={touchstart:!0,touchmove:!0},mo=w(function t(){D(this,t),this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null});function go(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function yo(t){t.someProp("handleDOMEvents",function(e){for(var n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=function(e){return ko(t,e)})})}function ko(t,e){return t.someProp("handleDOMEvents",function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function Do(t){return{left:t.clientX,top:t.clientY}}function bo(t,e,n,r,o){if(-1==r)return!1;for(var i,s=t.state.doc.resolve(r),a=function(r){if(t.someProp(e,function(e){return r>s.depth?e(t,n,s.nodeAfter,s.before(r),o,!0):e(t,n,s.node(r),s.before(r),o,!1)}))return{v:!0}},u=s.depth+1;u>0;u--)if(i=a(u))return i.v;return!1}function wo(t,e,n){if(t.focused||t.focus(),!t.state.selection.eq(e)){var r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}}function Co(t,e,n,r,o){return bo(t,"handleClickOn",e,n,r)||t.someProp("handleClick",function(n){return n(t,e,r)})||(o?function(t,e){if(-1==e)return!1;var n,r,o=t.state.selection;o instanceof qe&&(n=o.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(qe.isSelectable(a)){r=n&&o.$from.depth>0&&s>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(s);break}}return null!=r&&(wo(t,qe.create(t.state.doc,r)),!0)}(t,n):function(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&qe.isSelectable(r))&&(wo(t,new qe(n)),!0)}(t,n))}function xo(t,e,n,r){return bo(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",function(n){return n(t,e,r)})}function Eo(t,e,n,r){return bo(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",function(n){return n(t,e,r)})||function(t,e,n){if(0!=n.button)return!1;var r=t.state.doc;if(-1==e)return!!r.inlineContent&&(wo(t,We.create(r,0,r.content.size)),!0);for(var o=r.resolve(e),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)wo(t,We.create(r,a+1,a+1+s.content.size));else{if(!qe.isSelectable(s))continue;wo(t,qe.create(r,a))}return!0}}(t,n,r)}function Ao(t){return Ro(t)}po.keydown=function(t,e){var n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!Oo(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!Pn||!Tn||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!Bn||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",function(e){return e(t,n)})||Zr(t,n)?n.preventDefault():go(t,"key");else{var r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(function(){t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",function(e){return e(t,kn(13,"Enter"))}),t.input.lastIOSEnter=0)},200)}},po.keyup=function(t,e){16==e.keyCode&&(t.input.shiftKey=!1)},po.keypress=function(t,e){var n=e;if(!(Oo(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Rn&&n.metaKey))if(t.someProp("handleKeyPress",function(e){return e(t,n)}))n.preventDefault();else{var r=t.state.selection;if(!(r instanceof We&&r.$from.sameParent(r.$to))){var o=String.fromCharCode(n.charCode),i=function(){return t.state.tr.insertText(o).scrollIntoView()};/[\r\n]/.test(o)||t.someProp("handleTextInput",function(e){return e(t,r.$from.pos,r.$to.pos,o,i)})||t.dispatch(i()),n.preventDefault()}}};var So=Rn?"metaKey":"ctrlKey";ho.mousedown=function(t,e){var n=e;t.input.shiftKey=n.shiftKey;var r=Ao(t),o=Date.now(),i="singleClick";o-t.input.lastClick.time<500&&function(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[So]&&t.input.lastClick.button==n.button&&("singleClick"==t.input.lastClick.type?i="doubleClick":"doubleClick"==t.input.lastClick.type&&(i="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};var s=t.posAtCoords(Do(n));s&&("singleClick"==i?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new Mo(t,s,n,!!r)):("doubleClick"==i?xo:Eo)(t,s.pos,s.inside,n)?n.preventDefault():go(t,"pointer"))};var Mo=function(){return w(function t(e,n,r,o){var i,s,a=this;if(D(this,t),this.view=e,this.pos=n,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[So],this.allowDefault=r.shiftKey,n.inside>-1)i=e.state.doc.nodeAt(n.inside),s=n.inside;else{var u=e.state.doc.resolve(n.pos);i=u.parent,s=u.depth?u.before():0}var c=o?null:r.target,l=c?e.docView.nearestDesc(c,!0):null;this.target=l&&1==l.dom.nodeType?l.dom:null;var f=e.state.selection;(0==r.button&&i.type.spec.draggable&&!1!==i.type.spec.selectable||f instanceof qe&&f.from<=s&&f.to>s)&&(this.mightDrag={node:i,pos:s,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Mn||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){a.view.input.mouseDown==a&&a.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),go(e,"pointer")},[{key:"done",value:function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Fr(t.view)}),this.view.input.mouseDown=null}},{key:"up",value:function(t){if(this.done(),this.view.dom.contains(t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Do(t))),this.updateAllowDefault(t),this.allowDefault||!e?go(this.view,"pointer"):Co(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||Nn&&this.mightDrag&&!this.mightDrag.node.isAtom||Tn&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(wo(this.view,je.near(this.view.state.doc.resolve(e.pos))),t.preventDefault()):go(this.view,"pointer")}}},{key:"move",value:function(t){this.updateAllowDefault(t),go(this.view,"pointer"),0==t.buttons&&this.done()}},{key:"updateAllowDefault",value:function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}])}();function Oo(t,e){return!!t.composing||!!(Nn&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}ho.touchstart=function(t){t.input.lastTouch=Date.now(),Ao(t),go(t,"pointer")},ho.touchmove=function(t){t.input.lastTouch=Date.now(),go(t,"pointer")},ho.contextmenu=function(t){return Ao(t)};var To=Pn?5e3:-1;function Fo(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(function(){return Ro(t)},e))}function No(t){var e;for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=((e=document.createEvent("Event")).initEvent("event",!0,!0),e.timeStamp));t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Bo(t){var e=t.domSelectionRange();if(!e.focusNode)return null;var n=function(t,e){for(;;){if(3==t.nodeType&&e)return t;if(1==t.nodeType&&e>0){if("false"==t.contentEditable)return null;e=mn(t=t.childNodes[e-1])}else{if(!t.parentNode||gn(t))return null;e=cn(t),t=t.parentNode}}}(e.focusNode,e.focusOffset),r=function(t,e){for(;;){if(3==t.nodeType&&e<t.nodeValue.length)return t;if(1==t.nodeType&&e<t.childNodes.length){if("false"==t.contentEditable)return null;t=t.childNodes[e],e=0}else{if(!t.parentNode||gn(t))return null;e=cn(t)+1,t=t.parentNode}}}(e.focusNode,e.focusOffset);if(n&&r&&n!=r){var o=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!o||!o.isText(r.nodeValue))return r;if(t.input.compositionNode==r){var s=n.pmViewDesc;if(s&&s.isText(n.nodeValue))return r}}return n||r}function Ro(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(Pn&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),No(t),e||t.docView&&t.docView.dirty){var n=Or(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):!t.markCursor&&!e||r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.updateState(t.state):t.dispatch(t.state.tr.deleteSelection()),!0}return!1}}po.compositionstart=po.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,n=e.selection.$to;if(e.selection instanceof We&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(function(t){return!1===t.type.spec.inclusive})))t.markCursor=t.state.storedMarks||n.marks(),Ro(t,!0),t.markCursor=null;else if(Ro(t,!e.selection.empty),Mn&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=t.domSelectionRange(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){var a=t.domSelection();a&&a.collapse(s,s.nodeValue.length);break}o=s,i=-1}t.input.composing=!0}Fo(t,To)},po.compositionend=function(t,e){t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(function(){return t.domObserver.flush()}),t.input.compositionID++,Fo(t,20))};var Io=An&&Sn<15||Bn&&zn<604;function Po(t,e,n,r,o){var i=eo(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",function(e){return e(t,o,i||K.empty)}))return!0;if(!i)return!1;var s=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(i),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Lo(t){var e=t.getData("text/plain")||t.getData("Text");if(e)return e;var n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}ho.copy=po.cut=function(t,e){var n=e,r=t.state.selection,o="cut"==n.type;if(!r.empty){var i=Io?null:n.clipboardData,s=to(t,r.content()),a=s.dom,u=s.text;i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",u)):function(t,e){if(t.dom.parentNode){var n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}}(t,a),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},po.paste=function(t,e){var n=e;if(!t.composing||Pn){var r=Io?null:n.clipboardData,o=t.input.shiftKey&&45!=t.input.lastKeyCode;r&&Po(t,Lo(r),r.getData("text/html"),o,n)?n.preventDefault():function(t,e){if(t.dom.parentNode){var n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();var o=t.input.shiftKey&&45!=t.input.lastKeyCode;setTimeout(function(){t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Po(t,r.value,null,o,e):Po(t,r.textContent,r.innerHTML,o,e)},50)}}(t,n)}};var zo=w(function t(e,n,r){D(this,t),this.slice=e,this.move=n,this.node=r}),jo=Rn?"altKey":"ctrlKey";function $o(t,e){var n=t.someProp("dragCopies",function(t){return!t(e)});return null!=n?n:!e[jo]}for(var Vo in ho.dragstart=function(t,e){var n=e,r=t.input.mouseDown;if(r&&r.done(),n.dataTransfer){var o,i=t.state.selection,s=i.empty?null:t.posAtCoords(Do(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof qe?i.to-1:i.to));else if(r&&r.mightDrag)o=qe.create(t.state.doc,r.mightDrag.pos);else if(n.target&&1==n.target.nodeType){var a=t.docView.nearestDesc(n.target,!0);a&&a.node.type.spec.draggable&&a!=t.docView&&(o=qe.create(t.state.doc,a.posBefore))}var u=to(t,(o||t.state.selection).content()),c=u.dom,l=u.text,f=u.slice;(!n.dataTransfer.files.length||!Tn||Fn>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Io?"Text":"text/html",c.innerHTML),n.dataTransfer.effectAllowed="copyMove",Io||n.dataTransfer.setData("text/plain",l),t.dragging=new zo(f,$o(t,n),o)}},ho.dragend=function(t){var e=t.dragging;window.setTimeout(function(){t.dragging==e&&(t.dragging=null)},50)},po.dragover=po.dragenter=function(t,e){return e.preventDefault()},po.drop=function(t,e){var n=e,r=t.dragging;if(t.dragging=null,n.dataTransfer){var o=t.posAtCoords(Do(n));if(o){var i=t.state.doc.resolve(o.pos),s=r&&r.slice;s?t.someProp("transformPasted",function(e){s=e(s,t)}):s=eo(t,Lo(n.dataTransfer),Io?null:n.dataTransfer.getData("text/html"),!1,i);var a=!(!r||!$o(t,n));if(t.someProp("handleDrop",function(e){return e(t,n,s||K.empty,a)}))n.preventDefault();else if(s){n.preventDefault();var u=s?we(t.state.doc,i.pos,s):i.pos;null==u&&(u=i.pos);var c=t.state.tr;if(a){var l=r.node;l?l.replace(c):c.deleteSelection()}var f=c.mapping.map(u),d=0==s.openStart&&0==s.openEnd&&1==s.content.childCount,h=c.doc;if(d?c.replaceRangeWith(f,f,s.content.firstChild):c.replaceRange(f,f,s),!c.doc.eq(h)){var p=c.doc.resolve(f);if(d&&qe.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new qe(p));else{var v=c.mapping.map(u);c.mapping.maps[c.mapping.maps.length-1].forEach(function(t,e,n,r){return v=r}),c.setSelection(zr(t,p,c.doc.resolve(v)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}}}}},ho.focus=function(t){t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Fr(t)},20))},ho.blur=function(t,e){var n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},ho.beforeinput=function(t,e){if(Tn&&Pn&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();var n=t.input.domChangeCount;setTimeout(function(){if(t.input.domChangeCount==n&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",function(e){return e(t,kn(8,"Backspace"))}))){var e=t.state.selection.$cursor;e&&e.pos>0&&t.dispatch(t.state.tr.delete(e.pos-1,e.pos).scrollIntoView())}},50)}},po)ho[Vo]=po[Vo];function Ho(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var Wo=function(){function t(e,n){D(this,t),this.toDOM=e,this.spec=n||Uo,this.side=this.spec.side||0}return w(t,[{key:"map",value:function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos;return o.deleted?null:new Ko(i-n,i-n,this)}},{key:"valid",value:function(){return!0}},{key:"eq",value:function(e){return this==e||e instanceof t&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Ho(this.spec,e.spec))}},{key:"destroy",value:function(t){this.spec.destroy&&this.spec.destroy(t)}}])}(),_o=function(){function t(e,n){D(this,t),this.attrs=e,this.spec=n||Uo}return w(t,[{key:"map",value:function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new Ko(o,i,this)}},{key:"valid",value:function(t,e){return e.from<e.to}},{key:"eq",value:function(e){return this==e||e instanceof t&&Ho(this.attrs,e.attrs)&&Ho(this.spec,e.spec)}},{key:"destroy",value:function(){}}],[{key:"is",value:function(e){return e.type instanceof t}}])}(),qo=function(){function t(e,n){D(this,t),this.attrs=e,this.spec=n||Uo}return w(t,[{key:"map",value:function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new Ko(o.pos-n,i.pos-n,this)}},{key:"valid",value:function(t,e){var n,r=t.content.findIndex(e.from),o=r.index,i=r.offset;return i==e.from&&!(n=t.child(o)).isText&&i+n.nodeSize==e.to}},{key:"eq",value:function(e){return this==e||e instanceof t&&Ho(this.attrs,e.attrs)&&Ho(this.spec,e.spec)}},{key:"destroy",value:function(){}}])}(),Ko=function(){function t(e,n,r){D(this,t),this.from=e,this.to=n,this.type=r}return w(t,[{key:"copy",value:function(e,n){return new t(e,n,this.type)}},{key:"eq",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}},{key:"map",value:function(t,e,n){return this.type.map(t,this,e,n)}},{key:"spec",get:function(){return this.type.spec}},{key:"inline",get:function(){return this.type instanceof _o}},{key:"widget",get:function(){return this.type instanceof Wo}}],[{key:"widget",value:function(e,n,r){return new t(e,e,new Wo(n,r))}},{key:"inline",value:function(e,n,r,o){return new t(e,n,new _o(r,o))}},{key:"node",value:function(e,n,r,o){return new t(e,n,new qo(r,o))}}])}(),Jo=[],Uo={},Go=function(){function t(e,n){D(this,t),this.local=e.length?e:Jo,this.children=n.length?n:Jo}return w(t,[{key:"find",value:function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r}},{key:"findInner",value:function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(var a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){var u=this.children[a]+1;this.children[a+2].findInner(t-u,e-u,n,r+u,o)}}},{key:"map",value:function(t,e,n){return this==Qo||0==t.maps.length?this:this.mapInner(t,e,0,0,n||Uo)}},{key:"mapInner",value:function(e,n,r,o,i){for(var s,a=0;a<this.local.length;a++){var u=this.local[a].map(e,r,o);u&&u.type.valid(n,u)?(s||(s=[])).push(u):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?Xo(this.children,s||[],e,n,r,o,i):s?new t(s.sort(ri),Jo):Qo}},{key:"add",value:function(e,n){return n.length?this==Qo?t.create(e,n):this.addInner(e,n,0):this}},{key:"addInner",value:function(e,n,r){var o,i=this,s=0;e.forEach(function(t,e){var a,u=e+r;if(a=ti(n,t,u)){for(o||(o=i.children.slice());s<o.length&&o[s]<e;)s+=3;o[s]==e?o[s+2]=o[s+2].addInner(t,a,u+1):o.splice(s,0,e,e+t.nodeSize,ni(a,t,u+1,Uo)),s+=3}});for(var a=Zo(s?ei(n):n,-r),u=0;u<a.length;u++)a[u].type.valid(e,a[u])||a.splice(u--,1);return new t(a.length?this.local.concat(a).sort(ri):this.local,o||this.children)}},{key:"remove",value:function(t){return 0==t.length||this==Qo?this:this.removeInner(t,0)}},{key:"removeInner",value:function(e,n){for(var r=this.children,o=this.local,i=0;i<r.length;i+=3){for(var s,a=void 0,u=r[i]+n,c=r[i+1]+n,l=0;l<e.length;l++)(s=e[l])&&s.from>u&&s.to<c&&(e[l]=null,(a||(a=[])).push(s));if(a){r==this.children&&(r=this.children.slice());var f=r[i+2].removeInner(a,u+1);f!=Qo?r[i+2]=f:(r.splice(i,3),i-=3)}}if(o.length)for(var d,h=0;h<e.length;h++)if(d=e[h])for(var p=0;p<o.length;p++)o[p].eq(d,n)&&(o==this.local&&(o=this.local.slice()),o.splice(p--,1));return r==this.children&&o==this.local?this:o.length||r.length?new t(o,r):Qo}},{key:"forChild",value:function(e,n){if(this==Qo)return this;if(n.isLeaf)return t.empty;for(var r,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=e){this.children[i]==e&&(r=this.children[i+2]);break}for(var s=e+1,a=s+n.content.size,u=0;u<this.local.length;u++){var c=this.local[u];if(c.from<a&&c.to>s&&c.type instanceof _o){var l=Math.max(s,c.from)-s,f=Math.min(a,c.to)-s;l<f&&(o||(o=[])).push(c.copy(l,f))}}if(o){var d=new t(o.sort(ri),Jo);return r?new Yo([d,r]):d}return r||Qo}},{key:"eq",value:function(e){if(this==e)return!0;if(!(e instanceof t)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(var r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0}},{key:"locals",value:function(t){return oi(this.localsInner(t))}},{key:"localsInner",value:function(t){if(this==Qo)return Jo;if(t.inlineContent||!this.local.some(_o.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof _o||e.push(this.local[n]);return e}},{key:"forEachSet",value:function(t){t(this)}}],[{key:"create",value:function(t,e){return e.length?ni(e,t,0,Uo):Qo}}])}();Go.empty=new Go([],[]),Go.removeOverlap=oi;var Qo=Go.empty,Yo=function(){function t(e){D(this,t),this.members=e}return w(t,[{key:"map",value:function(e,n){var r=this.members.map(function(t){return t.map(e,n,Uo)});return t.from(r)}},{key:"forChild",value:function(e,n){if(n.isLeaf)return Go.empty;for(var r=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(e,n);i!=Qo&&(i instanceof t?r=r.concat(i.members):r.push(i))}return t.from(r)}},{key:"eq",value:function(e){if(!(e instanceof t)||e.members.length!=this.members.length)return!1;for(var n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}},{key:"locals",value:function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?oi(n?e:e.sort(ri)):Jo}},{key:"forEachSet",value:function(t){for(var e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}],[{key:"from",value:function(e){switch(e.length){case 0:return Qo;case 1:return e[0];default:return new t(e.every(function(t){return t instanceof Go})?e:e.reduce(function(t,e){return t.concat(e instanceof Go?e:e.members)},[]))}}}])}();function Xo(t,e,n,r,o,i,s){for(var a=t.slice(),u=function(t){var e=0;n.maps[c].forEach(function(n,r,o,i){for(var s=i-o-(r-n),u=0;u<a.length;u+=3){var c=a[u+1];if(!(c<0||n>c+t-e)){var l=a[u]+t-e;r>=l?a[u+1]=n<=l?-2:-1:n>=t&&s&&(a[u]+=s,a[u+1]+=s)}}e+=s}),t=n.maps[c].map(t,-1),l=t},c=0,l=i;c<n.maps.length;c++)u(l);for(var f=!1,d=0;d<a.length;d+=3)if(a[d+1]<0){if(-2==a[d+1]){f=!0,a[d+1]=-1;continue}var h=n.map(t[d]+i),p=h-o;if(p<0||p>=r.content.size){f=!0;continue}var v=n.map(t[d+1]+i,-1)-o,m=r.content.findIndex(p),g=m.index,y=m.offset,k=r.maybeChild(g);if(k&&y==p&&y+k.nodeSize==v){var D=a[d+2].mapInner(n,k,h+1,t[d]+i+1,s);D!=Qo?(a[d]=p,a[d+1]=v,a[d+2]=D):(a[d+1]=-2,f=!0)}else f=!0}if(f){var b=function(t,e,n,r,o,i,s){function a(t,e){for(var i=0;i<t.local.length;i++){var u=t.local[i].map(r,o,e);u?n.push(u):s.onRemove&&s.onRemove(t.local[i].spec)}for(var c=0;c<t.children.length;c+=3)a(t.children[c+2],t.children[c]+e+1)}for(var u=0;u<t.length;u+=3)-1==t[u+1]&&a(t[u+2],e[u]+i+1);return n}(a,t,e,n,o,i,s),w=ni(b,r,0,s);e=w.local;for(var C=0;C<a.length;C+=3)a[C+1]<0&&(a.splice(C,3),C-=3);for(var x=0,E=0;x<w.children.length;x+=3){for(var A=w.children[x];E<a.length&&a[E]<A;)E+=3;a.splice(E,0,w.children[x],w.children[x+1],w.children[x+2])}}return new Go(e.sort(ri),a)}function Zo(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new Ko(o.from+e,o.to+e,o.type))}return n}function ti(t,e,n){if(e.isLeaf)return null;for(var r,o=n+e.nodeSize,i=null,s=0;s<t.length;s++)(r=t[s])&&r.from>n&&r.to<o&&((i||(i=[])).push(r),t[s]=null);return i}function ei(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function ni(t,e,n,r){var o=[],i=!1;e.forEach(function(e,s){var a=ti(t,e,s+n);if(a){i=!0;var u=ni(a,e,n+s+1,r);u!=Qo&&o.push(s,s+e.nodeSize,u)}});for(var s=Zo(i?ei(t):t,-n).sort(ri),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new Go(s,o):Qo}function ri(t,e){return t.from-e.from||t.to-e.to}function oi(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),ii(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),ii(e,o+1,i.copy(r.to,i.to)))}}return e}function ii(t,e,n){for(;e<t.length&&ri(n,t[e])>0;)e++;t.splice(e,0,n)}function si(t){var e=[];return t.someProp("decorations",function(n){var r=n(t.state);r&&r!=Qo&&e.push(r)}),t.cursorWrapper&&e.push(Go.create(t.state.doc,[t.cursorWrapper.deco])),Yo.from(e)}var ai={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ui=An&&Sn<=11,ci=function(){return w(function t(){D(this,t),this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0},[{key:"set",value:function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}},{key:"clear",value:function(){this.anchorNode=this.focusNode=null}},{key:"eq",value:function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}])}(),li=function(){return w(function t(e,n){var r=this;D(this,t),this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new ci,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(function(t){for(var e=0;e<t.length;e++)r.queue.push(t[e]);An&&Sn<=11&&t.some(function(t){return"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length})?r.flushSoon():r.flush()}),ui&&(this.onCharData=function(t){r.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),r.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)},[{key:"flushSoon",value:function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))}},{key:"forceFlush",value:function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}},{key:"start",value:function(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,ai)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}},{key:"stop",value:function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}},{key:"connectSelection",value:function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}},{key:"disconnectSelection",value:function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}},{key:"suppressSelectionUpdates",value:function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)}},{key:"onSelectionChange",value:function(){if(jr(this.view)){if(this.suppressingSelectionUpdates)return Fr(this.view);if(An&&Sn<=11&&!this.view.state.selection.empty){var t=this.view.domSelectionRange();if(t.focusNode&&hn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}},{key:"setCurSelection",value:function(){this.currentSelection.set(this.view.domSelectionRange())}},{key:"ignoreSelectionChange",value:function(t){if(!t.focusNode)return!0;for(var e,n=new Set,r=t.focusNode;r;r=ln(r))n.add(r);for(var o=t.anchorNode;o;o=ln(o))if(n.has(o)){e=o;break}var i=e&&this.view.docView.nearestDesc(e);return i&&i.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0}},{key:"pendingRecords",value:function(){if(this.observer){var t,e=u(this.observer.takeRecords());try{for(e.s();!(t=e.n()).done;){var n=t.value;this.queue.push(n)}}catch(r){e.e(r)}finally{e.f()}}return this.queue}},{key:"flush",value:function(){var t=this.view;if(t.docView&&!(this.flushingSoon>-1)){var e=this.pendingRecords();e.length&&(this.queue=[]);var n=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&jr(t)&&!this.ignoreSelectionChange(n),o=-1,i=-1,s=!1,c=[];if(t.editable)for(var l=0;l<e.length;l++){var f=this.registerMutation(e[l],c);f&&(o=o<0?f.from:Math.min(f.from,o),i=i<0?f.to:Math.max(f.to,i),f.typeOver&&(s=!0))}if(Mn&&c.length){var d=c.filter(function(t){return"BR"==t.nodeName});if(2==d.length){var h=a(d,2),p=h[0],v=h[1];p.parentNode&&p.parentNode.parentNode==v.parentNode?v.remove():p.remove()}else{var m,g=this.currentSelection.focusNode,y=u(d);try{for(y.s();!(m=y.n()).done;){var k=m.value,D=k.parentNode;!D||"LI"!=D.nodeName||g&&pi(t,g)==D||k.remove()}}catch(w){y.e(w)}finally{y.f()}}}var b=null;o<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&yn(n)&&(b=Or(t))&&b.eq(je.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Fr(t),this.currentSelection.set(n),t.scrollToSelection()):(o>-1||r)&&(o>-1&&(t.docView.markDirty(o,i),function(t){if(fi.has(t))return;if(fi.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)){if(t.requiresGeckoHackNode=Mn,di)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),di=!0}}(t)),this.handleDOMChange(o,i,s,c),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||Fr(t),this.currentSelection.set(n))}}},{key:"registerMutation",value:function(t,e){if(e.indexOf(t.target)>-1)return null;var n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(var r=0;r<t.addedNodes.length;r++){var o=t.addedNodes[r];e.push(o),3==o.nodeType&&(this.lastChangedTextNode=o)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};var i=t.previousSibling,s=t.nextSibling;if(An&&Sn<=11&&t.addedNodes.length)for(var a=0;a<t.addedNodes.length;a++){var u=t.addedNodes[a],c=u.previousSibling,l=u.nextSibling;(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(i=c),(!l||Array.prototype.indexOf.call(t.addedNodes,l)<0)&&(s=l)}var f=i&&i.parentNode==t.target?cn(i)+1:0,d=n.localPosFromDOM(t.target,f,-1),h=s&&s.parentNode==t.target?cn(s):t.target.childNodes.length;return{from:d,to:n.localPosFromDOM(t.target,h,1)}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}])}(),fi=new WeakMap,di=!1;function hi(t,e){var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,s=t.domAtPos(t.state.selection.anchor);if(hn(s.node,s.offset,o,i)){var a=[o,i,n,r];n=a[0],r=a[1],o=a[2],i=a[3]}return{anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:i}}function pi(t,e){for(var n=e.parentNode;n&&n!=t.dom;n=n.parentNode){var r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function vi(t){var e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Nn&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||Nn&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}var mi=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function gi(t,e,n,r,o){var i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){var s=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,a=Or(t,s);if(a&&!t.state.selection.eq(a)){if(Tn&&Pn&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",function(e){return e(t,kn(13,"Enter"))}))return;var u=t.state.tr.setSelection(a);"pointer"==s?u.setMeta("pointer",!0):"key"==s&&u.scrollIntoView(),i&&u.setMeta("composition",i),t.dispatch(u)}}else{var c=t.state.doc.resolve(e),l=c.sharedDepth(n);e=c.before(l+1),n=t.state.doc.resolve(n).after(l+1);var f,d,h=t.state.selection,p=function(t,e,n){var r,o=t.docView.parseRange(e,n),i=o.node,s=o.fromOffset,a=o.toOffset,u=o.from,c=o.to,l=t.domSelectionRange(),f=l.anchorNode;if(f&&t.dom.contains(1==f.nodeType?f:f.parentNode)&&(r=[{node:f,offset:l.anchorOffset}],yn(l)||r.push({node:l.focusNode,offset:l.focusOffset})),Tn&&8===t.input.lastKeyCode)for(var d=a;d>s;d--){var h=i.childNodes[d-1],p=h.pmViewDesc;if("BR"==h.nodeName&&!p){a=d;break}if(!p||p.size)break}var v=t.state.doc,m=t.someProp("domParser")||Nt.fromSchema(t.state.schema),g=v.resolve(u),y=null,k=m.parse(i,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:s,to:a,preserveWhitespace:"pre"!=g.parent.type.whitespace||"full",findPositions:r,ruleFromNode:vi,context:g});if(r&&null!=r[0].pos){var D=r[0].pos,b=r[1]&&r[1].pos;null==b&&(b=D),y={anchor:D+u,head:b+u}}return{doc:k,sel:y,from:u,to:c}}(t,e,n),v=t.state.doc,m=v.slice(p.from,p.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,d="end"):(f=t.state.selection.from,d="start"),t.input.lastKeyCode=null;var g=function(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var s=t.findDiffEnd(e,n+t.size,n+e.size),a=s.a,u=s.b;if("end"==o){r-=a+Math.max(0,i-Math.min(a,u))-i}if(a<i&&t.size<e.size){var c=r<=i&&r>=a?i-r:0;(i-=c)&&i<e.size&&Di(e.textBetween(i-1,i+1))&&(i+=c?1:-1),u=i+(u-a),a=i}else if(u<i){var l=r<=i&&r>=u?i-r:0;(i-=l)&&i<t.size&&Di(t.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-u),u=i}return{start:i,endA:a,endB:u}}(m.content,p.doc.content,p.from,f,d);if(g&&t.input.domChangeCount++,(Bn&&t.input.lastIOSEnter>Date.now()-225||Pn)&&o.some(function(t){return 1==t.nodeType&&!mi.test(t.nodeName)})&&(!g||g.endA>=g.endB)&&t.someProp("handleKeyDown",function(e){return e(t,kn(13,"Enter"))}))t.input.lastIOSEnter=0;else{if(!g){if(!(r&&h instanceof We&&!h.empty&&h.$head.sameParent(h.$anchor))||t.composing||p.sel&&p.sel.anchor!=p.sel.head){if(p.sel){var y=yi(t,t.state.doc,p.sel);if(y&&!y.eq(t.state.selection)){var k=t.state.tr.setSelection(y);i&&k.setMeta("composition",i),t.dispatch(k)}}return}g={start:h.from,endA:h.to,endB:h.to}}t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof We&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=p.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=p.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),An&&Sn<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>p.from&&" "==p.doc.textBetween(g.start-p.from-1,g.start-p.from+1)&&(g.start--,g.endA--,g.endB--);var D,b=p.doc.resolveNoCache(g.start-p.from),w=p.doc.resolveNoCache(g.endB-p.from),C=v.resolve(g.start),x=b.sameParent(w)&&b.parent.inlineContent&&C.end()>=g.endA;if((Bn&&t.input.lastIOSEnter>Date.now()-225&&(!x||o.some(function(t){return"DIV"==t.nodeName||"P"==t.nodeName}))||!x&&b.pos<p.doc.content.size&&(!b.sameParent(w)||!b.parent.inlineContent)&&!/\S/.test(p.doc.textBetween(b.pos,w.pos,"",""))&&(D=je.findFrom(p.doc.resolve(b.pos+1),1,!0))&&D.head>b.pos)&&t.someProp("handleKeyDown",function(e){return e(t,kn(13,"Enter"))}))t.input.lastIOSEnter=0;else if(t.state.selection.anchor>g.start&&function(t,e,n,r,o){if(n-e<=o.pos-r.pos||ki(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(!r.parent.isTextblock){var s=i.nodeAfter;return null!=s&&n==e+s.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var a=t.resolve(ki(i,!0,!0));return!(!a.parent.isTextblock||a.pos>n||ki(a,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(a.parent.content)}(v,g.start,g.endA,b,w)&&t.someProp("handleKeyDown",function(e){return e(t,kn(8,"Backspace"))}))Pn&&Tn&&t.domObserver.suppressSelectionUpdates();else{Tn&&g.endB==g.start&&(t.input.lastChromeDelete=Date.now()),Pn&&!x&&b.start()!=w.start()&&0==w.parentOffset&&b.depth==w.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==g.endA&&(g.endB-=2,w=p.doc.resolveNoCache(g.endB-p.from),setTimeout(function(){t.someProp("handleKeyDown",function(e){return e(t,kn(13,"Enter"))})},20));var E,A=g.start,S=g.endA,M=function(e){var n=e||t.state.tr.replace(A,S,p.doc.slice(g.start-p.from,g.endB-p.from));if(p.sel){var r=yi(t,n.doc,p.sel);r&&!(Tn&&t.composing&&r.empty&&(g.start!=g.endB||t.input.lastChromeDelete<Date.now()-100)&&(r.head==A||r.head==n.mapping.map(S)-1)||An&&r.empty&&r.head==A)&&n.setSelection(r)}return i&&n.setMeta("composition",i),n.scrollIntoView()};if(x){if(b.pos==w.pos){An&&Sn<=11&&0==b.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Fr(t)},20));var O=M(t.state.tr.delete(A,S)),T=v.resolve(g.start).marksAcross(v.resolve(g.endA));T&&O.ensureMarks(T),t.dispatch(O)}else if(g.endA==g.endB&&(E=function(t,e){for(var n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,u=s,c=0;c<s.length;c++)a=s[c].removeFromSet(a);for(var l=0;l<i.length;l++)u=i[l].removeFromSet(u);if(1==a.length&&0==u.length)r=a[0],n="add",o=function(t){return t.mark(r.addToSet(t.marks))};else{if(0!=a.length||1!=u.length)return null;r=u[0],n="remove",o=function(t){return t.mark(r.removeFromSet(t.marks))}}for(var f=[],d=0;d<e.childCount;d++)f.push(o(e.child(d)));if($.from(f).eq(t))return{mark:r,type:n}}(b.parent.content.cut(b.parentOffset,w.parentOffset),C.parent.content.cut(C.parentOffset,g.endA-C.start())))){var F=M(t.state.tr);"add"==E.type?F.addMark(A,S,E.mark):F.removeMark(A,S,E.mark),t.dispatch(F)}else if(b.parent.child(b.index()).isText&&b.index()==w.index()-(w.textOffset?0:1)){var N=b.parent.textBetween(b.parentOffset,w.parentOffset),B=function(){return M(t.state.tr.insertText(N,A,S))};t.someProp("handleTextInput",function(e){return e(t,A,S,N,B)})||t.dispatch(B())}}else t.dispatch(M())}}}}function yi(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:zr(t,e.resolve(n.anchor),e.resolve(n.head))}function ki(t,e,n){for(var r=t.depth,o=e?t.end():t.pos;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n)for(var i=t.node(r).maybeChild(t.indexAfter(r));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function Di(t){if(2!=t.length)return!1;var e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}var bi=function(){return w(function t(e,n){var r=this;D(this,t),this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new mo,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Ai),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=xi(this),Ci(this),this.nodeViews=Ei(this),this.docView=hr(this.state.doc,wi(this),si(this),this.dom,this),this.domObserver=new li(this,function(t,e,n,o){return gi(r,t,e,n,o)}),this.domObserver.start(),function(t){var e=function(){var e=ho[n];t.dom.addEventListener(n,t.input.eventHandlers[n]=function(n){!function(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}(t,n)||ko(t,n)||!t.editable&&n.type in po||e(t,n)},vo[n]?{passive:!0}:void 0)};for(var n in ho)e();Nn&&t.dom.addEventListener("input",function(){return null}),yo(t)}(this),this.updatePluginViews()},[{key:"composing",get:function(){return this.input.composing}},{key:"props",get:function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props}},{key:"update",value:function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&yo(this);var e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(Ai),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}},{key:"setProps",value:function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)}},{key:"updateState",value:function(t){this.updateStateInner(t,this._props)}},{key:"updateStateInner",value:function(t,e){var n,r=this.state,o=!1,i=!1;t.storedMarks&&this.composing&&(No(this),i=!0),this.state=t;var s=r.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){var a=Ei(this);(function(t,e){var n=0,r=0;for(var o in t){if(t[o]!=e[o])return!0;n++}for(var i in e)r++;return n!=r})(a,this.nodeViews)&&(this.nodeViews=a,o=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&yo(this),this.editable=xi(this),Ci(this);var u=si(this),c=wi(this),l=r.plugins==t.plugins||r.doc.eq(t.doc)?t.scrollToSelection>r.scrollToSelection?"to selection":"preserve":"reset",f=o||!this.docView.matchesNode(t.doc,c,u);!f&&t.selection.eq(r.selection)||(i=!0);var d,h,p,v,m,g,y,k,D,b,w,C="preserve"==l&&i&&null==this.dom.style.overflowAnchor&&function(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(a&&a!=t.dom&&t.dom.contains(a)){var u=a.getBoundingClientRect();if(u.top>=o-20){e=a,n=u.top;break}}}return{refDOM:e,refTop:n,stack:Wn(t.dom)}}(this);if(i){this.domObserver.stop();var x=f&&(An||Tn)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&(v=r.selection,m=t.selection,g=Math.min(v.$anchor.sharedDepth(v.head),m.$anchor.sharedDepth(m.head)),v.$anchor.start(g)!=m.$anchor.start(g));if(f){var E=Tn?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Bo(this)),!o&&this.docView.update(t.doc,c,u,this)||(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=hr(t.doc,c,u,this.dom,this)),E&&!this.trackWrites&&(x=!0)}x||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(d=this,h=d.docView.domFromPos(d.state.selection.anchor,0),p=d.domSelectionRange(),hn(h.node,h.offset,p.anchorNode,p.anchorOffset)))?Fr(this,x):(Pr(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!r.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,r),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():C&&(k=(y=C).refDOM,D=y.refTop,b=y.stack,w=k?k.getBoundingClientRect().top:0,_n(b,0==w?0:w-D))}},{key:"scrollToSelection",value:function(){var t=this,e=this.domSelectionRange().focusNode;if(e&&this.dom.contains(1==e.nodeType?e:e.parentNode))if(this.someProp("handleScrollToSelection",function(e){return e(t)}));else if(this.state.selection instanceof qe){var n=this.docView.domAfterPos(this.state.selection.from);1==n.nodeType&&Hn(this,n.getBoundingClientRect(),e)}else Hn(this,this.coordsAtPos(this.state.selection.head,1),e);else;}},{key:"destroyPluginViews",value:function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()}},{key:"updatePluginViews",value:function(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(var e=0;e<this.pluginViews.length;e++){var n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var r=0;r<this.directPlugins.length;r++){var o=this.directPlugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var i=0;i<this.state.plugins.length;i++){var s=this.state.plugins[i];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}}},{key:"updateDraggedNode",value:function(t,e){var n=t.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{var o=n.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==n.node&&(r=o)}this.dragging=new zo(t.slice,t.move,r<0?void 0:qe.create(this.state.doc,r))}},{key:"someProp",value:function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;for(var o=0;o<this.directPlugins.length;o++){var i=this.directPlugins[o].props[t];if(null!=i&&(n=e?e(i):i))return n}var s=this.state.plugins;if(s)for(var a=0;a<s.length;a++){var u=s[a].props[t];if(null!=u&&(n=e?e(u):u))return n}}},{key:"hasFocus",value:function(){if(An){var t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}},{key:"focus",value:function(){this.domObserver.stop(),this.editable&&function(t){if(t.setActive)return t.setActive();if(qn)return t.focus(qn);var e=Wn(t);t.focus(null==qn?{get preventScroll(){return qn={preventScroll:!0},!0}}:void 0),qn||(qn=!1,_n(e,0))}(this.dom),Fr(this),this.domObserver.start()}},{key:"root",get:function(){var t=this,e=this._root;if(null==e)for(var n,r=function(e){if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return e.ownerDocument.getSelection()}),{v:t._root=e}},o=this.dom.parentNode;o;o=o.parentNode)if(n=r(o))return n.v;return e||document}},{key:"updateRoot",value:function(){this._root=null}},{key:"posAtCoords",value:function(t){return Gn(this,t)}},{key:"coordsAtPos",value:function(t){return Zn(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}},{key:"domAtPos",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.docView.domFromPos(t,e)}},{key:"nodeDOM",value:function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null}},{key:"posAtDOM",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}},{key:"endOfTextblock",value:function(t,e){return ar(this,e||this.state,t)}},{key:"pasteHTML",value:function(t,e){return Po(this,"",t,!1,e||new ClipboardEvent("paste"))}},{key:"pasteText",value:function(t,e){return Po(this,t,null,!0,e||new ClipboardEvent("paste"))}},{key:"serializeForClipboard",value:function(t){return to(this,t)}},{key:"destroy",value:function(){this.docView&&(!function(t){for(var e in t.domObserver.stop(),t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],si(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,fn=null)}},{key:"isDestroyed",get:function(){return null==this.docView}},{key:"dispatchEvent",value:function(t){return function(t,e){ko(t,e)||!ho[e.type]||!t.editable&&e.type in po||ho[e.type](t,e)}(this,t)}},{key:"domSelectionRange",value:function(){var t=this.domSelection();return t?Nn&&11===this.root.nodeType&&function(t){for(var e=t.activeElement;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom&&function(t,e){if(e.getComposedRanges){var n=e.getComposedRanges(t.root)[0];if(n)return hi(t,n)}var r;function o(t){t.preventDefault(),t.stopImmediatePropagation(),r=t.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",o,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",o,!0),r?hi(t,r):null}(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}},{key:"domSelection",value:function(){return this.root.getSelection()}}])}();function wi(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:"style"==r?e.style=(e.style?e.style+";":"")+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Ko.node(0,t.state.doc.content.size,e)]}function Ci(t){if(t.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Ko.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function xi(t){return!t.someProp("editable",function(e){return!1===e(t.state)})}function Ei(t){var e=Object.create(null);function n(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Ai(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}bi.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};for(var Si={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Mi={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Oi="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Ti="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Fi=0;Fi<10;Fi++)Si[48+Fi]=Si[96+Fi]=String(Fi);for(Fi=1;Fi<=24;Fi++)Si[Fi+111]="F"+Fi;for(Fi=65;Fi<=90;Fi++)Si[Fi]=String.fromCharCode(Fi+32),Mi[Fi]=String.fromCharCode(Fi);for(var Ni in Si)Mi.hasOwnProperty(Ni)||(Mi[Ni]=Si[Ni]);var Bi="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Ri="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function Ii(t){var e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(var a=0;a<i.length-1;a++){var u=i[a];if(/^(cmd|meta|m)$/i.test(u))o=!0;else if(/^a(lt)?$/i.test(u))e=!0;else if(/^(c|ctrl|control)$/i.test(u))n=!0;else if(/^s(hift)?$/i.test(u))r=!0;else{if(!/^mod$/i.test(u))throw new Error("Unrecognized modifier name: "+u);Bi?o=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}function Pi(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Li(t){var e=function(t){var e=Object.create(null);for(var n in t)e[Ii(n)]=t[n];return e}(t);return function(t,n){var r,o=function(t){var e=!(Oi&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Ti&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?Mi:Si)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(n),i=e[Pi(o,n)];if(i&&i(t.state,t.dispatch,t))return!0;if(1==o.length&&" "!=o){if(n.shiftKey){var s=e[Pi(o,n,!1)];if(s&&s(t.state,t.dispatch,t))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Ri&&n.ctrlKey&&n.altKey)&&(r=Si[n.keyCode])&&r!=o){var a=e[Pi(r,n)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}var zi=function(t,e){return!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)};function ji(t,e){var n=t.selection.$cursor;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}var $i=function(t,e,n){var r=ji(t,n);if(!r)return!1;var o=_i(r);if(!o){var i=r.blockRange(),s=i&&he(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}var a=o.nodeBefore;if(ts(t,o,e,-1))return!0;if(0==r.parent.content.size&&(Hi(a,"end")||qe.isSelectable(a)))for(var u=r.depth;;u--){var c=Ce(t.doc,r.before(u),r.after(u),K.empty);if(c&&c.slice.size<c.to-c.from){if(e){var l=t.tr.step(c);l.setSelection(Hi(a,"end")?je.findFrom(l.doc.resolve(l.mapping.map(o.pos,-1)),-1):qe.create(l.doc,o.pos-a.nodeSize)),e(l.scrollIntoView())}return!0}if(1==u||r.node(u-1).childCount>1)break}return!(!a.isAtom||o.depth!=r.depth-1)&&(e&&e(t.tr.delete(o.pos-a.nodeSize,o.pos).scrollIntoView()),!0)};function Vi(t,e,n){for(var r=e.nodeBefore,o=e.pos-1;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;var i=r.lastChild;if(!i)return!1;r=i}for(var s=e.nodeAfter,a=e.pos+1;!s.isTextblock;a++){if(s.type.spec.isolating)return!1;var u=s.firstChild;if(!u)return!1;s=u}var c=Ce(t.doc,o,a,K.empty);if(!c||c.from!=o||c instanceof ue&&c.slice.size>=a-o)return!1;if(n){var l=t.tr.step(c);l.setSelection(We.create(l.doc,o)),n(l.scrollIntoView())}return!0}function Hi(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t;r;r="start"==e?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}var Wi=function(t,e,n){var r=t.selection,o=r.$head,i=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):o.parentOffset>0)return!1;i=_i(o)}var s=i&&i.nodeBefore;return!(!s||!qe.isSelectable(s))&&(e&&e(t.tr.setSelection(qe.create(t.doc,i.pos-s.nodeSize)).scrollIntoView()),!0)};function _i(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function qi(t,e){var n=t.selection.$cursor;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}var Ki=function(t,e,n){var r=qi(t,n);if(!r)return!1;var o=Ui(r);if(!o)return!1;var i=o.nodeAfter;if(ts(t,o,e,1))return!0;if(0==r.parent.content.size&&(Hi(i,"start")||qe.isSelectable(i))){var s=Ce(t.doc,r.before(),r.after(),K.empty);if(s&&s.slice.size<s.to-s.from){if(e){var a=t.tr.step(s);a.setSelection(Hi(i,"start")?je.findFrom(a.doc.resolve(a.mapping.map(o.pos)),1):qe.create(a.doc,a.mapping.map(o.pos))),e(a.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=r.depth-1)&&(e&&e(t.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),!0)},Ji=function(t,e,n){var r=t.selection,o=r.$head,i=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size)return!1;i=Ui(o)}var s=i&&i.nodeAfter;return!(!s||!qe.isSelectable(s))&&(e&&e(t.tr.setSelection(qe.create(t.doc,i.pos)).scrollIntoView()),!0)};function Ui(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}var Gi=function(t,e){var n=t.selection,r=n.$head,o=n.$anchor;return!(!r.parent.type.spec.code||!r.sameParent(o))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)};function Qi(t){for(var e=0;e<t.edgeCount;e++){var n=t.edge(e).type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}var Yi=function(t,e){var n=t.selection,r=n.$from,o=n.$to;if(n instanceof Je||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=Qi(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=t.tr.insert(s,i.createAndFill());a.setSelection(We.create(a.doc,s+1)),e(a.scrollIntoView())}return!0},Xi=function(t,e){var n=t.selection.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var r=n.before();if(ye(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}var o=n.blockRange(),i=o&&he(o);return null!=i&&(e&&e(t.tr.lift(o,i).scrollIntoView()),!0)};var Zi=function(t,e){var n=t.selection,r=n.$from;if(n.$to,t.selection instanceof qe&&t.selection.node.isBlock)return!(!r.parentOffset||!ye(t.doc,r.pos)||(e&&e(t.tr.split(r.pos).scrollIntoView()),0));if(!r.depth)return!1;for(var o,i,s=[],a=!1,u=!1,c=r.depth;;c--){if(r.node(c).isBlock){a=r.end(c)==r.pos+(r.depth-c),u=r.start(c)==r.pos-(r.depth-c),i=Qi(r.node(c-1).contentMatchAt(r.indexAfter(c-1))),s.unshift(a&&i?{type:i}:null),o=c;break}if(1==c)return!1;s.unshift(null)}var l=t.tr;(t.selection instanceof We||t.selection instanceof Je)&&l.deleteSelection();var f=l.mapping.map(r.pos),d=ye(l.doc,f,s.length,s);if(d||(s[0]=i?{type:i}:null,d=ye(l.doc,f,s.length,s)),!d)return!1;if(l.split(f,s.length,s),!a&&u&&r.node(o).type!=i){var h=l.mapping.map(r.before(o)),p=l.doc.resolve(h);i&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,i)&&l.setNodeMarkup(l.mapping.map(r.before(o)),i)}return e&&e(l.scrollIntoView()),!0};function ts(t,e,n,r){var o,i,s=e.nodeBefore,a=e.nodeAfter,u=s.type.spec.isolating||a.type.spec.isolating;if(!u&&function(t,e,n){var r=e.nodeBefore,o=e.nodeAfter,i=e.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(i,i+1)||!o.isTextblock&&!ke(t.doc,e.pos)||(n&&n(t.tr.join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;var c=!u&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(i=s.contentMatchAt(s.childCount)).findWrapping(a.type))&&i.matchType(o[0]||a.type).validEnd){if(n){for(var l=e.pos+a.nodeSize,f=$.empty,d=o.length-1;d>=0;d--)f=$.from(o[d].create(null,f));f=$.from(s.copy(f));var h=t.tr.step(new ce(e.pos-1,l,e.pos,l,new K(f,1,0),o.length,!0)),p=h.doc.resolve(l+2*o.length);p.nodeAfter&&p.nodeAfter.type==s.type&&ke(h.doc,p.pos)&&h.join(p.pos),n(h.scrollIntoView())}return!0}var v=a.type.spec.isolating||r>0&&u?null:je.findFrom(e,1),m=v&&v.$from.blockRange(v.$to),g=m&&he(m);if(null!=g&&g>=e.depth)return n&&n(t.tr.lift(m,g).scrollIntoView()),!0;if(c&&Hi(a,"start",!0)&&Hi(s,"end")){for(var y=s,k=[];k.push(y),!y.isTextblock;)y=y.lastChild;for(var D=a,b=1;!D.isTextblock;D=D.firstChild)b++;if(y.canReplace(y.childCount,y.childCount,D.content)){if(n){for(var w=$.empty,C=k.length-1;C>=0;C--)w=$.from(k[C].copy(w));n(t.tr.step(new ce(e.pos-k.length,e.pos+a.nodeSize,e.pos+b,e.pos+a.nodeSize-b,new K(w,k.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function es(t){return function(e,n){for(var r=e.selection,o=t<0?r.$from:r.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(n&&n(e.tr.setSelection(We.create(e.doc,t<0?o.start(i):o.end(i)))),!0)}}var ns=es(-1),rs=es(1);function is(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r){for(var o=!1,i=0;i<n.selection.ranges.length&&!o;i++){var s=n.selection.ranges[i],a=s.$from.pos,u=s.$to.pos;n.doc.nodesBetween(a,u,function(r,i){if(o)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)o=!0;else{var s=n.doc.resolve(i),a=s.index();o=s.parent.canReplaceWith(a,a+1,t)}})}if(!o)return!1;if(r){for(var c=n.tr,l=0;l<n.selection.ranges.length;l++){var f=n.selection.ranges[l],d=f.$from.pos,h=f.$to.pos;c.setBlockType(d,h,t,e)}r(c.scrollIntoView())}return!0}}function ss(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t,n,r){for(var o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}function as(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r){var o=n.selection,i=o.$from,s=o.$to,a=i.blockRange(s);if(!a)return!1;var u=r?n.tr:null;return!!function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!1,i=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&0==e.startIndex){if(0==e.$from.index(e.depth-1))return!1;var a=s.resolve(e.start-2);i=new ut(a,a,e.depth),e.endIndex<e.parent.childCount&&(e=new ut(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),o=!0}var u=pe(i,n,r,e);if(!u)return!1;t&&function(t,e,n,r,o){for(var i=$.empty,s=n.length-1;s>=0;s--)i=$.from(n[s].type.create(n[s].attrs,i));t.step(new ce(e.start-(r?2:0),e.end,e.start,e.end,new K(i,0,0),n.length,!0));for(var a=0,u=0;u<n.length;u++)n[u].type==o&&(a=u+1);for(var c=n.length-a,l=e.start+n.length-(r?2:0),f=e.parent,d=e.startIndex,h=e.endIndex,p=!0;d<h;d++,p=!1)!p&&ye(t.doc,l,c)&&(t.split(l,c),l+=2*c),l+=f.child(d).nodeSize}(t,e,u,o,n);return!0}(u,a,t,e)&&(r&&r(u.scrollIntoView()),!0)}}function us(t){return function(e,n){var r=e.selection,o=r.$from,i=r.$to,s=o.blockRange(i,function(e){return e.childCount>0&&e.firstChild.type==t});return!!s&&(!n||(o.node(s.depth-1).type==t?function(t,e,n,r){var o=t.tr,i=r.end,s=r.$to.end(r.depth);i<s&&(o.step(new ce(i-1,s,i,s,new K($.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new ut(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth));var a=he(r);if(null==a)return!1;o.lift(r,a);var u=o.doc.resolve(o.mapping.map(i,-1)-1);ke(o.doc,u.pos)&&u.nodeBefore.type==u.nodeAfter.type&&o.join(u.pos);return e(o.scrollIntoView()),!0}(e,n,t,s):function(t,e,n){for(var r=t.tr,o=n.parent,i=n.end,s=n.endIndex-1,a=n.startIndex;s>a;s--)i-=o.child(s).nodeSize,r.delete(i-1,i+1);var u=r.doc.resolve(n.start),c=u.nodeAfter;if(r.mapping.map(n.end)!=n.start+u.nodeAfter.nodeSize)return!1;var l=0==n.startIndex,f=n.endIndex==o.childCount,d=u.node(-1),h=u.index(-1);if(!d.canReplace(h+(l?0:1),h+1,c.content.append(f?$.empty:$.from(o))))return!1;var p=u.pos,v=p+c.nodeSize;return r.step(new ce(p-(l?1:0),v+(f?1:0),p+1,v-1,new K((l?$.empty:$.from(o.copy($.empty))).append(f?$.empty:$.from(o.copy($.empty))),l?0:1,f?0:1),l?0:1)),e(r.scrollIntoView()),!0}(e,n,s)))}}function cs(t){var e=t.state,n=t.transaction,r=n.selection,o=n.doc,s=n.storedMarks;return i(i({},e),{},{apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,s=n.storedMarks,n}})}ss(zi,$i,Wi),ss(zi,Ki,Ji),ss(Gi,Yi,Xi,Zi),"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();var ls=function(){return w(function t(e){D(this,t),this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state},[{key:"hasCustomState",get:function(){return!!this.customState}},{key:"state",get:function(){return this.customState||this.editor.state}},{key:"commands",get:function(){var t=this,e=this.rawCommands,n=this.editor,r=this.state,o=n.view,i=r.tr,s=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(function(e){var n=a(e,2),r=n[0],u=n[1];return[r,function(){var e=u.apply(void 0,arguments)(s);return i.getMeta("preventDispatch")||t.hasCustomState||o.dispatch(i),e}]}))}},{key:"chain",get:function(){var t=this;return function(){return t.createChain()}}},{key:"can",get:function(){var t=this;return function(){return t.createCan()}}},{key:"createChain",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.rawCommands,o=this.editor,s=this.state,u=o.view,c=[],l=!!t,f=t||s.tr,d=i(i({},Object.fromEntries(Object.entries(r).map(function(t){var r=a(t,2),o=r[0],i=r[1];return[o,function(){var t=e.buildProps(f,n),r=i.apply(void 0,arguments)(t);return c.push(r),d}]}))),{},{run:function(){return l||!n||f.getMeta("preventDispatch")||e.hasCustomState||u.dispatch(f),c.every(function(t){return!0===t})}});return d}},{key:"createCan",value:function(t){var e=this,n=this.rawCommands,r=this.state,o=!1,s=t||r.tr,u=this.buildProps(s,o),c=Object.fromEntries(Object.entries(n).map(function(t){var e=a(t,2),n=e[0],r=e[1];return[n,function(){return r.apply(void 0,arguments)(i(i({},u),{},{dispatch:void 0}))}]}));return i(i({},c),{},{chain:function(){return e.createChain(s,o)}})}},{key:"buildProps",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.rawCommands,o=this.editor,i=this.state,s=o.view,u={tr:t,editor:o,view:s,state:cs({state:i,transaction:t}),dispatch:n?function(){}:void 0,chain:function(){return e.createChain(t,n)},can:function(){return e.createCan(t)},get commands(){return Object.fromEntries(Object.entries(r).map(function(t){var e=a(t,2),n=e[0],r=e[1];return[n,function(){return r.apply(void 0,arguments)(u)}]}))}};return u}}])}(),fs=function(){return w(function t(){D(this,t),this.callbacks={}},[{key:"on",value:function(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}},{key:"emit",value:function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=this.callbacks[t];return i&&i.forEach(function(t){return t.apply(e,r)}),this}},{key:"off",value:function(t,e){var n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(function(t){return t!==e}):delete this.callbacks[t]),this}},{key:"once",value:function(t,e){var n=this,r=function(){n.off(t,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];e.apply(n,i)};return this.on(t,r)}},{key:"removeAllListeners",value:function(){this.callbacks={}}}])}();function ds(t,e,n){return void 0===t.config[e]&&t.parent?ds(t.parent,e,n):"function"==typeof t.config[e]?t.config[e].bind(i(i({},n),{},{parent:t.parent?ds(t.parent,e,n):null})):t.config[e]}function hs(t){return{baseExtensions:t.filter(function(t){return"extension"===t.type}),nodeExtensions:t.filter(function(t){return"node"===t.type}),markExtensions:t.filter(function(t){return"mark"===t.type})}}function ps(t){var e=[],n=hs(t),o=n.nodeExtensions,s=n.markExtensions,u=[].concat(r(o),r(s)),c={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(function(t){var n=ds(t,"addGlobalAttributes",{name:t.name,options:t.options,storage:t.storage,extensions:u});n&&n().forEach(function(t){t.types.forEach(function(n){Object.entries(t.attributes).forEach(function(t){var r=a(t,2),o=r[0],s=r[1];e.push({type:n,name:o,attribute:i(i({},c),s)})})})})}),u.forEach(function(t){var n={name:t.name,options:t.options,storage:t.storage},r=ds(t,"addAttributes",n);if(r){var o=r();Object.entries(o).forEach(function(n){var r=a(n,2),o=r[0],s=r[1],u=i(i({},c),s);"function"==typeof(null==u?void 0:u.default)&&(u.default=u.default()),(null==u?void 0:u.isRequired)&&void 0===(null==u?void 0:u.default)&&delete u.default,e.push({type:t.name,name:o,attribute:u})})}}),e}function vs(t,e){if("string"==typeof t){if(!e.nodes[t])throw Error("There is no node type named '".concat(t,"'. Maybe you forgot to add the extension?"));return e.nodes[t]}return t}function ms(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.filter(function(t){return!!t}).reduce(function(t,e){var n=i({},t);return Object.entries(e).forEach(function(t){var e=a(t,2),o=e[0],i=e[1];if(n[o])if("class"===o){var s=i?String(i).split(" "):[],u=n[o]?n[o].split(" "):[],c=s.filter(function(t){return!u.includes(t)});n[o]=[].concat(r(u),r(c)).join(" ")}else if("style"===o){var l=i?i.split(";").map(function(t){return t.trim()}).filter(Boolean):[],f=n[o]?n[o].split(";").map(function(t){return t.trim()}).filter(Boolean):[],d=new Map;f.forEach(function(t){var e=a(t.split(":").map(function(t){return t.trim()}),2),n=e[0],r=e[1];d.set(n,r)}),l.forEach(function(t){var e=a(t.split(":").map(function(t){return t.trim()}),2),n=e[0],r=e[1];d.set(n,r)}),n[o]=Array.from(d.entries()).map(function(t){var e=a(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)}).join("; ")}else n[o]=i;else n[o]=i}),n},{})}function gs(t,e){return e.filter(function(e){return e.type===t.type.name}).filter(function(t){return t.attribute.rendered}).map(function(e){return e.attribute.renderHTML?e.attribute.renderHTML(t.attrs)||{}:s({},e.name,t.attrs[e.name])}).reduce(function(t,e){return ms(t,e)},{})}function ys(t){return"function"==typeof t}function ks(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(ys(t)){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e?t.bind(e).apply(void 0,r):t.apply(void 0,r)}return t}function Ds(t,e){return"style"in t?t:i(i({},t),{},{getAttrs:function(n){var r=t.getAttrs?t.getAttrs(n):t.attrs;if(!1===r)return!1;var o=e.reduce(function(t,e){var r=e.attribute.parseHTML?e.attribute.parseHTML(n):function(t){return"string"!=typeof t?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):"true"===t||"false"!==t&&t}(n.getAttribute(e.name));return null==r?t:i(i({},t),{},s({},e.name,r))},{});return i(i({},r),o)}})}function bs(t){return Object.fromEntries(Object.entries(t).filter(function(t){var e=a(t,2),n=e[0],r=e[1];return("attrs"!==n||!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 0===Object.keys(t).length&&t.constructor===Object}(r))&&null!=r}))}function ws(t,e){return e.nodes[t]||e.marks[t]||null}function Cs(t,e){return Array.isArray(e)?e.some(function(e){return("string"==typeof e?e:e.name)===t.name}):e}function xs(t,e){var n=Ht.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function Es(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var As=w(function t(e){D(this,t),this.find=e.find,this.handler=e.handler});function Ss(t){var e,n=t.editor,r=t.from,o=t.to,i=t.text,s=t.rules,a=t.plugin,u=n.view;if(u.composing)return!1;var c=u.state.doc.resolve(r);if(c.parent.type.spec.code||(null===(e=c.nodeBefore||c.nodeAfter)||void 0===e?void 0:e.marks.find(function(t){return t.type.spec.code})))return!1;var l=!1,f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n="",r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,function(t,e,o,i){var s,a,u=(null===(a=(s=t.type.spec).toText)||void 0===a?void 0:a.call(s,{node:t,pos:e,parent:o,index:i}))||t.textContent||"%leaf%";n+=t.isAtom&&!t.isText?u:u.slice(0,Math.max(0,r-e))}),n}(c)+i;return s.forEach(function(t){if(!l){var e=function(t,e){if(Es(e))return e.exec(t);var n=e(t);if(!n)return null;var r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r}(f,t.find);if(e){var s=u.state.tr,c=cs({state:u.state,transaction:s}),d={from:r-(e[0].length-i.length),to:o},h=new ls({editor:n,state:c}),p=h.commands,v=h.chain,m=h.can;null!==t.handler({state:c,range:d,match:e,commands:p,chain:v,can:m})&&s.steps.length&&(s.setMeta(a,{transform:s,from:r,to:o,text:i}),u.dispatch(s),l=!0)}}}),l}function Ms(t){var e=t.editor,n=t.rules,r=new on({state:{init:function(){return null},apply:function(t,o,i){var s=t.getMeta(r);if(s)return s;var a=t.getMeta("applyInputRules");return!!a&&setTimeout(function(){var t=a.text;"string"==typeof t||(t=xs($.from(t),i.schema));var o=a.from,s=o+t.length;Ss({editor:e,from:o,to:s,text:t,rules:n,plugin:r})}),t.selectionSet||t.docChanged?null:o}},props:{handleTextInput:function(t,o,i,s){return Ss({editor:e,from:o,to:i,text:s,rules:n,plugin:r})},handleDOMEvents:{compositionend:function(t){return setTimeout(function(){var o=t.state.selection.$cursor;o&&Ss({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1}},handleKeyDown:function(t,o){if("Enter"!==o.key)return!1;var i=t.state.selection.$cursor;return!!i&&Ss({editor:e,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:r})}},isInputRules:!0});return r}function Os(t){return"Object"===function(t){return Object.prototype.toString.call(t).slice(8,-1)}(t)&&(t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype)}function Ts(t,e){var n=i({},t);return Os(t)&&Os(e)&&Object.keys(e).forEach(function(r){Os(e[r])&&Os(t[r])?n[r]=Ts(t[r],e[r]):n[r]=e[r]}),n}var Fs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=i(i({},this.config),e),this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(this.name,'".')),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ks(ds(this,"addOptions",{name:this.name}))),this.storage=ks(ds(this,"addStorage",{name:this.name,options:this.options}))||{}}return w(t,[{key:"configure",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.extend(i(i({},this.config),{},{addOptions:function(){return Ts(t.options,e)}}));return n.name=this.name,n.parent=this.parent,n}},{key:"extend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new t(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(n.name,'".')),n.options=ks(ds(n,"addOptions",{name:n.name})),n.storage=ks(ds(n,"addStorage",{name:n.name,options:n.options})),n}}],[{key:"create",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"handleExit",value:function(t){var e=t.editor,n=t.mark,r=e.state.tr,o=e.state.selection.$from;if(o.pos===o.end()){var i=o.marks();if(!!!i.find(function(t){return(null==t?void 0:t.type.name)===n.name}))return!1;var s=i.find(function(t){return(null==t?void 0:t.type.name)===n.name});return s&&r.removeStoredMark(s),r.insertText(" ",o.pos),e.view.dispatch(r),!0}return!1}}])}();var Ns=w(function t(e){D(this,t),this.find=e.find,this.handler=e.handler});function Bs(t){var e=t.editor,n=t.state,o=t.from,i=t.to,s=t.rule,a=t.pasteEvent,u=t.dropEvent,c=new ls({editor:e,state:n}),l=c.commands,f=c.chain,d=c.can,h=[];return n.doc.nodesBetween(o,i,function(t,e){if(t.isTextblock&&!t.type.spec.code){var c=Math.max(o,e),p=Math.min(i,e+t.content.size);(function(t,e,n){if(Es(e))return r(t.matchAll(e));var o=e(t,n);return o?o.map(function(e){var n=[e.text];return n.index=e.index,n.input=t,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(e.replaceWith)),n}):[]})(t.textBetween(c-e,p-e,void 0,""),s.find,a).forEach(function(t){if(void 0!==t.index){var e=c+t.index+1,r=e+t[0].length,o={from:n.tr.mapping.map(e),to:n.tr.mapping.map(r)},i=s.handler({state:n,range:o,match:t,commands:l,chain:f,can:d,pasteEvent:a,dropEvent:u});h.push(i)}})}}),h.every(function(t){return null!==t})}var Rs=null;function Is(t){var e,n=t.editor,r=t.rules,o=null,i=!1,s=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{e="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(c){e=null}var u=function(t){var r=t.state,o=t.from,i=t.to,s=t.rule,u=t.pasteEvt,c=r.tr,l=cs({state:r,transaction:c});if(Bs({editor:n,state:l,from:Math.max(o-1,0),to:i.b-1,rule:s,pasteEvent:u,dropEvent:e})&&c.steps.length){try{e="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(f){e=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,c}};return r.map(function(t){return new on({view:function(t){var e=function(e){var r;(o=(null===(r=t.dom.parentElement)||void 0===r?void 0:r.contains(e.target))?t.dom.parentElement:null)&&(Rs=n)},r=function(){Rs&&(Rs=null)};return window.addEventListener("dragstart",e),window.addEventListener("dragend",r),{destroy:function(){window.removeEventListener("dragstart",e),window.removeEventListener("dragend",r)}}},props:{handleDOMEvents:{drop:function(t,n){if(s=o===t.dom.parentElement,e=n,!s){var r=Rs;(null==r?void 0:r.isEditable)&&setTimeout(function(){var t=r.state.selection;t&&r.commands.deleteRange({from:t.from,to:t.to})},10)}return!1},paste:function(t,e){var n,r=null===(n=e.clipboardData)||void 0===n?void 0:n.getData("text/html");return a=e,i=!!(null==r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:function(e,n,r){var o=e[0],c="paste"===o.getMeta("uiEvent")&&!i,l="drop"===o.getMeta("uiEvent")&&!s,f=o.getMeta("applyPasteRules"),d=!!f;if(c||l||d){if(d){var h=f.text;"string"==typeof h||(h=xs($.from(h),r.schema));var p=f.from,v=p+h.length,m=function(t){var e,n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null===(e=n.clipboardData)||void 0===e||e.setData("text/html",t),n}(h);return u({rule:t,state:r,from:p,to:{b:v},pasteEvt:m})}var g=n.doc.content.findDiffStart(r.doc.content),y=n.doc.content.findDiffEnd(r.doc.content);if("number"==typeof g&&y&&g!==y.b)return u({rule:t,state:r,from:g,to:y,pasteEvt:a})}}})})}var Ps=function(){function t(e,n){D(this,t),this.splittableMarks=[],this.editor=n,this.extensions=t.resolve(e),this.schema=function(t,e){var n,r=ps(t),o=hs(t),s=o.nodeExtensions,a=o.markExtensions,u=null===(n=s.find(function(t){return ds(t,"topNode")}))||void 0===n?void 0:n.name,c=Object.fromEntries(s.map(function(n){var o=r.filter(function(t){return t.type===n.name}),s={name:n.name,options:n.options,storage:n.storage,editor:e},a=t.reduce(function(t,e){var r=ds(e,"extendNodeSchema",s);return i(i({},t),r?r(n):{})},{}),u=bs(i(i({},a),{},{content:ks(ds(n,"content",s)),marks:ks(ds(n,"marks",s)),group:ks(ds(n,"group",s)),inline:ks(ds(n,"inline",s)),atom:ks(ds(n,"atom",s)),selectable:ks(ds(n,"selectable",s)),draggable:ks(ds(n,"draggable",s)),code:ks(ds(n,"code",s)),whitespace:ks(ds(n,"whitespace",s)),linebreakReplacement:ks(ds(n,"linebreakReplacement",s)),defining:ks(ds(n,"defining",s)),isolating:ks(ds(n,"isolating",s)),attrs:Object.fromEntries(o.map(function(t){var e;return[t.name,{default:null===(e=null==t?void 0:t.attribute)||void 0===e?void 0:e.default}]}))})),c=ks(ds(n,"parseHTML",s));c&&(u.parseDOM=c.map(function(t){return Ds(t,o)}));var l=ds(n,"renderHTML",s);l&&(u.toDOM=function(t){return l({node:t,HTMLAttributes:gs(t,o)})});var f=ds(n,"renderText",s);return f&&(u.toText=f),[n.name,u]})),l=Object.fromEntries(a.map(function(n){var o=r.filter(function(t){return t.type===n.name}),s={name:n.name,options:n.options,storage:n.storage,editor:e},a=t.reduce(function(t,e){var r=ds(e,"extendMarkSchema",s);return i(i({},t),r?r(n):{})},{}),u=bs(i(i({},a),{},{inclusive:ks(ds(n,"inclusive",s)),excludes:ks(ds(n,"excludes",s)),group:ks(ds(n,"group",s)),spanning:ks(ds(n,"spanning",s)),code:ks(ds(n,"code",s)),attrs:Object.fromEntries(o.map(function(t){var e;return[t.name,{default:null===(e=null==t?void 0:t.attribute)||void 0===e?void 0:e.default}]}))})),c=ks(ds(n,"parseHTML",s));c&&(u.parseDOM=c.map(function(t){return Ds(t,o)}));var l=ds(n,"renderHTML",s);return l&&(u.toDOM=function(t){return l({mark:t,HTMLAttributes:gs(t,o)})}),[n.name,u]}));return new Tt({topNode:u,nodes:c,marks:l})}(this.extensions,n),this.setupExtensions()}return w(t,[{key:"commands",get:function(){var t=this;return this.extensions.reduce(function(e,n){var r=ds(n,"addCommands",{name:n.name,options:n.options,storage:n.storage,editor:t.editor,type:ws(n.name,t.schema)});return r?i(i({},e),r()):e},{})}},{key:"plugins",get:function(){var e=this,n=this.editor,o=t.sort(r(this.extensions).reverse()),s=[],u=[],c=o.map(function(t){var o={name:t.name,options:t.options,storage:t.storage,editor:n,type:ws(t.name,e.schema)},c=[],l=ds(t,"addKeyboardShortcuts",o),f={};if("mark"===t.type&&ds(t,"exitable",o)&&(f.ArrowRight=function(){return Fs.handleExit({editor:n,mark:t})}),l){var d=Object.fromEntries(Object.entries(l()).map(function(t){var e=a(t,2),r=e[0],o=e[1];return[r,function(){return o({editor:n})}]}));f=i(i({},f),d)}var h=function(t){return new on({props:{handleKeyDown:Li(t)}})}(f);c.push(h);var p=ds(t,"addInputRules",o);Cs(t,n.options.enableInputRules)&&p&&s.push.apply(s,r(p()));var v=ds(t,"addPasteRules",o);Cs(t,n.options.enablePasteRules)&&v&&u.push.apply(u,r(v()));var m=ds(t,"addProseMirrorPlugins",o);if(m){var g=m();c.push.apply(c,r(g))}return c}).flat();return[Ms({editor:n,rules:s})].concat(r(Is({editor:n,rules:u})),r(c))}},{key:"attributes",get:function(){return ps(this.extensions)}},{key:"nodeViews",get:function(){var t=this,e=this.editor,n=hs(this.extensions).nodeExtensions;return Object.fromEntries(n.filter(function(t){return!!ds(t,"addNodeView")}).map(function(n){var r=t.attributes.filter(function(t){return t.type===n.name}),o={name:n.name,options:n.options,storage:n.storage,editor:e,type:vs(n.name,t.schema)},i=ds(n,"addNodeView",o);if(!i)return[];return[n.name,function(t,o,s,a,u){var c=gs(t,r);return i()({node:t,view:o,getPos:s,decorations:a,innerDecorations:u,editor:e,extension:n,HTMLAttributes:c})}]}))}},{key:"setupExtensions",value:function(){var t=this;this.extensions.forEach(function(e){var n;t.editor.extensionStorage[e.name]=e.storage;var r={name:e.name,options:e.options,storage:e.storage,editor:t.editor,type:ws(e.name,t.schema)};"mark"===e.type&&((null===(n=ks(ds(e,"keepOnSplit",r)))||void 0===n||n)&&t.splittableMarks.push(e.name));var o=ds(e,"onBeforeCreate",r),i=ds(e,"onCreate",r),s=ds(e,"onUpdate",r),a=ds(e,"onSelectionUpdate",r),u=ds(e,"onTransaction",r),c=ds(e,"onFocus",r),l=ds(e,"onBlur",r),f=ds(e,"onDestroy",r);o&&t.editor.on("beforeCreate",o),i&&t.editor.on("create",i),s&&t.editor.on("update",s),a&&t.editor.on("selectionUpdate",a),u&&t.editor.on("transaction",u),c&&t.editor.on("focus",c),l&&t.editor.on("blur",l),f&&t.editor.on("destroy",f)})}}],[{key:"resolve",value:function(e){var n,r,o=t.sort(t.flatten(e)),i=(n=o.map(function(t){return t.name}),r=n.filter(function(t,e){return n.indexOf(t)!==e}),Array.from(new Set(r)));return i.length&&console.warn("[tiptap warn]: Duplicate extension names found: [".concat(i.map(function(t){return"'".concat(t,"'")}).join(", "),"]. This can lead to issues.")),o}},{key:"flatten",value:function(t){var e=this;return t.map(function(t){var n=ds(t,"addExtensions",{name:t.name,options:t.options,storage:t.storage});return n?[t].concat(r(e.flatten(n()))):t}).flat(10)}},{key:"sort",value:function(t){return t.sort(function(t,e){var n=ds(t,"priority")||100,r=ds(e,"priority")||100;return n>r?-1:n<r?1:0})}}])}(),Ls=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=i(i({},this.config),e),this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(this.name,'".')),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ks(ds(this,"addOptions",{name:this.name}))),this.storage=ks(ds(this,"addStorage",{name:this.name,options:this.options}))||{}}return w(t,[{key:"configure",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.extend(i(i({},this.config),{},{addOptions:function(){return Ts(t.options,e)}}));return n.name=this.name,n.parent=this.parent,n}},{key:"extend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new t(i(i({},this.config),e));return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(n.name,'".')),n.options=ks(ds(n,"addOptions",{name:n.name})),n.storage=ks(ds(n,"addStorage",{name:n.name,options:n.options})),n}}],[{key:"create",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}])}();function zs(t,e,n){var r=e.from,o=e.to,i=n||{},s=i.blockSeparator,a=void 0===s?"\n\n":s,u=i.textSerializers,c=void 0===u?{}:u,l="";return t.nodesBetween(r,o,function(t,n,i,s){var u;t.isBlock&&n>r&&(l+=a);var f=null==c?void 0:c[t.type.name];if(f)return i&&(l+=f({node:t,pos:n,parent:i,index:s,range:e})),!1;t.isText&&(l+=null===(u=null==t?void 0:t.text)||void 0===u?void 0:u.slice(Math.max(r,n)-n,o-n))}),l}function js(t){return Object.fromEntries(Object.entries(t.nodes).filter(function(t){return a(t,2)[1].spec.toText}).map(function(t){var e=a(t,2);return[e[0],e[1].spec.toText]}))}var $s=Ls.create({name:"clipboardTextSerializer",addOptions:function(){return{blockSeparator:void 0}},addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("clipboardTextSerializer"),props:{clipboardTextSerializer:function(){var e=t.editor,n=e.state,o=e.schema,s=n.doc,a=n.selection.ranges,u=Math.min.apply(Math,r(a.map(function(t){return t.$from.pos}))),c=Math.max.apply(Math,r(a.map(function(t){return t.$to.pos}))),l=js(o);return zs(s,{from:u,to:c},i(i({},void 0!==t.options.blockSeparator?{blockSeparator:t.options.blockSeparator}:{}),{},{textSerializers:l}))}}})]}});function Vs(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{strict:!0},r=Object.keys(e);return!r.length||r.every(function(r){return n.strict?e[r]===t[r]:Es(e[r])?e[r].test(t[r]):e[r]===t[r]})}function Hs(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.find(function(t){return t.type===e&&Vs(Object.fromEntries(Object.keys(n).map(function(e){return[e,t.attrs[e]]})),n)})}function Ws(t,e){return!!Hs(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}function _s(t,e,n){var o;if(t&&e){var i=t.parent.childAfter(t.parentOffset);if(i.node&&i.node.marks.some(function(t){return t.type===e})||(i=t.parent.childBefore(t.parentOffset)),i.node&&i.node.marks.some(function(t){return t.type===e}))if(n=n||(null===(o=i.node.marks[0])||void 0===o?void 0:o.attrs),Hs(r(i.node.marks),e,n)){for(var s=i.index,a=t.start()+i.offset,u=s+1,c=a+i.node.nodeSize;s>0&&Ws(r(t.parent.child(s-1).marks),e,n);)s-=1,a-=t.parent.child(s).nodeSize;for(;u<t.parent.childCount&&Ws(r(t.parent.child(u).marks),e,n);)c+=t.parent.child(u).nodeSize,u+=1;return{from:a,to:c}}}}function qs(t,e){if("string"==typeof t){if(!e.marks[t])throw Error("There is no mark type named '".concat(t,"'. Maybe you forgot to add the extension?"));return e.marks[t]}return t}function Ks(t){return t instanceof We}function Js(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.min(Math.max(t,e),n)}function Us(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return null;var n=je.atStart(t),r=je.atEnd(t);if("start"===e||!0===e)return n;if("end"===e)return r;var o=n.from,i=r.to;return"all"===e?We.create(t,Js(0,o,i),Js(t.content.size,o,i)):We.create(t,Js(e,o,i),Js(e,o,i))}function Gs(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Qs=function(t){for(var e=t.childNodes,n=e.length-1;n>=0;n-=1){var r=e[n];3===r.nodeType&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):1===r.nodeType&&Qs(r)}return t};function Ys(t){var e="<body>".concat(t,"</body>"),n=(new window.DOMParser).parseFromString(e,"text/html").body;return Qs(n)}function Xs(t,e,n){if(t instanceof lt||t instanceof $)return t;n=i({slice:!0,parseOptions:{}},n);var r="string"==typeof t;if("object"===k(t)&&null!==t)try{if(Array.isArray(t)&&t.length>0)return $.fromArray(t.map(function(t){return e.nodeFromJSON(t)}));var o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(l){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:l});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",l),Xs("",e,n)}if(r){if(n.errorOnInvalidContent){var s=!1,a="",u=new Tt({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:function(t){return s=!0,a="string"==typeof t?t:t.outerHTML,null}}]}})});if(n.slice?Nt.fromSchema(u).parseSlice(Ys(t),n.parseOptions):Nt.fromSchema(u).parse(Ys(t),n.parseOptions),n.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error("Invalid element found: ".concat(a))})}var c=Nt.fromSchema(e);return n.slice?c.parseSlice(Ys(t),n.parseOptions).content:c.parse(Ys(t),n.parseOptions)}return Xs("",e,n)}function Zs(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function ta(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.selection,o=r.from,i=r.to,s=r.empty,a=e?vs(e,t.schema):null,u=[];t.doc.nodesBetween(o,i,function(t,e){if(!t.isText){var n=Math.max(o,e),r=Math.min(i,e+t.nodeSize);u.push({node:t,from:n,to:r})}});var c=i-o,l=u.filter(function(t){return!a||a.name===t.node.type.name}).filter(function(t){return Vs(t.node.attrs,n,{strict:!1})});return s?!!l.length:l.reduce(function(t,e){return t+e.to-e.from},0)>=c}function ea(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function na(t,e){var n="string"==typeof e?[e]:e;return Object.keys(t).reduce(function(e,r){return n.includes(r)||(e[r]=t[r]),e},{})}function ra(t,e){return Xs(t,e,{slice:!1,parseOptions:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},errorOnInvalidContent:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).errorOnInvalidContent})}function oa(t,e){var n=qs(e,t.schema),o=t.selection,s=o.from,a=o.to,u=o.empty,c=[];u?(t.storedMarks&&c.push.apply(c,r(t.storedMarks)),c.push.apply(c,r(t.selection.$head.marks()))):t.doc.nodesBetween(s,a,function(t){c.push.apply(c,r(t.marks))});var l=c.find(function(t){return t.type.name===n.name});return l?i({},l.attrs):{}}function ia(t){return function(e){return function(t,e){for(var n=t.depth;n>0;n-=1){var r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}(e.$from,t)}}function sa(t,e){var n=ea("string"==typeof e?e:e.name,t.schema);return"node"===n?function(t,e){var n=vs(e,t.schema),r=t.selection,o=r.from,s=r.to,a=[];t.doc.nodesBetween(o,s,function(t){a.push(t)});var u=a.reverse().find(function(t){return t.type.name===n.name});return u?i({},u.attrs):{}}(t,e):"mark"===n?oa(t,e):{}}function aa(t){var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n={};return t.filter(function(t){var r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)})}(t);return 1===e.length?e:e.filter(function(t,n){var r=e.filter(function(t,e){return e!==n});return!r.some(function(e){return t.oldRange.from>=e.oldRange.from&&t.oldRange.to<=e.oldRange.to&&t.newRange.from>=e.newRange.from&&t.newRange.to<=e.newRange.to})})}function ua(t,e,n){var o=[];return t===e?n.resolve(t).marks().forEach(function(e){var r=_s(n.resolve(t),e.type);r&&o.push(i({mark:e},r))}):n.nodesBetween(t,e,function(t,e){t&&void 0!==(null==t?void 0:t.nodeSize)&&o.push.apply(o,r(t.marks.map(function(n){return{from:e,to:e+t.nodeSize,mark:n}})))}),o}function ca(t,e,n){return Object.fromEntries(Object.entries(n).filter(function(n){var r=a(n,1)[0],o=t.find(function(t){return t.type===e&&t.name===r});return!!o&&o.attribute.keepOnSplit}))}function la(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.selection,i=o.empty,s=o.ranges,a=e?qs(e,t.schema):null;if(i)return!!(t.storedMarks||t.selection.$from.marks()).filter(function(t){return!a||a.name===t.type.name}).find(function(t){return Vs(t.attrs,n,{strict:!1})});var u=0,c=[];if(s.forEach(function(e){var n=e.$from,o=e.$to,i=n.pos,s=o.pos;t.doc.nodesBetween(i,s,function(t,e){if(t.isText||t.marks.length){var n=Math.max(i,e),o=Math.min(s,e+t.nodeSize);u+=o-n,c.push.apply(c,r(t.marks.map(function(t){return{mark:t,from:n,to:o}})))}})}),0===u)return!1;var l=c.filter(function(t){return!a||a.name===t.mark.type.name}).filter(function(t){return Vs(t.mark.attrs,n,{strict:!1})}).reduce(function(t,e){return t+e.to-e.from},0),f=c.filter(function(t){return!a||t.mark.type!==a&&t.mark.type.excludes(a)}).reduce(function(t,e){return t+e.to-e.from},0);return(l>0?l+f:l)>=u}function fa(t,e){var n=hs(e).nodeExtensions.find(function(e){return e.name===t});if(!n)return!1;var r=ks(ds(n,"group",{name:n.name,options:n.options,storage:n.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function da(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.checkChildren,o=void 0===r||r,i=n.ignoreWhitespace,s=void 0!==i&&i;if(s){if("hardBreak"===t.type.name)return!0;if(t.isText)return/^\s*$/m.test(null!==(e=t.text)&&void 0!==e?e:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(0===t.content.childCount)return!0;if(o){var a=!0;return t.content.forEach(function(t){!1!==a&&(da(t,{ignoreWhitespace:s,checkChildren:o})||(a=!1))}),a}return!1}function ha(t,e){var n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){var r=n.filter(function(t){return null==e?void 0:e.includes(t.type.name)});t.tr.ensureMarks(r)}}var pa=function(t,e){var n=ia(function(t){return t.type===e})(t.selection);if(!n)return!0;var r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;var o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!ke(t.doc,n.pos)||(t.join(n.pos),!0)},va=function(t,e){var n=ia(function(t){return t.type===e})(t.selection);if(!n)return!0;var r=t.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;var o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!ke(t.doc,r)||(t.join(r),!0)},ma=Object.freeze({__proto__:null,blur:function(){return function(t){var e=t.editor,n=t.view;return requestAnimationFrame(function(){var t;e.isDestroyed||(n.dom.blur(),null===(t=null===window||void 0===window?void 0:window.getSelection())||void 0===t||t.removeAllRanges())}),!0}},clearContent:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e){return e.commands.setContent("",t)}},clearNodes:function(){return function(t){var e=t.state,n=t.tr,r=t.dispatch,o=n.selection.ranges;return!r||(o.forEach(function(t){var r=t.$from,o=t.$to;e.doc.nodesBetween(r.pos,o.pos,function(t,e){if(!t.type.isText){var r=n.doc,o=n.mapping,i=r.resolve(o.map(e)),s=r.resolve(o.map(e+t.nodeSize)),a=i.blockRange(s);if(a){var u=he(a);if(t.type.isTextblock){var c=i.parent.contentMatchAt(i.index()).defaultType;n.setNodeMarkup(a.start,c)}(u||0===u)&&n.lift(a,u)}}})}),!0)}},command:function(t){return function(e){return t(e)}},createParagraphNear:function(){return function(t){var e=t.state,n=t.dispatch;return Yi(e,n)}},cut:function(t,e){return function(n){var r=n.editor,o=n.tr,i=r.state.doc.slice(t.from,t.to);o.deleteRange(t.from,t.to);var s=o.mapping.map(e);return o.insert(s,i.content),o.setSelection(new We(o.doc.resolve(s-1))),!0}},deleteCurrentNode:function(){return function(t){var e=t.tr,n=t.dispatch,r=e.selection.$anchor.node();if(r.content.size>0)return!1;for(var o=e.selection.$anchor,i=o.depth;i>0;i-=1){if(o.node(i).type===r.type){if(n){var s=o.before(i),a=o.after(i);e.delete(s,a).scrollIntoView()}return!0}}return!1}},deleteNode:function(t){return function(e){for(var n=e.tr,r=e.state,o=e.dispatch,i=vs(t,r.schema),s=n.selection.$anchor,a=s.depth;a>0;a-=1){if(s.node(a).type===i){if(o){var u=s.before(a),c=s.after(a);n.delete(u,c).scrollIntoView()}return!0}}return!1}},deleteRange:function(t){return function(e){var n=e.tr,r=e.dispatch,o=t.from,i=t.to;return r&&n.delete(o,i),!0}},deleteSelection:function(){return function(t){var e=t.state,n=t.dispatch;return zi(e,n)}},enter:function(){return function(t){return t.commands.keyboardShortcut("Enter")}},exitCode:function(){return function(t){return function(t,e){var n=t.selection,r=n.$head,o=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(o))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=Qi(i.contentMatchAt(s));if(!a||!i.canReplaceWith(s,s,a))return!1;if(e){var u=r.after(),c=t.tr.replaceWith(u,u,a.createAndFill());c.setSelection(je.near(c.doc.resolve(u),1)),e(c.scrollIntoView())}return!0}(t.state,t.dispatch)}},extendMarkRange:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.tr,o=n.state,i=n.dispatch,s=qs(t,o.schema),a=r.doc,u=r.selection,c=u.$from,l=u.from,f=u.to;if(i){var d=_s(c,s,e);if(d&&d.from<=l&&d.to>=f){var h=We.create(a,d.from,d.to);r.setSelection(h)}}return!0}},first:function(t){return function(e){for(var n="function"==typeof t?t(e):t,r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1}},focus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.editor,o=n.view,s=n.tr,a=n.dispatch;e=i({scrollIntoView:!0},e);var u=function(){(Gs()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&o.dom.focus(),requestAnimationFrame(function(){r.isDestroyed||(o.focus(),(null==e?void 0:e.scrollIntoView)&&r.commands.scrollIntoView())})};if(o.hasFocus()&&null===t||!1===t)return!0;if(a&&null===t&&!Ks(r.state.selection))return u(),!0;var c=Us(s.doc,t)||r.state.selection,l=r.state.selection.eq(c);return a&&(l||s.setSelection(c),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),u()),!0}},forEach:function(t,e){return function(n){return t.every(function(t,r){return e(t,i(i({},n),{},{index:r}))})}},insertContent:function(t,e){return function(n){var r=n.tr;return n.commands.insertContentAt({from:r.selection.from,to:r.selection.to},t,e)}},insertContentAt:function(t,e,n){return function(r){var o,s=r.tr,a=r.dispatch,u=r.editor;if(a){var c;n=i({parseOptions:u.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1},n);var l=function(t){u.emit("contentError",{editor:u,error:t,disableCollaboration:function(){u.storage.collaboration&&(u.storage.collaboration.isDisabled=!0)}})},f=i({preserveWhitespace:"full"},n.parseOptions);if(!n.errorOnInvalidContent&&!u.options.enableContentCheck&&u.options.emitContentError)try{Xs(e,u.schema,{parseOptions:f,errorOnInvalidContent:!0})}catch(b){l(b)}try{c=Xs(e,u.schema,{parseOptions:f,errorOnInvalidContent:null!==(o=n.errorOnInvalidContent)&&void 0!==o?o:u.options.enableContentCheck})}catch(b){return l(b),!1}var d,h="number"==typeof t?{from:t,to:t}:{from:t.from,to:t.to},p=h.from,v=h.to,m=!0,g=!0;if(("type"in c?[c]:c).forEach(function(t){t.check(),m=!!m&&(t.isText&&0===t.marks.length),g=!!g&&t.isBlock}),p===v&&g){var y=s.doc.resolve(p).parent;y.isTextblock&&!y.type.spec.code&&!y.childCount&&(p-=1,v+=1)}if(m){if(Array.isArray(e))d=e.map(function(t){return t.text||""}).join("");else if(e instanceof $){var D="";e.forEach(function(t){t.text&&(D+=t.text)}),d=D}else d="object"===k(e)&&e&&e.text?e.text:e;s.insertText(d,p,v)}else d=c,s.replaceWith(p,v,d);n.updateSelection&&function(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof ue||o instanceof ce){var i=t.mapping.maps[r],s=0;i.forEach(function(t,e,n,r){0===s&&(s=r)}),t.setSelection(je.near(t.doc.resolve(s),n))}}}(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:p,text:d}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:p,text:d})}return!0}},joinBackward:function(){return function(t){var e=t.state,n=t.dispatch;return $i(e,n)}},joinDown:function(){return function(t){return function(t,e){var n,r=t.selection;if(r instanceof qe){if(r.node.isTextblock||!ke(t.doc,r.to))return!1;n=r.to}else if(null==(n=be(t.doc,r.to,1)))return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0}(t.state,t.dispatch)}},joinForward:function(){return function(t){var e=t.state,n=t.dispatch;return Ki(e,n)}},joinItemBackward:function(){return function(t){var e=t.state,n=t.dispatch,r=t.tr;try{var o=be(e.doc,e.selection.$from.pos,-1);return null!=o&&(r.join(o,2),n&&n(r),!0)}catch(i){return!1}}},joinItemForward:function(){return function(t){var e=t.state,n=t.dispatch,r=t.tr;try{var o=be(e.doc,e.selection.$from.pos,1);return null!=o&&(r.join(o,2),n&&n(r),!0)}catch(i){return!1}}},joinTextblockBackward:function(){return function(t){return function(t,e,n){var r=ji(t,n);if(!r)return!1;var o=_i(r);return!!o&&Vi(t,o,e)}(t.state,t.dispatch)}},joinTextblockForward:function(){return function(t){return function(t,e,n){var r=qi(t,n);if(!r)return!1;var o=Ui(r);return!!o&&Vi(t,o,e)}(t.state,t.dispatch)}},joinUp:function(){return function(t){return function(t,e){var n,r=t.selection,o=r instanceof qe;if(o){if(r.node.isTextblock||!ke(t.doc,r.from))return!1;n=r.from}else if(null==(n=be(t.doc,r.from,-1)))return!1;if(e){var i=t.tr.join(n);o&&i.setSelection(qe.create(i.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0}(t.state,t.dispatch)}},keyboardShortcut:function(t){return function(e){var n=e.editor,r=e.view,o=e.tr,i=e.dispatch,s=function(t){var e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"===s&&(s=" ");for(var a=0;a<i.length-1;a+=1){var u=i[a];if(/^(cmd|meta|m)$/i.test(u))o=!0;else if(/^a(lt)?$/i.test(u))e=!0;else if(/^(c|ctrl|control)$/i.test(u))n=!0;else if(/^s(hift)?$/i.test(u))r=!0;else{if(!/^mod$/i.test(u))throw new Error("Unrecognized modifier name: ".concat(u));Gs()||Zs()?o=!0:n=!0}}return e&&(s="Alt-".concat(s)),n&&(s="Ctrl-".concat(s)),o&&(s="Meta-".concat(s)),r&&(s="Shift-".concat(s)),s}(t).split(/-(?!$)/),a=s.find(function(t){return!["Alt","Ctrl","Meta","Shift"].includes(t)}),u=new KeyboardEvent("keydown",{key:"Space"===a?" ":a,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),c=n.captureTransaction(function(){r.someProp("handleKeyDown",function(t){return t(r,u)})});return null==c||c.steps.forEach(function(t){var e=t.map(o.mapping);e&&i&&o.maybeStep(e)}),!0}},lift:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.state,o=n.dispatch;return!!ta(r,vs(t,r.schema),e)&&function(t,e){var n=t.selection,r=n.$from,o=n.$to,i=r.blockRange(o),s=i&&he(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}(r,o)}},liftEmptyBlock:function(){return function(t){var e=t.state,n=t.dispatch;return Xi(e,n)}},liftListItem:function(t){return function(e){var n=e.state,r=e.dispatch;return us(vs(t,n.schema))(n,r)}},newlineInCode:function(){return function(t){var e=t.state,n=t.dispatch;return Gi(e,n)}},resetAttributes:function(t,e){return function(n){var r=n.tr,o=n.state,i=n.dispatch,s=null,a=null,u=ea("string"==typeof t?t:t.name,o.schema);return!!u&&("node"===u&&(s=vs(t,o.schema)),"mark"===u&&(a=qs(t,o.schema)),i&&r.selection.ranges.forEach(function(t){o.doc.nodesBetween(t.$from.pos,t.$to.pos,function(t,n){s&&s===t.type&&r.setNodeMarkup(n,void 0,na(t.attrs,e)),a&&t.marks.length&&t.marks.forEach(function(o){a===o.type&&r.addMark(n,n+t.nodeSize,a.create(na(o.attrs,e)))})})}),!0)}},scrollIntoView:function(){return function(t){var e=t.tr;return t.dispatch&&e.scrollIntoView(),!0}},selectAll:function(){return function(t){var e=t.tr;if(t.dispatch){var n=new Je(e.doc);e.setSelection(n)}return!0}},selectNodeBackward:function(){return function(t){var e=t.state,n=t.dispatch;return Wi(e,n)}},selectNodeForward:function(){return function(t){var e=t.state,n=t.dispatch;return Ji(e,n)}},selectParentNode:function(){return function(t){return function(t,e){var n,r=t.selection,o=r.$from,i=r.to,s=o.sharedDepth(i);return 0!=s&&(n=o.before(s),e&&e(t.tr.setSelection(qe.create(t.doc,n))),!0)}(t.state,t.dispatch)}},selectTextblockEnd:function(){return function(t){var e=t.state,n=t.dispatch;return rs(e,n)}},selectTextblockStart:function(){return function(t){var e=t.state,n=t.dispatch;return ns(e,n)}},setContent:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(o){var i,s,a=o.editor,u=o.tr,c=o.dispatch,l=o.commands,f=u.doc;if("full"!==n.preserveWhitespace){var d=ra(t,a.schema,n,{errorOnInvalidContent:null!==(i=r.errorOnInvalidContent)&&void 0!==i?i:a.options.enableContentCheck});return c&&u.replaceWith(0,f.content.size,d).setMeta("preventUpdate",!e),!0}return c&&u.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:f.content.size},t,{parseOptions:n,errorOnInvalidContent:null!==(s=r.errorOnInvalidContent)&&void 0!==s?s:a.options.enableContentCheck})}},setMark:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.tr,o=n.state,s=n.dispatch,a=r.selection,u=a.empty,c=a.ranges,l=qs(t,o.schema);if(s)if(u){var f=oa(o,l);r.addStoredMark(l.create(i(i({},f),e)))}else c.forEach(function(t){var n=t.$from.pos,s=t.$to.pos;o.doc.nodesBetween(n,s,function(t,o){var a=Math.max(o,n),u=Math.min(o+t.nodeSize,s);t.marks.find(function(t){return t.type===l})?t.marks.forEach(function(t){l===t.type&&r.addMark(a,u,l.create(i(i({},t.attrs),e)))}):r.addMark(a,u,l.create(e))})});return function(t,e,n){var r,o=e.selection,i=null;if(Ks(o)&&(i=o.$cursor),i){var s=null!==(r=t.storedMarks)&&void 0!==r?r:i.marks();return!!n.isInSet(s)||!s.some(function(t){return t.type.excludes(n)})}return o.ranges.some(function(e){var r=e.$from,o=e.$to,i=0===r.depth&&t.doc.inlineContent&&t.doc.type.allowsMarkType(n);return t.doc.nodesBetween(r.pos,o.pos,function(t,e,r){if(i)return!1;if(t.isInline){var o=!r||r.type.allowsMarkType(n),s=!!n.isInSet(t.marks)||!t.marks.some(function(t){return t.type.excludes(n)});i=o&&s}return!i}),i})}(o,r,l)}},setMeta:function(t,e){return function(n){return n.tr.setMeta(t,e),!0}},setNode:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r,o=n.state,s=n.dispatch,a=n.chain,u=vs(t,o.schema);return o.selection.$anchor.sameParent(o.selection.$head)&&(r=o.selection.$anchor.parent.attrs),u.isTextblock?a().command(function(t){var n=t.commands;return!!is(u,i(i({},r),e))(o)||n.clearNodes()}).command(function(t){var n=t.state;return is(u,i(i({},r),e))(n,s)}).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)}},setNodeSelection:function(t){return function(e){var n=e.tr;if(e.dispatch){var r=n.doc,o=Js(t,0,r.content.size),i=qe.create(r,o);n.setSelection(i)}return!0}},setTextSelection:function(t){return function(e){var n=e.tr;if(e.dispatch){var r=n.doc,o="number"==typeof t?{from:t,to:t}:t,i=o.from,s=o.to,a=We.atStart(r).from,u=We.atEnd(r).to,c=Js(i,a,u),l=Js(s,a,u),f=We.create(r,c,l);n.setSelection(f)}return!0}},sinkListItem:function(t){return function(e){var n,r=e.state,o=e.dispatch,i=vs(t,r.schema);return(n=i,function(t,e){var r=t.selection,o=r.$from,i=r.$to,s=o.blockRange(i,function(t){return t.childCount>0&&t.firstChild.type==n});if(!s)return!1;var a=s.startIndex;if(0==a)return!1;var u=s.parent,c=u.child(a-1);if(c.type!=n)return!1;if(e){var l=c.lastChild&&c.lastChild.type==u.type,f=$.from(l?n.create():null),d=new K($.from(n.create(null,$.from(u.type.create(null,f)))),l?3:1,0),h=s.start,p=s.end;e(t.tr.step(new ce(h-(l?3:1),p,h,p,d,1,!0)).scrollIntoView())}return!0})(r,o)}},splitBlock:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).keepMarks,e=void 0===t||t;return function(t){var n=t.tr,r=t.state,o=t.dispatch,i=t.editor,s=n.selection,a=n.doc,u=s.$from,c=s.$to,l=ca(i.extensionManager.attributes,u.node().type.name,u.node().attrs);if(s instanceof qe&&s.node.isBlock)return!(!u.parentOffset||!ye(a,u.pos))&&(o&&(e&&ha(r,i.extensionManager.splittableMarks),n.split(u.pos).scrollIntoView()),!0);if(!u.parent.isBlock)return!1;var f=c.parentOffset===c.parent.content.size,d=0===u.depth?void 0:function(t){for(var e=0;e<t.edgeCount;e+=1){var n=t.edge(e).type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(u.node(-1).contentMatchAt(u.indexAfter(-1))),h=f&&d?[{type:d,attrs:l}]:void 0,p=ye(n.doc,n.mapping.map(u.pos),1,h);if(h||p||!ye(n.doc,n.mapping.map(u.pos),1,d?[{type:d}]:void 0)||(p=!0,h=d?[{type:d,attrs:l}]:void 0),o){if(p&&(s instanceof We&&n.deleteSelection(),n.split(n.mapping.map(u.pos),1,h),d&&!f&&!u.parentOffset&&u.parent.type!==d)){var v=n.mapping.map(u.before()),m=n.doc.resolve(v);u.node(-1).canReplaceWith(m.index(),m.index()+1,d)&&n.setNodeMarkup(n.mapping.map(u.before()),d)}e&&ha(r,i.extensionManager.splittableMarks),n.scrollIntoView()}return p}},splitListItem:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r,o=n.tr,s=n.state,a=n.dispatch,u=n.editor,c=vs(t,s.schema),l=s.selection,f=l.$from,d=l.$to,h=s.selection.node;if(h&&h.isBlock||f.depth<2||!f.sameParent(d))return!1;var p=f.node(-1);if(p.type!==c)return!1;var v=u.extensionManager.attributes;if(0===f.parent.content.size&&f.node(-1).childCount===f.indexAfter(-1)){if(2===f.depth||f.node(-3).type!==c||f.index(-2)!==f.node(-2).childCount-1)return!1;if(a){for(var m=$.empty,g=f.index(-1)?1:f.index(-2)?2:3,y=f.depth-g;y>=f.depth-3;y-=1)m=$.from(f.node(y).copy(m));var k=f.indexAfter(-1)<f.node(-2).childCount?1:f.indexAfter(-2)<f.node(-3).childCount?2:3,D=i(i({},ca(v,f.node().type.name,f.node().attrs)),e),b=(null===(r=c.contentMatch.defaultType)||void 0===r?void 0:r.createAndFill(D))||void 0;m=m.append($.from(c.createAndFill(null,b)||void 0));var w=f.before(f.depth-(g-1));o.replace(w,f.after(-k),new K(m,4-g,0));var C=-1;o.doc.nodesBetween(w,o.doc.content.size,function(t,e){if(C>-1)return!1;t.isTextblock&&0===t.content.size&&(C=e+1)}),C>-1&&o.setSelection(We.near(o.doc.resolve(C))),o.scrollIntoView()}return!0}var x=d.pos===f.end()?p.contentMatchAt(0).defaultType:null,E=i(i({},ca(v,p.type.name,p.attrs)),e),A=i(i({},ca(v,f.node().type.name,f.node().attrs)),e);o.delete(f.pos,d.pos);var S=x?[{type:c,attrs:E},{type:x,attrs:A}]:[{type:c,attrs:E}];if(!ye(o.doc,f.pos,2))return!1;if(a){var M=s.selection,O=s.storedMarks,T=u.extensionManager.splittableMarks,F=O||M.$to.parentOffset&&M.$from.marks();if(o.split(f.pos,2,S).scrollIntoView(),!F||!a)return!0;var N=F.filter(function(t){return T.includes(t.type.name)});o.ensureMarks(N)}return!0}},toggleList:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(o){var i=o.editor,s=o.tr,a=o.state,u=o.dispatch,c=o.chain,l=o.commands,f=o.can,d=i.extensionManager,h=d.extensions,p=d.splittableMarks,v=vs(t,a.schema),m=vs(e,a.schema),g=a.selection,y=a.storedMarks,k=g.$from,D=g.$to,b=k.blockRange(D),w=y||g.$to.parentOffset&&g.$from.marks();if(!b)return!1;var C=ia(function(t){return fa(t.type.name,h)})(g);if(b.depth>=1&&C&&b.depth-C.depth<=1){if(C.node.type===v)return l.liftListItem(m);if(fa(C.node.type.name,h)&&v.validContent(C.node.content)&&u)return c().command(function(){return s.setNodeMarkup(C.pos,v),!0}).command(function(){return pa(s,v)}).command(function(){return va(s,v)}).run()}return n&&w&&u?c().command(function(){var t=f().wrapInList(v,r),e=w.filter(function(t){return p.includes(t.type.name)});return s.ensureMarks(e),!!t||l.clearNodes()}).wrapInList(v,r).command(function(){return pa(s,v)}).command(function(){return va(s,v)}).run():c().command(function(){return!!f().wrapInList(v,r)||l.clearNodes()}).wrapInList(v,r).command(function(){return pa(s,v)}).command(function(){return va(s,v)}).run()}},toggleMark:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){var o=r.state,i=r.commands,s=n.extendEmptyMarkRange,a=void 0!==s&&s,u=qs(t,o.schema);return la(o,u,e)?i.unsetMark(u,{extendEmptyMarkRange:a}):i.setMark(u,e)}},toggleNode:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){var o,s=r.state,a=r.commands,u=vs(t,s.schema),c=vs(e,s.schema),l=ta(s,u,n);return s.selection.$anchor.sameParent(s.selection.$head)&&(o=s.selection.$anchor.parent.attrs),l?a.setNode(c,o):a.setNode(u,i(i({},o),n))}},toggleWrap:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.state,o=n.commands,i=vs(t,r.schema);return ta(r,i,e)?o.lift(i):o.wrapIn(i,e)}},undoInputRule:function(){return function(t){for(var e=t.state,n=t.dispatch,r=e.plugins,o=0;o<r.length;o+=1){var i=r[o],s=void 0;if(i.spec.isInputRules&&(s=i.getState(e))){if(n){for(var a=e.tr,u=s.transform,c=u.steps.length-1;c>=0;c-=1)a.step(u.steps[c].invert(u.docs[c]));if(s.text){var l=a.doc.resolve(s.from).marks();a.replaceWith(s.from,s.to,e.schema.text(s.text,l))}else a.delete(s.from,s.to)}return!0}}return!1}},unsetAllMarks:function(){return function(t){var e=t.tr,n=t.dispatch,r=e.selection,o=r.empty,i=r.ranges;return o||n&&i.forEach(function(t){e.removeMark(t.$from.pos,t.$to.pos)}),!0}},unsetMark:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r,o=n.tr,i=n.state,s=n.dispatch,a=e.extendEmptyMarkRange,u=void 0!==a&&a,c=o.selection,l=qs(t,i.schema),f=c.$from,d=c.empty,h=c.ranges;if(!s)return!0;if(d&&u){var p=c.from,v=c.to,m=null===(r=f.marks().find(function(t){return t.type===l}))||void 0===r?void 0:r.attrs,g=_s(f,l,m);g&&(p=g.from,v=g.to),o.removeMark(p,v,l)}else h.forEach(function(t){o.removeMark(t.$from.pos,t.$to.pos,l)});return o.removeStoredMark(l),!0}},updateAttributes:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.tr,o=n.state,s=n.dispatch,a=null,u=null,c=ea("string"==typeof t?t:t.name,o.schema);return!!c&&("node"===c&&(a=vs(t,o.schema)),"mark"===c&&(u=qs(t,o.schema)),s&&r.selection.ranges.forEach(function(t){var n,s,c,l,f=t.$from.pos,d=t.$to.pos;r.selection.empty?o.doc.nodesBetween(f,d,function(t,e){a&&a===t.type&&(c=Math.max(e,f),l=Math.min(e+t.nodeSize,d),n=e,s=t)}):o.doc.nodesBetween(f,d,function(t,o){o<f&&a&&a===t.type&&(c=Math.max(o,f),l=Math.min(o+t.nodeSize,d),n=o,s=t),o>=f&&o<=d&&(a&&a===t.type&&r.setNodeMarkup(o,void 0,i(i({},t.attrs),e)),u&&t.marks.length&&t.marks.forEach(function(n){if(u===n.type){var s=Math.max(o,f),a=Math.min(o+t.nodeSize,d);r.addMark(s,a,u.create(i(i({},n.attrs),e)))}}))}),s&&(void 0!==n&&r.setNodeMarkup(n,void 0,i(i({},s.attrs),e)),u&&s.marks.length&&s.marks.forEach(function(t){u===t.type&&r.addMark(c,l,u.create(i(i({},t.attrs),e)))}))}),!0)}},wrapIn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.state,o=n.dispatch;return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r){var o=n.selection,i=o.$from,s=o.$to,a=i.blockRange(s),u=a&&pe(a,t,e);return!!u&&(r&&r(n.tr.wrap(a,u).scrollIntoView()),!0)}}(vs(t,r.schema),e)(r,o)}},wrapInList:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var r=n.state,o=n.dispatch;return as(vs(t,r.schema),e)(r,o)}}}),ga=Ls.create({name:"commands",addCommands:function(){return i({},ma)}}),ya=Ls.create({name:"drop",addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("tiptapDrop"),props:{handleDrop:function(e,n,r,o){t.editor.emit("drop",{editor:t.editor,event:n,slice:r,moved:o})}}})]}}),ka=Ls.create({name:"editable",addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("editable"),props:{editable:function(){return t.editor.options.editable}}})]}}),Da=new un("focusEvents"),ba=Ls.create({name:"focusEvents",addProseMirrorPlugins:function(){var t=this.editor;return[new on({key:Da,props:{handleDOMEvents:{focus:function(e,n){t.isFocused=!0;var r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:function(e,n){t.isFocused=!1;var r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),wa=Ls.create({name:"keymap",addKeyboardShortcuts:function(){var t=this,e=function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.undoInputRule()},function(){return e.command(function(t){var n=t.tr,r=n.selection,o=n.doc,i=r.empty,s=r.$anchor,a=s.pos,u=s.parent,c=s.parent.isTextblock&&a>0?n.doc.resolve(a-1):s,l=c.parent.type.spec.isolating,f=s.pos-s.parentOffset,d=l&&1===c.parent.childCount?f===s.pos:je.atStart(o).from===a;return!(!i||!u.type.isTextblock||u.textContent.length||!d||d&&"paragraph"===s.parent.type.name)&&e.clearNodes()})},function(){return e.deleteSelection()},function(){return e.joinBackward()},function(){return e.selectNodeBackward()}]})},n=function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.deleteSelection()},function(){return e.deleteCurrentNode()},function(){return e.joinForward()},function(){return e.selectNodeForward()}]})},r={Enter:function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.newlineInCode()},function(){return e.createParagraphNear()},function(){return e.liftEmptyBlock()},function(){return e.splitBlock()}]})},"Mod-Enter":function(){return t.editor.commands.exitCode()},Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:n,"Mod-Delete":n,"Mod-a":function(){return t.editor.commands.selectAll()}},o=i({},r),s=i(i({},r),{},{"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":n,"Ctrl-Alt-Backspace":n,"Alt-Delete":n,"Alt-d":n,"Ctrl-a":function(){return t.editor.commands.selectTextblockStart()},"Ctrl-e":function(){return t.editor.commands.selectTextblockEnd()}});return Gs()||Zs()?s:o},addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("clearDocument"),appendTransaction:function(e,n,r){if(!e.some(function(t){return t.getMeta("composition")})){var o=e.some(function(t){return t.docChanged})&&!n.doc.eq(r.doc),i=e.some(function(t){return t.getMeta("preventClearDocument")});if(o&&!i){var s=n.selection,a=s.empty,u=s.from,c=s.to,l=je.atStart(n.doc).from,f=je.atEnd(n.doc).to;if(!a&&(u===l&&c===f))if(da(r.doc)){var d=r.tr,h=cs({state:r,transaction:d});if(new ls({editor:t.editor,state:h}).commands.clearNodes(),d.steps.length)return d}}}}})]}}),Ca=Ls.create({name:"paste",addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("tiptapPaste"),props:{handlePaste:function(e,n,r){t.editor.emit("paste",{editor:t.editor,event:n,slice:r})}}})]}}),xa=Ls.create({name:"tabindex",addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("tabindex"),props:{attributes:function(){return t.editor.isEditable?{tabindex:"0"}:{}}}})]}}),Ea=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;D(this,t),this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=o}return w(t,[{key:"name",get:function(){return this.node.type.name}},{key:"node",get:function(){return this.currentNode||this.resolvedPos.node()}},{key:"element",get:function(){return this.editor.view.domAtPos(this.pos).node}},{key:"depth",get:function(){var t;return null!==(t=this.actualDepth)&&void 0!==t?t:this.resolvedPos.depth}},{key:"pos",get:function(){return this.resolvedPos.pos}},{key:"content",get:function(){return this.node.content},set:function(t){var e=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return void console.error("You cant set content on a block node. Tried to set content on ".concat(this.name," at ").concat(this.pos));e=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:e,to:n},t)}},{key:"attributes",get:function(){return this.node.attrs}},{key:"textContent",get:function(){return this.node.textContent}},{key:"size",get:function(){return this.node.nodeSize}},{key:"from",get:function(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}},{key:"range",get:function(){return{from:this.from,to:this.to}}},{key:"to",get:function(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}},{key:"parent",get:function(){if(0===this.depth)return null;var e=this.resolvedPos.start(this.resolvedPos.depth-1);return new t(this.resolvedPos.doc.resolve(e),this.editor)}},{key:"before",get:function(){var e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new t(e,this.editor)}},{key:"after",get:function(){var e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new t(e,this.editor)}},{key:"children",get:function(){var e=this,n=[];return this.node.content.forEach(function(r,o){var i=r.isBlock&&!r.isTextblock,s=r.isAtom&&!r.isText,a=e.pos+o+(s?0:1);if(!(a<0||a>e.resolvedPos.doc.nodeSize-2)){var u=e.resolvedPos.doc.resolve(a);if(i||!(u.depth<=e.depth)){var c=new t(u,e.editor,i,i?r:null);i&&(c.actualDepth=e.depth+1),n.push(new t(u,e.editor,i,i?r:null))}}}),n}},{key:"firstChild",get:function(){return this.children[0]||null}},{key:"lastChild",get:function(){var t=this.children;return t[t.length-1]||null}},{key:"closest",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=this.parent;r&&!n;){if(r.node.type.name===t)if(Object.keys(e).length>0)for(var o=r.node.attrs,i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(o[a]!==e[a])break}else n=r;r=r.parent}return n}},{key:"querySelector",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.querySelectorAll(t,e,!0)[0]||null}},{key:"querySelectorAll",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];if(!this.children||0===this.children.length)return r;var o=Object.keys(e);return this.children.forEach(function(i){if(!(n&&r.length>0)){if(i.node.type.name===t)o.every(function(t){return e[t]===i.node.attrs[t]})&&r.push(i);n&&r.length>0||(r=r.concat(i.querySelectorAll(t,e,n)))}}),r}},{key:"setAttribute",value:function(t){var e=this.editor.state.tr;e.setNodeMarkup(this.from,void 0,i(i({},this.node.attrs),t)),this.editor.view.dispatch(e)}}])}();var Aa=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return D(this,e),(t=h(this,e)).isFocused=!1,t.isInitialized=!1,t.extensionStorage={},t.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:function(){return null},onCreate:function(){return null},onUpdate:function(){return null},onSelectionUpdate:function(){return null},onTransaction:function(){return null},onFocus:function(){return null},onBlur:function(){return null},onDestroy:function(){return null},onContentError:function(t){throw t.error},onPaste:function(){return null},onDrop:function(){return null}},t.isCapturingTransaction=!1,t.capturedTransaction=null,t.setOptions(n),t.createExtensionManager(),t.createCommandManager(),t.createSchema(),t.on("beforeCreate",t.options.onBeforeCreate),t.emit("beforeCreate",{editor:t}),t.on("contentError",t.options.onContentError),t.createView(),t.injectCSS(),t.on("create",t.options.onCreate),t.on("update",t.options.onUpdate),t.on("selectionUpdate",t.options.onSelectionUpdate),t.on("transaction",t.options.onTransaction),t.on("focus",t.options.onFocus),t.on("blur",t.options.onBlur),t.on("destroy",t.options.onDestroy),t.on("drop",function(e){var n=e.event,r=e.slice,o=e.moved;return t.options.onDrop(n,r,o)}),t.on("paste",function(e){var n=e.event,r=e.slice;return t.options.onPaste(n,r)}),window.setTimeout(function(){t.isDestroyed||(t.commands.focus(t.options.autofocus),t.emit("create",{editor:t}),t.isInitialized=!0)},0),t}return p(e,t),w(e,[{key:"storage",get:function(){return this.extensionStorage}},{key:"commands",get:function(){return this.commandManager.commands}},{key:"chain",value:function(){return this.commandManager.chain()}},{key:"can",value:function(){return this.commandManager.can()}},{key:"injectCSS",value:function(){this.options.injectCSS&&document&&(this.css=function(t,e){var n=document.querySelector("style[data-tiptap-style".concat("]"));if(null!==n)return n;var r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}},{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=i(i({},this.options),t),this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}},{key:"setEditable",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}},{key:"isEditable",get:function(){return this.options.editable&&this.view&&this.view.editable}},{key:"state",get:function(){return this.view.state}},{key:"registerPlugin",value:function(t,e){var n=ys(e)?e(t,r(this.state.plugins)):[].concat(r(this.state.plugins),[t]),o=this.state.reconfigure({plugins:n});return this.view.updateState(o),o}},{key:"unregisterPlugin",value:function(t){if(!this.isDestroyed){var e=this.state.plugins,n=e;if([].concat(t).forEach(function(t){var e="string"==typeof t?"".concat(t,"$"):t.key;n=n.filter(function(t){return!t.key.startsWith(e)})}),e.length!==n.length){var r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}}}},{key:"createExtensionManager",value:function(){var t,e,n=this,o=this.options.enableCoreExtensions?[ka,$s.configure({blockSeparator:null===(e=null===(t=this.options.coreExtensionOptions)||void 0===t?void 0:t.clipboardTextSerializer)||void 0===e?void 0:e.blockSeparator}),ga,ba,wa,xa,ya,Ca].filter(function(t){return"object"!==k(n.options.enableCoreExtensions)||!1!==n.options.enableCoreExtensions[t.name]}):[],i=[].concat(r(o),r(this.options.extensions)).filter(function(t){return["extension","node","mark"].includes(null==t?void 0:t.type)});this.extensionManager=new Ps(i,this)}},{key:"createCommandManager",value:function(){this.commandManager=new ls({editor:this})}},{key:"createSchema",value:function(){this.schema=this.extensionManager.schema}},{key:"createView",value:function(){var t,e,n=this;try{e=ra(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(s){if(!(s instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(s.message)))throw s;this.emit("contentError",{editor:this,error:s,disableCollaboration:function(){n.storage.collaboration&&(n.storage.collaboration.isDisabled=!0),n.options.extensions=n.options.extensions.filter(function(t){return"collaboration"!==t.name}),n.createExtensionManager()}}),e=ra(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}var r=Us(e,this.options.autofocus);this.view=new bi(this.options.element,i(i({},this.options.editorProps),{},{attributes:i({role:"textbox"},null===(t=this.options.editorProps)||void 0===t?void 0:t.attributes),dispatchTransaction:this.dispatchTransaction.bind(this),state:nn.create({doc:e,selection:r||void 0})}));var o=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(o),this.createNodeViews(),this.prependClass(),this.view.dom.editor=this}},{key:"createNodeViews",value:function(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}},{key:"prependClass",value:function(){this.view.dom.className="tiptap ".concat(this.view.dom.className)}},{key:"captureTransaction",value:function(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;var e=this.capturedTransaction;return this.capturedTransaction=null,e}},{key:"dispatchTransaction",value:function(t){var e=this;if(!this.view.isDestroyed){if(this.isCapturingTransaction)return this.capturedTransaction?void t.steps.forEach(function(t){var n;return null===(n=e.capturedTransaction)||void 0===n?void 0:n.step(t)}):void(this.capturedTransaction=t);var n=this.state.apply(t),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:t}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});var o=t.getMeta("focus"),i=t.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:t}),i&&this.emit("blur",{editor:this,event:i.event,transaction:t}),t.docChanged&&!t.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:t})}}},{key:"getAttributes",value:function(t){return sa(this.state,t)}},{key:"isActive",value:function(t,e){var n="string"==typeof t?t:null,r="string"==typeof t?e:t;return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return ta(t,null,n)||la(t,null,n);var r=ea(e,t.schema);return"node"===r?ta(t,e,n):"mark"===r&&la(t,e,n)}(this.state,n,r)}},{key:"getJSON",value:function(){return this.state.doc.toJSON()}},{key:"getHTML",value:function(){return xs(this.state.doc.content,this.schema)}},{key:"getText",value:function(t){var e=t||{},n=e.blockSeparator,r=void 0===n?"\n\n":n,o=e.textSerializers,s=void 0===o?{}:o;return function(t,e){return zs(t,{from:0,to:t.content.size},e)}(this.state.doc,{blockSeparator:r,textSerializers:i(i({},js(this.schema)),s)})}},{key:"isEmpty",get:function(){return da(this.state.doc)}},{key:"getCharacterCount",value:function(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}},{key:"destroy",value:function(){if(this.emit("destroy"),this.view){var t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}},{key:"isDestroyed",get:function(){var t;return!(null===(t=this.view)||void 0===t?void 0:t.docView)}},{key:"$node",value:function(t,e){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelector(t,e))||null}},{key:"$nodes",value:function(t,e){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelectorAll(t,e))||null}},{key:"$pos",value:function(t){var e=this.state.doc.resolve(t);return new Ea(e,this)}},{key:"$doc",get:function(){return this.$pos(0)}}])}(fs);function Sa(t){return new As({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=ks(t.getAttributes,void 0,o);if(!1===i||null===i)return null;var s=n.tr,a=o[o.length-1],u=o[0];if(a){var c=u.search(/\S/),l=r.from+u.indexOf(a),f=l+a.length;if(ua(r.from,r.to,n.doc).filter(function(e){return e.mark.type.excluded.find(function(n){return n===t.type&&n!==e.mark.type})}).filter(function(t){return t.to>l}).length)return null;f<r.to&&s.delete(f,r.to),l>r.from&&s.delete(r.from+c,l);var d=r.from+c+a.length;s.addMark(r.from+c,d,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function Ma(t){return new As({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=n.doc.resolve(r.from),s=ks(t.getAttributes,void 0,o)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;n.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,s)}})}function Oa(t){return new As({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=e.chain,s=ks(t.getAttributes,void 0,o)||{},a=n.tr.delete(r.from,r.to),u=a.doc.resolve(r.from).blockRange(),c=u&&pe(u,t.type,s);if(!c)return null;if(a.wrap(u,c),t.keepMarks&&t.editor){var l=n.selection,f=n.storedMarks,d=t.editor.extensionManager.splittableMarks,h=f||l.$to.parentOffset&&l.$from.marks();if(h){var p=h.filter(function(t){return d.includes(t.type.name)});a.ensureMarks(p)}}if(t.keepAttributes){var v="bulletList"===t.type.name||"orderedList"===t.type.name?"listItem":"taskList";i().updateAttributes(v,s).run()}var m=a.doc.resolve(r.from-1).nodeBefore;m&&m.type===t.type&&ke(a.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(o,m))&&a.join(r.from-1)}})}var Ta=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D(this,t),this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=i(i({},this.config),e),this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(this.name,'".')),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ks(ds(this,"addOptions",{name:this.name}))),this.storage=ks(ds(this,"addStorage",{name:this.name,options:this.options}))||{}}return w(t,[{key:"configure",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.extend(i(i({},this.config),{},{addOptions:function(){return Ts(t.options,e)}}));return n.name=this.name,n.parent=this.parent,n}},{key:"extend",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new t(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn('[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "'.concat(n.name,'".')),n.options=ks(ds(n,"addOptions",{name:n.name})),n.storage=ks(ds(n,"addStorage",{name:n.name,options:n.options})),n}}],[{key:"create",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}])}();function Fa(t){return new Ns({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=e.pasteEvent,s=ks(t.getAttributes,void 0,o,i);if(!1===s||null===s)return null;var a=n.tr,u=o[o.length-1],c=o[0],l=r.to;if(u){var f=c.search(/\S/),d=r.from+c.indexOf(u),h=d+u.length;if(ua(r.from,r.to,n.doc).filter(function(e){return e.mark.type.excluded.find(function(n){return n===t.type&&n!==e.mark.type})}).filter(function(t){return t.to>d}).length)return null;h<r.to&&a.delete(h,r.to),d>r.from&&a.delete(r.from+f,d),l=r.from+f+u.length,a.addMark(r.from+f,l,t.type.create(s||{})),a.removeStoredMark(t.type)}}})}function Na(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ba,Ra={exports:{}},Ia={};Ra.exports=function(){if(Ba)return Ia;Ba=1;var t=l,e="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},n=t.useState,r=t.useEffect,o=t.useLayoutEffect,i=t.useDebugValue;function s(t){var n=t.getSnapshot;t=t.value;try{var r=n();return!e(t,r)}catch(o){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var a=e(),u=n({inst:{value:a,getSnapshot:e}}),c=u[0].inst,l=u[1];return o(function(){c.value=a,c.getSnapshot=e,s(c)&&l({inst:c})},[t,a,e]),r(function(){return s(c)&&l({inst:c}),t(function(){s(c)&&l({inst:c})})},[t]),i(a),a};return Ia.useSyncExternalStore=void 0!==t.useSyncExternalStore?t.useSyncExternalStore:a,Ia}();var Pa=Ra.exports,La=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){e.forEach(function(e){"function"==typeof e?e(t):e&&(e.current=t)})}},za=function(t){var e=t.contentComponent,n=Pa.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getServerSnapshot);return l.createElement(l.Fragment,null,Object.values(n))};var ja,$a=function(e){function o(t){var e,n;return D(this,o),(e=h(this,o,[t])).editorContentRef=l.createRef(),e.initialized=!1,e.state={hasContentComponentInitialized:Boolean(null===(n=t.editor)||void 0===n?void 0:n.contentComponent)},e}return p(o,e),w(o,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(){this.init()}},{key:"init",value:function(){var t,e,n=this,o=this.props.editor;if(o&&!o.isDestroyed&&o.options.element){if(o.contentComponent)return;var a=this.editorContentRef.current;a.append.apply(a,r(o.options.element.childNodes)),o.setOptions({element:a}),o.contentComponent=(t=new Set,e={},{subscribe:function(e){return t.add(e),function(){t.delete(e)}},getSnapshot:function(){return e},getServerSnapshot:function(){return e},setRenderer:function(n,r){e=i(i({},e),{},s({},n,m.createPortal(r.reactElement,r.element,n))),t.forEach(function(t){return t()})},removeRenderer:function(n){var r=i({},e);delete r[n],e=r,t.forEach(function(t){return t()})}}),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=o.contentComponent.subscribe(function(){n.setState(function(t){return t.hasContentComponentInitialized?t:{hasContentComponentInitialized:!0}}),n.unsubscribeToContentComponent&&n.unsubscribeToContentComponent()})),o.createNodeViews(),this.initialized=!0}}},{key:"componentWillUnmount",value:function(){var t=this.props.editor;if(t&&(this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null,t.options.element.firstChild)){var e=document.createElement("div");e.append.apply(e,r(t.options.element.childNodes)),t.setOptions({element:e})}}},{key:"render",value:function(){var e=this.props,r=e.editor,o=e.innerRef,s=n(e,t);return l.createElement(l.Fragment,null,l.createElement("div",i({ref:La(o,this.editorContentRef)},s)),(null==r?void 0:r.contentComponent)&&l.createElement(za,{contentComponent:r.contentComponent}))}}])}(l.Component),Va=d.forwardRef(function(t,e){var n=l.useMemo(function(){return Math.floor(4294967295*Math.random()).toString()},[t.editor]);return l.createElement($a,i({key:n,innerRef:e},t))}),Ha=l.memo(Va),Wa=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==k(e)&&"object"==k(n)){if(e.constructor!==n.constructor)return!1;var r,o,i;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(o=r;0!==o--;)if(!t(e[o],n[o]))return!1;return!0}if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;var s,a=u(e.entries());try{for(a.s();!(s=a.n()).done;)if(o=s.value,!n.has(o[0]))return!1}catch(p){a.e(p)}finally{a.f()}var c,l=u(e.entries());try{for(l.s();!(c=l.n()).done;)if(!t((o=c.value)[1],n.get(o[0])))return!1}catch(p){l.e(p)}finally{l.f()}return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;var f,d=u(e.entries());try{for(d.s();!(f=d.n()).done;)if(o=f.value,!n.has(o[0]))return!1}catch(p){d.e(p)}finally{d.f()}return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if((r=e.length)!=n.length)return!1;for(o=r;0!==o--;)if(e[o]!==n[o])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(i=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(o=r;0!==o--;)if(!Object.prototype.hasOwnProperty.call(n,i[o]))return!1;for(o=r;0!==o--;){var h=i[o];if(("_owner"!==h||!e.$$typeof)&&!t(e[h],n[h]))return!1}return!0}return e!=e&&n!=n},_a=Na(Wa),qa={exports:{}},Ka={};qa.exports=function(){if(ja)return Ka;ja=1;var t=l,e=Pa,n="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},r=e.useSyncExternalStore,o=t.useRef,i=t.useEffect,s=t.useMemo,a=t.useDebugValue;return Ka.useSyncExternalStoreWithSelector=function(t,e,u,c,l){var f=o(null);if(null===f.current){var d={hasValue:!1,value:null};f.current=d}else d=f.current;f=s(function(){function t(t){if(!i){if(i=!0,r=t,t=c(t),void 0!==l&&d.hasValue){var e=d.value;if(l(e,t))return o=e}return o=t}if(e=o,n(r,t))return e;var s=c(t);return void 0!==l&&l(e,s)?e:(r=t,o=s)}var r,o,i=!1,s=void 0===u?null:u;return[function(){return t(e())},null===s?void 0:function(){return t(s())}]},[e,u,c,l]);var h=r(t,f[0],f[1]);return i(function(){d.hasValue=!0,d.value=h},[h]),a(h),h},Ka}();var Ja=qa.exports,Ua="undefined"!=typeof window?d.useLayoutEffect:d.useEffect,Ga=function(){return w(function t(e){D(this,t),this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)},[{key:"getSnapshot",value:function(){return this.transactionNumber===this.lastTransactionNumber||(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber}),this.lastSnapshot}},{key:"getServerSnapshot",value:function(){return{editor:null,transactionNumber:0}}},{key:"subscribe",value:function(t){var e=this;return this.subscribers.add(t),function(){e.subscribers.delete(t)}}},{key:"watch",value:function(t){var e=this;if(this.editor=t,this.editor){var n=function(){e.transactionNumber+=1,e.subscribers.forEach(function(t){return t()})},r=this.editor;return r.on("transaction",n),function(){r.off("transaction",n)}}}}])}();var Qa="undefined"==typeof window,Ya=Qa||Boolean("undefined"!=typeof window&&window.next),Xa=function(){function t(e){D(this,t),this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}return w(t,[{key:"setEditor",value:function(t){this.editor=t,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(function(t){return t()})}},{key:"getInitialEditor",value:function(){return void 0===this.options.current.immediatelyRender?Qa||Ya?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}},{key:"createEditor",value:function(){var t=this,e=i(i({},this.options.current),{},{onBeforeCreate:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onBeforeCreate)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onBlur:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onBlur)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onCreate:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onCreate)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onDestroy:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onDestroy)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onFocus:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onFocus)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onSelectionUpdate:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onSelectionUpdate)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onTransaction:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onTransaction)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onUpdate:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onUpdate)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onContentError:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onContentError)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onDrop:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onDrop)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))},onPaste:function(){for(var e,n,r,o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return null===(r=(n=t.options.current).onPaste)||void 0===r?void 0:(e=r).call.apply(e,[n].concat(i))}});return new Aa(e)}},{key:"getEditor",value:function(){return this.editor}},{key:"getServerSnapshot",value:function(){return null}},{key:"subscribe",value:function(t){var e=this;return this.subscriptions.add(t),function(){e.subscriptions.delete(t)}}},{key:"onRender",value:function(e){var n=this;return function(){return n.isComponentMounted=!0,clearTimeout(n.scheduledDestructionTimeout),n.editor&&!n.editor.isDestroyed&&0===e.length?t.compareOptions(n.options.current,n.editor.options)||n.editor.setOptions(i(i({},n.options.current),{},{editable:n.editor.isEditable})):n.refreshEditorInstance(e),function(){n.isComponentMounted=!1,n.scheduleDestroy()}}}},{key:"refreshEditorInstance",value:function(t){if(this.editor&&!this.editor.isDestroyed){if(null===this.previousDeps)return void(this.previousDeps=t);if(this.previousDeps.length===t.length&&this.previousDeps.every(function(e,n){return e===t[n]}))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=t}},{key:"scheduleDestroy",value:function(){var t=this,e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(function(){t.isComponentMounted&&t.instanceId===e?n&&n.setOptions(t.options.current):n&&!n.isDestroyed&&(n.destroy(),t.instanceId===e&&t.setEditor(null))},1)}}],[{key:"compareOptions",value:function(t,e){return Object.keys(t).every(function(n){return!!["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(n)||("extensions"===n&&t.extensions&&e.extensions?t.extensions.length===e.extensions.length&&t.extensions.every(function(t,n){var r;return t===(null===(r=e.extensions)||void 0===r?void 0:r[n])}):t[n]===e[n])})}}])}();function Za(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=d.useRef(t);n.current=t;var r=a(d.useState(function(){return new Xa(n)}),1)[0],o=Pa.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return d.useDebugValue(o),d.useEffect(r.onRender(e)),function(t){var e,n=a(d.useState(function(){return new Ga(t.editor)}),1)[0],r=Ja.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,null!==(e=t.equalityFn)&&void 0!==e?e:_a);Ua(function(){return n.watch(t.editor)},[t.editor,n]),d.useDebugValue(r)}({editor:o,selector:function(e){var n=e.transactionNumber;return!1===t.shouldRerenderOnTransaction?null:t.immediatelyRender&&0===n?0:n+1}}),o}d.createContext({editor:null}).Consumer;var tu=d.createContext({onDragStart:void 0});l.forwardRef(function(t,e){var n=d.useContext(tu).onDragStart,r=t.as||"div";return l.createElement(r,i(i({},t),{},{ref:e,"data-node-view-wrapper":"",onDragStart:n,style:i({whiteSpace:"normal"},t.style)}))});var eu=/^\s*>\s$/,nu=Ta.create({name:"blockquote",addOptions:function(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML:function(){return[{tag:"blockquote"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["blockquote",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setBlockquote:function(){return function(e){return e.commands.wrapIn(t.name)}},toggleBlockquote:function(){return function(e){return e.commands.toggleWrap(t.name)}},unsetBlockquote:function(){return function(e){return e.commands.lift(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-b":function(){return t.editor.commands.toggleBlockquote()}}},addInputRules:function(){return[Oa({find:eu,type:this.type})]}}),ru=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ou=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,iu=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,su=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,au=Fs.create({name:"bold",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){var t=this;return[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!==t.style.fontWeight&&null}},{style:"font-weight=400",clearMark:function(e){return e.type.name===t.name}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["strong",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setBold:function(){return function(e){return e.commands.setMark(t.name)}},toggleBold:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetBold:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-b":function(){return t.editor.commands.toggleBold()},"Mod-B":function(){return t.editor.commands.toggleBold()}}},addInputRules:function(){return[Sa({find:ru,type:this.type}),Sa({find:iu,type:this.type})]},addPasteRules:function(){return[Fa({find:ou,type:this.type}),Fa({find:su,type:this.type})]}}),uu="textStyle",cu=/^\s*([-+*])\s$/,lu=Ta.create({name:"bulletList",addOptions:function(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content:function(){return"".concat(this.options.itemTypeName,"+")},parseHTML:function(){return[{tag:"ul"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["ul",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{toggleBulletList:function(){return function(e){var n=e.commands,r=e.chain;return t.options.keepAttributes?r().toggleList(t.name,t.options.itemTypeName,t.options.keepMarks).updateAttributes("listItem",t.editor.getAttributes(uu)).run():n.toggleList(t.name,t.options.itemTypeName,t.options.keepMarks)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-8":function(){return t.editor.commands.toggleBulletList()}}},addInputRules:function(){var t=this,e=Oa({find:cu,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Oa({find:cu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:function(){return t.editor.getAttributes(uu)},editor:this.editor})),[e]}}),fu=/(^|[^`])`([^`]+)`(?!`)/,du=/(^|[^`])`([^`]+)`(?!`)/g,hu=Fs.create({name:"code",addOptions:function(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML:function(){return[{tag:"code"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["code",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setCode:function(){return function(e){return e.commands.setMark(t.name)}},toggleCode:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetCode:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-e":function(){return t.editor.commands.toggleCode()}}},addInputRules:function(){return[Sa({find:fu,type:this.type})]},addPasteRules:function(){return[Fa({find:du,type:this.type})]}}),pu=/^```([a-z]+)?[\s\n]$/,vu=/^~~~([a-z]+)?[\s\n]$/,mu=Ta.create({name:"codeBlock",addOptions:function(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes:function(){var t=this;return{language:{default:this.options.defaultLanguage,parseHTML:function(e){var n,o=t.options.languageClassPrefix,i=r((null===(n=e.firstElementChild)||void 0===n?void 0:n.classList)||[]).filter(function(t){return t.startsWith(o)}).map(function(t){return t.replace(o,"")})[0];return i||null},rendered:!1}}},parseHTML:function(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes;return["pre",ms(this.options.HTMLAttributes,n),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands:function(){var t=this;return{setCodeBlock:function(e){return function(n){return n.commands.setNode(t.name,e)}},toggleCodeBlock:function(e){return function(n){return n.commands.toggleNode(t.name,"paragraph",e)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Alt-c":function(){return t.editor.commands.toggleCodeBlock()},Backspace:function(){var e=t.editor.state.selection,n=e.empty,r=e.$anchor,o=1===r.pos;return!(!n||r.parent.type.name!==t.name)&&(!(!o&&r.parent.textContent.length)&&t.editor.commands.clearNodes())},Enter:function(e){var n=e.editor;if(!t.options.exitOnTripleEnter)return!1;var r=n.state.selection,o=r.$from;if(!r.empty||o.parent.type!==t.type)return!1;var i=o.parentOffset===o.parent.nodeSize-2,s=o.parent.textContent.endsWith("\n\n");return!(!i||!s)&&n.chain().command(function(t){return t.tr.delete(o.pos-2,o.pos),!0}).exitCode().run()},ArrowDown:function(e){var n=e.editor;if(!t.options.exitOnArrowDown)return!1;var r=n.state,o=r.selection,i=r.doc,s=o.$from;if(!o.empty||s.parent.type!==t.type)return!1;if(!(s.parentOffset===s.parent.nodeSize-2))return!1;var a=s.after();return void 0!==a&&(i.nodeAt(a)?n.commands.command(function(t){return t.tr.setSelection(je.near(i.resolve(a))),!0}):n.commands.exitCode())}}},addInputRules:function(){return[Ma({find:pu,type:this.type,getAttributes:function(t){return{language:t[1]}}}),Ma({find:vu,type:this.type,getAttributes:function(t){return{language:t[1]}}})]},addProseMirrorPlugins:function(){var t=this;return[new on({key:new un("codeBlockVSCodeHandler"),props:{handlePaste:function(e,n){if(!n.clipboardData)return!1;if(t.editor.isActive(t.type.name))return!1;var r=n.clipboardData.getData("text/plain"),o=n.clipboardData.getData("vscode-editor-data"),i=o?JSON.parse(o):void 0,s=null==i?void 0:i.mode;if(!r||!s)return!1;var a=e.state,u=a.tr,c=a.schema.text(r.replace(/\r\n?/g,"\n"));return u.replaceSelectionWith(t.type.create({language:s},c)),u.selection.$from.parent.type!==t.type&&u.setSelection(We.near(u.doc.resolve(Math.max(0,u.selection.from-2)))),u.setMeta("paste",!0),e.dispatch(u),!0}}})]}}),gu=Ta.create({name:"doc",topNode:!0,content:"block+"});function yu(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new on({view:function(e){return new ku(e,t)}})}var ku=function(){return w(function t(e,n){var r,o=this;D(this,t),this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(r=n.width)&&void 0!==r?r:1,this.color=!1===n.color?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(function(t){var n=function(e){o[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})},[{key:"destroy",value:function(){var t=this;this.handlers.forEach(function(e){var n=e.name,r=e.handler;return t.editorView.dom.removeEventListener(n,r)})}},{key:"update",value:function(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}},{key:"setCursor",value:function(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}},{key:"updateOverlay",value:function(){var t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r=this.editorView.dom,o=r.getBoundingClientRect(),i=o.width/r.offsetWidth,s=o.height/r.offsetHeight;if(n){var a=e.nodeBefore,u=e.nodeAfter;if(a||u){var c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){var l=c.getBoundingClientRect(),f=a?l.bottom:l.top;a&&u&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);var d=this.width/2*s;t={left:l.left,right:l.right,top:f-d,bottom:f+d}}}}if(!t){var h=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*i;t={left:h.left-p,right:h.left+p,top:h.top,bottom:h.bottom}}var v,m,g=this.editorView.dom.offsetParent;if(this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!g||g==document.body&&"static"==getComputedStyle(g).position)v=-pageXOffset,m=-pageYOffset;else{var y=g.getBoundingClientRect(),k=y.width/g.offsetWidth,D=y.height/g.offsetHeight;v=y.left-g.scrollLeft*k,m=y.top-g.scrollTop*D}this.element.style.left=(t.left-v)/i+"px",this.element.style.top=(t.top-m)/s+"px",this.element.style.width=(t.right-t.left)/i+"px",this.element.style.height=(t.bottom-t.top)/s+"px"}},{key:"scheduleRemoval",value:function(t){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return e.setCursor(null)},t)}},{key:"dragover",value:function(t){if(this.editorView.editable){var e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,o="function"==typeof r?r(this.editorView,e,t):r;if(e&&!o){var i=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){var s=we(this.editorView.state.doc,i,this.editorView.dragging.slice);null!=s&&(i=s)}this.setCursor(i),this.scheduleRemoval(5e3)}}}},{key:"dragend",value:function(){this.scheduleRemoval(20)}},{key:"drop",value:function(){this.scheduleRemoval(20)}},{key:"dragleave",value:function(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}])}(),Du=Ls.create({name:"dropCursor",addOptions:function(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins:function(){return[yu(this.options)]}}),bu=function(t){function e(t){return D(this,e),h(this,e,[t,t])}return p(e,t),w(e,[{key:"map",value:function(t,n){var r=t.resolve(n.map(this.head));return e.valid(r)?new e(r):je.near(r)}},{key:"content",value:function(){return K.empty}},{key:"eq",value:function(t){return t instanceof e&&t.head==this.head}},{key:"toJSON",value:function(){return{type:"gapcursor",pos:this.head}}},{key:"getBookmark",value:function(){return new wu(this.anchor)}}],[{key:"fromJSON",value:function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(t.resolve(n.pos))}},{key:"valid",value:function(t){var e=t.parent;if(e.isTextblock||!function(t){for(var e=t.depth;e>=0;e--){var n=t.index(e),r=t.node(e);if(0!=n)for(var o=r.child(n-1);;o=o.lastChild){if(0==o.childCount&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t)||!function(t){for(var e=t.depth;e>=0;e--){var n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(var o=r.child(n);;o=o.firstChild){if(0==o.childCount&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t))return!1;var n=e.type.spec.allowGapCursor;if(null!=n)return n;var r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}},{key:"findGapCursorFrom",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t:for(;;){if(!r&&e.valid(t))return t;for(var o=t.pos,i=null,s=t.depth;;s--){var a=t.node(s);if(n>0?t.indexAfter(s)<a.childCount:t.index(s)>0){i=a.child(n>0?t.indexAfter(s):t.index(s)-1);break}if(0==s)return null;o+=n;var u=t.doc.resolve(o);if(e.valid(u))return u}for(;;){var c=n>0?i.firstChild:i.lastChild;if(!c){if(i.isAtom&&!i.isText&&!qe.isSelectable(i)){t=t.doc.resolve(o+i.nodeSize*n),r=!1;continue t}break}i=c,o+=n;var l=t.doc.resolve(o);if(e.valid(l))return l}return null}}}])}(je);bu.prototype.visible=!1,bu.findFrom=bu.findGapCursorFrom,je.jsonID("gapcursor",bu);var wu=function(){function t(e){D(this,t),this.pos=e}return w(t,[{key:"map",value:function(e){return new t(e.map(this.pos))}},{key:"resolve",value:function(t){var e=t.resolve(this.pos);return bu.valid(e)?new bu(e):je.near(e)}}])}();var Cu=Li({ArrowLeft:xu("horiz",-1),ArrowRight:xu("horiz",1),ArrowUp:xu("vert",-1),ArrowDown:xu("vert",1)});function xu(t,e){var n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,o){var i=t.selection,s=e>0?i.$to:i.$from,a=i.empty;if(i instanceof We){if(!o.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=t.doc.resolve(e>0?s.after():s.before())}var u=bu.findGapCursorFrom(s,e,a);return!!u&&(r&&r(t.tr.setSelection(new bu(u))),!0)}}function Eu(t,e,n){if(!t||!t.editable)return!1;var r=t.state.doc.resolve(e);if(!bu.valid(r))return!1;var o=t.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&qe.isSelectable(t.state.doc.nodeAt(o.inside)))&&(t.dispatch(t.state.tr.setSelection(new bu(r))),!0)}function Au(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof bu))return!1;var n=t.state.selection.$from,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;for(var o=$.empty,i=r.length-1;i>=0;i--)o=$.from(r[i].createAndFill(null,o));var s=t.state.tr.replace(n.pos,n.pos,new K(o,0,0));return s.setSelection(We.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function Su(t){if(!(t.selection instanceof bu))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",Go.create(t.doc,[Ko.widget(t.selection.head,e,{key:"gapcursor"})])}var Mu=Ls.create({name:"gapCursor",addProseMirrorPlugins:function(){return[new on({props:{decorations:Su,createSelectionBetween:function(t,e,n){return e.pos==n.pos&&bu.valid(n)?new bu(n):null},handleClick:Eu,handleKeyDown:Cu,handleDOMEvents:{beforeinput:Au}}})]},extendNodeSchema:function(t){var e;return{allowGapCursor:null!==(e=ks(ds(t,"allowGapCursor",{name:t.name,options:t.options,storage:t.storage})))&&void 0!==e?e:null}}}),Ou=Ta.create({name:"hardBreak",addOptions:function(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:function(){return[{tag:"br"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["br",ms(this.options.HTMLAttributes,e)]},renderText:function(){return"\n"},addCommands:function(){var t=this;return{setHardBreak:function(){return function(e){var n=e.commands,r=e.chain,o=e.state,i=e.editor;return n.first([function(){return n.exitCode()},function(){return n.command(function(){var e=o.selection,n=o.storedMarks;if(e.$from.parent.type.spec.isolating)return!1;var s=t.options.keepMarks,a=i.extensionManager.splittableMarks,u=n||e.$to.parentOffset&&e.$from.marks();return r().insertContent({type:t.name}).command(function(t){var e=t.tr;if(t.dispatch&&u&&s){var n=u.filter(function(t){return a.includes(t.type.name)});e.ensureMarks(n)}return!0}).run()})}])}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Enter":function(){return t.editor.commands.setHardBreak()},"Shift-Enter":function(){return t.editor.commands.setHardBreak()}}}}),Tu=Ta.create({name:"heading",addOptions:function(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes:function(){return{level:{default:1,rendered:!1}}},parseHTML:function(){return this.options.levels.map(function(t){return{tag:"h".concat(t),attrs:{level:t}}})},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes,r=this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0];return["h".concat(r),ms(this.options.HTMLAttributes,n),0]},addCommands:function(){var t=this;return{setHeading:function(e){return function(n){var r=n.commands;return!!t.options.levels.includes(e.level)&&r.setNode(t.name,e)}},toggleHeading:function(e){return function(n){var r=n.commands;return!!t.options.levels.includes(e.level)&&r.toggleNode(t.name,"paragraph",e)}}}},addKeyboardShortcuts:function(){var t=this;return this.options.levels.reduce(function(e,n){return i(i({},e),s({},"Mod-Alt-".concat(n),function(){return t.editor.commands.toggleHeading({level:n})}))},{})},addInputRules:function(){var t=this;return this.options.levels.map(function(e){return Ma({find:new RegExp("^(#{".concat(Math.min.apply(Math,r(t.options.levels)),",").concat(e,"})\\s$")),type:t.type,getAttributes:{level:e}})})}}),Fu=200,Nu=function(){};Nu.prototype.append=function(t){return t.length?(t=Nu.from(t),!this.length&&t||t.length<Fu&&this.leafAppend(t)||this.length<Fu&&t.leafPrepend(this)||this.appendInner(t)):this},Nu.prototype.prepend=function(t){return t.length?Nu.from(t).append(this):this},Nu.prototype.appendInner=function(t){return new Ru(this,t)},Nu.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?Nu.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},Nu.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},Nu.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},Nu.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach(function(e,n){return r.push(t(e,n))},e,n),r},Nu.from=function(t){return t instanceof Nu?t:t&&t.length?new Bu(t):Nu.empty};var Bu=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var o=e;o<n;o++)if(!1===t(this.values[o],r+o))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var o=e-1;o>=n;o--)if(!1===t(this.values[o],r+o))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=Fu)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=Fu)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Nu);Nu.empty=new Bu([]);var Ru=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var o=this.left.length;return!(e<o&&!1===this.left.forEachInner(t,e,Math.min(n,o),r))&&(!(n>o&&!1===this.right.forEachInner(t,Math.max(e-o,0),Math.min(this.length,n)-o,r+o))&&void 0)},e.prototype.forEachInvertedInner=function(t,e,n,r){var o=this.left.length;return!(e>o&&!1===this.right.forEachInvertedInner(t,e-o,Math.max(n,o)-o,r+o))&&(!(n<o&&!1===this.left.forEachInvertedInner(t,Math.min(e,o),n,r))&&void 0)},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(Nu),Iu=function(){function t(e,n){D(this,t),this.items=e,this.eventCount=n}return w(t,[{key:"popEvent",value:function(e,n){var r=this;if(0==this.eventCount)return null;for(var o,i,s=this.items.length;;s--){if(this.items.get(s-1).selection){--s;break}}n&&(o=this.remapping(s,this.items.length),i=o.maps.length);var a,u,c=e.tr,l=[],f=[];return this.items.forEach(function(e,n){if(!e.step)return o||(o=r.remapping(s,n+1),i=o.maps.length),i--,void f.push(e);if(o){f.push(new Pu(e.map));var d,h=e.step.map(o.slice(i));h&&c.maybeStep(h).doc&&(d=c.mapping.maps[c.mapping.maps.length-1],l.push(new Pu(d,void 0,void 0,l.length+f.length))),i--,d&&o.appendMap(d,i)}else c.maybeStep(e.step);return e.selection?(a=o?e.selection.map(o.slice(i)):e.selection,u=new t(r.items.slice(0,s).append(f.reverse().concat(l)),r.eventCount-1),!1):void 0},this.items.length,0),{remaining:u,transform:c,selection:a}}},{key:"addTransform",value:function(e,n,r,o){for(var i=[],s=this.eventCount,a=this.items,u=!o&&a.length?a.get(a.length-1):null,c=0;c<e.steps.length;c++){var l,f=e.steps[c].invert(e.docs[c]),d=new Pu(e.mapping.maps[c],f,n);(l=u&&u.merge(d))&&(d=l,c?i.pop():a=a.slice(0,a.length-1)),i.push(d),n&&(s++,n=void 0),o||(u=d)}var h,p,v,m=s-r.depth;return m>zu&&(p=m,(h=a).forEach(function(t,e){if(t.selection&&0==p--)return v=e,!1}),a=h.slice(v),s-=m),new t(a.append(i),s)}},{key:"remapping",value:function(t,e){var n=new Zt;return this.items.forEach(function(e,r){var o=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,o)},t,e),n}},{key:"addMaps",value:function(e){return 0==this.eventCount?this:new t(this.items.append(e.map(function(t){return new Pu(t)})),this.eventCount)}},{key:"rebased",value:function(e,n){if(!this.eventCount)return this;var r=[],o=Math.max(0,this.items.length-n),i=e.mapping,s=e.steps.length,a=this.eventCount;this.items.forEach(function(t){t.selection&&a--},o);var u=n;this.items.forEach(function(t){var n=i.getMirror(--u);if(null!=n){s=Math.min(s,n);var o=i.maps[n];if(t.step){var c=e.steps[n].invert(e.docs[n]),l=t.selection&&t.selection.map(i.slice(u+1,n));l&&a++,r.push(new Pu(o,c,l))}else r.push(new Pu(o))}},o);for(var c=[],l=n;l<s;l++)c.push(new Pu(i.maps[l]));var f=new t(this.items.slice(0,o).append(c).append(r),a);return f.emptyItemCount()>500&&(f=f.compress(this.items.length-r.length)),f}},{key:"emptyItemCount",value:function(){var t=0;return this.items.forEach(function(e){e.step||t++}),t}},{key:"compress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items.length,n=this.remapping(0,e),r=n.maps.length,o=[],i=0;return this.items.forEach(function(t,s){if(s>=e)o.push(t),t.selection&&i++;else if(t.step){var a=t.step.map(n.slice(r)),u=a&&a.getMap();if(r--,u&&n.appendMap(u,r),a){var c=t.selection&&t.selection.map(n.slice(r));c&&i++;var l,f=new Pu(u.invert(),a,c),d=o.length-1;(l=o.length&&o[d].merge(f))?o[d]=l:o.push(f)}}else t.map&&r--},this.items.length,0),new t(Nu.from(o.reverse()),i)}}])}();Iu.empty=new Iu(Nu.empty,0);var Pu=function(){function t(e,n,r,o){D(this,t),this.map=e,this.step=n,this.selection=r,this.mirrorOffset=o}return w(t,[{key:"merge",value:function(e){if(this.step&&e.step&&!e.selection){var n=e.step.merge(this.step);if(n)return new t(n.getMap().invert(),n,this.selection)}}}])}(),Lu=w(function t(e,n,r,o,i){D(this,t),this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=o,this.prevComposition=i}),zu=20;function ju(t){for(var e=[],n=t.length-1;n>=0&&0==e.length;n--)t[n].forEach(function(t,n,r,o){return e.push(r,o)});return e}function $u(t,e){if(!t)return null;for(var n=[],r=0;r<t.length;r+=2){var o=e.map(t[r],1),i=e.map(t[r+1],-1);o<=i&&n.push(o,i)}return n}var Vu=!1,Hu=null;function Wu(t){var e=t.plugins;if(Hu!=e){Vu=!1,Hu=e;for(var n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Vu=!0;break}}return Vu}var _u=new un("history"),qu=new un("closeHistory");function Ku(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new on({key:_u,state:{init:function(){return new Lu(Iu.empty,Iu.empty,null,0,-1)},apply:function(e,n,r){return function(t,e,n,r){var o,i=n.getMeta(_u);if(i)return i.historyState;n.getMeta(qu)&&(t=new Lu(t.done,t.undone,null,0,-1));var s=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(s&&s.getMeta(_u))return s.getMeta(_u).redo?new Lu(t.done.addTransform(n,void 0,r,Wu(e)),t.undone,ju(n.mapping.maps),t.prevTime,t.prevComposition):new Lu(t.done,t.undone.addTransform(n,void 0,r,Wu(e)),null,t.prevTime,t.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new Lu(t.done.rebased(n,o),t.undone.rebased(n,o),$u(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Lu(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),$u(t.prevRanges,n.mapping),t.prevTime,t.prevComposition);var a=n.getMeta("composition"),u=0==t.prevTime||!s&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!function(t,e){if(!e)return!1;if(!t.docChanged)return!0;var n=!1;return t.mapping.maps[0].forEach(function(t,r){for(var o=0;o<e.length;o+=2)t<=e[o+1]&&r>=e[o]&&(n=!0)}),n}(n,t.prevRanges)),c=s?$u(t.prevRanges,n.mapping):ju(n.mapping.maps);return new Lu(t.done.addTransform(n,u?e.selection.getBookmark():void 0,r,Wu(e)),Iu.empty,c,n.time,null==a?t.prevComposition:a)}(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput:function(t,e){var n=e.inputType,r="historyUndo"==n?Uu:"historyRedo"==n?Gu:null;return!!r&&(e.preventDefault(),r(t.state,t.dispatch))}}}})}function Ju(t,e){return function(n,r){var o=_u.getState(n);if(!o||0==(t?o.undone:o.done).eventCount)return!1;if(r){var i=function(t,e,n){var r=Wu(e),o=_u.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;var s=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),o,r),u=new Lu(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(s).setMeta(_u,{redo:n,historyState:u})}(o,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}var Uu=Ju(!1,!0),Gu=Ju(!0,!0),Qu=Ls.create({name:"history",addOptions:function(){return{depth:100,newGroupDelay:500}},addCommands:function(){return{undo:function(){return function(t){var e=t.state,n=t.dispatch;return Uu(e,n)}},redo:function(){return function(t){var e=t.state,n=t.dispatch;return Gu(e,n)}}}},addProseMirrorPlugins:function(){return[Ku(this.options)]},addKeyboardShortcuts:function(){var t=this;return{"Mod-z":function(){return t.editor.commands.undo()},"Shift-Mod-z":function(){return t.editor.commands.redo()},"Mod-y":function(){return t.editor.commands.redo()},"Mod-":function(){return t.editor.commands.undo()},"Shift-Mod-":function(){return t.editor.commands.redo()}}}}),Yu=Ta.create({name:"horizontalRule",addOptions:function(){return{HTMLAttributes:{}}},group:"block",parseHTML:function(){return[{tag:"hr"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["hr",ms(this.options.HTMLAttributes,e)]},addCommands:function(){var t=this;return{setHorizontalRule:function(){return function(e){var n=e.chain,r=e.state;if(!function(t,e){var n=t.selection,r=n.$from;if(n instanceof qe){var o=r.index();return r.parent.canReplaceWith(o,o+1,e)}for(var i=r.depth;i>=0;){var s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}(r,r.schema.nodes[t.name]))return!1;var o=r.selection,i=o.$from,s=o.$to,a=n();return 0===i.parentOffset?a.insertContentAt({from:Math.max(i.pos-1,0),to:s.pos},{type:t.name}):o instanceof qe?a.insertContentAt(s.pos,{type:t.name}):a.insertContent({type:t.name}),a.command(function(t){var e,n=t.tr;if(t.dispatch){var r=n.selection.$to,o=r.end();if(r.nodeAfter)r.nodeAfter.isTextblock?n.setSelection(We.create(n.doc,r.pos+1)):r.nodeAfter.isBlock?n.setSelection(qe.create(n.doc,r.pos)):n.setSelection(We.create(n.doc,r.pos));else{var i=null===(e=r.parent.type.contentMatch.defaultType)||void 0===e?void 0:e.create();i&&(n.insert(o,i),n.setSelection(We.create(n.doc,o+1)))}n.scrollIntoView()}return!0}).run()}}}},addInputRules:function(){return[(t={find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type},new As({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=ks(t.getAttributes,void 0,o)||{},s=n.tr,a=r.from,u=r.to,c=t.type.create(i);if(o[1]){var l=a+o[0].lastIndexOf(o[1]);l>u?l=u:u=l+o[1].length;var f=o[0][o[0].length-1];s.insertText(f,a+o[0].length-1),s.replaceWith(l,u,c)}else if(o[0]){var d=t.type.isInline?a:a-1;s.insert(d,t.type.create(i)).delete(s.mapping.map(a),s.mapping.map(u))}s.scrollIntoView()}}))];var t}}),Xu=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Zu=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,tc=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,ec=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,nc=Fs.create({name:"italic",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){var t=this;return[{tag:"em"},{tag:"i",getAttrs:function(t){return"normal"!==t.style.fontStyle&&null}},{style:"font-style=normal",clearMark:function(e){return e.type.name===t.name}},{style:"font-style=italic"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["em",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setItalic:function(){return function(e){return e.commands.setMark(t.name)}},toggleItalic:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetItalic:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-i":function(){return t.editor.commands.toggleItalic()},"Mod-I":function(){return t.editor.commands.toggleItalic()}}},addInputRules:function(){return[Sa({find:Xu,type:this.type}),Sa({find:tc,type:this.type})]},addPasteRules:function(){return[Fa({find:Zu,type:this.type}),Fa({find:ec,type:this.type})]}}),rc=Ta.create({name:"listItem",addOptions:function(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML:function(){return[{tag:"li"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["li",ms(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts:function(){var t=this;return{Enter:function(){return t.editor.commands.splitListItem(t.name)},Tab:function(){return t.editor.commands.sinkListItem(t.name)},"Shift-Tab":function(){return t.editor.commands.liftListItem(t.name)}}}}),oc="textStyle",ic=/^(\d+)\.\s$/,sc=Ta.create({name:"orderedList",addOptions:function(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content:function(){return"".concat(this.options.itemTypeName,"+")},addAttributes:function(){return{start:{default:1,parseHTML:function(t){return t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}},type:{default:null,parseHTML:function(t){return t.getAttribute("type")}}}},parseHTML:function(){return[{tag:"ol"}]},renderHTML:function(t){var r=t.HTMLAttributes,o=r.start,i=n(r,e);return 1===o?["ol",ms(this.options.HTMLAttributes,i),0]:["ol",ms(this.options.HTMLAttributes,r),0]},addCommands:function(){var t=this;return{toggleOrderedList:function(){return function(e){var n=e.commands,r=e.chain;return t.options.keepAttributes?r().toggleList(t.name,t.options.itemTypeName,t.options.keepMarks).updateAttributes("listItem",t.editor.getAttributes(oc)).run():n.toggleList(t.name,t.options.itemTypeName,t.options.keepMarks)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-7":function(){return t.editor.commands.toggleOrderedList()}}},addInputRules:function(){var t=this,e=Oa({find:ic,type:this.type,getAttributes:function(t){return{start:+t[1]}},joinPredicate:function(t,e){return e.childCount+e.attrs.start===+t[1]}});return(this.options.keepMarks||this.options.keepAttributes)&&(e=Oa({find:ic,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:function(e){return i({start:+e[1]},t.editor.getAttributes(oc))},joinPredicate:function(t,e){return e.childCount+e.attrs.start===+t[1]},editor:this.editor})),[e]}}),ac=Ta.create({name:"paragraph",priority:1e3,addOptions:function(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML:function(){return[{tag:"p"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["p",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setParagraph:function(){return function(e){return e.commands.setNode(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Alt-0":function(){return t.editor.commands.setParagraph()}}}}),uc=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cc=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,lc=Fs.create({name:"strike",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:function(t){return!!t.includes("line-through")&&{}}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["s",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setStrike:function(){return function(e){return e.commands.setMark(t.name)}},toggleStrike:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetStrike:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-s":function(){return t.editor.commands.toggleStrike()}}},addInputRules:function(){return[Sa({find:uc,type:this.type})]},addPasteRules:function(){return[Fa({find:cc,type:this.type})]}}),fc=Ta.create({name:"text",group:"inline"}),dc=Ls.create({name:"starterKit",addExtensions:function(){var t=[];return!1!==this.options.bold&&t.push(au.configure(this.options.bold)),!1!==this.options.blockquote&&t.push(nu.configure(this.options.blockquote)),!1!==this.options.bulletList&&t.push(lu.configure(this.options.bulletList)),!1!==this.options.code&&t.push(hu.configure(this.options.code)),!1!==this.options.codeBlock&&t.push(mu.configure(this.options.codeBlock)),!1!==this.options.document&&t.push(gu.configure(this.options.document)),!1!==this.options.dropcursor&&t.push(Du.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&t.push(Mu.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&t.push(Ou.configure(this.options.hardBreak)),!1!==this.options.heading&&t.push(Tu.configure(this.options.heading)),!1!==this.options.history&&t.push(Qu.configure(this.options.history)),!1!==this.options.horizontalRule&&t.push(Yu.configure(this.options.horizontalRule)),!1!==this.options.italic&&t.push(nc.configure(this.options.italic)),!1!==this.options.listItem&&t.push(rc.configure(this.options.listItem)),!1!==this.options.orderedList&&t.push(sc.configure(this.options.orderedList)),!1!==this.options.paragraph&&t.push(ac.configure(this.options.paragraph)),!1!==this.options.strike&&t.push(lc.configure(this.options.strike)),!1!==this.options.text&&t.push(fc.configure(this.options.text)),t}}),hc=Fs.create({name:"textStyle",priority:101,addOptions:function(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML:function(){var t=this;return[{tag:"span",getAttrs:function(e){return!!e.hasAttribute("style")&&(t.options.mergeNestedSpanStyles&&function(t){if(t.children.length){var e=t.querySelectorAll("span");e&&e.forEach(function(t){var e,n,r=t.getAttribute("style"),o=null===(n=null===(e=t.parentElement)||void 0===e?void 0:e.closest("span"))||void 0===n?void 0:n.getAttribute("style");t.setAttribute("style","".concat(o,";").concat(r))})}}(e),{})}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["span",ms(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{removeEmptyTextStyle:function(){return function(e){var n=e.tr,r=n.selection;return n.doc.nodesBetween(r.from,r.to,function(e,r){if(e.isTextblock)return!0;e.marks.filter(function(e){return e.type===t.type}).some(function(t){return Object.values(t.attrs).some(function(t){return!!t})})||n.removeMark(r,r+e.nodeSize,t.type)}),!0}}}}}),pc=Ls.create({name:"color",addOptions:function(){return{types:["textStyle"]}},addGlobalAttributes:function(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:function(t){var e;return null===(e=t.style.color)||void 0===e?void 0:e.replace(/['"]+/g,"")},renderHTML:function(t){return t.color?{style:"color: ".concat(t.color)}:{}}}}}]},addCommands:function(){return{setColor:function(t){return function(e){return(0,e.chain)().setMark("textStyle",{color:t}).run()}},unsetColor:function(){return function(t){return(0,t.chain)().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}}}),vc=Ls.create({name:"textAlign",addOptions:function(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes:function(){var t=this;return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:function(e){var n=e.style.textAlign;return t.options.alignments.includes(n)?n:t.options.defaultAlignment},renderHTML:function(t){return t.textAlign?{style:"text-align: ".concat(t.textAlign)}:{}}}}}]},addCommands:function(){var t=this;return{setTextAlign:function(e){return function(n){var r=n.commands;return!!t.options.alignments.includes(e)&&t.options.types.map(function(t){return r.updateAttributes(t,{textAlign:e})}).every(function(t){return t})}},unsetTextAlign:function(){return function(e){var n=e.commands;return t.options.types.map(function(t){return n.resetAttributes(t,"textAlign")}).every(function(t){return t})}},toggleTextAlign:function(e){return function(n){var r=n.editor,o=n.commands;return!!t.options.alignments.includes(e)&&(r.isActive({textAlign:e})?o.unsetTextAlign():o.setTextAlign(e))}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-l":function(){return t.editor.commands.setTextAlign("left")},"Mod-Shift-e":function(){return t.editor.commands.setTextAlign("center")},"Mod-Shift-r":function(){return t.editor.commands.setTextAlign("right")},"Mod-Shift-j":function(){return t.editor.commands.setTextAlign("justify")}}}}),mc=function(t,e){for(var n in e)t[n]=e[n];return t},gc="numeric",yc="ascii",kc="alpha",Dc="asciinumeric",bc="alphanumeric",wc="domain",Cc="emoji",xc="whitespace";function Ec(t,e){return t in e||(e[t]=[]),e[t]}function Ac(t,e,n){for(var r in e[gc]&&(e[Dc]=!0,e[bc]=!0),e[yc]&&(e[Dc]=!0,e[kc]=!0),e[Dc]&&(e[bc]=!0),e[kc]&&(e[bc]=!0),e[bc]&&(e[wc]=!0),e[Cc]&&(e[wc]=!0),e){var o=Ec(r,n);o.indexOf(t)<0&&o.push(t)}}function Sc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.j={},this.jr=[],this.jd=null,this.t=t}Sc.groups={},Sc.prototype={accepts:function(){return!!this.t},go:function(t){var e=this,n=e.j[t];if(n)return n;for(var r=0;r<e.jr.length;r++){var o=e.jr[r][0],i=e.jr[r][1];if(i&&o.test(t))return i}return e.jd},has:function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t in this.j:!!this.go(t)},ta:function(t,e,n,r){for(var o=0;o<t.length;o++)this.tt(t[o],e,n,r)},tr:function(t,e,n,r){var o;return r=r||Sc.groups,e&&e.j?o=e:(o=new Sc(e),n&&r&&Ac(e,n,r)),this.jr.push([t,o]),o},ts:function(t,e,n,r){var o=this,i=t.length;if(!i)return o;for(var s=0;s<i-1;s++)o=o.tt(t[s]);return o.tt(t[i-1],e,n,r)},tt:function(t,e,n,r){r=r||Sc.groups;var o=this;if(e&&e.j)return o.j[t]=e,e;var i,s=e,a=o.go(t);if(a?(i=new Sc,mc(i.j,a.j),i.jr.push.apply(i.jr,a.jr),i.jd=a.jd,i.t=a.t):i=new Sc,s){if(r)if(i.t&&"string"==typeof i.t){var u=mc(function(t,e){var n={};for(var r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}(i.t,r),n);Ac(s,u,r)}else n&&Ac(s,n,r);i.t=s}return o.j[t]=i,i}};var Mc=function(t,e,n,r,o){return t.ta(e,n,r,o)},Oc=function(t,e,n,r,o){return t.tr(e,n,r,o)},Tc=function(t,e,n,r,o){return t.ts(e,n,r,o)},Fc=function(t,e,n,r,o){return t.tt(e,n,r,o)},Nc="WORD",Bc="UWORD",Rc="ASCIINUMERICAL",Ic="ALPHANUMERICAL",Pc="LOCALHOST",Lc="TLD",zc="UTLD",jc="SCHEME",$c="SLASH_SCHEME",Vc="NUM",Hc="WS",Wc="NL",_c="OPENBRACE",qc="CLOSEBRACE",Kc="OPENBRACKET",Jc="CLOSEBRACKET",Uc="OPENPAREN",Gc="CLOSEPAREN",Qc="OPENANGLEBRACKET",Yc="CLOSEANGLEBRACKET",Xc="FULLWIDTHLEFTPAREN",Zc="FULLWIDTHRIGHTPAREN",tl="LEFTCORNERBRACKET",el="RIGHTCORNERBRACKET",nl="LEFTWHITECORNERBRACKET",rl="RIGHTWHITECORNERBRACKET",ol="FULLWIDTHLESSTHAN",il="FULLWIDTHGREATERTHAN",sl="AMPERSAND",al="APOSTROPHE",ul="ASTERISK",cl="AT",ll="BACKSLASH",fl="BACKTICK",dl="CARET",hl="COLON",pl="COMMA",vl="DOLLAR",ml="DOT",gl="EQUALS",yl="EXCLAMATION",kl="HYPHEN",Dl="PERCENT",bl="PIPE",wl="PLUS",Cl="POUND",xl="QUERY",El="QUOTE",Al="FULLWIDTHMIDDLEDOT",Sl="SEMI",Ml="SLASH",Ol="TILDE",Tl="UNDERSCORE",Fl="EMOJI",Nl="SYM",Bl=Object.freeze({__proto__:null,ALPHANUMERICAL:Ic,AMPERSAND:sl,APOSTROPHE:al,ASCIINUMERICAL:Rc,ASTERISK:ul,AT:cl,BACKSLASH:ll,BACKTICK:fl,CARET:dl,CLOSEANGLEBRACKET:Yc,CLOSEBRACE:qc,CLOSEBRACKET:Jc,CLOSEPAREN:Gc,COLON:hl,COMMA:pl,DOLLAR:vl,DOT:ml,EMOJI:Fl,EQUALS:gl,EXCLAMATION:yl,FULLWIDTHGREATERTHAN:il,FULLWIDTHLEFTPAREN:Xc,FULLWIDTHLESSTHAN:ol,FULLWIDTHMIDDLEDOT:Al,FULLWIDTHRIGHTPAREN:Zc,HYPHEN:kl,LEFTCORNERBRACKET:tl,LEFTWHITECORNERBRACKET:nl,LOCALHOST:Pc,NL:Wc,NUM:Vc,OPENANGLEBRACKET:Qc,OPENBRACE:_c,OPENBRACKET:Kc,OPENPAREN:Uc,PERCENT:Dl,PIPE:bl,PLUS:wl,POUND:Cl,QUERY:xl,QUOTE:El,RIGHTCORNERBRACKET:el,RIGHTWHITECORNERBRACKET:rl,SCHEME:jc,SEMI:Sl,SLASH:Ml,SLASH_SCHEME:$c,SYM:Nl,TILDE:Ol,TLD:Lc,UNDERSCORE:Tl,UTLD:zc,UWORD:Bc,WORD:Nc,WS:Hc}),Rl=/[a-z]/,Il=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088F\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5C\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDC-\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7DC\uA7F1-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD40-\uDD59\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC7\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDB0-\uDDDB\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDEA0-\uDEB8\uDEBB-\uDED3\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF2\uDFF3]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDEC0-\uDEDE\uDEE0-\uDEE2\uDEE4\uDEE5\uDEE7-\uDEED\uDEF0-\uDEF4\uDEFE\uDEFF\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])/,Pl=/(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED8\uDEDC-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE7C\uDE80-\uDE8A\uDE8E-\uDEC6\uDEC8\uDECD-\uDEDC\uDEDF-\uDEEA\uDEEF-\uDEF8])/,Ll=/\d/,zl=/\s/,jl=null,$l=null;function Vl(t,e){for(var n=function(t){var e=[],n=t.length,r=0;for(;r<n;){var o=t.charCodeAt(r),i=void 0,s=o<55296||o>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(s),r+=s.length}return e}(e.replace(/[A-Z]/g,function(t){return t.toLowerCase()})),r=n.length,o=[],i=0,s=0;s<r;){for(var a=t,u=null,c=0,l=null,f=-1,d=-1;s<r&&(u=a.go(n[s]));)(a=u).accepts()?(f=0,d=0,l=a):f>=0&&(f+=n[s].length,d++),c+=n[s].length,i+=n[s].length,s++;i-=f,s-=d,c-=f,o.push({t:l.t,v:e.slice(i-c,i),s:i-c,e:i})}return o}function Hl(t,e,n,r,o){for(var i,s=e.length,a=0;a<s-1;a++){var u=e[a];t.j[u]?i=t.j[u]:((i=new Sc(r)).jr=o.slice(),t.j[u]=i),t=i}return(i=new Sc(n)).jr=o.slice(),t.j[e[s-1]]=i,i}function Wl(t){for(var e=[],n=[],r=0;r<t.length;){for(var o=0;"0123456789".indexOf(t[r+o])>=0;)o++;if(o>0){e.push(n.join(""));for(var i=parseInt(t.substring(r,r+o),10);i>0;i--)n.pop();r+=o}else n.push(t[r]),r++}return e}var _l={defaultProtocol:"http",events:null,format:Kl,formatHref:Kl,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function ql(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=mc({},_l);t&&(n=mc(n,t instanceof ql?t.o:t));for(var r=n.ignoreTags,o=[],i=0;i<r.length;i++)o.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=o}function Kl(t){return t}function Jl(t,e){this.t="token",this.v=t,this.tk=e}function Ul(t,e){var n=function(e){function n(e,r){var o;return D(this,n),(o=h(this,n,[e,r])).t=t,o}return p(n,e),w(n)}(Jl);for(var r in e)n.prototype[r]=e[r];return n.t=t,n}ql.prototype={o:_l,ignoreTags:[],defaultRender:function(t){return t},check:function(t){return this.get("validate",t.toString(),t)},get:function(t,e,n){var r=null!=e,o=this.o[t];return o?("object"===k(o)?"function"==typeof(o=n.t in o?o[n.t]:_l[t])&&r&&(o=o(e,n)):"function"==typeof o&&r&&(o=o(e,n.t,n)),o):o},getObj:function(t,e,n){var r=this.o[t];return"function"==typeof r&&null!=e&&(r=r(e,n.t,n)),r},render:function(t){var e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}},Jl.prototype={isLink:!1,toString:function(){return this.v},toHref:function(t){return this.toString()},toFormattedString:function(t){var e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref:function(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex:function(){return this.tk[0].s},endIndex:function(){return this.tk[this.tk.length-1].e},toObject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_l.defaultProtocol;return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject:function(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate:function(t){return t.get("validate",this.toString(),this)},render:function(t){var e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),o=t.get("tagName",n,e),i=this.toFormattedString(t),s={},a=t.get("className",n,e),u=t.get("target",n,e),c=t.get("rel",n,e),l=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return s.href=r,a&&(s.class=a),u&&(s.target=u),c&&(s.rel=c),l&&mc(s,l),{tagName:o,attributes:s,content:i,eventListeners:f}}};var Gl=Ul("email",{isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Ql=Ul("text"),Yl=Ul("nl"),Xl=Ul("url",{isLink:!0,toHref:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_l.defaultProtocol;return this.hasProtocol()?this.v:"".concat(t,"://").concat(this.v)},hasProtocol:function(){var t=this.tk;return t.length>=2&&t[0].t!==Pc&&t[1].t===hl}}),Zl=function(t){return new Sc(t)};function tf(t,e,n){var r=n[0].s,o=n[n.length-1].e;return new t(e.slice(r,o),n)}var ef="undefined"!=typeof console&&console&&console.warn||function(){},nf={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function rf(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(nf.initialized&&ef('linkifyjs: already initialized - will not register custom scheme "'.concat(t,'" ').concat("until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.")),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');nf.customSchemes.push([t,e])}function of(){nf.scanner=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e={};Sc.groups=e;var n=new Sc;null==jl&&(jl=Wl("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==$l&&($l=Wl("121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222")),Fc(n,"'",al),Fc(n,"{",_c),Fc(n,"}",qc),Fc(n,"[",Kc),Fc(n,"]",Jc),Fc(n,"(",Uc),Fc(n,")",Gc),Fc(n,"<",Qc),Fc(n,">",Yc),Fc(n,"",Xc),Fc(n,"",Zc),Fc(n,"",tl),Fc(n,"",el),Fc(n,"",nl),Fc(n,"",rl),Fc(n,"",ol),Fc(n,"",il),Fc(n,"&",sl),Fc(n,"*",ul),Fc(n,"@",cl),Fc(n,"`",fl),Fc(n,"^",dl),Fc(n,":",hl),Fc(n,",",pl),Fc(n,"$",vl),Fc(n,".",ml),Fc(n,"=",gl),Fc(n,"!",yl),Fc(n,"-",kl),Fc(n,"%",Dl),Fc(n,"|",bl),Fc(n,"+",wl),Fc(n,"#",Cl),Fc(n,"?",xl),Fc(n,'"',El),Fc(n,"/",Ml),Fc(n,";",Sl),Fc(n,"~",Ol),Fc(n,"_",Tl),Fc(n,"\\",ll),Fc(n,"",Al);var r=Oc(n,Ll,Vc,s({},gc,!0));Oc(r,Ll,r);var o=Oc(r,Rl,Rc,s({},Dc,!0)),i=Oc(r,Il,Ic,s({},bc,!0)),a=Oc(n,Rl,Nc,s({},yc,!0));Oc(a,Ll,o),Oc(a,Rl,a),Oc(o,Ll,o),Oc(o,Rl,o);var u=Oc(n,Il,Bc,s({},kc,!0));Oc(u,Rl),Oc(u,Ll,i),Oc(u,Il,u),Oc(i,Ll,i),Oc(i,Rl),Oc(i,Il,i);var c=Fc(n,"\n",Wc,s({},xc,!0)),l=Fc(n,"\r",Hc,s({},xc,!0)),f=Oc(n,zl,Hc,s({},xc,!0));Fc(n,"",f),Fc(l,"\n",c),Fc(l,"",f),Oc(l,zl,f),Fc(f,"\r"),Fc(f,"\n"),Oc(f,zl,f),Fc(f,"",f);var d=Oc(n,Pl,Fl,s({},Cc,!0));Fc(d,"#"),Oc(d,Pl,d),Fc(d,"",d);var h=Fc(d,"");Fc(h,"#"),Oc(h,Pl,d);for(var p=[[Rl,a],[Ll,o]],v=[[Rl,null],[Il,u],[Ll,i]],m=0;m<jl.length;m++)Hl(n,jl[m],Lc,Nc,p);for(var g=0;g<$l.length;g++)Hl(n,$l[g],zc,Bc,v);Ac(Lc,{tld:!0,ascii:!0},e),Ac(zc,{utld:!0,alpha:!0},e),Hl(n,"file",jc,Nc,p),Hl(n,"mailto",jc,Nc,p),Hl(n,"http",$c,Nc,p),Hl(n,"https",$c,Nc,p),Hl(n,"ftp",$c,Nc,p),Hl(n,"ftps",$c,Nc,p),Ac(jc,{scheme:!0,ascii:!0},e),Ac($c,{slashscheme:!0,ascii:!0},e),t=t.sort(function(t,e){return t[0]>e[0]?1:-1});for(var y=0;y<t.length;y++){var k=t[y][0],D=s({},t[y][1]?"scheme":"slashscheme",!0);k.indexOf("-")>=0?D[wc]=!0:Rl.test(k)?Ll.test(k)?D[Dc]=!0:D[yc]=!0:D[gc]=!0,Tc(n,k,k,D)}return Tc(n,"localhost",Pc,{ascii:!0}),n.jd=new Sc(Nl),{start:n,tokens:mc({groups:e},Bl)}}(nf.customSchemes);for(var t=0;t<nf.tokenQueue.length;t++)nf.tokenQueue[t][1]({scanner:nf.scanner});nf.parser=function(t){var e=t.groups,n=e.domain.concat([sl,ul,cl,ll,fl,dl,vl,gl,kl,Vc,Dl,bl,wl,Cl,Ml,Nl,Ol,Tl]),r=[al,hl,pl,ml,yl,Dl,xl,El,Sl,Qc,Yc,_c,qc,Jc,Kc,Uc,Gc,Xc,Zc,tl,el,nl,rl,ol,il],o=[sl,al,ul,ll,fl,dl,vl,gl,kl,_c,qc,Dl,bl,wl,Cl,xl,Ml,Nl,Ol,Tl],i=Zl(),s=Fc(i,Ol);Mc(s,o,s),Mc(s,e.domain,s);var u=Zl(),c=Zl(),l=Zl();Mc(i,e.domain,u),Mc(i,e.scheme,c),Mc(i,e.slashscheme,l),Mc(u,o,s),Mc(u,e.domain,u);var f=Fc(u,cl);Fc(s,cl,f),Fc(c,cl,f),Fc(l,cl,f);var d=Fc(s,ml);Mc(d,o,s),Mc(d,e.domain,s);var h=Zl();Mc(f,e.domain,h),Mc(h,e.domain,h);var p=Fc(h,ml);Mc(p,e.domain,h);var v=Zl(Gl);Mc(p,e.tld,v),Mc(p,e.utld,v),Fc(f,Pc,v);var m=Fc(h,kl);Fc(m,kl,m),Mc(m,e.domain,h),Mc(v,e.domain,h),Fc(v,ml,p),Fc(v,kl,m);var g=Fc(v,hl);Mc(g,e.numeric,Gl);var y=Fc(u,kl),k=Fc(u,ml);Fc(y,kl,y),Mc(y,e.domain,u),Mc(k,o,s),Mc(k,e.domain,u);var D=Zl(Xl);Mc(k,e.tld,D),Mc(k,e.utld,D),Mc(D,e.domain,u),Mc(D,o,s),Fc(D,ml,k),Fc(D,kl,y),Fc(D,cl,f);var b=Fc(D,hl),w=Zl(Xl);Mc(b,e.numeric,w);var C=Zl(Xl),x=Zl();Mc(C,n,C),Mc(C,r,x),Mc(x,n,C),Mc(x,r,x),Fc(D,Ml,C),Fc(w,Ml,C);var E=Fc(c,hl),A=Fc(l,hl),S=Fc(A,Ml),M=Fc(S,Ml);Mc(c,e.domain,u),Fc(c,ml,k),Fc(c,kl,y),Mc(l,e.domain,u),Fc(l,ml,k),Fc(l,kl,y),Mc(E,e.domain,C),Fc(E,Ml,C),Fc(E,xl,C),Mc(M,e.domain,C),Mc(M,n,C),Fc(M,Ml,C);for(var O=[[_c,qc],[Kc,Jc],[Uc,Gc],[Qc,Yc],[Xc,Zc],[tl,el],[nl,rl],[ol,il]],T=0;T<O.length;T++){var F=a(O[T],2),N=F[0],B=F[1],R=Fc(C,N);Fc(x,N,R),Fc(R,B,C);var I=Zl(Xl);Mc(R,n,I);var P=Zl();Mc(R,r),Mc(I,n,I),Mc(I,r,P),Mc(P,n,I),Mc(P,r,P),Fc(I,B,C),Fc(P,B,C)}return Fc(i,Pc,D),Fc(i,Wc,Yl),{start:i,tokens:Bl}}(nf.scanner.tokens);for(var e=0;e<nf.pluginQueue.length;e++)nf.pluginQueue[e][1]({scanner:nf.scanner,parser:nf.parser});return nf.initialized=!0,nf}function sf(t){return nf.initialized||of(),function(t,e,n){for(var r=n.length,o=0,i=[],s=[];o<r;){for(var a=t,u=null,c=null,l=0,f=null,d=-1;o<r&&!(u=a.go(n[o].t));)s.push(n[o++]);for(;o<r&&(c=u||a.go(n[o].t));)u=null,(a=c).accepts()?(d=0,f=a):d>=0&&d++,o++,l++;if(d<0)(o-=l)<r&&(s.push(n[o]),o++);else{s.length>0&&(i.push(tf(Ql,e,s)),s=[]),o-=d,l-=d;var h=f.t,p=n.slice(o-l,o);i.push(tf(h,e,p))}}return s.length>0&&i.push(tf(Ql,e,s)),i}(nf.parser.start,t,Vl(nf.scanner.start,t))}function af(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&"object"===k(e)){if(n)throw Error("linkifyjs: Invalid link type ".concat(e,"; must be a string"));n=e,e=null}for(var r=new ql(n),o=sf(t),i=[],s=0;s<o.length;s++){var a=o[s];!a.isLink||e&&a.t!==e||!r.check(a)||i.push(a.toFormattedObject(r))}return i}function uf(t){return new on({key:new un("autolink"),appendTransaction:function(e,n,o){var s=e.some(function(t){return t.docChanged})&&!n.doc.eq(o.doc),a=e.some(function(t){return t.getMeta("preventAutolink")});if(s&&!a){var u=o.tr,c=function(t,e){var n=new Le(t);return e.forEach(function(t){t.steps.forEach(function(t){n.step(t)})}),n}(n.doc,r(e)),l=function(t){var e=t.mapping,n=t.steps,r=[];return e.maps.forEach(function(t,o){var i=[];if(t.ranges.length)t.forEach(function(t,e){i.push({from:t,to:e})});else{var s=n[o],a=s.from,u=s.to;if(void 0===a||void 0===u)return;i.push({from:a,to:u})}i.forEach(function(t){var n=t.from,i=t.to,s=e.slice(o).map(n,-1),a=e.slice(o).map(i),u=e.invert().map(s,-1),c=e.invert().map(a);r.push({oldRange:{from:u,to:c},newRange:{from:s,to:a}})})}),aa(r)}(c);if(l.forEach(function(e){var n,r,s,a,c,l,f,d=e.newRange,h=(n=o.doc,r=d,s=function(t){return t.isTextblock},a=[],n.nodesBetween(r.from,r.to,function(t,e){s(t)&&a.push({node:t,pos:e})}),a);if(h.length>1?(c=h[0],l=o.doc.textBetween(c.pos,c.pos+c.node.nodeSize,void 0," ")):h.length&&o.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(c=h[0],l=o.doc.textBetween(c.pos,d.to,void 0," ")),c&&l){var p=l.split(" ").filter(function(t){return""!==t});if(p.length<=0)return!1;var v=p[p.length-1],m=c.pos+l.lastIndexOf(v);if(!v)return!1;var g=sf(v).map(function(e){return e.toObject(t.defaultProtocol)});if(!(1===(f=g).length?f[0].isLink:3===f.length&&f[1].isLink&&["()","[]"].includes(f[0].value+f[2].value)))return!1;g.filter(function(t){return t.isLink}).map(function(t){return i(i({},t),{},{from:m+t.start+1,to:m+t.end+1})}).filter(function(t){return!o.schema.marks.code||!o.doc.rangeHasMark(t.from,t.to,o.schema.marks.code)}).filter(function(e){return t.validate(e.value)}).filter(function(e){return t.shouldAutoLink(e.value)}).forEach(function(e){ua(e.from,e.to,o.doc).some(function(e){return e.mark.type===t.type})||u.addMark(e.from,e.to,t.type.create({href:e.href}))})}}),u.steps.length)return u}}})}sf.scan=Vl;var cf=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function lf(t,e){var n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(function(t){var e="string"==typeof t?t:t.scheme;e&&n.push(e)}),!t||t.replace(cf,"").match(new RegExp("^(?:(?:".concat(n.join("|"),"):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))"),"i"))}var ff=Fs.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate:function(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(function(t){"string"!=typeof t?rf(t.scheme,t.optionalSlashes):rf(t)})},onDestroy:function(){Sc.groups={},nf.scanner=null,nf.parser=null,nf.tokenQueue=[],nf.pluginQueue=[],nf.customSchemes=[],nf.initialized=!1},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:function(t,e){return!!lf(t,e.protocols)},validate:function(t){return!!t},shouldAutoLink:function(t){return!!t}}},addAttributes:function(){return{href:{default:null,parseHTML:function(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){var t=this;return[{tag:"a[href]",getAttrs:function(e){var n=e.getAttribute("href");return!(!n||!t.options.isAllowedUri(n,{defaultValidate:function(e){return!!lf(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol}))&&null}}]},renderHTML:function(t){var e=this,n=t.HTMLAttributes;return this.options.isAllowedUri(n.href,{defaultValidate:function(t){return!!lf(t,e.options.protocols)},protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ms(this.options.HTMLAttributes,n),0]:["a",ms(this.options.HTMLAttributes,i(i({},n),{},{href:""})),0]},addCommands:function(){var t=this;return{setLink:function(e){return function(n){var r=n.chain,o=e.href;return!!t.options.isAllowedUri(o,{defaultValidate:function(e){return!!lf(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol})&&r().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(n){var r=n.chain,o=e.href;return!!t.options.isAllowedUri(o,{defaultValidate:function(e){return!!lf(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol})&&r().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[Fa({find:function(e){var n=[];if(e){var r=t.options,o=r.protocols,i=r.defaultProtocol,s=af(e).filter(function(e){return e.isLink&&t.options.isAllowedUri(e.value,{defaultValidate:function(t){return!!lf(t,o)},protocols:o,defaultProtocol:i})});s.length&&s.forEach(function(t){return n.push({text:t.value,data:{href:t.href},index:t.start})})}return n},type:this.type,getAttributes:function(t){var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=this,n=[],r=this.options,o=r.protocols,i=r.defaultProtocol;return this.options.autolink&&n.push(uf({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:function(t){return e.options.isAllowedUri(t,{defaultValidate:function(t){return!!lf(t,o)},protocols:o,defaultProtocol:i})},shouldAutoLink:this.options.shouldAutoLink})),!0===this.options.openOnClick&&n.push((t={type:this.type},new on({key:new un("handleClickLink"),props:{handleClick:function(e,n,r){var o,i;if(0!==r.button)return!1;if(!e.editable)return!1;for(var s=r.target,a=[];"DIV"!==s.nodeName;)a.push(s),s=s.parentNode;if(!a.find(function(t){return"A"===t.nodeName}))return!1;var u=sa(e.state,t.type.name),c=r.target,l=null!==(o=null==c?void 0:c.href)&&void 0!==o?o:u.href,f=null!==(i=null==c?void 0:c.target)&&void 0!==i?i:u.target;return!(!c||!l||(window.open(l,f),0))}}}))),this.options.linkOnPaste&&n.push(function(t){return new on({key:new un("handlePasteLink"),props:{handlePaste:function(e,n,r){if(e.state.selection.empty)return!1;var o="";r.content.forEach(function(t){o+=t.textContent});var i=af(o,{defaultProtocol:t.defaultProtocol}).find(function(t){return t.isLink&&t.value===o});return!(!o||!i)&&t.editor.commands.setMark(t.type,{href:i.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),n}});o("R",d.forwardRef(function(t,e){var n=t.content,r=void 0===n?"":n,o=t.onChange,i=t.placeholder,s=void 0===i?"Start typing...":i,u=t.className,c=t.editable,l=void 0===c||c,f=a(d.useState(!1),2),h=f[0],p=f[1],v=a(d.useState(r),2),m=v[0],k=v[1],D=Za({extensions:[dc,hc,pc,vc.configure({types:["heading","paragraph"]}),ff.configure({openOnClick:!1})],content:r,editable:l,onUpdate:function(t){var e=t.editor;h||null==o||o(e.getHTML())}});if(d.useImperativeHandle(e,function(){return{getContent:function(){return(null==D?void 0:D.getHTML())||""},setContent:function(t){return null==D?void 0:D.commands.setContent(t)},focus:function(){return null==D?void 0:D.commands.focus()}}}),!D)return null;return g.jsxs("div",{className:y("border rounded-lg overflow-hidden",u),children:[l&&g.jsxs("div",{className:"border-b p-2 flex flex-wrap gap-1 bg-muted/50",children:[g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleBold().run()},className:D.isActive("bold")?"bg-muted":"",children:g.jsx(x,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleItalic().run()},className:D.isActive("italic")?"bg-muted":"",children:g.jsx(E,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleStrike().run()},className:D.isActive("strike")?"bg-muted":"",children:g.jsx(A,{className:"h-4 w-4"})}),g.jsx(C,{orientation:"vertical",className:"h-6"}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().setTextAlign("left").run()},className:D.isActive({textAlign:"left"})?"bg-muted":"",children:g.jsx(S,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().setTextAlign("center").run()},className:D.isActive({textAlign:"center"})?"bg-muted":"",children:g.jsx(M,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().setTextAlign("right").run()},className:D.isActive({textAlign:"right"})?"bg-muted":"",children:g.jsx(O,{className:"h-4 w-4"})}),g.jsx(C,{orientation:"vertical",className:"h-6"}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleBulletList().run()},className:D.isActive("bulletList")?"bg-muted":"",children:g.jsx(R,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleOrderedList().run()},className:D.isActive("orderedList")?"bg-muted":"",children:g.jsx(T,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().toggleBlockquote().run()},className:D.isActive("blockquote")?"bg-muted":"",children:g.jsx(I,{className:"h-4 w-4"})}),g.jsx(C,{orientation:"vertical",className:"h-6"}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){var t=window.prompt("Enter URL:");t&&D.chain().focus().setLink({href:t}).run()},children:g.jsx(P,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().unsetLink().run()},disabled:!D.isActive("link"),children:g.jsx(F,{className:"h-4 w-4"})}),g.jsx(C,{orientation:"vertical",className:"h-6"}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().undo().run()},disabled:!D.can().undo(),children:g.jsx(N,{className:"h-4 w-4"})}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){return D.chain().focus().redo().run()},disabled:!D.can().redo(),children:g.jsx(B,{className:"h-4 w-4"})}),g.jsx(C,{orientation:"vertical",className:"h-6"}),g.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:function(){if(h)null==D||D.commands.setContent(m,!1),null==o||o(m),p(!1);else{var t=r||(null==D?void 0:D.getHTML())||"";k(t),p(!0)}},className:h?"bg-muted":"",children:g.jsx(L,{className:"h-4 w-4"})})]}),h?g.jsx("textarea",{value:m,onChange:function(t){var e=t.target.value;k(e),null==o||o(e)},className:"w-full p-4 min-h-[200px] font-mono text-sm border-0 resize-none focus:outline-none bg-gray-50",placeholder:"Enter HTML content..."}):g.jsx(Ha,{editor:D,className:"prose prose-sm max-w-none p-4 min-h-[200px] focus-within:outline-none",placeholder:s})]})})).displayName="RichTextEditor"}}})}();
